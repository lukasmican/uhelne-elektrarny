(self.webpackChunkhvt_uhelne_elektrarny=self.webpackChunkhvt_uhelne_elektrarny||[]).push([[179],{738:(Ed,Xl,Yl)=>{"use strict";function hn(e){return"function"==typeof e}function Bc(e){const t=e(r=>{Error.call(r),r.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const Md=Bc(e=>function(t){e(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((r,a)=>`${a+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function g(e,n){if(e){const t=e.indexOf(n);0<=t&&e.splice(t,1)}}class On{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const u of t)u.remove(this);else t.remove(this);const{initialTeardown:r}=this;if(hn(r))try{r()}catch(u){n=u instanceof Md?u.errors:[u]}const{_finalizers:a}=this;if(a){this._finalizers=null;for(const u of a)try{Gr(u)}catch(p){n=n??[],p instanceof Md?n=[...n,...p.errors]:n.push(p)}}if(n)throw new Md(n)}}add(n){var t;if(n&&n!==this)if(this.closed)Gr(n);else{if(n instanceof On){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(n)}}_hasParent(n){const{_parentage:t}=this;return t===n||Array.isArray(t)&&t.includes(n)}_addParent(n){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n}_removeParent(n){const{_parentage:t}=this;t===n?this._parentage=null:Array.isArray(t)&&g(t,n)}remove(n){const{_finalizers:t}=this;t&&g(t,n),n instanceof On&&n._removeParent(this)}}On.EMPTY=(()=>{const e=new On;return e.closed=!0,e})();const ye=On.EMPTY;function ji(e){return e instanceof On||e&&"closed"in e&&hn(e.remove)&&hn(e.add)&&hn(e.unsubscribe)}function Gr(e){hn(e)?e():e.unsubscribe()}const tt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},To={setTimeout(e,n,...t){const{delegate:r}=To;return r?.setTimeout?r.setTimeout(e,n,...t):setTimeout(e,n,...t)},clearTimeout(e){const{delegate:n}=To;return(n?.clearTimeout||clearTimeout)(e)},delegate:void 0};function fa(e){To.setTimeout(()=>{const{onUnhandledError:n}=tt;if(!n)throw e;n(e)})}function Jo(){}const Zr=lo("C",void 0,void 0);function lo(e,n,t){return{kind:e,value:n,error:t}}let $i=null;function Ao(e){if(tt.useDeprecatedSynchronousErrorHandling){const n=!$i;if(n&&($i={errorThrown:!1,error:null}),e(),n){const{errorThrown:t,error:r}=$i;if($i=null,t)throw r}}else e()}class Ms extends On{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,ji(n)&&n.add(this)):this.destination=gi}static create(n,t,r){return new uo(n,t,r)}next(n){this.isStopped?xr(function Kl(e){return lo("N",e,void 0)}(n),this):this._next(n)}error(n){this.isStopped?xr(function Yn(e){return lo("E",void 0,e)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?xr(Zr,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const vr=Function.prototype.bind;function ma(e,n){return vr.call(e,n)}class In{constructor(n){this.partialObserver=n}next(n){const{partialObserver:t}=this;if(t.next)try{t.next(n)}catch(r){ai(r)}}error(n){const{partialObserver:t}=this;if(t.error)try{t.error(n)}catch(r){ai(r)}else ai(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(t){ai(t)}}}class uo extends Ms{constructor(n,t,r){let a;if(super(),hn(n)||!n)a={next:n??void 0,error:t??void 0,complete:r??void 0};else{let u;this&&tt.useDeprecatedNextContext?(u=Object.create(n),u.unsubscribe=()=>this.unsubscribe(),a={next:n.next&&ma(n.next,u),error:n.error&&ma(n.error,u),complete:n.complete&&ma(n.complete,u)}):a=n}this.destination=new In(a)}}function ai(e){tt.useDeprecatedSynchronousErrorHandling?function co(e){tt.useDeprecatedSynchronousErrorHandling&&$i&&($i.errorThrown=!0,$i.error=e)}(e):fa(e)}function xr(e,n){const{onStoppedNotification:t}=tt;t&&To.setTimeout(()=>t(e,n))}const gi={closed:!0,next:Jo,error:function es(e){throw e},complete:Jo},Ui="function"==typeof Symbol&&Symbol.observable||"@@observable";function ir(e){return e}function ga(e){return 0===e.length?ir:1===e.length?e[0]:function(t){return e.reduce((r,a)=>a(r),t)}}let Bn=(()=>{class e{constructor(t){t&&(this._subscribe=t)}lift(t){const r=new e;return r.source=this,r.operator=t,r}subscribe(t,r,a){const u=function yn(e){return e&&e instanceof Ms||function ho(e){return e&&hn(e.next)&&hn(e.error)&&hn(e.complete)}(e)&&ji(e)}(t)?t:new uo(t,r,a);return Ao(()=>{const{operator:p,source:b}=this;u.add(p?p.call(u,b):b?this._subscribe(u):this._trySubscribe(u))}),u}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return new(r=ya(r))((a,u)=>{const p=new uo({next:b=>{try{t(b)}catch(w){u(w),p.unsubscribe()}},error:u,complete:a});this.subscribe(p)})}_subscribe(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)}[Ui](){return this}pipe(...t){return ga(t)(this)}toPromise(t){return new(t=ya(t))((r,a)=>{let u;this.subscribe(p=>u=p,p=>a(p),()=>r(u))})}}return e.create=n=>new e(n),e})();function ya(e){var n;return null!==(n=e??tt.Promise)&&void 0!==n?n:Promise}const li=Bc(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let dr=(()=>{class e extends Bn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const r=new As(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new li}next(t){Ao(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(t)}})}error(t){Ao(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){Ao(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:r,isStopped:a,observers:u}=this;return r||a?ye:(this.currentObservers=null,u.push(t),new On(()=>{this.currentObservers=null,g(u,t)}))}_checkFinalizedStatuses(t){const{hasError:r,thrownError:a,isStopped:u}=this;r?t.error(a):u&&t.complete()}asObservable(){const t=new Bn;return t.source=this,t}}return e.create=(n,t)=>new As(n,t),e})();class As extends dr{constructor(n,t){super(),this.destination=n,this.source=t}next(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,n)}error(n){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,n)}complete(){var n,t;null===(t=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===t||t.call(n)}_subscribe(n){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(n))&&void 0!==r?r:ye}}function Ps(e){return hn(e?.lift)}function _n(e){return n=>{if(Ps(n))return n.lift(function(t){try{return e(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function an(e,n,t,r,a){return new Si(e,n,t,r,a)}class Si extends Ms{constructor(n,t,r,a,u,p){super(n),this.onFinalize=u,this.shouldUnsubscribe=p,this._next=t?function(b){try{t(b)}catch(w){n.error(w)}}:super._next,this._error=a?function(b){try{a(b)}catch(w){n.error(w)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(b){n.error(b)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function rn(e,n){return _n((t,r)=>{let a=0;t.subscribe(an(r,u=>{r.next(e.call(n,u,a++))}))})}function Pe(e){return this instanceof Pe?(this.v=e,this):new Pe(e)}function rs(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function qi(e){var n="function"==typeof Symbol&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(u){t[u]=e[u]&&function(p){return new Promise(function(b,w){!function a(u,p,b,w){Promise.resolve(w).then(function(M){u({value:M,done:b})},p)}(b,w,(p=e[u](p)).done,p.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const U=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function K(e){return hn(e?.then)}function J(e){return hn(e[Ui])}function ue(e){return Symbol.asyncIterator&&hn(e?.[Symbol.asyncIterator])}function oe(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const le=function ne(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function xe(e){return hn(e?.[le])}function we(e){return function Gi(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a,r=t.apply(e,n||[]),u=[];return a={},p("next"),p("throw"),p("return"),a[Symbol.asyncIterator]=function(){return this},a;function p(W){r[W]&&(a[W]=function(re){return new Promise(function(pe,ve){u.push([W,re,pe,ve])>1||b(W,re)})})}function b(W,re){try{!function w(W){W.value instanceof Pe?Promise.resolve(W.value.v).then(M,R):B(u[0][2],W)}(r[W](re))}catch(pe){B(u[0][3],pe)}}function M(W){b("next",W)}function R(W){b("throw",W)}function B(W,re){W(re),u.shift(),u.length&&b(u[0][0],u[0][1])}}(this,arguments,function*(){const t=e.getReader();try{for(;;){const{value:r,done:a}=yield Pe(t.read());if(a)return yield Pe(void 0);yield yield Pe(r)}}finally{t.releaseLock()}})}function Se(e){return hn(e?.getReader)}function Ze(e){if(e instanceof Bn)return e;if(null!=e){if(J(e))return function lt(e){return new Bn(n=>{const t=e[Ui]();if(hn(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(U(e))return function Ye(e){return new Bn(n=>{for(let t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}(e);if(K(e))return function nt(e){return new Bn(n=>{e.then(t=>{n.closed||(n.next(t),n.complete())},t=>n.error(t)).then(null,fa)})}(e);if(ue(e))return Gt(e);if(xe(e))return function mt(e){return new Bn(n=>{for(const t of e)if(n.next(t),n.closed)return;n.complete()})}(e);if(Se(e))return function cn(e){return Gt(we(e))}(e)}throw oe(e)}function Gt(e){return new Bn(n=>{(function jt(e,n){var t,r,a,u;return function ln(e,n,t,r){return new(t||(t=Promise))(function(u,p){function b(R){try{M(r.next(R))}catch(B){p(B)}}function w(R){try{M(r.throw(R))}catch(B){p(B)}}function M(R){R.done?u(R.value):function a(u){return u instanceof t?u:new t(function(p){p(u)})}(R.value).then(b,w)}M((r=r.apply(e,n||[])).next())})}(this,void 0,void 0,function*(){try{for(t=rs(e);!(r=yield t.next()).done;)if(n.next(r.value),n.closed)return}catch(p){a={error:p}}finally{try{r&&!r.done&&(u=t.return)&&(yield u.call(t))}finally{if(a)throw a.error}}n.complete()})})(e,n).catch(t=>n.error(t))})}function Dt(e,n,t,r=0,a=!1){const u=n.schedule(function(){t(),a?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(u),!a)return u}function Et(e,n,t=1/0){return hn(n)?Et((r,a)=>rn((u,p)=>n(r,u,a,p))(Ze(e(r,a))),t):("number"==typeof n&&(t=n),_n((r,a)=>function kr(e,n,t,r,a,u,p,b){const w=[];let M=0,R=0,B=!1;const W=()=>{B&&!w.length&&!M&&n.complete()},re=ve=>M<r?pe(ve):w.push(ve),pe=ve=>{u&&n.next(ve),M++;let Ae=!1;Ze(t(ve,R++)).subscribe(an(n,Be=>{a?.(Be),u?re(Be):n.next(Be)},()=>{Ae=!0},void 0,()=>{if(Ae)try{for(M--;w.length&&M<r;){const Be=w.shift();p?Dt(n,p,()=>pe(Be)):pe(Be)}W()}catch(Be){n.error(Be)}}))};return e.subscribe(an(n,re,()=>{B=!0,W()})),()=>{b?.()}}(r,a,e,t)))}function wn(e=1/0){return Et(ir,e)}const vn=new Bn(e=>e.complete());function is(e){return e[e.length-1]}function Ht(e){return function wa(e){return e&&hn(e.schedule)}(is(e))?e.pop():void 0}function tl(e,n=0){return _n((t,r)=>{t.subscribe(an(r,a=>Dt(r,e,()=>r.next(a),n),()=>Dt(r,e,()=>r.complete(),n),a=>Dt(r,e,()=>r.error(a),n)))})}function br(e,n=0){return _n((t,r)=>{r.add(e.schedule(()=>t.subscribe(r),n))})}function nl(e,n){if(!e)throw new Error("Iterable cannot be null");return new Bn(t=>{Dt(t,n,()=>{const r=e[Symbol.asyncIterator]();Dt(t,n,()=>{r.next().then(a=>{a.done?t.complete():t.next(a.value)})},0,!0)})})}function gt(e,n){return n?function En(e,n){if(null!=e){if(J(e))return function _i(e,n){return Ze(e).pipe(br(n),tl(n))}(e,n);if(U(e))return function Mi(e,n){return new Bn(t=>{let r=0;return n.schedule(function(){r===e.length?t.complete():(t.next(e[r++]),t.closed||this.schedule())})})}(e,n);if(K(e))return function Ad(e,n){return Ze(e).pipe(br(n),tl(n))}(e,n);if(ue(e))return nl(e,n);if(xe(e))return function wr(e,n){return new Bn(t=>{let r;return Dt(t,n,()=>{r=e[le](),Dt(t,n,()=>{let a,u;try{({value:a,done:u}=r.next())}catch(p){return void t.error(p)}u?t.complete():t.next(a)},0,!0)}),()=>hn(r?.return)&&r.return()})}(e,n);if(Se(e))return function Ca(e,n){return nl(we(e),n)}(e,n)}throw oe(e)}(e,n):Ze(e)}class qt extends dr{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const t=super._subscribe(n);return!t.closed&&n.next(this._value),t}getValue(){const{hasError:n,thrownError:t,_value:r}=this;if(n)throw t;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}}function yt(...e){return gt(e,Ht(e))}function vi(e={}){const{connector:n=(()=>new dr),resetOnError:t=!0,resetOnComplete:r=!0,resetOnRefCountZero:a=!0}=e;return u=>{let p,b,w,M=0,R=!1,B=!1;const W=()=>{b?.unsubscribe(),b=void 0},re=()=>{W(),p=w=void 0,R=B=!1},pe=()=>{const ve=p;re(),ve?.unsubscribe()};return _n((ve,Ae)=>{M++,!B&&!R&&W();const Be=w=w??n();Ae.add(()=>{M--,0===M&&!B&&!R&&(b=rl(pe,a))}),Be.subscribe(Ae),!p&&M>0&&(p=new uo({next:Ce=>Be.next(Ce),error:Ce=>{B=!0,W(),b=rl(re,t,Ce),Be.error(Ce)},complete:()=>{R=!0,W(),b=rl(re,r),Be.complete()}}),Ze(ve).subscribe(p))})(u)}}function rl(e,n,...t){if(!0===n)return void e();if(!1===n)return;const r=new uo({next:()=>{r.unsubscribe(),e()}});return Ze(n(...t)).subscribe(r)}function Cr(e,n){return _n((t,r)=>{let a=null,u=0,p=!1;const b=()=>p&&!a&&r.complete();t.subscribe(an(r,w=>{a?.unsubscribe();let M=0;const R=u++;Ze(e(w,R)).subscribe(a=an(r,B=>r.next(n?n(w,B,R,M++):B),()=>{a=null,b()}))},()=>{p=!0,b()}))})}function jc(e,n){return e===n}function Wt(e){for(let n in e)if(e[n]===Wt)return n;throw Error("Could not find renamed property on target object.")}function xn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(xn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const n=e.toString();if(null==n)return""+n;const t=n.indexOf("\n");return-1===t?n:n.substring(0,t)}function il(e,n){return null==e||""===e?null===n?"":n:null==n||""===n?e:e+" "+n}const ol=Wt({__forward_ref__:Wt});function Ql(e){return e.__forward_ref__=Ql,e.toString=function(){return xn(this())},e}function xt(e){return sl(e)?e():e}function sl(e){return"function"==typeof e&&e.hasOwnProperty(ol)&&e.__forward_ref__===Ql}function al(e){return e&&!!e.\u0275providers}class Ve extends Error{constructor(n,t){super(function ll(e,n){return`NG0${Math.abs(e)}${n?": "+n:""}`}(n,t)),this.code=n}}function Jt(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():function _t(e){return"string"==typeof e?e:null==e?"":String(e)}(e)}function Ro(e,n){throw new Ve(-201,!1)}function Xr(e,n){null==e&&function ut(e,n,t,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${t} ${r} ${n} <=Actual]`))}(n,e,null,"!=")}function ct(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Ai(e){return{providers:e.providers||[],imports:e.imports||[]}}function ul(e){return zs(e,nc)||zs(e,Ju)}function zs(e,n){return e.hasOwnProperty(n)?e[n]:null}function tc(e){return e&&(e.hasOwnProperty(Gc)||e.hasOwnProperty(Rd))?e[Gc]:null}const nc=Wt({\u0275prov:Wt}),Gc=Wt({\u0275inj:Wt}),Ju=Wt({ngInjectableDef:Wt}),Rd=Wt({ngInjectorDef:Wt});var Lt=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(Lt||{});let Da;function Or(e){const n=Da;return Da=e,n}function Bs(e,n,t){const r=ul(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&Lt.Optional?null:void 0!==n?n:void Ro(xn(e))}const dn=globalThis;class ot{constructor(n,t){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=ct({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Oo={},ic="__NG_DI_FLAG__",Ea="ngTempTokenPath",sc=/\n/gm,dl="__source";let ss;function Pi(e){const n=ss;return ss=e,n}function fl(e,n=Lt.Default){if(void 0===ss)throw new Ve(-203,!1);return null===ss?Bs(e,void 0,n):ss.get(e,n&Lt.Optional?null:void 0,n)}function ht(e,n=Lt.Default){return(function rc(){return Da}()||fl)(xt(e),n)}function Je(e,n=Lt.Default){return ht(e,ml(n))}function ml(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function Ma(e){const n=[];for(let t=0;t<e.length;t++){const r=xt(e[t]);if(Array.isArray(r)){if(0===r.length)throw new Ve(900,!1);let a,u=Lt.Default;for(let p=0;p<r.length;p++){const b=r[p],w=th(b);"number"==typeof w?-1===w?a=b.token:u|=w:a=b}n.push(ht(a,u))}else n.push(ht(r))}return n}function Vs(e,n){return e[ic]=n,e.prototype[ic]=n,e}function th(e){return e[ic]}function ki(e){return{toString:e}.toString()}var js=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(js||{}),Ri=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Ri||{});const Xt={},Nt=[],Dr=Wt({\u0275cmp:Wt}),as=Wt({\u0275dir:Wt}),$s=Wt({\u0275pipe:Wt}),yl=Wt({\u0275mod:Wt}),Yr=Wt({\u0275fac:Wt}),Lo=Wt({__NG_ELEMENT_ID__:Wt}),Us=Wt({__NG_ENV_ID__:Wt});function Xc(e,n,t){let r=e.length;for(;;){const a=e.indexOf(n,t);if(-1===a)return a;if(0===a||e.charCodeAt(a-1)<=32){const u=n.length;if(a+u===r||e.charCodeAt(a+u)<=32)return a}t=a+1}}function lc(e,n,t){let r=0;for(;r<t.length;){const a=t[r];if("number"==typeof a){if(0!==a)break;r++;const u=t[r++],p=t[r++],b=t[r++];e.setAttribute(n,p,b,u)}else{const u=a,p=t[++r];Kc(u)?e.setProperty(n,u,p):e.setAttribute(n,u,p),r++}}return r}function Yc(e){return 3===e||4===e||6===e}function Kc(e){return 64===e.charCodeAt(0)}function Ta(e,n){if(null!==n&&0!==n.length)if(null===e||0===e.length)e=n.slice();else{let t=-1;for(let r=0;r<n.length;r++){const a=n[r];"number"==typeof a?t=a:0===t||Yi(e,t,a,null,-1===t||2===t?n[++r]:null)}}return e}function Yi(e,n,t,r,a){let u=0,p=e.length;if(-1===n)p=-1;else for(;u<e.length;){const b=e[u++];if("number"==typeof b){if(b===n){p=-1;break}if(b>n){p=u-1;break}}}for(;u<e.length;){const b=e[u];if("number"==typeof b)break;if(b===t){if(null===r)return void(null!==a&&(e[u+1]=a));if(r===e[u+1])return void(e[u+2]=a)}u++,null!==r&&u++,null!==a&&u++}-1!==p&&(e.splice(p,0,n),u=p+1),e.splice(u++,0,t),null!==r&&e.splice(u++,0,r),null!==a&&e.splice(u++,0,a)}const Aa="ng-template";function bi(e,n,t){let r=0,a=!0;for(;r<e.length;){let u=e[r++];if("string"==typeof u&&a){const p=e[r++];if(t&&"class"===u&&-1!==Xc(p.toLowerCase(),n,0))return!0}else{if(1===u){for(;r<e.length&&"string"==typeof(u=e[r++]);)if(u.toLowerCase()===n)return!0;return!1}"number"==typeof u&&(a=!1)}}return!1}function Pa(e){return 4===e.type&&e.value!==Aa}function rh(e,n,t){return n===(4!==e.type||t?e.value:Aa)}function ih(e,n,t){let r=4;const a=e.attrs||[],u=function No(e){for(let n=0;n<e.length;n++)if(Yc(e[n]))return n;return e.length}(a);let p=!1;for(let b=0;b<n.length;b++){const w=n[b];if("number"!=typeof w){if(!p)if(4&r){if(r=2|1&r,""!==w&&!rh(e,w,t)||""===w&&1===n.length){if(Oi(r))return!1;p=!0}}else{const M=8&r?w:n[++b];if(8&r&&null!==e.attrs){if(!bi(e.attrs,M,t)){if(Oi(r))return!1;p=!0}continue}const B=Fo(8&r?"class":w,a,Pa(e),t);if(-1===B){if(Oi(r))return!1;p=!0;continue}if(""!==M){let W;W=B>u?"":a[B+1].toLowerCase();const re=8&r?W:null;if(re&&-1!==Xc(re,M,0)||2&r&&M!==W){if(Oi(r))return!1;p=!0}}}}else{if(!p&&!Oi(r)&&!Oi(w))return!1;if(p&&Oi(w))continue;p=!1,r=w|1&r}}return Oi(r)||p}function Oi(e){return 0==(1&e)}function Fo(e,n,t,r){if(null===n)return-1;let a=0;if(r||!t){let u=!1;for(;a<n.length;){const p=n[a];if(p===e)return a;if(3===p||6===p)u=!0;else{if(1===p||2===p){let b=n[++a];for(;"string"==typeof b;)b=n[++a];continue}if(4===p)break;if(0===p){a+=4;continue}}a+=u?1:2}return-1}return function cc(e,n){let t=e.indexOf(4);if(t>-1)for(t++;t<e.length;){const r=e[t];if("number"==typeof r)return-1;if(r===n)return t;t++}return-1}(n,e)}function Qc(e,n,t=!1){for(let r=0;r<n.length;r++)if(ih(e,n[r],t))return!0;return!1}function go(e,n){return e?":not("+n.trim()+")":n}function Ld(e){let n=e[0],t=1,r=2,a="",u=!1;for(;t<e.length;){let p=e[t];if("string"==typeof p)if(2&r){const b=e[++t];a+="["+p+(b.length>0?'="'+b+'"':"")+"]"}else 8&r?a+="."+p:4&r&&(a+=" "+p);else""!==a&&!Oi(p)&&(n+=go(u,a),a=""),r=p,u=u||!Oi(r);t++}return""!==a&&(n+=go(u,a)),n}function ls(e){return ki(()=>{const n=eu(e),t={...n,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===js.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Ri.Emulated,styles:e.styles||Nt,_:null,schemas:e.schemas||null,tView:null,id:""};tu(t);const r=e.dependencies;return t.directiveDefs=uc(r,!1),t.pipeDefs=uc(r,!0),t.id=function ru(e){let n=0;const t=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const a of t)n=Math.imul(31,n)+a.charCodeAt(0)<<0;return n+=2147483648,"c"+n}(t),t})}function Bo(e){return $t(e)||or(e)}function qe(e){return null!==e}function Ki(e){return ki(()=>({type:e.type,bootstrap:e.bootstrap||Nt,declarations:e.declarations||Nt,imports:e.imports||Nt,exports:e.exports||Nt,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function Hs(e,n){if(null==e)return Xt;const t={};for(const r in e)if(e.hasOwnProperty(r)){let a=e[r],u=a;Array.isArray(a)&&(u=a[1],a=a[0]),t[a]=r,n&&(n[a]=u)}return t}function Lr(e){return ki(()=>{const n=eu(e);return tu(n),n})}function $t(e){return e[Dr]||null}function or(e){return e[as]||null}function Kr(e){return e[$s]||null}function ci(e,n){const t=e[yl]||null;if(!t&&!0===n)throw new Error(`Type ${xn(e)} does not have '\u0275mod' property.`);return t}function eu(e){const n={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:e.inputs||Xt,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||Nt,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Hs(e.inputs,n),outputs:Hs(e.outputs)}}function tu(e){e.features?.forEach(n=>n(e))}function uc(e,n){if(!e)return null;const t=n?Kr:Bo;return()=>("function"==typeof e?e():e).map(r=>t(r)).filter(qe)}const Tn=0,Ge=1,at=2,en=3,Qr=4,qs=5,Kn=6,hs=7,Vn=8,Qn=9,tn=10,vt=11,Gs=12,iu=13,Zs=14,jn=15,_l=16,Jn=17,wi=18,Ke=19,rt=20,Fi=21,Qi=22,Ws=23,Cn=24,Ft=25,hc=1,ds=2,Yt=7,eo=9,qn=11;function Fr(e){return Array.isArray(e)&&"object"==typeof e[hc]}function Sr(e){return Array.isArray(e)&&!0===e[hc]}function ps(e){return 0!=(4&e.flags)}function jo(e){return e.componentOffset>-1}function Oa(e){return 1==(1&e.flags)}function Mt(e){return!!e.template}function y(e){return 0!=(512&e[at])}function be(e,n){return e.hasOwnProperty(Yr)?e[Yr]:null}let $e=null,Tt=!1;function ke(e){const n=$e;return $e=e,n}const it={version:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{}};function nn(e){if(!on(e)||e.dirty){if(!e.producerMustRecompute(e)&&!pr(e))return void(e.dirty=!1);e.producerRecomputeValue(e),e.dirty=!1}}function kt(e){e.dirty=!0,function At(e){if(void 0===e.liveConsumerNode)return;const n=Tt;Tt=!0;try{for(const t of e.liveConsumerNode)t.dirty||kt(t)}finally{Tt=n}}(e),e.consumerMarkedDirty?.(e)}function An(e){return e&&(e.nextProducerIndex=0),ke(e)}function un(e,n){if(ke(n),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(on(e))for(let t=e.nextProducerIndex;t<e.producerNode.length;t++)Nr(e.producerNode[t],e.producerIndexOfThis[t]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function pr(e){Jr(e);for(let n=0;n<e.producerNode.length;n++){const t=e.producerNode[n],r=e.producerLastReadVersion[n];if(r!==t.version||(nn(t),r!==t.version))return!0}return!1}function er(e){if(Jr(e),on(e))for(let n=0;n<e.producerNode.length;n++)Nr(e.producerNode[n],e.producerIndexOfThis[n]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function Nr(e,n){if(function to(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),Jr(e),1===e.liveConsumerNode.length)for(let r=0;r<e.producerNode.length;r++)Nr(e.producerNode[r],e.producerIndexOfThis[r]);const t=e.liveConsumerNode.length-1;if(e.liveConsumerNode[n]=e.liveConsumerNode[t],e.liveConsumerIndexOfThis[n]=e.liveConsumerIndexOfThis[t],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,n<e.liveConsumerNode.length){const r=e.liveConsumerIndexOfThis[n],a=e.liveConsumerNode[n];Jr(a),a.producerIndexOfThis[r]=n}}function on(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function Jr(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let fs=null;const Ci=()=>{},vo=(()=>({...it,consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:e=>{e.schedule(e.ref)},hasRun:!1,cleanupFn:Ci}))();class $o{constructor(n,t,r){this.previousValue=n,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function Na(){return Nd}function Nd(e){return e.type.prototype.ngOnChanges&&(e.setInput=zd),tr}function tr(){const e=za(this),n=e?.current;if(n){const t=e.previous;if(t===Xt)e.previous=n;else for(let r in n)t[r]=n[r];e.current=null,this.ngOnChanges(n)}}function zd(e,n,t,r){const a=this.declaredInputs[t],u=za(e)||function xl(e,n){return e[Bd]=n}(e,{previous:Xt,current:null}),p=u.current||(u.current={}),b=u.previous,w=b[a];p[a]=new $o(w&&w.currentValue,n,b===Xt),e[r]=n}Na.ngInherit=!0;const Bd="__ngSimpleChanges__";function za(e){return e[Bd]||null}const Uo=function(e,n,t){};function kn(e){for(;Array.isArray(e);)e=e[Tn];return e}function hi(e,n){return kn(n[e.index])}function $d(e,n){return e.data[n]}function no(e,n){const t=n[e];return Fr(t)?t:t[Tn]}function Ys(e,n){return null==n?null:e[n]}function Ud(e){e[Jn]=0}function Qg(e){1024&e[at]||(e[at]|=1024,bl(e,1))}function ei(e){1024&e[at]&&(e[at]&=-1025,bl(e,-1))}function bl(e,n){let t=e[en];if(null===t)return;t[qs]+=n;let r=t;for(t=t[en];null!==t&&(1===n&&1===r[qs]||-1===n&&0===r[qs]);)t[qs]+=n,r=t,t=t[en]}const pt={lFrame:Yd(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function qd(){return pt.bindingsEnabled}function Me(){return pt.lFrame.lView}function Kt(){return pt.lFrame.tView}function ti(){let e=Vf();for(;null!==e&&64===e.type;)e=e.parent;return e}function Vf(){return pt.lFrame.currentTNode}function xo(e,n){const t=pt.lFrame;t.currentTNode=e,t.isParent=n}function mc(){return pt.lFrame.isParent}function ny(e,n){const t=pt.lFrame;t.bindingIndex=t.bindingRootIndex=e,Wd(n)}function Wd(e){pt.lFrame.currentDirectiveIndex=e}function du(){return pt.lFrame.currentQueryIndex}function fh(e){pt.lFrame.currentQueryIndex=e}function mh(e){const n=e[Ge];return 2===n.type?n.declTNode:1===n.type?e[Kn]:null}function pu(e,n,t){if(t&Lt.SkipSelf){let a=n,u=e;for(;!(a=a.parent,null!==a||t&Lt.Host||(a=mh(u),null===a||(u=u[Zs],10&a.type))););if(null===a)return!1;n=a,e=u}const r=pt.lFrame=Xd();return r.currentTNode=n,r.lView=e,!0}function Cl(e){const n=Xd(),t=e[Ge];pt.lFrame=n,n.currentTNode=t.firstChild,n.lView=e,n.tView=t,n.contextLView=e,n.bindingIndex=t.bindingStartIndex,n.inI18n=!1}function Xd(){const e=pt.lFrame,n=null===e?null:e.child;return null===n?Yd(e):n}function Yd(e){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=n),n}function _c(){const e=pt.lFrame;return pt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const gh=_c;function fu(){const e=_c();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function di(){return pt.lFrame.selectedIndex}function qo(e){pt.lFrame.selectedIndex=e}let ep=!0;function mu(){return ep}function Ba(e){ep=e}function _h(e,n){for(let t=n.directiveStart,r=n.directiveEnd;t<r;t++){const u=e.data[t].type.prototype,{ngAfterContentInit:p,ngAfterContentChecked:b,ngAfterViewInit:w,ngAfterViewChecked:M,ngOnDestroy:R}=u;p&&(e.contentHooks??=[]).push(-t,p),b&&((e.contentHooks??=[]).push(t,b),(e.contentCheckHooks??=[]).push(t,b)),w&&(e.viewHooks??=[]).push(-t,w),M&&((e.viewHooks??=[]).push(t,M),(e.viewCheckHooks??=[]).push(t,M)),null!=R&&(e.destroyHooks??=[]).push(t,R)}}function vh(e,n,t){Hf(e,n,3,t)}function xh(e,n,t,r){(3&e[at])===t&&Hf(e,n,t,r)}function gs(e,n){let t=e[at];(3&t)===n&&(t&=8191,t+=1,e[at]=t)}function Hf(e,n,t,r){const u=r??-1,p=n.length-1;let b=0;for(let w=void 0!==r?65535&e[Jn]:0;w<p;w++)if("number"==typeof n[w+1]){if(b=n[w],null!=r&&b>=r)break}else n[w]<0&&(e[Jn]+=65536),(b<u||-1==u)&&(vc(e,t,n,w),e[Jn]=(4294901760&e[Jn])+w+2),w++}function tp(e,n){Uo(4,e,n);const t=ke(null);try{n.call(e)}finally{ke(t),Uo(5,e,n)}}function vc(e,n,t,r){const a=t[r]<0,u=t[r+1],b=e[a?-t[r]:t[r]];a?e[at]>>13<e[Jn]>>16&&(3&e[at])===n&&(e[at]+=8192,tp(b,u)):tp(b,u)}const xc=-1;class gu{constructor(n,t,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function Dl(e){return e!==xc}function Sl(e){return 32767&e}function yu(e,n){let t=function uy(e){return e>>16}(e),r=n;for(;t>0;)r=r[Zs],t--;return r}let wh=!0;function Ch(e){const n=wh;return wh=e,n}const bc=255,np=5;let hy=0;const ys={};function Dh(e,n){const t=Gf(e,n);if(-1!==t)return t;const r=n[Ge];r.firstCreatePass&&(e.injectorIndex=n.length,rp(r.data,e),rp(n,null),rp(r.blueprint,null));const a=_u(e,n),u=e.injectorIndex;if(Dl(a)){const p=Sl(a),b=yu(a,n),w=b[Ge].data;for(let M=0;M<8;M++)n[u+M]=b[p+M]|w[p+M]}return n[u+8]=a,u}function rp(e,n){e.push(0,0,0,0,0,0,0,0,n)}function Gf(e,n){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===n[e.injectorIndex+8]?-1:e.injectorIndex}function _u(e,n){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let t=0,r=null,a=n;for(;null!==a;){if(r=sn(a),null===r)return xc;if(t++,a=a[Zs],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return xc}function vu(e,n,t){!function dy(e,n,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(Lo)&&(r=t[Lo]),null==r&&(r=t[Lo]=hy++);const a=r&bc;n.data[e+(a>>np)]|=1<<a}(e,n,t)}function ip(e,n,t){if(t&Lt.Optional||void 0!==e)return e;Ro()}function op(e,n,t,r){if(t&Lt.Optional&&void 0===r&&(r=null),!(t&(Lt.Self|Lt.Host))){const a=e[Qn],u=Or(void 0);try{return a?a.get(n,r,t&Lt.Optional):Bs(n,r,t&Lt.Optional)}finally{Or(u)}}return ip(r,0,t)}function Wf(e,n,t,r=Lt.Default,a){if(null!==e){if(2048&n[at]&&!(r&Lt.Self)){const p=function Yf(e,n,t,r,a){let u=e,p=n;for(;null!==u&&null!==p&&2048&p[at]&&!(512&p[at]);){const b=xu(u,p,t,r|Lt.Self,ys);if(b!==ys)return b;let w=u.parent;if(!w){const M=p[rt];if(M){const R=M.get(t,ys,r);if(R!==ys)return R}w=sn(p),p=p[Zs]}u=w}return a}(e,n,t,r,ys);if(p!==ys)return p}const u=xu(e,n,t,r,ys);if(u!==ys)return u}return op(n,t,r,a)}function xu(e,n,t,r,a){const u=function fy(e){if("string"==typeof e)return e.charCodeAt(0)||0;const n=e.hasOwnProperty(Lo)?e[Lo]:void 0;return"number"==typeof n?n>=0?n&bc:ar:n}(t);if("function"==typeof u){if(!pu(n,e,r))return r&Lt.Host?ip(a,0,r):op(n,t,r,a);try{let p;if(p=u(r),null!=p||r&Lt.Optional)return p;Ro()}finally{gh()}}else if("number"==typeof u){let p=null,b=Gf(e,n),w=xc,M=r&Lt.Host?n[jn][Kn]:null;for((-1===b||r&Lt.SkipSelf)&&(w=-1===b?_u(e,n):n[b+8],w!==xc&&sp(r,!1)?(p=n[Ge],b=Sl(w),n=yu(w,n)):b=-1);-1!==b;){const R=n[Ge];if(Xf(u,b,R.data)){const B=py(b,n,t,p,r,M);if(B!==ys)return B}w=n[b+8],w!==xc&&sp(r,n[Ge].data[b+8]===M)&&Xf(u,b,n)?(p=R,b=Sl(w),n=yu(w,n)):b=-1}}return a}function py(e,n,t,r,a,u){const p=n[Ge],b=p.data[e+8],R=bu(b,p,t,null==r?jo(b)&&wh:r!=p&&0!=(3&b.type),a&Lt.Host&&u===b);return null!==R?Il(n,p,R,b):ys}function bu(e,n,t,r,a){const u=e.providerIndexes,p=n.data,b=1048575&u,w=e.directiveStart,R=u>>20,W=a?b+R:e.directiveEnd;for(let re=r?b:b+R;re<W;re++){const pe=p[re];if(re<w&&t===pe||re>=w&&pe.type===t)return re}if(a){const re=p[w];if(re&&Mt(re)&&re.type===t)return w}return null}function Il(e,n,t,r){let a=e[t];const u=n.data;if(function sy(e){return e instanceof gu}(a)){const p=a;p.resolving&&function Gu(e,n){const t=n?`. Dependency path: ${n.join(" > ")} > ${e}`:"";throw new Ve(-200,`Circular dependency in DI detected for ${e}${t}`)}(Jt(u[t]));const b=Ch(p.canSeeViewProviders);p.resolving=!0;const M=p.injectImpl?Or(p.injectImpl):null;pu(e,r,Lt.Default);try{a=e[t]=p.factory(void 0,u,e,r),n.firstCreatePass&&t>=r.directiveStart&&function oy(e,n,t){const{ngOnChanges:r,ngOnInit:a,ngDoCheck:u}=n.type.prototype;if(r){const p=Nd(n);(t.preOrderHooks??=[]).push(e,p),(t.preOrderCheckHooks??=[]).push(e,p)}a&&(t.preOrderHooks??=[]).push(0-e,a),u&&((t.preOrderHooks??=[]).push(e,u),(t.preOrderCheckHooks??=[]).push(e,u))}(t,u[t],n)}finally{null!==M&&Or(M),Ch(b),p.resolving=!1,gh()}}return a}function Xf(e,n,t){return!!(t[n+(e>>np)]&1<<e)}function sp(e,n){return!(e&Lt.Self||e&Lt.Host&&n)}class Er{constructor(n,t){this._tNode=n,this._lView=t}get(n,t,r){return Wf(this._tNode,this._lView,n,ml(r),t)}}function ar(){return new Er(ti(),Me())}function Sh(e){return sl(e)?()=>{const n=Sh(xt(e));return n&&n()}:be(e)}function sn(e){const n=e[Ge],t=n.type;return 2===t?n.declTNode:1===t?e[Kn]:null}const Ml="__parameters__";function Cc(e,n,t){return ki(()=>{const r=function Ih(e){return function(...t){if(e){const r=e(...t);for(const a in r)this[a]=r[a]}}}(n);function a(...u){if(this instanceof a)return r.apply(this,u),this;const p=new a(...u);return b.annotation=p,b;function b(w,M,R){const B=w.hasOwnProperty(Ml)?w[Ml]:Object.defineProperty(w,Ml,{value:[]})[Ml];for(;B.length<=R;)B.push(null);return(B[R]=B[R]||[]).push(p),w}}return t&&(a.prototype=Object.create(t.prototype)),a.prototype.ngMetadataName=e,a.annotationCls=a,a})}function Al(e,n){e.forEach(t=>Array.isArray(t)?Al(t,n):n(t))}function cp(e,n,t){n>=e.length?e.push(t):e.splice(n,0,t)}function Vr(e,n){return n>=e.length-1?e.pop():e.splice(n,1)[0]}function jr(e,n,t){let r=ea(e,n);return r>=0?e[1|r]=t:(r=~r,function Du(e,n,t,r){let a=e.length;if(a==n)e.push(t,r);else if(1===a)e.push(r,e[0]),e[0]=t;else{for(a--,e.push(e[a-1],e[a]);a>n;)e[a]=e[a-2],a--;e[n]=t,e[n+1]=r}}(e,r,n,t)),r}function Sc(e,n){const t=ea(e,n);if(t>=0)return e[1|t]}function ea(e,n){return function up(e,n,t){let r=0,a=e.length>>t;for(;a!==r;){const u=r+(a-r>>1),p=e[u<<t];if(n===p)return u<<t;p>n?a=u:r=u+1}return~(a<<t)}(e,n,1)}const Va=Vs(Cc("Optional"),8),Go=Vs(Cc("SkipSelf"),4);function Eu(e){return 128==(128&e.flags)}var ta=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(ta||{});const Dp=new Map;let gm=0;const Sp="__ngContext__";function pi(e,n){Fr(n)?(e[Sp]=n[Ke],function ym(e){Dp.set(e[Ke],e)}(n)):e[Sp]=n}let Mp;function Nh(e,n){return Mp(e,n)}function Fl(e){const n=e[en];return Sr(n)?n[en]:n}function zh(e){return Bh(e[Gs])}function Ap(e){return Bh(e[Qr])}function Bh(e){for(;null!==e&&!Sr(e);)e=e[Qr];return e}function na(e,n,t,r,a){if(null!=r){let u,p=!1;Sr(r)?u=r:Fr(r)&&(p=!0,r=r[Tn]);const b=kn(r);0===e&&null!==t?null==a?$(n,t,b):j(n,t,b,a||null,!0):1===e&&null!==t?j(n,t,b,a||null,!0):2===e?function Fe(e,n,t){const r=ae(e,n);r&&function Q(e,n,t,r){e.removeChild(n,t,r)}(e,r,n,t)}(n,b,p):3===e&&n.destroyNode(b),null!=u&&function Dn(e,n,t,r,a){const u=t[Yt];u!==kn(t)&&na(n,e,r,u,a);for(let b=qn;b<t.length;b++){const w=t[b];We(w[Ge],w,e,n,r,u)}}(n,e,u,t,a)}}function Tc(e,n,t){return e.createElement(n,t)}function _(e,n){const t=e[eo],r=t.indexOf(n);ei(n),t.splice(r,1)}function x(e,n){if(e.length<=qn)return;const t=qn+n,r=e[t];if(r){const a=r[_l];null!==a&&a!==e&&_(a,r),n>0&&(e[t-1][Qr]=r[Qr]);const u=Vr(e,qn+n);!function My(e,n){We(e,n,n[vt],2,null,null),n[Tn]=null,n[Kn]=null}(r[Ge],r);const p=u[wi];null!==p&&p.detachView(u[Ge]),r[en]=null,r[Qr]=null,r[at]&=-129}return r}function C(e,n){if(!(256&n[at])){const t=n[vt];n[Ws]&&er(n[Ws]),n[Cn]&&er(n[Cn]),t.destroyNode&&We(e,n,t,3,null,null),function l(e){let n=e[Gs];if(!n)return I(e[Ge],e);for(;n;){let t=null;if(Fr(n))t=n[Gs];else{const r=n[qn];r&&(t=r)}if(!t){for(;n&&!n[Qr]&&n!==e;)Fr(n)&&I(n[Ge],n),n=n[en];null===n&&(n=e),Fr(n)&&I(n[Ge],n),t=n&&n[Qr]}n=t}}(n)}}function I(e,n){if(!(256&n[at])){n[at]&=-129,n[at]|=256,function P(e,n){let t;if(null!=e&&null!=(t=e.destroyHooks))for(let r=0;r<t.length;r+=2){const a=n[t[r]];if(!(a instanceof gu)){const u=t[r+1];if(Array.isArray(u))for(let p=0;p<u.length;p+=2){const b=a[u[p]],w=u[p+1];Uo(4,b,w);try{w.call(b)}finally{Uo(5,b,w)}}else{Uo(4,a,u);try{u.call(a)}finally{Uo(5,a,u)}}}}}(e,n),function T(e,n){const t=e.cleanup,r=n[hs];if(null!==t)for(let u=0;u<t.length-1;u+=2)if("string"==typeof t[u]){const p=t[u+3];p>=0?r[p]():r[-p].unsubscribe(),u+=2}else t[u].call(r[t[u+1]]);null!==r&&(n[hs]=null);const a=n[Fi];if(null!==a){n[Fi]=null;for(let u=0;u<a.length;u++)(0,a[u])()}}(e,n),1===n[Ge].type&&n[vt].destroy();const t=n[_l];if(null!==t&&Sr(n[en])){t!==n[en]&&_(t,n);const r=n[wi];null!==r&&r.detachView(e)}!function _m(e){Dp.delete(e[Ke])}(n)}}function L(e,n,t){return function N(e,n,t){let r=n;for(;null!==r&&40&r.type;)r=(n=r).parent;if(null===r)return t[Tn];{const{componentOffset:a}=r;if(a>-1){const{encapsulation:u}=e.data[r.directiveStart+a];if(u===Ri.None||u===Ri.Emulated)return null}return hi(r,t)}}(e,n.parent,t)}function j(e,n,t,r,a){e.insertBefore(n,t,r,a)}function $(e,n,t){e.appendChild(n,t)}function q(e,n,t,r,a){null!==r?j(e,n,t,r,a):$(e,n,t)}function ae(e,n){return e.parentNode(n)}let Ue,$r,De=function fe(e,n,t){return 40&e.type?hi(e,t):null};function je(e,n,t,r){const a=L(e,r,n),u=n[vt],b=function he(e,n,t){return De(e,n,t)}(r.parent||n[Kn],r,n);if(null!=a)if(Array.isArray(t))for(let w=0;w<t.length;w++)q(u,a,t[w],b,!1);else q(u,a,t,b,!1);void 0!==Ue&&Ue(u,r,n,t,a)}function Ne(e,n){if(null!==n){const t=n.type;if(3&t)return hi(n,e);if(4&t)return He(-1,e[n.index]);if(8&t){const r=n.child;if(null!==r)return Ne(e,r);{const a=e[n.index];return Sr(a)?He(-1,a):kn(a)}}if(32&t)return Nh(n,e)()||kn(e[n.index]);{const r=Le(e,n);return null!==r?Array.isArray(r)?r[0]:Ne(Fl(e[jn]),r):Ne(e,n.next)}}return null}function Le(e,n){return null!==n?e[jn][Kn].projection[n.projection]:null}function He(e,n){const t=qn+e+1;if(t<n.length){const r=n[t],a=r[Ge].firstChild;if(null!==a)return Ne(r,a)}return n[Yt]}function et(e,n,t,r,a,u,p){for(;null!=t;){const b=r[t.index],w=t.type;if(p&&0===n&&(b&&pi(kn(b),r),t.flags|=2),32!=(32&t.flags))if(8&w)et(e,n,t.child,r,a,u,!1),na(n,e,a,b,u);else if(32&w){const M=Nh(t,r);let R;for(;R=M();)na(n,e,a,R,u);na(n,e,a,b,u)}else 16&w?fn(e,n,r,t,a,u):na(n,e,a,b,u);t=p?t.projectionNext:t.next}}function We(e,n,t,r,a,u){et(t,r,e.firstChild,n,a,u,!1)}function fn(e,n,t,r,a,u){const p=t[jn],w=p[Kn].projection[r.projection];if(Array.isArray(w))for(let M=0;M<w.length;M++)na(n,e,a,w[M],u);else{let M=w;const R=p[en];Eu(r)&&(M.flags|=128),et(e,n,M,R,a,u,!0)}}function ri(e,n,t){""===t?e.removeAttribute(n,"class"):e.setAttribute(n,"class",t)}function Wn(e,n,t){const{mergedAttrs:r,classes:a,styles:u}=t;null!==r&&lc(e,n,r),null!==a&&ri(e,n,a),null!==u&&function zi(e,n,t){e.setAttribute(n,"style",t)}(e,n,u)}class rr{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function yr(e){return e instanceof rr?e.changingThisBreaksApplicationSecurity:e}const Np=new ot("ENVIRONMENT_INITIALIZER"),V0=new ot("INJECTOR",-1),j0=new ot("INJECTOR_DEF_TYPES");class Ly{get(n,t=Oo){if(t===Oo){const r=new Error(`NullInjectorError: No provider for ${xn(n)}!`);throw r.name="NullInjectorError",r}return t}}function ES(...e){return{\u0275providers:U0(0,e),\u0275fromNgModule:!0}}function U0(e,...n){const t=[],r=new Set;let a;const u=p=>{t.push(p)};return Al(n,p=>{const b=p;Pm(b,u,[],r)&&(a||=[],a.push(b))}),void 0!==a&&H0(a,u),t}function H0(e,n){for(let t=0;t<e.length;t++){const{ngModule:r,providers:a}=e[t];Fy(a,u=>{n(u,r)})}}function Pm(e,n,t,r){if(!(e=xt(e)))return!1;let a=null,u=tc(e);const p=!u&&$t(e);if(u||p){if(p&&!p.standalone)return!1;a=e}else{const w=e.ngModule;if(u=tc(w),!u)return!1;a=w}const b=r.has(a);if(p){if(b)return!1;if(r.add(a),p.dependencies){const w="function"==typeof p.dependencies?p.dependencies():p.dependencies;for(const M of w)Pm(M,n,t,r)}}else{if(!u)return!1;{if(null!=u.imports&&!b){let M;r.add(a);try{Al(u.imports,R=>{Pm(R,n,t,r)&&(M||=[],M.push(R))})}finally{}void 0!==M&&H0(M,n)}if(!b){const M=be(a)||(()=>new a);n({provide:a,useFactory:M,deps:Nt},a),n({provide:j0,useValue:a,multi:!0},a),n({provide:Np,useValue:()=>ht(a),multi:!0},a)}const w=u.providers;if(null!=w&&!b){const M=e;Fy(w,R=>{n(R,M)})}}}return a!==e&&void 0!==e.providers}function Fy(e,n){for(let t of e)al(t)&&(t=t.\u0275providers),Array.isArray(t)?Fy(t,n):n(t)}const MS=Wt({provide:String,useValue:Wt});function Ny(e){return null!==e&&"object"==typeof e&&MS in e}function Ru(e){return"function"==typeof e}const zy=new ot("Set Injector scope."),km={},AS={};let By;function Rm(){return void 0===By&&(By=new Ly),By}class xs{}class Uh extends xs{get destroyed(){return this._destroyed}constructor(n,t,r,a){super(),this.parent=t,this.source=r,this.scopes=a,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,jy(n,p=>this.processProvider(p)),this.records.set(V0,Hh(void 0,this)),a.has("environment")&&this.records.set(xs,Hh(void 0,this));const u=this.records.get(zy);null!=u&&"string"==typeof u.value&&this.scopes.add(u.value),this.injectorDefTypes=new Set(this.get(j0.multi,Nt,Lt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const t of n)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(n){return this.assertNotDestroyed(),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){this.assertNotDestroyed();const t=Pi(this),r=Or(void 0);try{return n()}finally{Pi(t),Or(r)}}get(n,t=Oo,r=Lt.Default){if(this.assertNotDestroyed(),n.hasOwnProperty(Us))return n[Us](this);r=ml(r);const u=Pi(this),p=Or(void 0);try{if(!(r&Lt.SkipSelf)){let w=this.records.get(n);if(void 0===w){const M=function LS(e){return"function"==typeof e||"object"==typeof e&&e instanceof ot}(n)&&ul(n);w=M&&this.injectableDefInScope(M)?Hh(Vy(n),km):null,this.records.set(n,w)}if(null!=w)return this.hydrate(n,w)}return(r&Lt.Self?Rm():this.parent).get(n,t=r&Lt.Optional&&t===Oo?null:t)}catch(b){if("NullInjectorError"===b.name){if((b[Ea]=b[Ea]||[]).unshift(xn(n)),u)throw b;return function nh(e,n,t,r){const a=e[Ea];throw n[dl]&&a.unshift(n[dl]),e.message=function gl(e,n,t,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let a=xn(n);if(Array.isArray(n))a=n.map(xn).join(" -> ");else if("object"==typeof n){let u=[];for(let p in n)if(n.hasOwnProperty(p)){let b=n[p];u.push(p+":"+("string"==typeof b?JSON.stringify(b):xn(b)))}a=`{${u.join(", ")}}`}return`${t}${r?"("+r+")":""}[${a}]: ${e.replace(sc,"\n  ")}`}("\n"+e.message,a,t,r),e.ngTokenPath=a,e[Ea]=null,e}(b,n,"R3InjectorError",this.source)}throw b}finally{Or(p),Pi(u)}}resolveInjectorInitializers(){const n=Pi(this),t=Or(void 0);try{const a=this.get(Np.multi,Nt,Lt.Self);for(const u of a)u()}finally{Pi(n),Or(t)}}toString(){const n=[],t=this.records;for(const r of t.keys())n.push(xn(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Ve(205,!1)}processProvider(n){let t=Ru(n=xt(n))?n:xt(n&&n.provide);const r=function kS(e){return Ny(e)?Hh(void 0,e.useValue):Hh(Z0(e),km)}(n);if(Ru(n)||!0!==n.multi)this.records.get(t);else{let a=this.records.get(t);a||(a=Hh(void 0,km,!0),a.factory=()=>Ma(a.multi),this.records.set(t,a)),t=n,a.multi.push(n)}this.records.set(t,r)}hydrate(n,t){return t.value===km&&(t.value=AS,t.value=t.factory()),"object"==typeof t.value&&t.value&&function OS(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(n){if(!n.providedIn)return!1;const t=xt(n.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}removeOnDestroy(n){const t=this._onDestroyHooks.indexOf(n);-1!==t&&this._onDestroyHooks.splice(t,1)}}function Vy(e){const n=ul(e),t=null!==n?n.factory:be(e);if(null!==t)return t;if(e instanceof ot)throw new Ve(204,!1);if(e instanceof Function)return function PS(e){const n=e.length;if(n>0)throw function Pl(e,n){const t=[];for(let r=0;r<e;r++)t.push(n);return t}(n,"?"),new Ve(204,!1);const t=function kd(e){return e&&(e[nc]||e[Ju])||null}(e);return null!==t?()=>t.factory(e):()=>new e}(e);throw new Ve(204,!1)}function Z0(e,n,t){let r;if(Ru(e)){const a=xt(e);return be(a)||Vy(a)}if(Ny(e))r=()=>xt(e.useValue);else if(function G0(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...Ma(e.deps||[]));else if(function q0(e){return!(!e||!e.useExisting)}(e))r=()=>ht(xt(e.useExisting));else{const a=xt(e&&(e.useClass||e.provide));if(!function RS(e){return!!e.deps}(e))return be(a)||Vy(a);r=()=>new a(...Ma(e.deps))}return r}function Hh(e,n,t=!1){return{factory:e,value:n,multi:t?[]:void 0}}function jy(e,n){for(const t of e)Array.isArray(t)?jy(t,n):t&&al(t)?jy(t.\u0275providers,n):n(t)}const Om=new ot("AppId",{providedIn:"root",factory:()=>FS}),FS="ng",W0=new ot("Platform Initializer"),qh=new ot("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),X0=new ot("CSP nonce",{providedIn:"root",factory:()=>function gr(){if(void 0!==$r)return $r;if(typeof document<"u")return document;throw new Ve(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let Y0=(e,n,t)=>null;function Xy(e,n,t=!1){return Y0(e,n,t)}class GS{}class J0{}class WS{resolveComponentFactory(n){throw function ZS(e){const n=Error(`No component factory found for ${xn(e)}.`);return n.ngComponent=e,n}(n)}}let Vm=(()=>{class e{static#e=this.NULL=new WS}return e})();function XS(){return Wh(ti(),Me())}function Wh(e,n){return new Ac(hi(e,n))}let Ac=(()=>{class e{constructor(t){this.nativeElement=t}static#e=this.__NG_ELEMENT_ID__=XS}return e})();function YS(e){return e instanceof Ac?e.nativeElement:e}class tx{}let QS=(()=>{class e{static#e=this.\u0275prov=ct({token:e,providedIn:"root",factory:()=>null})}return e})();class $m{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const JS=new $m("16.2.11"),Qy={};function ox(e,n=null,t=null,r){const a=sx(e,n,t,r);return a.resolveInjectorInitializers(),a}function sx(e,n=null,t=null,r,a=new Set){const u=[t||Nt,ES(e)];return r=r||("object"==typeof e?void 0:xn(e)),new Uh(u,n||Rm(),r||null,a)}let bs=(()=>{class e{static#e=this.THROW_IF_NOT_FOUND=Oo;static#t=this.NULL=new Ly;static create(t,r){if(Array.isArray(t))return ox({name:""},r,t,"");{const a=t.name??"";return ox({name:a},t.parent,t.providers,a)}}static#n=this.\u0275prov=ct({token:e,providedIn:"any",factory:()=>ht(V0)});static#r=this.__NG_ELEMENT_ID__=-1}return e})();function e_(e){return e.ngOriginalError}class zl{constructor(){this._console=console}handleError(n){const t=this._findOriginalError(n);this._console.error("ERROR",n),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(n){let t=n&&e_(n);for(;t&&e_(t);)t=e_(t);return t||null}}function n_(e){return n=>{setTimeout(e,void 0,n)}}const st=class sI extends dr{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,t,r){let a=n,u=t||(()=>null),p=r;if(n&&"object"==typeof n){const w=n;a=w.next?.bind(w),u=w.error?.bind(w),p=w.complete?.bind(w)}this.__isAsync&&(u=n_(u),a&&(a=n_(a)),p&&(p=n_(p)));const b=super.subscribe({next:a,error:u,complete:p});return n instanceof On&&n.add(b),b}};function lx(...e){}class Rn{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new st(!1),this.onMicrotaskEmpty=new st(!1),this.onStable=new st(!1),this.onError=new st(!1),typeof Zone>"u")throw new Ve(908,!1);Zone.assertZonePatched();const a=this;a._nesting=0,a._outer=a._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(a._inner=a._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(a._inner=a._inner.fork(Zone.longStackTraceZoneSpec)),a.shouldCoalesceEventChangeDetection=!r&&t,a.shouldCoalesceRunChangeDetection=r,a.lastRequestAnimationFrameId=-1,a.nativeRequestAnimationFrame=function aI(){const e="function"==typeof dn.requestAnimationFrame;let n=dn[e?"requestAnimationFrame":"setTimeout"],t=dn[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&n&&t){const r=n[Zone.__symbol__("OriginalDelegate")];r&&(n=r);const a=t[Zone.__symbol__("OriginalDelegate")];a&&(t=a)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function uI(e){const n=()=>{!function cI(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(dn,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,i_(e),e.isCheckStableRunning=!0,r_(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),i_(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,a,u,p,b)=>{if(function dI(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(b))return t.invokeTask(a,u,p,b);try{return cx(e),t.invokeTask(a,u,p,b)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===u.type||e.shouldCoalesceRunChangeDetection)&&n(),ux(e)}},onInvoke:(t,r,a,u,p,b,w)=>{try{return cx(e),t.invoke(a,u,p,b,w)}finally{e.shouldCoalesceRunChangeDetection&&n(),ux(e)}},onHasTask:(t,r,a,u)=>{t.hasTask(a,u),r===a&&("microTask"==u.change?(e._hasPendingMicrotasks=u.microTask,i_(e),r_(e)):"macroTask"==u.change&&(e.hasPendingMacrotasks=u.macroTask))},onHandleError:(t,r,a,u)=>(t.handleError(a,u),e.runOutsideAngular(()=>e.onError.emit(u)),!1)})}(a)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Rn.isInAngularZone())throw new Ve(909,!1)}static assertNotInAngularZone(){if(Rn.isInAngularZone())throw new Ve(909,!1)}run(n,t,r){return this._inner.run(n,t,r)}runTask(n,t,r,a){const u=this._inner,p=u.scheduleEventTask("NgZoneEvent: "+a,n,lI,lx,lx);try{return u.runTask(p,t,r)}finally{u.cancelTask(p)}}runGuarded(n,t,r){return this._inner.runGuarded(n,t,r)}runOutsideAngular(n){return this._outer.run(n)}}const lI={};function r_(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function i_(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function cx(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function ux(e){e._nesting--,r_(e)}class hI{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new st,this.onMicrotaskEmpty=new st,this.onStable=new st,this.onError=new st}run(n,t,r){return n.apply(t,r)}runGuarded(n,t,r){return n.apply(t,r)}runOutsideAngular(n){return n()}runTask(n,t,r,a){return n.apply(t,r)}}const hx=new ot("",{providedIn:"root",factory:dx});function dx(){const e=Je(Rn);let n=!0;return function Ls(...e){const n=Ht(e),t=function Vc(e,n){return"number"==typeof is(e)?e.pop():n}(e,1/0),r=e;return r.length?1===r.length?Ze(r[0]):wn(t)(gt(r,n)):vn}(new Bn(a=>{n=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{a.next(n),a.complete()})}),new Bn(a=>{let u;e.runOutsideAngular(()=>{u=e.onStable.subscribe(()=>{Rn.assertNotInAngularZone(),queueMicrotask(()=>{!n&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(n=!0,a.next(!0))})})});const p=e.onUnstable.subscribe(()=>{Rn.assertInAngularZone(),n&&(n=!1,e.runOutsideAngular(()=>{a.next(!1)}))});return()=>{u.unsubscribe(),p.unsubscribe()}}).pipe(vi()))}function Bl(e){return e instanceof Function?e():e}let o_=(()=>{class e{constructor(){this.renderDepth=0,this.handler=null}begin(){this.handler?.validateBegin(),this.renderDepth++}end(){this.renderDepth--,0===this.renderDepth&&this.handler?.execute()}ngOnDestroy(){this.handler?.destroy(),this.handler=null}static#e=this.\u0275prov=ct({token:e,providedIn:"root",factory:()=>new e})}return e})();function Vp(e){for(;e;){e[at]|=64;const n=Fl(e);if(y(e)&&!n)return e;e=n}return null}const yx=new ot("",{providedIn:"root",factory:()=>!1});let Hm=null;function bx(e,n){return e[n]??Dx()}function wx(e,n){const t=Dx();t.producerNode?.length&&(e[n]=Hm,t.lView=e,Hm=Cx())}const wI={...it,consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{Vp(e.lView)},lView:null};function Cx(){return Object.create(wI)}function Dx(){return Hm??=Cx(),Hm}const Ot={};function Ix(e,n,t,r){if(!r)if(3==(3&n[at])){const u=e.preOrderCheckHooks;null!==u&&vh(n,u,t)}else{const u=e.preOrderHooks;null!==u&&xh(n,u,0,t)}qo(t)}function Ct(e,n=Lt.Default){const t=Me();return null===t?ht(e,n):Wf(ti(),t,xt(e),n)}function qm(e,n,t,r,a,u,p,b,w,M,R){const B=n.blueprint.slice();return B[Tn]=a,B[at]=140|r,(null!==M||e&&2048&e[at])&&(B[at]|=2048),Ud(B),B[en]=B[Zs]=e,B[Vn]=t,B[tn]=p||e&&e[tn],B[vt]=b||e&&e[vt],B[Qn]=w||e&&e[Qn]||null,B[Kn]=u,B[Ke]=function Ec(){return gm++}(),B[Qi]=R,B[rt]=M,B[jn]=2==n.type?e[jn]:B,B}function Kh(e,n,t,r,a){let u=e.data[n];if(null===u)u=function s_(e,n,t,r,a){const u=Vf(),p=mc(),w=e.data[n]=function AI(e,n,t,r,a,u){let p=n?n.injectorIndex:-1,b=0;return function fc(){return null!==pt.skipHydrationRootTNode}()&&(b|=128),{type:t,index:r,insertBeforeIndex:null,injectorIndex:p,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:b,providerIndexes:0,value:a,attrs:u,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,p?u:u&&u.parent,t,n,r,a);return null===e.firstChild&&(e.firstChild=w),null!==u&&(p?null==u.child&&null!==w.parent&&(u.child=w):null===u.next&&(u.next=w,w.prev=u)),w}(e,n,t,r,a),function ty(){return pt.lFrame.inI18n}()&&(u.flags|=32);else if(64&u.type){u.type=t,u.value=r,u.attrs=a;const p=function hu(){const e=pt.lFrame,n=e.currentTNode;return e.isParent?n:n.parent}();u.injectorIndex=null===p?-1:p.injectorIndex}return xo(u,!0),u}function jp(e,n,t,r){if(0===t)return-1;const a=n.length;for(let u=0;u<t;u++)n.push(r),e.blueprint.push(r),e.data.push(null);return a}function Mx(e,n,t,r,a){const u=bx(n,Ws),p=di(),b=2&r;try{qo(-1),b&&n.length>Ft&&Ix(e,n,Ft,!1),Uo(b?2:0,a);const M=b?u:null,R=An(M);try{null!==M&&(M.dirty=!1),t(r,a)}finally{un(M,R)}}finally{b&&null===n[Ws]&&wx(n,Ws),qo(p),Uo(b?3:1,a)}}function a_(e,n,t){if(ps(n)){const r=ke(null);try{const u=n.directiveEnd;for(let p=n.directiveStart;p<u;p++){const b=e.data[p];b.contentQueries&&b.contentQueries(1,t[p],p)}}finally{ke(r)}}}function Tx(e){const n=e.tView;return null===n||n.incompleteFirstPass?e.tView=u_(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):n}function u_(e,n,t,r,a,u,p,b,w,M,R){const B=Ft+r,W=B+a,re=function DI(e,n){const t=[];for(let r=0;r<n;r++)t.push(r<e?null:Ot);return t}(B,W),pe="function"==typeof M?M():M;return re[Ge]={type:e,blueprint:re,template:t,queries:null,viewQuery:b,declTNode:n,data:re.slice().fill(null,B),bindingStartIndex:B,expandoStartIndex:W,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof u?u():u,pipeRegistry:"function"==typeof p?p():p,firstChild:null,schemas:w,consts:pe,incompleteFirstPass:!1,ssrId:R}}let Ax=e=>null;function Px(e,n,t,r){for(let a in e)if(e.hasOwnProperty(a)){t=null===t?{}:t;const u=e[a];null===r?kx(t,n,a,u):r.hasOwnProperty(a)&&kx(t,n,r[a],u)}return t}function kx(e,n,t,r){e.hasOwnProperty(t)?e[t].push(n,r):e[t]=[n,r]}function Rx(e,n,t,r,a,u){for(let M=0;M<r.length;M++)vu(Dh(t,n),e,r[M].type);!function $I(e,n,t){e.flags|=1,e.directiveStart=n,e.directiveEnd=n+t,e.providerIndexes=n}(t,e.data.length,r.length);for(let M=0;M<r.length;M++){const R=r[M];R.providersResolver&&R.providersResolver(R)}let p=!1,b=!1,w=jp(e,n,r.length,null);for(let M=0;M<r.length;M++){const R=r[M];t.mergedAttrs=Ta(t.mergedAttrs,R.hostAttrs),UI(e,t,n,w,R),jI(w,R,a),null!==R.contentQueries&&(t.flags|=4),(null!==R.hostBindings||null!==R.hostAttrs||0!==R.hostVars)&&(t.flags|=64);const B=R.type.prototype;!p&&(B.ngOnChanges||B.ngOnInit||B.ngDoCheck)&&((e.preOrderHooks??=[]).push(t.index),p=!0),!b&&(B.ngOnChanges||B.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(t.index),b=!0),w++}!function PI(e,n,t){const a=n.directiveEnd,u=e.data,p=n.attrs,b=[];let w=null,M=null;for(let R=n.directiveStart;R<a;R++){const B=u[R],W=t?t.get(B):null,pe=W?W.outputs:null;w=Px(B.inputs,R,w,W?W.inputs:null),M=Px(B.outputs,R,M,pe);const ve=null===w||null===p||Pa(n)?null:GI(w,R,p);b.push(ve)}null!==w&&(w.hasOwnProperty("class")&&(n.flags|=8),w.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=b,n.inputs=w,n.outputs=M}(e,t,u)}function Ox(e,n,t){const r=t.directiveStart,a=t.directiveEnd,u=t.index,p=function yc(){return pt.lFrame.currentDirectiveIndex}();try{qo(u);for(let b=r;b<a;b++){const w=e.data[b],M=n[b];Wd(b),(null!==w.hostBindings||0!==w.hostVars||null!==w.hostAttrs)&&zI(w,M)}}finally{qo(-1),Wd(p)}}function zI(e,n){null!==e.hostBindings&&e.hostBindings(1,n)}function d_(e,n,t){n.componentOffset=t,(e.components??=[]).push(n.index)}function jI(e,n,t){if(t){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)t[n.exportAs[r]]=e;Mt(n)&&(t[""]=e)}}function UI(e,n,t,r,a){e.data[r]=a;const u=a.factory||(a.factory=be(a.type)),p=new gu(u,Mt(a),Ct);e.blueprint[r]=p,t[r]=p,function LI(e,n,t,r,a){const u=a.hostBindings;if(u){let p=e.hostBindingOpCodes;null===p&&(p=e.hostBindingOpCodes=[]);const b=~n.index;(function FI(e){let n=e.length;for(;n>0;){const t=e[--n];if("number"==typeof t&&t<0)return t}return 0})(p)!=b&&p.push(b),p.push(t,r,u)}}(e,n,r,jp(e,t,a.hostVars,Ot),a)}function qI(e,n,t,r,a,u){const p=u[n];if(null!==p)for(let b=0;b<p.length;)Lx(r,t,p[b++],p[b++],p[b++])}function Lx(e,n,t,r,a){const u=ke(null);try{const p=e.inputTransforms;null!==p&&p.hasOwnProperty(r)&&(a=p[r].call(n,a)),null!==e.setInput?e.setInput(n,a,t,r):n[r]=a}finally{ke(u)}}function GI(e,n,t){let r=null,a=0;for(;a<t.length;){const u=t[a];if(0!==u)if(5!==u){if("number"==typeof u)break;if(e.hasOwnProperty(u)){null===r&&(r=[]);const p=e[u];for(let b=0;b<p.length;b+=2)if(p[b]===n){r.push(u,p[b+1],t[a+1]);break}}a+=2}else a+=2;else a+=4}return r}function Nx(e,n){const t=e.contentQueries;if(null!==t)for(let r=0;r<t.length;r+=2){const u=t[r+1];if(-1!==u){const p=e.data[u];fh(t[r]),p.contentQueries(2,n[u],u)}}}function Gm(e,n){return e[Gs]?e[iu][Qr]=n:e[Gs]=n,e[iu]=n,n}function f_(e,n,t){fh(0);const r=ke(null);try{n(e,t)}finally{ke(r)}}function zx(e){return e[hs]||(e[hs]=[])}function Bx(e){return e.cleanup||(e.cleanup=[])}function jx(e,n){const t=e[Qn],r=t?t.get(zl,null):null;r&&r.handleError(n)}function m_(e,n,t,r,a){for(let u=0;u<t.length;){const p=t[u++],b=t[u++];Lx(e.data[p],n[p],r,b,a)}}function ZI(e,n){const t=no(n,e),r=t[Ge];!function WI(e,n){for(let t=n.length;t<e.blueprint.length;t++)n.push(e.blueprint[t])}(r,t);const a=t[Tn];null!==a&&null===t[Qi]&&(t[Qi]=Xy(a,t[Qn])),g_(r,t,t[Vn])}function g_(e,n,t){Cl(n);try{const r=e.viewQuery;null!==r&&f_(1,r,t);const a=e.template;null!==a&&Mx(e,n,a,1,t),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Nx(e,n),e.staticViewQueries&&f_(2,e.viewQuery,t);const u=e.components;null!==u&&function XI(e,n){for(let t=0;t<n.length;t++)ZI(e,n[t])}(n,u)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{n[at]&=-5,fu()}}let $x=(()=>{class e{constructor(){this.all=new Set,this.queue=new Map}create(t,r,a){const u=typeof Zone>"u"?null:Zone.current,p=function _o(e,n,t){const r=Object.create(vo);t&&(r.consumerAllowSignalWrites=!0),r.fn=e,r.schedule=n;const a=p=>{r.cleanupFn=p};return r.ref={notify:()=>kt(r),run:()=>{if(r.dirty=!1,r.hasRun&&!pr(r))return;r.hasRun=!0;const p=An(r);try{r.cleanupFn(),r.cleanupFn=Ci,r.fn(a)}finally{un(r,p)}},cleanup:()=>r.cleanupFn()},r.ref}(t,M=>{this.all.has(M)&&this.queue.set(M,u)},a);let b;this.all.add(p),p.notify();const w=()=>{p.cleanup(),b?.(),this.all.delete(p),this.queue.delete(p)};return b=r?.onDestroy(w),{destroy:w}}flush(){if(0!==this.queue.size)for(const[t,r]of this.queue)this.queue.delete(t),r?r.run(()=>t.run()):t.run()}get isQueueEmpty(){return 0===this.queue.size}static#e=this.\u0275prov=ct({token:e,providedIn:"root",factory:()=>new e})}return e})();function Zm(e,n,t){let r=t?e.styles:null,a=t?e.classes:null,u=0;if(null!==n)for(let p=0;p<n.length;p++){const b=n[p];"number"==typeof b?u=b:1==u?a=il(a,b):2==u&&(r=il(r,b+": "+n[++p]+";"))}t?e.styles=r:e.stylesWithoutHost=r,t?e.classes=a:e.classesWithoutHost=a}function $p(e,n,t,r,a=!1){for(;null!==t;){const u=n[t.index];null!==u&&r.push(kn(u)),Sr(u)&&Ux(u,r);const p=t.type;if(8&p)$p(e,n,t.child,r);else if(32&p){const b=Nh(t,n);let w;for(;w=b();)r.push(w)}else if(16&p){const b=Le(n,t);if(Array.isArray(b))r.push(...b);else{const w=Fl(n[jn]);$p(w[Ge],w,b,r,!0)}}t=a?t.projectionNext:t.next}return r}function Ux(e,n){for(let t=qn;t<e.length;t++){const r=e[t],a=r[Ge].firstChild;null!==a&&$p(r[Ge],r,a,n)}e[Yt]!==e[Tn]&&n.push(e[Yt])}function Wm(e,n,t,r=!0){const a=n[tn],u=a.rendererFactory,p=a.afterRenderEventManager;u.begin?.(),p?.begin();try{Hx(e,n,e.template,t)}catch(w){throw r&&jx(n,w),w}finally{u.end?.(),a.effectManager?.flush(),p?.end()}}function Hx(e,n,t,r){const a=n[at];if(256!=(256&a)){n[tn].effectManager?.flush(),Cl(n);try{Ud(n),function $f(e){return pt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==t&&Mx(e,n,t,2,r);const p=3==(3&a);if(p){const M=e.preOrderCheckHooks;null!==M&&vh(n,M,null)}else{const M=e.preOrderHooks;null!==M&&xh(n,M,0,null),gs(n,0)}if(function QI(e){for(let n=zh(e);null!==n;n=Ap(n)){if(!n[ds])continue;const t=n[eo];for(let r=0;r<t.length;r++){Qg(t[r])}}}(n),qx(n,2),null!==e.contentQueries&&Nx(e,n),p){const M=e.contentCheckHooks;null!==M&&vh(n,M)}else{const M=e.contentHooks;null!==M&&xh(n,M,1),gs(n,1)}!function CI(e,n){const t=e.hostBindingOpCodes;if(null===t)return;const r=bx(n,Cn);try{for(let a=0;a<t.length;a++){const u=t[a];if(u<0)qo(~u);else{const p=u,b=t[++a],w=t[++a];ny(b,p),r.dirty=!1;const M=An(r);try{w(2,n[p])}finally{un(r,M)}}}}finally{null===n[Cn]&&wx(n,Cn),qo(-1)}}(e,n);const b=e.components;null!==b&&Zx(n,b,0);const w=e.viewQuery;if(null!==w&&f_(2,w,r),p){const M=e.viewCheckHooks;null!==M&&vh(n,M)}else{const M=e.viewHooks;null!==M&&xh(n,M,2),gs(n,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),n[at]&=-73,ei(n)}finally{fu()}}}function qx(e,n){for(let t=zh(e);null!==t;t=Ap(t))for(let r=qn;r<t.length;r++)Gx(t[r],n)}function JI(e,n,t){Gx(no(n,e),t)}function Gx(e,n){if(!function lh(e){return 128==(128&e[at])}(e))return;const t=e[Ge],r=e[at];if(80&r&&0===n||1024&r||2===n)Hx(t,e,t.template,e[Vn]);else if(e[qs]>0){qx(e,1);const a=t.components;null!==a&&Zx(e,a,1)}}function Zx(e,n,t){for(let r=0;r<n.length;r++)JI(e,n[r],t)}class Up{get rootNodes(){const n=this._lView,t=n[Ge];return $p(t,n,t.firstChild,[])}constructor(n,t){this._lView=n,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Vn]}set context(n){this._lView[Vn]=n}get destroyed(){return 256==(256&this._lView[at])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[en];if(Sr(n)){const t=n[8],r=t?t.indexOf(this):-1;r>-1&&(x(n,r),Vr(t,r))}this._attachedToViewContainer=!1}C(this._lView[Ge],this._lView)}onDestroy(n){!function uh(e,n){if(256==(256&e[at]))throw new Ve(911,!1);null===e[Fi]&&(e[Fi]=[]),e[Fi].push(n)}(this._lView,n)}markForCheck(){Vp(this._cdRefInjectingView||this._lView)}detach(){this._lView[at]&=-129}reattach(){this._lView[at]|=128}detectChanges(){Wm(this._lView[Ge],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ve(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function i(e,n){We(e,n,n[vt],2,null,null)}(this._lView[Ge],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Ve(902,!1);this._appRef=n}}class eE extends Up{constructor(n){super(n),this._view=n}detectChanges(){const n=this._view;Wm(n[Ge],n,n[Vn],!1)}checkNoChanges(){}get context(){return null}}class Wx extends Vm{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const t=$t(n);return new Hp(t,this.ngModule)}}function Xx(e){const n=[];for(let t in e)e.hasOwnProperty(t)&&n.push({propName:e[t],templateName:t});return n}class nE{constructor(n,t){this.injector=n,this.parentInjector=t}get(n,t,r){r=ml(r);const a=this.injector.get(n,Qy,r);return a!==Qy||t===Qy?a:this.parentInjector.get(n,t,r)}}class Hp extends J0{get inputs(){const n=this.componentDef,t=n.inputTransforms,r=Xx(n.inputs);if(null!==t)for(const a of r)t.hasOwnProperty(a.propName)&&(a.transform=t[a.propName]);return r}get outputs(){return Xx(this.componentDef.outputs)}constructor(n,t){super(),this.componentDef=n,this.ngModule=t,this.componentType=n.type,this.selector=function Jc(e){return e.map(Ld).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!t}create(n,t,r,a){let u=(a=a||this.ngModule)instanceof xs?a:a?.injector;u&&null!==this.componentDef.getStandaloneInjector&&(u=this.componentDef.getStandaloneInjector(u)||u);const p=u?new nE(n,u):n,b=p.get(tx,null);if(null===b)throw new Ve(407,!1);const B={rendererFactory:b,sanitizer:p.get(QS,null),effectManager:p.get($x,null),afterRenderEventManager:p.get(o_,null)},W=b.createRenderer(null,this.componentDef),re=this.componentDef.selectors[0][0]||"div",pe=r?function SI(e,n,t,r){const u=r.get(yx,!1)||t===Ri.ShadowDom,p=e.selectRootElement(n,u);return function II(e){Ax(e)}(p),p}(W,r,this.componentDef.encapsulation,p):Tc(W,re,function tE(e){const n=e.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(re)),Be=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let Ce=null;null!==pe&&(Ce=Xy(pe,p,!0));const dt=u_(0,null,null,1,0,null,null,null,null,null,null),It=qm(null,dt,null,Be,null,null,B,W,p,null,Ce);let Qt,Mo;Cl(It);try{const Wl=this.componentDef;let Id,w0=null;Wl.findHostDirectiveDefs?(Id=[],w0=new Map,Wl.findHostDirectiveDefs(Wl,Id,w0),Id.push(Wl)):Id=[Wl];const VF=function iE(e,n){const t=e[Ge],r=Ft;return e[r]=n,Kh(t,r,2,"#host",null)}(It,pe),jF=function oE(e,n,t,r,a,u,p){const b=a[Ge];!function sE(e,n,t,r){for(const a of e)n.mergedAttrs=Ta(n.mergedAttrs,a.hostAttrs);null!==n.mergedAttrs&&(Zm(n,n.mergedAttrs,!0),null!==t&&Wn(r,t,n))}(r,e,n,p);let w=null;null!==n&&(w=Xy(n,a[Qn]));const M=u.rendererFactory.createRenderer(n,t);let R=16;t.signals?R=4096:t.onPush&&(R=64);const B=qm(a,Tx(t),null,R,a[e.index],e,u,M,null,null,w);return b.firstCreatePass&&d_(b,e,r.length-1),Gm(a,B),a[e.index]=B}(VF,pe,Wl,Id,It,B,W);Mo=$d(dt,Ft),pe&&function lE(e,n,t,r){if(r)lc(e,t,["ng-version",JS.full]);else{const{attrs:a,classes:u}=function oh(e){const n=[],t=[];let r=1,a=2;for(;r<e.length;){let u=e[r];if("string"==typeof u)2===a?""!==u&&n.push(u,e[++r]):8===a&&t.push(u);else{if(!Oi(a))break;a=u}r++}return{attrs:n,classes:t}}(n.selectors[0]);a&&lc(e,t,a),u&&u.length>0&&ri(e,t,u.join(" "))}}(W,Wl,pe,r),void 0!==t&&function cE(e,n,t){const r=e.projection=[];for(let a=0;a<n.length;a++){const u=t[a];r.push(null!=u?Array.from(u):null)}}(Mo,this.ngContentSelectors,t),Qt=function aE(e,n,t,r,a,u){const p=ti(),b=a[Ge],w=hi(p,a);Rx(b,a,p,t,null,r);for(let R=0;R<t.length;R++)pi(Il(a,b,p.directiveStart+R,p),a);Ox(b,a,p),w&&pi(w,a);const M=Il(a,b,p.directiveStart+p.componentOffset,p);if(e[Vn]=a[Vn]=M,null!==u)for(const R of u)R(M,n);return a_(b,p,e),M}(jF,Wl,Id,w0,It,[uE]),g_(dt,It,null)}finally{fu()}return new rE(this.componentType,Qt,Wh(Mo,It),It,Mo)}}class rE extends GS{constructor(n,t,r,a,u){super(),this.location=r,this._rootLView=a,this._tNode=u,this.previousInputValues=null,this.instance=t,this.hostView=this.changeDetectorRef=new eE(a),this.componentType=n}setInput(n,t){const r=this._tNode.inputs;let a;if(null!==r&&(a=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),t))return;const u=this._rootLView;m_(u[Ge],u,a,n,t),this.previousInputValues.set(n,t),Vp(no(this._tNode.index,u))}}get injector(){return new Er(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function uE(){const e=ti();_h(Me()[Ge],e)}function Bi(e,n,t){return!Object.is(e[n],t)&&(e[n]=t,!0)}function D_(e,n,t){const r=Me();return Bi(r,function gc(){return pt.lFrame.bindingIndex++}(),n)&&function Ko(e,n,t,r,a,u,p,b){const w=hi(n,t);let R,M=n.inputs;!b&&null!=M&&(R=M[r])?(m_(e,t,R,r,a),jo(n)&&function RI(e,n){const t=no(n,e);16&t[at]||(t[at]|=64)}(t,n.index)):3&n.type&&(r=function kI(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),a=null!=p?p(a,n.value||"",r):a,u.setProperty(w,r,a))}(Kt(),function Zn(){const e=pt.lFrame;return $d(e.tView,e.selectedIndex)}(),r,e,n,r[vt],t,!1),D_}function S_(e,n,t,r,a){const p=a?"class":"style";m_(e,t,n.inputs[p],p,r)}function sa(e,n,t,r){const a=Me(),u=Kt(),p=Ft+e,b=a[vt],w=u.firstCreatePass?function qE(e,n,t,r,a,u){const p=n.consts,w=Kh(n,e,2,r,Ys(p,a));return function h_(e,n,t,r){if(qd()){const a=null===r?null:{"":-1},u=function BI(e,n){const t=e.directiveRegistry;let r=null,a=null;if(t)for(let u=0;u<t.length;u++){const p=t[u];if(Qc(n,p.selectors,!1))if(r||(r=[]),Mt(p))if(null!==p.findHostDirectiveDefs){const b=[];a=a||new Map,p.findHostDirectiveDefs(p,b,a),r.unshift(...b,p),d_(e,n,b.length)}else r.unshift(p),d_(e,n,0);else a=a||new Map,p.findHostDirectiveDefs?.(p,r,a),r.push(p)}return null===r?null:[r,a]}(e,t);let p,b;null===u?p=b=null:[p,b]=u,null!==p&&Rx(e,n,t,p,a,b),a&&function VI(e,n,t){if(n){const r=e.localNames=[];for(let a=0;a<n.length;a+=2){const u=t[n[a+1]];if(null==u)throw new Ve(-301,!1);r.push(n[a],u)}}}(t,r,a)}t.mergedAttrs=Ta(t.mergedAttrs,t.attrs)}(n,t,w,Ys(p,u)),null!==w.attrs&&Zm(w,w.attrs,!1),null!==w.mergedAttrs&&Zm(w,w.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,w),w}(p,u,a,n,t,r):u.data[p],M=gb(u,a,w,b,n,e);a[p]=M;const R=Oa(w);return xo(w,!0),Wn(b,M,w),32!=(32&w.flags)&&mu()&&je(u,a,M,w),0===function Jg(){return pt.lFrame.elementDepthCount}()&&pi(M,a),function Ff(){pt.lFrame.elementDepthCount++}(),R&&(function l_(e,n,t){qd()&&(function NI(e,n,t,r){const a=t.directiveStart,u=t.directiveEnd;jo(t)&&function HI(e,n,t){const r=hi(n,e),a=Tx(t);let p=16;t.signals?p=4096:t.onPush&&(p=64);const b=Gm(e,qm(e,a,null,p,r,n,null,e[tn].rendererFactory.createRenderer(r,t),null,null,null));e[n.index]=b}(n,t,e.data[a+t.componentOffset]),e.firstCreatePass||Dh(t,n),pi(r,n);const p=t.initialInputs;for(let b=a;b<u;b++){const w=e.data[b],M=Il(n,e,b,t);pi(M,n),null!==p&&qI(0,b-a,M,w,0,p),Mt(w)&&(no(t.index,n)[Vn]=Il(n,e,b,t))}}(e,n,t,hi(t,n)),64==(64&t.flags)&&Ox(e,n,t))}(u,a,w),a_(u,w,a)),null!==r&&function c_(e,n,t=hi){const r=n.localNames;if(null!==r){let a=n.index+1;for(let u=0;u<r.length;u+=2){const p=r[u+1],b=-1===p?t(n,e):e[p];e[a++]=b}}}(a,w),sa}function Cs(){let e=ti();mc()?function hh(){pt.lFrame.isParent=!1}():(e=e.parent,xo(e,!1));const n=e;(function Gd(e){return pt.skipHydrationRootTNode===e})(n)&&function ro(){pt.skipHydrationRootTNode=null}(),function Nf(){pt.lFrame.elementDepthCount--}();const t=Kt();return t.firstCreatePass&&(_h(t,e),ps(e)&&t.queries.elementEnd(e)),null!=n.classesWithoutHost&&function ly(e){return 0!=(8&e.flags)}(n)&&S_(t,n,Me(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function cy(e){return 0!=(16&e.flags)}(n)&&S_(t,n,Me(),n.stylesWithoutHost,!1),Cs}function ad(e,n,t,r){return sa(e,n,t,r),Cs(),ad}let gb=(e,n,t,r,a,u)=>(Ba(!0),Tc(r,a,function yh(){return pt.lFrame.currentNamespace}()));function tg(e){return!!e&&"function"==typeof e.then}function vb(e){return!!e&&"function"==typeof e.subscribe}function ng(e,n,t,r){const a=Me(),u=Kt(),p=ti();return function bb(e,n,t,r,a,u,p){const b=Oa(r),M=e.firstCreatePass&&Bx(e),R=n[Vn],B=zx(n);let W=!0;if(3&r.type||p){const ve=hi(r,n),Ae=p?p(ve):ve,Be=B.length,Ce=p?It=>p(kn(It[r.index])):r.index;let dt=null;if(!p&&b&&(dt=function QE(e,n,t,r){const a=e.cleanup;if(null!=a)for(let u=0;u<a.length-1;u+=2){const p=a[u];if(p===t&&a[u+1]===r){const b=n[hs],w=a[u+2];return b.length>w?b[w]:null}"string"==typeof p&&(u+=2)}return null}(e,n,a,r.index)),null!==dt)(dt.__ngLastListenerFn__||dt).__ngNextListenerFn__=u,dt.__ngLastListenerFn__=u,W=!1;else{u=Cb(r,n,R,u,!1);const It=t.listen(Ae,a,u);B.push(u,It),M&&M.push(a,Ce,Be,Be+1)}}else u=Cb(r,n,R,u,!1);const re=r.outputs;let pe;if(W&&null!==re&&(pe=re[a])){const ve=pe.length;if(ve)for(let Ae=0;Ae<ve;Ae+=2){const Qt=n[pe[Ae]][pe[Ae+1]].subscribe(u),Mo=B.length;B.push(u,Qt),M&&M.push(a,r.index,Mo,-(Mo+1))}}}(u,a,a[vt],p,e,n,r),ng}function wb(e,n,t,r){try{return Uo(6,n,t),!1!==t(r)}catch(a){return jx(e,a),!1}finally{Uo(7,n,t)}}function Cb(e,n,t,r,a){return function u(p){if(p===Function)return r;Vp(e.componentOffset>-1?no(e.index,n):n);let w=wb(n,t,r,p),M=u.__ngNextListenerFn__;for(;M;)w=wb(n,t,M,p)&&w,M=M.__ngNextListenerFn__;return a&&!1===w&&p.preventDefault(),w}}function rg(e,n){return e<<17|n<<2}function Pc(e){return e>>17&32767}function T_(e){return 2|e}function Lu(e){return(131068&e)>>2}function A_(e,n){return-131069&e|n<<2}function P_(e){return 1|e}function Rb(e,n,t,r,a){const u=e[t+1],p=null===n;let b=r?Pc(u):Lu(u),w=!1;for(;0!==b&&(!1===w||p);){const R=e[b+1];lM(e[b],n)&&(w=!0,e[b+1]=r?P_(R):T_(R)),b=r?Pc(R):Lu(R)}w&&(e[t+1]=r?T_(u):P_(u))}function lM(e,n){return null===e||null==n||(Array.isArray(e)?e[1]:e)===n||!(!Array.isArray(e)||"string"!=typeof n)&&ea(e,n)>=0}const si={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Ob(e){return e.substring(si.key,si.keyEnd)}function cM(e){return e.substring(si.value,si.valueEnd)}function Fb(e,n){const t=si.textEnd;let r=si.key=ld(e,n,t);return t===r?-1:(r=si.keyEnd=function pM(e,n,t){let r;for(;n<t&&(45===(r=e.charCodeAt(n))||95===r||(-33&r)>=65&&(-33&r)<=90||r>=48&&r<=57);)n++;return n}(e,r,t),r=zb(e,r,t),r=si.value=ld(e,r,t),r=si.valueEnd=function fM(e,n,t){let r=-1,a=-1,u=-1,p=n,b=p;for(;p<t;){const w=e.charCodeAt(p++);if(59===w)return b;34===w||39===w?b=p=Bb(e,w,p,t):n===p-4&&85===u&&82===a&&76===r&&40===w?b=p=Bb(e,41,p,t):w>32&&(b=p),u=a,a=r,r=-33&w}return b}(e,r,t),zb(e,r,t))}function ld(e,n,t){for(;n<t&&e.charCodeAt(n)<=32;)n++;return n}function zb(e,n,t,r){return(n=ld(e,n,t))<t&&n++,n}function Bb(e,n,t,r){let a=-1,u=t;for(;u<r;){const p=e.charCodeAt(u++);if(p==n&&92!==a)return u;a=92==p&&92===a?0:p}throw new Error}function aa(e){!function ca(e,n,t,r){const a=Kt(),u=function Qs(e){const n=pt.lFrame,t=n.bindingIndex;return n.bindingIndex=n.bindingIndex+e,t}(2);a.firstUpdatePass&&function Ub(e,n,t,r){const a=e.data;if(null===a[t+1]){const u=a[di()],p=$b(e,t);Zb(u,r)&&null===n&&!p&&(n=!1),n=function yM(e,n,t,r){const a=function Nn(e){const n=pt.lFrame.currentDirectiveIndex;return-1===n?null:e[n]}(e);let u=r?n.residualClasses:n.residualStyles;if(null===a)0===(r?n.classBindings:n.styleBindings)&&(t=Xp(t=k_(null,e,n,t,r),n.attrs,r),u=null);else{const p=n.directiveStylingLast;if(-1===p||e[p]!==a)if(t=k_(a,e,n,t,r),null===u){let w=function _M(e,n,t){const r=t?n.classBindings:n.styleBindings;if(0!==Lu(r))return e[Pc(r)]}(e,n,r);void 0!==w&&Array.isArray(w)&&(w=k_(null,e,n,w[1],r),w=Xp(w,n.attrs,r),function vM(e,n,t,r){e[Pc(t?n.classBindings:n.styleBindings)]=r}(e,n,r,w))}else u=function xM(e,n,t){let r;const a=n.directiveEnd;for(let u=1+n.directiveStylingLast;u<a;u++)r=Xp(r,e[u].hostAttrs,t);return Xp(r,n.attrs,t)}(e,n,r)}return void 0!==u&&(r?n.residualClasses=u:n.residualStyles=u),t}(a,u,n,r),function sM(e,n,t,r,a,u){let p=u?n.classBindings:n.styleBindings,b=Pc(p),w=Lu(p);e[r]=t;let R,M=!1;if(Array.isArray(t)?(R=t[1],(null===R||ea(t,R)>0)&&(M=!0)):R=t,a)if(0!==w){const W=Pc(e[b+1]);e[r+1]=rg(W,b),0!==W&&(e[W+1]=A_(e[W+1],r)),e[b+1]=function iM(e,n){return 131071&e|n<<17}(e[b+1],r)}else e[r+1]=rg(b,0),0!==b&&(e[b+1]=A_(e[b+1],r)),b=r;else e[r+1]=rg(w,0),0===b?b=r:e[w+1]=A_(e[w+1],r),w=r;M&&(e[r+1]=T_(e[r+1])),Rb(e,R,r,!0),Rb(e,R,r,!1),function aM(e,n,t,r,a){const u=a?e.residualClasses:e.residualStyles;null!=u&&"string"==typeof n&&ea(u,n)>=0&&(t[r+1]=P_(t[r+1]))}(n,R,e,r,u),p=rg(b,w),u?n.classBindings=p:n.styleBindings=p}(a,u,n,t,p,r)}}(a,null,u,r);const p=Me();if(t!==Ot&&Bi(p,u,t)){const b=a.data[di()];if(Zb(b,r)&&!$b(a,u)){let w=r?b.classesWithoutHost:b.stylesWithoutHost;null!==w&&(t=il(w,t||"")),S_(a,b,p,t,r)}else!function CM(e,n,t,r,a,u,p,b){a===Ot&&(a=Nt);let w=0,M=0,R=0<a.length?a[0]:null,B=0<u.length?u[0]:null;for(;null!==R||null!==B;){const W=w<a.length?a[w+1]:void 0,re=M<u.length?u[M+1]:void 0;let ve,pe=null;R===B?(w+=2,M+=2,W!==re&&(pe=B,ve=re)):null===B||null!==R&&R<B?(w+=2,pe=R):(M+=2,pe=B,ve=re),null!==pe&&qb(e,n,t,r,pe,ve,p,b),R=w<a.length?a[w]:null,B=M<u.length?u[M]:null}}(a,b,p,p[vt],p[u+1],p[u+1]=function bM(e,n,t){if(null==t||""===t)return Nt;const r=[],a=yr(t);if(Array.isArray(a))for(let u=0;u<a.length;u++)e(r,a[u],!0);else if("object"==typeof a)for(const u in a)a.hasOwnProperty(u)&&e(r,u,a[u]);else"string"==typeof a&&n(r,a);return r}(e,n,t),r,u)}}(Hb,mM,e,!1)}function mM(e,n){for(let t=function hM(e){return function Nb(e){si.key=0,si.keyEnd=0,si.value=0,si.valueEnd=0,si.textEnd=e.length}(e),Fb(e,ld(e,0,si.textEnd))}(n);t>=0;t=Fb(n,t))Hb(e,Ob(n),cM(n))}function $b(e,n){return n>=e.expandoStartIndex}function k_(e,n,t,r,a){let u=null;const p=t.directiveEnd;let b=t.directiveStylingLast;for(-1===b?b=t.directiveStart:b++;b<p&&(u=n[b],r=Xp(r,u.hostAttrs,a),u!==e);)b++;return null!==e&&(t.directiveStylingLast=b),r}function Xp(e,n,t){const r=t?1:2;let a=-1;if(null!==n)for(let u=0;u<n.length;u++){const p=n[u];"number"==typeof p?a=p:a===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),jr(e,p,!!t||n[++u]))}return void 0===e?null:e}function Hb(e,n,t){jr(e,n,yr(t))}function qb(e,n,t,r,a,u,p,b){if(!(3&n.type))return;const w=e.data,M=w[b+1],R=function oM(e){return 1==(1&e)}(M)?Gb(w,n,t,a,Lu(M),p):void 0;ig(R)||(ig(u)||function rM(e){return 2==(2&e)}(M)&&(u=Gb(w,null,t,a,b,p)),function cr(e,n,t,r,a){if(n)a?e.addClass(t,r):e.removeClass(t,r);else{let u=-1===r.indexOf("-")?void 0:ta.DashCase;null==a?e.removeStyle(t,r,u):("string"==typeof a&&a.endsWith("!important")&&(a=a.slice(0,-10),u|=ta.Important),e.setStyle(t,r,a,u))}}(r,p,function ah(e,n){return kn(n[e])}(di(),t),a,u))}function Gb(e,n,t,r,a,u){const p=null===n;let b;for(;a>0;){const w=e[a],M=Array.isArray(w),R=M?w[1]:w,B=null===R;let W=t[a+1];W===Ot&&(W=B?Nt:void 0);let re=B?Sc(W,r):R===r?W:void 0;if(M&&!ig(re)&&(re=Sc(w,r)),ig(re)&&(b=re,p))return b;const pe=e[a+1];a=p?Pc(pe):Lu(pe)}if(null!==n){let w=u?n.residualClasses:n.residualStyles;null!=w&&(b=Sc(w,r))}return b}function ig(e){return void 0!==e}function Zb(e,n){return 0!=(e.flags&(n?8:16))}function kc(e,n=""){const t=Me(),r=Kt(),a=e+Ft,u=r.firstCreatePass?Kh(r,a,1,n,null):r.data[a],p=Wb(r,t,u,n,e);t[a]=p,mu()&&je(r,t,p,u),xo(u,!1)}let Wb=(e,n,t,r,a)=>(Ba(!0),function qa(e,n){return e.createText(n)}(n[vt],r));const ud="en-US";let yw=ud;function F_(e,n,t,r,a){if(e=xt(e),Array.isArray(e))for(let u=0;u<e.length;u++)F_(e[u],n,t,r,a);else{const u=Kt(),p=Me(),b=ti();let w=Ru(e)?e:xt(e.provide);const M=Z0(e),R=1048575&b.providerIndexes,B=b.directiveStart,W=b.providerIndexes>>20;if(Ru(e)||!e.multi){const re=new gu(M,a,Ct),pe=z_(w,n,a?R:R+W,B);-1===pe?(vu(Dh(b,p),u,w),N_(u,e,n.length),n.push(w),b.directiveStart++,b.directiveEnd++,a&&(b.providerIndexes+=1048576),t.push(re),p.push(re)):(t[pe]=re,p[pe]=re)}else{const re=z_(w,n,R+W,B),pe=z_(w,n,R,R+W),Ae=pe>=0&&t[pe];if(a&&!Ae||!a&&!(re>=0&&t[re])){vu(Dh(b,p),u,w);const Be=function qT(e,n,t,r,a){const u=new gu(e,t,Ct);return u.multi=[],u.index=n,u.componentProviders=0,$w(u,a,r&&!t),u}(a?HT:UT,t.length,a,r,M);!a&&Ae&&(t[pe].providerFactory=Be),N_(u,e,n.length,0),n.push(w),b.directiveStart++,b.directiveEnd++,a&&(b.providerIndexes+=1048576),t.push(Be),p.push(Be)}else N_(u,e,re>-1?re:pe,$w(t[a?pe:re],M,!a&&r));!a&&r&&Ae&&t[pe].componentProviders++}}}function N_(e,n,t,r){const a=Ru(n),u=function TS(e){return!!e.useClass}(n);if(a||u){const w=(u?xt(n.useClass):n).prototype.ngOnDestroy;if(w){const M=e.destroyHooks||(e.destroyHooks=[]);if(!a&&n.multi){const R=M.indexOf(t);-1===R?M.push(t,[r,w]):M[R+1].push(r,w)}else M.push(t,w)}}}function $w(e,n,t){return t&&e.componentProviders++,e.multi.push(n)-1}function z_(e,n,t,r){for(let a=t;a<r;a++)if(n[a]===e)return a;return-1}function UT(e,n,t,r){return B_(this.multi,[])}function HT(e,n,t,r){const a=this.multi;let u;if(this.providerFactory){const p=this.providerFactory.componentProviders,b=Il(t,t[Ge],this.providerFactory.index,r);u=b.slice(0,p),B_(a,u);for(let w=p;w<b.length;w++)u.push(b[w])}else u=[],B_(a,u);return u}function B_(e,n){for(let t=0;t<e.length;t++)n.push((0,e[t])());return n}function Uw(e,n=[]){return t=>{t.providersResolver=(r,a)=>function $T(e,n,t){const r=Kt();if(r.firstCreatePass){const a=Mt(e);F_(t,r.data,r.blueprint,a,!0),F_(n,r.data,r.blueprint,a,!1)}}(r,a?a(e):e,n)}}class Nu{}class Hw{}class V_ extends Nu{constructor(n,t,r){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Wx(this);const a=ci(n);this._bootstrapComponents=Bl(a.bootstrap),this._r3Injector=sx(n,t,[{provide:Nu,useValue:this},{provide:Vm,useValue:this.componentFactoryResolver},...r],xn(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class j_ extends Hw{constructor(n){super(),this.moduleType=n}create(n){return new V_(this.moduleType,n,[])}}class qw extends Nu{constructor(n){super(),this.componentFactoryResolver=new Wx(this),this.instance=null;const t=new Uh([...n.providers,{provide:Nu,useValue:this},{provide:Vm,useValue:this.componentFactoryResolver}],n.parent||Rm(),n.debugName,new Set(["environment"]));this.injector=t,n.runEnvironmentInitializers&&t.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function $_(e,n,t=null){return new qw({providers:e,parent:n,debugName:t,runEnvironmentInitializers:!0}).injector}let WT=(()=>{class e{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t)){const r=U0(0,t.type),a=r.length>0?$_([r],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t,a)}return this.cachedInjectors.get(t)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=ct({token:e,providedIn:"environment",factory:()=>new e(ht(xs))})}return e})();function Gw(e){e.getStandaloneInjector=n=>n.get(WT).getOrCreateStandaloneInjector(e)}function H_(e,n,t){const r=function Di(){const e=pt.lFrame;let n=e.bindingRootIndex;return-1===n&&(n=e.bindingRootIndex=e.tView.bindingStartIndex),n}()+e,a=Me();return a[r]===Ot?function Xa(e,n,t){return e[n]=t}(a,r,t?n.call(t):n()):function qp(e,n){return e[n]}(a,r)}function vA(){return this._results[Symbol.iterator]()}class q_{static#e=Symbol.iterator;get changes(){return this._changes||(this._changes=new st)}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=q_.prototype;t[Symbol.iterator]||(t[Symbol.iterator]=vA)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,t){return this._results.reduce(n,t)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,t){const r=this;r.dirty=!1;const a=function bo(e){return e.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function yy(e,n,t){if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++){let a=e[r],u=n[r];if(t&&(a=t(a),u=t(u)),u!==a)return!1}return!0}(r._results,a,t))&&(r._results=a,r.length=a.length,r.last=a[this.length-1],r.first=a[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function bA(e,n,t,r=!0){const a=n[Ge];if(function h(e,n,t,r){const a=qn+r,u=t.length;r>0&&(t[a-1][Qr]=n),r<u-qn?(n[Qr]=t[a],cp(t,qn+r,n)):(t.push(n),n[Qr]=null),n[en]=t;const p=n[_l];null!==p&&t!==p&&function f(e,n){const t=e[eo];n[jn]!==n[en][en][jn]&&(e[ds]=!0),null===t?e[eo]=[n]:t.push(n)}(p,n);const b=n[wi];null!==b&&b.insertView(e),n[at]|=128}(a,n,e,t),r){const u=He(t,e),p=n[vt],b=ae(p,e[Yt]);null!==b&&function s(e,n,t,r,a,u){r[Tn]=a,r[Kn]=n,We(e,r,t,1,a,u)}(a,e[Kn],p,n,b,u)}}let jl=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=DA}return e})();const wA=jl,CA=class extends wA{constructor(n,t,r){super(),this._declarationLView=n,this._declarationTContainer=t,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,t){return this.createEmbeddedViewImpl(n,t)}createEmbeddedViewImpl(n,t,r){const a=function xA(e,n,t,r){const a=n.tView,b=qm(e,a,t,4096&e[at]?4096:16,null,n,null,null,null,r?.injector??null,r?.hydrationInfo??null);b[_l]=e[n.index];const M=e[wi];return null!==M&&(b[wi]=M.createEmbeddedView(a)),g_(a,b,t),b}(this._declarationLView,this._declarationTContainer,n,{injector:t,hydrationInfo:r});return new Up(a)}};function DA(){return cg(ti(),Me())}function cg(e,n){return 4&e.type?new CA(n,e,Wh(e,n)):null}let ua=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=AA}return e})();function AA(){return u1(ti(),Me())}const PA=ua,l1=class extends PA{constructor(n,t,r){super(),this._lContainer=n,this._hostTNode=t,this._hostLView=r}get element(){return Wh(this._hostTNode,this._hostLView)}get injector(){return new Er(this._hostTNode,this._hostLView)}get parentInjector(){const n=_u(this._hostTNode,this._hostLView);if(Dl(n)){const t=yu(n,this._hostLView),r=Sl(n);return new Er(t[Ge].data[r+8],t)}return new Er(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const t=c1(this._lContainer);return null!==t&&t[n]||null}get length(){return this._lContainer.length-qn}createEmbeddedView(n,t,r){let a,u;"number"==typeof r?a=r:null!=r&&(a=r.index,u=r.injector);const b=n.createEmbeddedViewImpl(t||{},u,null);return this.insertImpl(b,a,false),b}createComponent(n,t,r,a,u){const p=n&&!function Cu(e){return"function"==typeof e}(n);let b;if(p)b=t;else{const ve=t||{};b=ve.index,r=ve.injector,a=ve.projectableNodes,u=ve.environmentInjector||ve.ngModuleRef}const w=p?n:new Hp($t(n)),M=r||this.parentInjector;if(!u&&null==w.ngModule){const Ae=(p?M:this.parentInjector).get(xs,null);Ae&&(u=Ae)}$t(w.componentType??{});const re=w.create(M,a,null,u);return this.insertImpl(re.hostView,b,false),re}insert(n,t){return this.insertImpl(n,t,!1)}insertImpl(n,t,r){const a=n._lView;if(function ch(e){return Sr(e[en])}(a)){const w=this.indexOf(n);if(-1!==w)this.detach(w);else{const M=a[en],R=new l1(M,M[Kn],M[en]);R.detach(R.indexOf(n))}}const p=this._adjustIndex(t),b=this._lContainer;return bA(b,a,p,!r),n.attachToViewContainerRef(),cp(G_(b),p,n),n}move(n,t){return this.insert(n,t)}indexOf(n){const t=c1(this._lContainer);return null!==t?t.indexOf(n):-1}remove(n){const t=this._adjustIndex(n,-1),r=x(this._lContainer,t);r&&(Vr(G_(this._lContainer),t),C(r[Ge],r))}detach(n){const t=this._adjustIndex(n,-1),r=x(this._lContainer,t);return r&&null!=Vr(G_(this._lContainer),t)?new Up(r):null}_adjustIndex(n,t=0){return n??this.length+t}};function c1(e){return e[8]}function G_(e){return e[8]||(e[8]=[])}function u1(e,n){let t;const r=n[e.index];return Sr(r)?t=r:(t=function Fx(e,n,t,r){return[e,!0,!1,n,null,0,r,t,null,null,null]}(r,n,null,e),n[e.index]=t,Gm(n,t)),h1(t,n,e,r),new l1(t,e,n)}let h1=function d1(e,n,t,r){if(e[Yt])return;let a;a=8&t.type?kn(r):function kA(e,n){const t=e[vt],r=t.createComment(""),a=hi(n,e);return j(t,ae(t,a),r,function ie(e,n){return e.nextSibling(n)}(t,a),!1),r}(n,t),e[Yt]=a};class Z_{constructor(n){this.queryList=n,this.matches=null}clone(){return new Z_(this.queryList)}setDirty(){this.queryList.setDirty()}}class W_{constructor(n=[]){this.queries=n}createEmbeddedView(n){const t=n.queries;if(null!==t){const r=null!==n.contentQueries?n.contentQueries[0]:t.length,a=[];for(let u=0;u<r;u++){const p=t.getByIndex(u);a.push(this.queries[p.indexInDeclarationView].clone())}return new W_(a)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let t=0;t<this.queries.length;t++)null!==_1(n,t).matches&&this.queries[t].setDirty()}}class p1{constructor(n,t,r=null){this.predicate=n,this.flags=t,this.read=r}}class X_{constructor(n=[]){this.queries=n}elementStart(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,t)}elementEnd(n){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(n)}embeddedTView(n){let t=null;for(let r=0;r<this.length;r++){const a=null!==t?t.length:0,u=this.getByIndex(r).embeddedTView(n,a);u&&(u.indexInDeclarationView=r,null!==t?t.push(u):t=[u])}return null!==t?new X_(t):null}template(n,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,t)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class Y_{constructor(n,t=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(n,t){this.isApplyingToNode(t)&&this.matchTNode(n,t)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,t){this.elementStart(n,t)}embeddedTView(n,t){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,t),new Y_(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let r=n.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(n,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let a=0;a<r.length;a++){const u=r[a];this.matchTNodeWithReadOption(n,t,LA(t,u)),this.matchTNodeWithReadOption(n,t,bu(t,n,u,!1,!1))}else r===jl?4&t.type&&this.matchTNodeWithReadOption(n,t,-1):this.matchTNodeWithReadOption(n,t,bu(t,n,r,!1,!1))}matchTNodeWithReadOption(n,t,r){if(null!==r){const a=this.metadata.read;if(null!==a)if(a===Ac||a===ua||a===jl&&4&t.type)this.addMatch(t.index,-2);else{const u=bu(t,n,a,!1,!1);null!==u&&this.addMatch(t.index,u)}else this.addMatch(t.index,r)}}addMatch(n,t){null===this.matches?this.matches=[n,t]:this.matches.push(n,t)}}function LA(e,n){const t=e.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===n)return t[r+1];return null}function NA(e,n,t,r){return-1===t?function FA(e,n){return 11&e.type?Wh(e,n):4&e.type?cg(e,n):null}(n,e):-2===t?function zA(e,n,t){return t===Ac?Wh(n,e):t===jl?cg(n,e):t===ua?u1(n,e):void 0}(e,n,r):Il(e,e[Ge],t,n)}function f1(e,n,t,r){const a=n[wi].queries[r];if(null===a.matches){const u=e.data,p=t.matches,b=[];for(let w=0;w<p.length;w+=2){const M=p[w];b.push(M<0?null:NA(n,u[M],p[w+1],t.metadata.read))}a.matches=b}return a.matches}function K_(e,n,t,r){const a=e.queries.getByIndex(t),u=a.matches;if(null!==u){const p=f1(e,n,a,t);for(let b=0;b<u.length;b+=2){const w=u[b];if(w>0)r.push(p[b/2]);else{const M=u[b+1],R=n[-w];for(let B=qn;B<R.length;B++){const W=R[B];W[_l]===W[en]&&K_(W[Ge],W,M,r)}if(null!==R[eo]){const B=R[eo];for(let W=0;W<B.length;W++){const re=B[W];K_(re[Ge],re,M,r)}}}}}return r}function rf(e){const n=Me(),t=Kt(),r=du();fh(r+1);const a=_1(t,r);if(e.dirty&&function cu(e){return 4==(4&e[at])}(n)===(2==(2&a.metadata.flags))){if(null===a.matches)e.reset([]);else{const u=a.crossesNgTemplate?K_(t,n,r,[]):f1(t,n,a,r);e.reset(u,YS),e.notifyOnChanges()}return!0}return!1}function hg(e,n,t){const r=Kt();r.firstCreatePass&&(function y1(e,n,t){null===e.queries&&(e.queries=new X_),e.queries.track(new Y_(n,t))}(r,new p1(e,n,t),-1),2==(2&n)&&(r.staticViewQueries=!0)),function g1(e,n,t){const r=new q_(4==(4&t));(function TI(e,n,t,r){const a=zx(n);a.push(t),e.firstCreatePass&&Bx(e).push(r,a.length-1)})(e,n,r,r.destroy),null===n[wi]&&(n[wi]=new W_),n[wi].queries.push(new Z_(r))}(r,Me(),n)}function sf(){return function BA(e,n){return e[wi].queries[n].queryList}(Me(),du())}function _1(e,n){return e.queries.getByIndex(n)}const rv=new ot("Application Initializer");let iv=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,r)=>{this.resolve=t,this.reject=r}),this.appInits=Je(rv,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const t=[];for(const a of this.appInits){const u=a();if(tg(u))t.push(u);else if(vb(u)){const p=new Promise((b,w)=>{u.subscribe({complete:b,error:w})});t.push(p)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(t).then(()=>{r()}).catch(a=>{this.reject(a)}),0===t.length&&r(),this.initialized=!0}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),L1=(()=>{class e{log(t){console.log(t)}warn(t){console.warn(t)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const $l=new ot("LocaleId",{providedIn:"root",factory:()=>Je($l,Lt.Optional|Lt.SkipSelf)||function c2(){return typeof $localize<"u"&&$localize.locale||ud}()});let F1=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new qt(!1)}add(){this.hasPendingTasks.next(!0);const t=this.taskId++;return this.pendingTasks.add(t),t}remove(t){this.pendingTasks.delete(t),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class d2{constructor(n,t){this.ngModuleFactory=n,this.componentFactories=t}}let N1=(()=>{class e{compileModuleSync(t){return new j_(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const r=this.compileModuleSync(t),u=Bl(ci(t).declarations).reduce((p,b)=>{const w=$t(b);return w&&p.push(new Hp(w)),p},[]);return new d2(r,u)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const j1=new ot(""),fg=new ot("");let cv,av=(()=>{class e{constructor(t,r,a){this._ngZone=t,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,cv||(function O2(e){cv=e}(a),a.addToWindow(r)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Rn.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,a){let u=-1;r&&r>0&&(u=setTimeout(()=>{this._callbacks=this._callbacks.filter(p=>p.timeoutId!==u),t(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:t,timeoutId:u,updateCb:a})}whenStable(t,r,a){if(a&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,a),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,r,a){return[]}static#e=this.\u0275fac=function(r){return new(r||e)(ht(Rn),ht(lv),ht(fg))};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac})}return e})(),lv=(()=>{class e{constructor(){this._applications=new Map}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return cv?.findTestabilityInTree(this,t,r)??null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),Rc=null;const $1=new ot("AllowMultipleToken"),uv=new ot("PlatformDestroyListeners"),hv=new ot("appBootstrapListener");class H1{constructor(n,t){this.name=n,this.token=t}}function G1(e,n,t=[]){const r=`Platform: ${n}`,a=new ot(r);return(u=[])=>{let p=dv();if(!p||p.injector.get($1,!1)){const b=[...t,...u,{provide:a,useValue:!0}];e?e(b):function N2(e){if(Rc&&!Rc.get($1,!1))throw new Ve(400,!1);(function U1(){!function sr(e){fs=e}(()=>{throw new Ve(600,!1)})})(),Rc=e;const n=e.get(W1);(function q1(e){e.get(W0,null)?.forEach(t=>t())})(e)}(function Z1(e=[],n){return bs.create({name:n,providers:[{provide:zy,useValue:"platform"},{provide:uv,useValue:new Set([()=>Rc=null])},...e]})}(b,r))}return function B2(e){const n=dv();if(!n)throw new Ve(401,!1);return n}()}}function dv(){return Rc?.get(W1)??null}let W1=(()=>{class e{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const a=function V2(e="zone.js",n){return"noop"===e?new hI:"zone.js"===e?new Rn(n):e}(r?.ngZone,function X1(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:r?.ngZoneEventCoalescing,runCoalescing:r?.ngZoneRunCoalescing}));return a.run(()=>{const u=function ZT(e,n,t){return new V_(e,n,t)}(t.moduleType,this.injector,function eC(e){return[{provide:Rn,useFactory:e},{provide:Np,multi:!0,useFactory:()=>{const n=Je($2,{optional:!0});return()=>n.initialize()}},{provide:J1,useFactory:j2},{provide:hx,useFactory:dx}]}(()=>a)),p=u.injector.get(zl,null);return a.runOutsideAngular(()=>{const b=a.onError.subscribe({next:w=>{p.handleError(w)}});u.onDestroy(()=>{mg(this._modules,u),b.unsubscribe()})}),function Y1(e,n,t){try{const r=t();return tg(r)?r.catch(a=>{throw n.runOutsideAngular(()=>e.handleError(a)),a}):r}catch(r){throw n.runOutsideAngular(()=>e.handleError(r)),r}}(p,a,()=>{const b=u.injector.get(iv);return b.runInitializers(),b.donePromise.then(()=>(function _w(e){Xr(e,"Expected localeId to be defined"),"string"==typeof e&&(yw=e.toLowerCase().replace(/_/g,"-"))}(u.injector.get($l,ud)||ud),this._moduleDoBootstrap(u),u))})})}bootstrapModule(t,r=[]){const a=K1({},r);return function L2(e,n,t){const r=new j_(t);return Promise.resolve(r)}(0,0,t).then(u=>this.bootstrapModuleFactory(u,a))}_moduleDoBootstrap(t){const r=t.injector.get(pd);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(a=>r.bootstrap(a));else{if(!t.instance.ngDoBootstrap)throw new Ve(-403,!1);t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Ve(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const t=this._injector.get(uv,null);t&&(t.forEach(r=>r()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}static#e=this.\u0275fac=function(r){return new(r||e)(ht(bs))};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function K1(e,n){return Array.isArray(n)?n.reduce(K1,e):{...e,...n}}let pd=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Je(J1),this.zoneIsStable=Je(hx),this.componentTypes=[],this.components=[],this.isStable=Je(F1).hasPendingTasks.pipe(Cr(t=>t?yt(!1):this.zoneIsStable),function Hu(e,n=ir){return e=e??jc,_n((t,r)=>{let a,u=!0;t.subscribe(an(r,p=>{const b=n(p);(u||!e(a,b))&&(u=!1,a=b,r.next(p))}))})}(),vi()),this._injector=Je(xs)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,r){const a=t instanceof J0;if(!this._injector.get(iv).done)throw!a&&function us(e){const n=$t(e)||or(e)||Kr(e);return null!==n&&n.standalone}(t),new Ve(405,!1);let p;p=a?t:this._injector.get(Vm).resolveComponentFactory(t),this.componentTypes.push(p.componentType);const b=function F2(e){return e.isBoundToModule}(p)?void 0:this._injector.get(Nu),M=p.create(bs.NULL,[],r||p.selector,b),R=M.location.nativeElement,B=M.injector.get(j1,null);return B?.registerApplication(R),M.onDestroy(()=>{this.detachView(M.hostView),mg(this.components,M),B?.unregisterApplication(R)}),this._loadComponent(M),M}tick(){if(this._runningTick)throw new Ve(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this.internalErrorHandler(t)}finally{this._runningTick=!1}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;mg(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const r=this._injector.get(hv,[]);r.push(...this._bootstrapListeners),r.forEach(a=>a(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>mg(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new Ve(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function mg(e,n){const t=e.indexOf(n);t>-1&&e.splice(t,1)}const J1=new ot("",{providedIn:"root",factory:()=>Je(zl).handleError.bind(void 0)});function j2(){const e=Je(Rn),n=Je(zl);return t=>e.runOutsideAngular(()=>n.handleError(t))}let $2=(()=>{class e{constructor(){this.zone=Je(Rn),this.applicationRef=Je(pd)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();let pv=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=H2}return e})();function H2(e){return function q2(e,n,t){if(jo(e)&&!t){const r=no(e.index,n);return new Up(r,r)}return 47&e.type?new Up(n[jn],n):null}(ti(),Me(),16==(16&e))}const iP=G1(null,"core",[]);let oP=(()=>{class e{constructor(t){}static#e=this.\u0275fac=function(r){return new(r||e)(ht(pd))};static#t=this.\u0275mod=Ki({type:e});static#n=this.\u0275inj=Ai({})}return e})(),xv=null;function fd(){return xv}class vP{}const Ds=new ot("DocumentToken");let bv=(()=>{class e{historyGo(t){throw new Error("Not implemented")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:function(){return Je(bP)},providedIn:"platform"})}return e})();const xP=new ot("Location Initialized");let bP=(()=>{class e extends bv{constructor(){super(),this._doc=Je(Ds),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return fd().getBaseHref(this._doc)}onPopState(t){const r=fd().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=fd().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,a){this._history.pushState(t,r,a)}replaceState(t,r,a){this._history.replaceState(t,r,a)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:function(){return new e},providedIn:"platform"})}return e})();function wv(e,n){if(0==e.length)return n;if(0==n.length)return e;let t=0;return e.endsWith("/")&&t++,n.startsWith("/")&&t++,2==t?e+n.substring(1):1==t?e+n:e+"/"+n}function _C(e){const n=e.match(/#|\?|$/),t=n&&n.index||e.length;return e.slice(0,t-("/"===e[t-1]?1:0))+e.slice(t)}function Ul(e){return e&&"?"!==e[0]?"?"+e:e}let Bu=(()=>{class e{historyGo(t){throw new Error("Not implemented")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:function(){return Je(xC)},providedIn:"root"})}return e})();const vC=new ot("appBaseHref");let xC=(()=>{class e extends Bu{constructor(t,r){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??Je(Ds).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return wv(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+Ul(this._platformLocation.search),a=this._platformLocation.hash;return a&&t?`${r}${a}`:r}pushState(t,r,a,u){const p=this.prepareExternalUrl(a+Ul(u));this._platformLocation.pushState(t,r,p)}replaceState(t,r,a,u){const p=this.prepareExternalUrl(a+Ul(u));this._platformLocation.replaceState(t,r,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(r){return new(r||e)(ht(bv),ht(vC,8))};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),wP=(()=>{class e extends Bu{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=wv(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,a,u){let p=this.prepareExternalUrl(a+Ul(u));0==p.length&&(p=this._platformLocation.pathname),this._platformLocation.pushState(t,r,p)}replaceState(t,r,a,u){let p=this.prepareExternalUrl(a+Ul(u));0==p.length&&(p=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,p)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static#e=this.\u0275fac=function(r){return new(r||e)(ht(bv),ht(vC,8))};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac})}return e})(),Cv=(()=>{class e{constructor(t){this._subject=new st,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const r=this._locationStrategy.getBaseHref();this._basePath=function SP(e){if(new RegExp("^(https?:)?//").test(e)){const[,t]=e.split(/\/\/[^\/]+/);return t}return e}(_C(bC(r))),this._locationStrategy.onPopState(a=>{this._subject.emit({url:this.path(!0),pop:!0,state:a.state,type:a.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+Ul(r))}normalize(t){return e.stripTrailingSlash(function DP(e,n){if(!e||!n.startsWith(e))return n;const t=n.substring(e.length);return""===t||["/",";","?","#"].includes(t[0])?t:n}(this._basePath,bC(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",a=null){this._locationStrategy.pushState(a,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Ul(r)),a)}replaceState(t,r="",a=null){this._locationStrategy.replaceState(a,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Ul(r)),a)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(a=>a(t,r))}subscribe(t,r,a){return this._subject.subscribe({next:t,error:r,complete:a})}static#e=this.normalizeQueryParams=Ul;static#t=this.joinWithSlash=wv;static#n=this.stripTrailingSlash=_C;static#r=this.\u0275fac=function(r){return new(r||e)(ht(Bu))};static#i=this.\u0275prov=ct({token:e,factory:function(){return function CP(){return new Cv(ht(Bu))}()},providedIn:"root"})}return e})();function bC(e){return e.replace(/\/index.html$/,"")}let FC=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ki({type:e});static#n=this.\u0275inj=Ai({})}return e})();function zC(e){return"server"===e}let Uk=(()=>{class e{static#e=this.\u0275prov=ct({token:e,providedIn:"root",factory:()=>new Hk(ht(Ds),window)})}return e})();class Hk{constructor(n,t){this.document=n,this.window=t,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const t=function qk(e,n){const t=e.getElementById(n)||e.getElementsByName(n)[0];if(t)return t;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let a=r.currentNode;for(;a;){const u=a.shadowRoot;if(u){const p=u.getElementById(n)||u.querySelector(`[name="${n}"]`);if(p)return p}a=r.nextNode()}}return null}(this.document,n);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(n){this.supportsScrolling()&&(this.window.history.scrollRestoration=n)}scrollToElement(n){const t=n.getBoundingClientRect(),r=t.left+this.window.pageXOffset,a=t.top+this.window.pageYOffset,u=this.offset();this.window.scrollTo(r-u[0],a-u[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class mR extends vP{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Vv extends mR{static makeCurrent(){!function _P(e){xv||(xv=e)}(new Vv)}onAndCancel(n,t,r){return n.addEventListener(t,r),()=>{n.removeEventListener(t,r)}}dispatchEvent(n,t){n.dispatchEvent(t)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,t){return(t=t||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,t){return"window"===t?window:"document"===t?n:"body"===t?n.body:null}getBaseHref(n){const t=function gR(){return pf=pf||document.querySelector("base"),pf?pf.getAttribute("href"):null}();return null==t?null:function yR(e){kg=kg||document.createElement("a"),kg.setAttribute("href",e);const n=kg.pathname;return"/"===n.charAt(0)?n:`/${n}`}(t)}resetBaseElement(){pf=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return function ck(e,n){n=encodeURIComponent(n);for(const t of e.split(";")){const r=t.indexOf("="),[a,u]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(a.trim()===n)return decodeURIComponent(u)}return null}(document.cookie,n)}}let kg,pf=null,vR=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac})}return e})();const jv=new ot("EventManagerPlugins");let UC=(()=>{class e{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(a=>{a.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,a){return this._findPluginFor(r).addEventListener(t,r,a)}getZone(){return this._zone}_findPluginFor(t){let r=this._eventNameToPlugin.get(t);if(r)return r;if(r=this._plugins.find(u=>u.supports(t)),!r)throw new Ve(5101,!1);return this._eventNameToPlugin.set(t,r),r}static#e=this.\u0275fac=function(r){return new(r||e)(ht(jv),ht(Rn))};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac})}return e})();class HC{constructor(n){this._doc=n}}const $v="ng-app-id";let qC=(()=>{class e{constructor(t,r,a,u={}){this.doc=t,this.appId=r,this.nonce=a,this.platformId=u,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=zC(u),this.resetHostNodes()}addStyles(t){for(const r of t)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(t){for(const r of t)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const t=this.styleNodesInDOM;t&&(t.forEach(r=>r.remove()),t.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(const r of this.getAllStyles())this.addStyleToHost(t,r)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(const r of this.hostNodes)this.addStyleToHost(r,t)}onStyleRemoved(t){const r=this.styleRef;r.get(t)?.elements?.forEach(a=>a.remove()),r.delete(t)}collectServerRenderedStyles(){const t=this.doc.head?.querySelectorAll(`style[${$v}="${this.appId}"]`);if(t?.length){const r=new Map;return t.forEach(a=>{null!=a.textContent&&r.set(a.textContent,a)}),r}return null}changeUsageCount(t,r){const a=this.styleRef;if(a.has(t)){const u=a.get(t);return u.usage+=r,u.usage}return a.set(t,{usage:r,elements:[]}),r}getStyleElement(t,r){const a=this.styleNodesInDOM,u=a?.get(r);if(u?.parentNode===t)return a.delete(r),u.removeAttribute($v),u;{const p=this.doc.createElement("style");return this.nonce&&p.setAttribute("nonce",this.nonce),p.textContent=r,this.platformIsServer&&p.setAttribute($v,this.appId),p}}addStyleToHost(t,r){const a=this.getStyleElement(t,r);t.appendChild(a);const u=this.styleRef,p=u.get(r)?.elements;p?p.push(a):u.set(r,{elements:[a],usage:1})}resetHostNodes(){const t=this.hostNodes;t.clear(),t.add(this.doc.head)}static#e=this.\u0275fac=function(r){return new(r||e)(ht(Ds),ht(Om),ht(X0,8),ht(qh))};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac})}return e})();const Uv={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Hv=/%COMP%/g,CR=new ot("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function ZC(e,n){return n.map(t=>t.replace(Hv,e))}let WC=(()=>{class e{constructor(t,r,a,u,p,b,w,M=null){this.eventManager=t,this.sharedStylesHost=r,this.appId=a,this.removeStylesOnCompDestroy=u,this.doc=p,this.platformId=b,this.ngZone=w,this.nonce=M,this.rendererByCompId=new Map,this.platformIsServer=zC(b),this.defaultRenderer=new qv(t,p,w,this.platformIsServer)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===Ri.ShadowDom&&(r={...r,encapsulation:Ri.Emulated});const a=this.getOrCreateRenderer(t,r);return a instanceof YC?a.applyToHost(t):a instanceof Gv&&a.applyStyles(),a}getOrCreateRenderer(t,r){const a=this.rendererByCompId;let u=a.get(r.id);if(!u){const p=this.doc,b=this.ngZone,w=this.eventManager,M=this.sharedStylesHost,R=this.removeStylesOnCompDestroy,B=this.platformIsServer;switch(r.encapsulation){case Ri.Emulated:u=new YC(w,M,r,this.appId,R,p,b,B);break;case Ri.ShadowDom:return new ER(w,M,t,r,p,b,this.nonce,B);default:u=new Gv(w,M,r,R,p,b,B)}a.set(r.id,u)}return u}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(r){return new(r||e)(ht(UC),ht(qC),ht(Om),ht(CR),ht(Ds),ht(qh),ht(Rn),ht(X0))};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac})}return e})();class qv{constructor(n,t,r,a){this.eventManager=n,this.doc=t,this.ngZone=r,this.platformIsServer=a,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,t){return t?this.doc.createElementNS(Uv[t]||t,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,t){(XC(n)?n.content:n).appendChild(t)}insertBefore(n,t,r){n&&(XC(n)?n.content:n).insertBefore(t,r)}removeChild(n,t){n&&n.removeChild(t)}selectRootElement(n,t){let r="string"==typeof n?this.doc.querySelector(n):n;if(!r)throw new Ve(-5104,!1);return t||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,t,r,a){if(a){t=a+":"+t;const u=Uv[a];u?n.setAttributeNS(u,t,r):n.setAttribute(t,r)}else n.setAttribute(t,r)}removeAttribute(n,t,r){if(r){const a=Uv[r];a?n.removeAttributeNS(a,t):n.removeAttribute(`${r}:${t}`)}else n.removeAttribute(t)}addClass(n,t){n.classList.add(t)}removeClass(n,t){n.classList.remove(t)}setStyle(n,t,r,a){a&(ta.DashCase|ta.Important)?n.style.setProperty(t,r,a&ta.Important?"important":""):n.style[t]=r}removeStyle(n,t,r){r&ta.DashCase?n.style.removeProperty(t):n.style[t]=""}setProperty(n,t,r){n[t]=r}setValue(n,t){n.nodeValue=t}listen(n,t,r){if("string"==typeof n&&!(n=fd().getGlobalEventTarget(this.doc,n)))throw new Error(`Unsupported event target ${n} for event ${t}`);return this.eventManager.addEventListener(n,t,this.decoratePreventDefault(r))}decoratePreventDefault(n){return t=>{if("__ngUnwrap__"===t)return n;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>n(t)):n(t))&&t.preventDefault()}}}function XC(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class ER extends qv{constructor(n,t,r,a,u,p,b,w){super(n,u,p,w),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const M=ZC(a.id,a.styles);for(const R of M){const B=document.createElement("style");b&&B.setAttribute("nonce",b),B.textContent=R,this.shadowRoot.appendChild(B)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,t){return super.appendChild(this.nodeOrShadowRoot(n),t)}insertBefore(n,t,r){return super.insertBefore(this.nodeOrShadowRoot(n),t,r)}removeChild(n,t){return super.removeChild(this.nodeOrShadowRoot(n),t)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Gv extends qv{constructor(n,t,r,a,u,p,b,w){super(n,u,p,b),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=a,this.styles=w?ZC(w,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class YC extends Gv{constructor(n,t,r,a,u,p,b,w){const M=a+"-"+r.id;super(n,t,r,u,p,b,w,M),this.contentAttr=function DR(e){return"_ngcontent-%COMP%".replace(Hv,e)}(M),this.hostAttr=function SR(e){return"_nghost-%COMP%".replace(Hv,e)}(M)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,t){const r=super.createElement(n,t);return super.setAttribute(r,this.contentAttr,""),r}}let MR=(()=>{class e extends HC{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,a){return t.addEventListener(r,a,!1),()=>this.removeEventListener(t,r,a)}removeEventListener(t,r,a){return t.removeEventListener(r,a)}static#e=this.\u0275fac=function(r){return new(r||e)(ht(Ds))};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac})}return e})();const KC=["alt","control","meta","shift"],TR={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},AR={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let PR=(()=>{class e extends HC{constructor(t){super(t)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,r,a){const u=e.parseEventName(r),p=e.eventCallback(u.fullKey,a,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>fd().onAndCancel(t,u.domEventName,p))}static parseEventName(t){const r=t.toLowerCase().split("."),a=r.shift();if(0===r.length||"keydown"!==a&&"keyup"!==a)return null;const u=e._normalizeKey(r.pop());let p="",b=r.indexOf("code");if(b>-1&&(r.splice(b,1),p="code."),KC.forEach(M=>{const R=r.indexOf(M);R>-1&&(r.splice(R,1),p+=M+".")}),p+=u,0!=r.length||0===u.length)return null;const w={};return w.domEventName=a,w.fullKey=p,w}static matchEventFullKeyCode(t,r){let a=TR[t.key]||t.key,u="";return r.indexOf("code.")>-1&&(a=t.code,u="code."),!(null==a||!a)&&(a=a.toLowerCase()," "===a?a="space":"."===a&&(a="dot"),KC.forEach(p=>{p!==a&&(0,AR[p])(t)&&(u+=p+".")}),u+=a,u===r)}static eventCallback(t,r,a){return u=>{e.matchEventFullKeyCode(u,t)&&a.runGuarded(()=>r(u))}}static _normalizeKey(t){return"esc"===t?"escape":t}static#e=this.\u0275fac=function(r){return new(r||e)(ht(Ds))};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac})}return e})();const LR=G1(iP,"browser",[{provide:qh,useValue:"browser"},{provide:W0,useValue:function kR(){Vv.makeCurrent()},multi:!0},{provide:Ds,useFactory:function OR(){return function oi(e){$r=e}(document),document},deps:[]}]),FR=new ot(""),eD=[{provide:fg,useClass:class _R{addToWindow(n){dn.getAngularTestability=(r,a=!0)=>{const u=n.findTestabilityInTree(r,a);if(null==u)throw new Ve(5103,!1);return u},dn.getAllAngularTestabilities=()=>n.getAllTestabilities(),dn.getAllAngularRootElements=()=>n.getAllRootElements(),dn.frameworkStabilizers||(dn.frameworkStabilizers=[]),dn.frameworkStabilizers.push(r=>{const a=dn.getAllAngularTestabilities();let u=a.length,p=!1;const b=function(w){p=p||w,u--,0==u&&r(p)};a.forEach(w=>{w.whenStable(b)})})}findTestabilityInTree(n,t,r){return null==t?null:n.getTestability(t)??(r?fd().isShadowRoot(t)?this.findTestabilityInTree(n,t.host,!0):this.findTestabilityInTree(n,t.parentElement,!0):null)}},deps:[]},{provide:j1,useClass:av,deps:[Rn,lv,fg]},{provide:av,useClass:av,deps:[Rn,lv,fg]}],tD=[{provide:zy,useValue:"root"},{provide:zl,useFactory:function RR(){return new zl},deps:[]},{provide:jv,useClass:MR,multi:!0,deps:[Ds,Rn,qh]},{provide:jv,useClass:PR,multi:!0,deps:[Ds]},WC,qC,UC,{provide:tx,useExisting:WC},{provide:class Gk{},useClass:vR,deps:[]},[]];let NR=(()=>{class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:Om,useValue:t.appId}]}}static#e=this.\u0275fac=function(r){return new(r||e)(ht(FR,12))};static#t=this.\u0275mod=Ki({type:e});static#n=this.\u0275inj=Ai({providers:[...tD,...eD],imports:[FC,oP]})}return e})(),nD=(()=>{class e{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static#e=this.\u0275fac=function(r){return new(r||e)(ht(Ds))};static#t=this.\u0275prov=ct({token:e,factory:function(r){let a=null;return a=r?new r:function BR(){return new nD(ht(Ds))}(),a},providedIn:"root"})}return e})();function sD(e,n,t,r,a,u,p){try{var b=e[u](p),w=b.value}catch(M){return void t(M)}b.done?n(w):Promise.resolve(w).then(r,a)}function aD(e){return function(){var n=this,t=arguments;return new Promise(function(r,a){var u=e.apply(n,t);function p(w){sD(u,r,a,p,b,"next",w)}function b(w){sD(u,r,a,p,b,"throw",w)}p(void 0)})}}typeof window<"u"&&window;var Rg=Yl(624);class lD extends dr{constructor(){super(...arguments),this._value=null,this._hasValue=!1,this._isComplete=!1}_checkFinalizedStatuses(n){const{hasError:t,_hasValue:r,_value:a,thrownError:u,isStopped:p,_isComplete:b}=this;t?n.error(u):(p||b)&&(r&&n.next(a),n.complete())}next(n){this.isStopped||(this._value=n,this._hasValue=!0)}complete(){const{_hasValue:n,_value:t,_isComplete:r}=this;r||(this._isComplete=!0,n&&super.next(t),super.complete())}}const Og=Bc(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function Lc(e,n){return _n((t,r)=>{let a=0;t.subscribe(an(r,u=>e.call(n,u,a++)&&r.next(u)))})}function gd(e){return e<=0?()=>vn:_n((n,t)=>{let r=0;n.subscribe(an(t,a=>{++r<=e&&(t.next(a),e<=r&&t.complete())}))})}function Lg(e){return _n((n,t)=>{let r=!1;n.subscribe(an(t,a=>{r=!0,t.next(a)},()=>{r||t.next(e),t.complete()}))})}function cD(e=HR){return _n((n,t)=>{let r=!1;n.subscribe(an(t,a=>{r=!0,t.next(a)},()=>r?t.complete():t.error(e())))})}function HR(){return new Og}function Fc(e,n){const t=arguments.length>=2;return r=>r.pipe(e?Lc((a,u)=>e(a,u,r)):ir,gd(1),t?Lg(n):cD(()=>new Og))}const qR=["container"];let hD=(()=>{class e{constructor(t){this.zone=t,this.mapCreated=new lD,this.mapLoaded=new lD,this.markersToRemove=[],this.popupsToRemove=[],this.imageIdsToRemove=[],this.subscription=new On,this.mapCreated$=this.mapCreated.asObservable(),this.mapLoaded$=this.mapLoaded.asObservable()}setup(t){this.zone.onStable.pipe(Fc()).subscribe(()=>{this.createMap(t.mapOptions),this.hookEvents(t.mapEvents),this.mapEvents=t.mapEvents,this.mapCreated.next(void 0),this.mapCreated.complete(),t.mapOptions.terrain&&this.mapInstance.on("load",()=>{this.updateTerrain(t.mapOptions.terrain)})})}destroyMap(){this.mapInstance&&(this.subscription.unsubscribe(),this.mapInstance.remove())}updateMinZoom(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinZoom(t)})}updateMaxZoom(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxZoom(t)})}updateMinPitch(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMinPitch(t)})}updateMaxPitch(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxPitch(t)})}updateRenderWorldCopies(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setRenderWorldCopies(t)})}updateScrollZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.scrollZoom.enable():this.mapInstance.scrollZoom.disable()})}updateDragRotate(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.dragRotate.enable():this.mapInstance.dragRotate.disable()})}updateTouchPitch(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.touchPitch.enable():this.mapInstance.touchPitch.disable()})}updateTouchZoomRotate(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.touchZoomRotate.enable():this.mapInstance.touchZoomRotate.disable()})}updateDoubleClickZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.doubleClickZoom.enable():this.mapInstance.doubleClickZoom.disable()})}updateKeyboard(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.keyboard.enable():this.mapInstance.keyboard.disable()})}updateDragPan(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.dragPan.enable():this.mapInstance.dragPan.disable()})}updateBoxZoom(t){return this.zone.runOutsideAngular(()=>{t?this.mapInstance.boxZoom.enable():this.mapInstance.boxZoom.disable()})}updateStyle(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setStyle(t)})}updateMaxBounds(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setMaxBounds(t)})}updateTerrain(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.setTerrain(t)})}getTerrain(){return this.zone.runOutsideAngular(()=>this.mapInstance.getTerrain())}changeCanvasCursor(t){this.mapInstance.getCanvasContainer().style.cursor=t}queryRenderedFeatures(t,r){return this.mapInstance.queryRenderedFeatures(t,r)}panTo(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.panTo(t,r)})}move(t,r,a,u,p,b){return this.zone.runOutsideAngular(()=>{this.mapInstance[t]({...r,zoom:a??this.mapInstance.getZoom(),center:u??this.mapInstance.getCenter(),bearing:p??this.mapInstance.getBearing(),pitch:b??this.mapInstance.getPitch()})})}addLayer(t,r,a){this.zone.runOutsideAngular(()=>{Object.keys(t.layerOptions).forEach(u=>{void 0===t.layerOptions[u]&&delete t.layerOptions[u]}),this.mapInstance.addLayer(t.layerOptions,a),r&&(t.layerEvents.layerClick.observers.length&&this.mapInstance.on("click",t.layerOptions.id,u=>{this.zone.run(()=>{t.layerEvents.layerClick.emit(u)})}),t.layerEvents.layerDblClick.observers.length&&this.mapInstance.on("dblclick",t.layerOptions.id,u=>{this.zone.run(()=>{t.layerEvents.layerDblClick.emit(u)})}),t.layerEvents.layerMouseDown.observers.length&&this.mapInstance.on("mousedown",t.layerOptions.id,u=>{this.zone.run(()=>{t.layerEvents.layerMouseDown.emit(u)})}),t.layerEvents.layerMouseUp.observers.length&&this.mapInstance.on("mouseup",t.layerOptions.id,u=>{this.zone.run(()=>{t.layerEvents.layerMouseUp.emit(u)})}),t.layerEvents.layerMouseEnter.observers.length&&this.mapInstance.on("mouseenter",t.layerOptions.id,u=>{this.zone.run(()=>{t.layerEvents.layerMouseEnter.emit(u)})}),t.layerEvents.layerMouseLeave.observers.length&&this.mapInstance.on("mouseleave",t.layerOptions.id,u=>{this.zone.run(()=>{t.layerEvents.layerMouseLeave.emit(u)})}),t.layerEvents.layerMouseMove.observers.length&&this.mapInstance.on("mousemove",t.layerOptions.id,u=>{this.zone.run(()=>{t.layerEvents.layerMouseMove.emit(u)})}),t.layerEvents.layerMouseOver.observers.length&&this.mapInstance.on("mouseover",t.layerOptions.id,u=>{this.zone.run(()=>{t.layerEvents.layerMouseOver.emit(u)})}),t.layerEvents.layerMouseOut.observers.length&&this.mapInstance.on("mouseout",t.layerOptions.id,u=>{this.zone.run(()=>{t.layerEvents.layerMouseOut.emit(u)})}),t.layerEvents.layerContextMenu.observers.length&&this.mapInstance.on("contextmenu",t.layerOptions.id,u=>{this.zone.run(()=>{t.layerEvents.layerContextMenu.emit(u)})}),t.layerEvents.layerTouchStart.observers.length&&this.mapInstance.on("touchstart",t.layerOptions.id,u=>{this.zone.run(()=>{t.layerEvents.layerTouchStart.emit(u)})}),t.layerEvents.layerTouchEnd.observers.length&&this.mapInstance.on("touchend",t.layerOptions.id,u=>{this.zone.run(()=>{t.layerEvents.layerTouchEnd.emit(u)})}),t.layerEvents.layerTouchCancel.observers.length&&this.mapInstance.on("touchcancel",t.layerOptions.id,u=>{this.zone.run(()=>{t.layerEvents.layerTouchCancel.emit(u)})}))})}removeLayer(t){this.zone.runOutsideAngular(()=>{null!=this.mapInstance.getLayer(t)&&this.mapInstance.removeLayer(t)})}addMarker(t){const r={offset:t.markersOptions.offset,anchor:t.markersOptions.anchor,draggable:!!t.markersOptions.draggable,rotationAlignment:t.markersOptions.rotationAlignment,pitchAlignment:t.markersOptions.pitchAlignment,clickTolerance:t.markersOptions.clickTolerance};t.markersOptions.element.childNodes.length>0&&(r.element=t.markersOptions.element);const a=new Rg.Marker(r);return t.markersEvents.markerDragStart.observers.length&&a.on("dragstart",p=>{if(p){const{target:b}=p;this.zone.run(()=>{t.markersEvents.markerDragStart.emit(b)})}}),t.markersEvents.markerDrag.observers.length&&a.on("drag",p=>{if(p){const{target:b}=p;this.zone.run(()=>{t.markersEvents.markerDrag.emit(b)})}}),t.markersEvents.markerDragEnd.observers.length&&a.on("dragend",p=>{if(p){const{target:b}=p;this.zone.run(()=>{t.markersEvents.markerDragEnd.emit(b)})}}),a.setLngLat(t.markersOptions.feature?t.markersOptions.feature.geometry.coordinates:t.markersOptions.lngLat),this.zone.runOutsideAngular(()=>(a.addTo(this.mapInstance),a))}removeMarker(t){this.markersToRemove.push(t)}createPopup(t,r){return this.zone.runOutsideAngular(()=>{Object.keys(t.popupOptions).forEach(u=>void 0===t.popupOptions[u]&&delete t.popupOptions[u]);const a=new Rg.Popup(t.popupOptions);return a.setDOMContent(r),t.popupEvents.popupClose.observers.length&&a.on("close",()=>{this.zone.run(()=>{t.popupEvents.popupClose.emit()})}),t.popupEvents.popupOpen.observers.length&&a.on("open",()=>{this.zone.run(()=>{t.popupEvents.popupOpen.emit()})}),a})}addPopupToMap(t,r,a=!1){return this.zone.runOutsideAngular(()=>{a&&t._listeners&&delete t._listeners.open,t.setLngLat(r),t.addTo(this.mapInstance)})}addPopupToMarker(t,r){return this.zone.runOutsideAngular(()=>{t.setPopup(r)})}removePopupFromMap(t,r=!1){r&&t._listeners&&delete t._listeners.close,this.popupsToRemove.push(t)}removePopupFromMarker(t){return this.zone.runOutsideAngular(()=>{t.setPopup(void 0)})}addControl(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.addControl(t,r)})}removeControl(t){return this.zone.runOutsideAngular(()=>{this.mapInstance.removeControl(t)})}loadAndAddImage(t,r,a){var u=this;return aD(function*(){return u.zone.runOutsideAngular(()=>new Promise((p,b)=>{u.mapInstance.loadImage(r,(w,M)=>{w?b(w):(u.addImage(t,M,a),p())})}))})()}addImage(t,r,a){return this.zone.runOutsideAngular(()=>{this.mapInstance.addImage(t,r,a)})}removeImage(t){this.imageIdsToRemove.push(t)}addSource(t,r){return this.zone.runOutsideAngular(()=>{Object.keys(r).forEach(a=>void 0===r[a]&&delete r[a]),this.mapInstance.addSource(t,r)})}getSource(t){return this.mapInstance.getSource(t)}removeSource(t){this.zone.runOutsideAngular(()=>{this.findLayersBySourceId(t).forEach(r=>this.mapInstance.removeLayer(r.id)),this.mapInstance.removeSource(t)})}setAllLayerPaintProperty(t,r){return this.zone.runOutsideAngular(()=>{Object.keys(r).forEach(a=>{this.mapInstance.setPaintProperty(t,a,r[a])})})}setAllLayerLayoutProperty(t,r){return this.zone.runOutsideAngular(()=>{Object.keys(r).forEach(a=>{this.mapInstance.setLayoutProperty(t,a,r[a])})})}setLayerFilter(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.setFilter(t,r)})}setLayerBefore(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.moveLayer(t,r)})}setLayerZoomRange(t,r,a){return this.zone.runOutsideAngular(()=>{this.mapInstance.setLayerZoomRange(t,r||0,a||20)})}fitBounds(t,r){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitBounds(t,r)})}fitScreenCoordinates(t,r,a){return this.zone.runOutsideAngular(()=>{this.mapInstance.fitScreenCoordinates(t[0],t[1],r,a)})}applyChanges(){this.zone.runOutsideAngular(()=>{this.removeMarkers(),this.removePopups(),this.removeImages()})}createMap(t){Rn.assertNotInAngularZone(),Object.keys(t).forEach(a=>{void 0===t[a]&&delete t[a]}),this.mapInstance=new Rg.Map(t),window&&/msie\s|trident\/|edge\//i.test(window.navigator.userAgent)&&this.mapInstance.setStyle(t.style),this.subscription.add(this.zone.onMicrotaskEmpty.subscribe(()=>this.applyChanges()))}removeMarkers(){for(const t of this.markersToRemove)t.remove();this.markersToRemove=[]}removePopups(){for(const t of this.popupsToRemove)t.remove();this.popupsToRemove=[]}removeImages(){for(const t of this.imageIdsToRemove)this.mapInstance.removeImage(t);this.imageIdsToRemove=[]}findLayersBySourceId(t){const r=this.mapInstance.getStyle().layers;return null==r?[]:r.filter(a=>"source"in a&&a.source===t)}hookEvents(t){this.mapInstance.on("load",r=>{this.mapLoaded.next(void 0),this.mapLoaded.complete(),this.zone.run(()=>{t.mapLoad.emit(r.target)})}),t.mapResize.observers.length&&this.mapInstance.on("resize",r=>this.zone.run(()=>{t.mapResize.emit(r)})),t.mapRemove.observers.length&&this.mapInstance.on("remove",r=>this.zone.run(()=>{t.mapRemove.emit(r)})),t.mapMouseDown.observers.length&&this.mapInstance.on("mousedown",r=>this.zone.run(()=>{t.mapMouseDown.emit(r)})),t.mapMouseUp.observers.length&&this.mapInstance.on("mouseup",r=>this.zone.run(()=>{t.mapMouseUp.emit(r)})),t.mapMouseMove.observers.length&&this.mapInstance.on("mousemove",r=>this.zone.run(()=>{t.mapMouseMove.emit(r)})),t.mapClick.observers.length&&this.mapInstance.on("click",r=>this.zone.run(()=>{t.mapClick.emit(r)})),t.mapDblClick.observers.length&&this.mapInstance.on("dblclick",r=>this.zone.run(()=>{t.mapDblClick.emit(r)})),t.mapMouseOver.observers.length&&this.mapInstance.on("mouseover",r=>this.zone.run(()=>{t.mapMouseOver.emit(r)})),t.mapMouseOut.observers.length&&this.mapInstance.on("mouseout",r=>this.zone.run(()=>{t.mapMouseOut.emit(r)})),t.mapContextMenu.observers.length&&this.mapInstance.on("contextmenu",r=>this.zone.run(()=>{t.mapContextMenu.emit(r)})),t.mapTouchStart.observers.length&&this.mapInstance.on("touchstart",r=>this.zone.run(()=>{t.mapTouchStart.emit(r)})),t.mapTouchEnd.observers.length&&this.mapInstance.on("touchend",r=>this.zone.run(()=>{t.mapTouchEnd.emit(r)})),t.mapTouchMove.observers.length&&this.mapInstance.on("touchmove",r=>this.zone.run(()=>{t.mapTouchMove.emit(r)})),t.mapTouchCancel.observers.length&&this.mapInstance.on("touchcancel",r=>this.zone.run(()=>{t.mapTouchCancel.emit(r)})),t.mapWheel.observers.length&&this.mapInstance.on("wheel",r=>this.zone.run(()=>{t.mapWheel.emit(r)})),t.moveStart.observers.length&&this.mapInstance.on("movestart",r=>this.zone.run(()=>t.moveStart.emit(r))),t.move.observers.length&&this.mapInstance.on("move",r=>this.zone.run(()=>t.move.emit(r))),t.moveEnd.observers.length&&this.mapInstance.on("moveend",r=>this.zone.run(()=>t.moveEnd.emit(r))),t.mapDragStart.observers.length&&this.mapInstance.on("dragstart",r=>this.zone.run(()=>{t.mapDragStart.emit(r)})),t.mapDrag.observers.length&&this.mapInstance.on("drag",r=>this.zone.run(()=>{t.mapDrag.emit(r)})),t.mapDragEnd.observers.length&&this.mapInstance.on("dragend",r=>this.zone.run(()=>{t.mapDragEnd.emit(r)})),t.zoomStart.observers.length&&this.mapInstance.on("zoomstart",r=>this.zone.run(()=>t.zoomStart.emit(r))),t.zoomEvt.observers.length&&this.mapInstance.on("zoom",r=>this.zone.run(()=>t.zoomEvt.emit(r))),t.zoomEnd.observers.length&&this.mapInstance.on("zoomend",r=>this.zone.run(()=>t.zoomEnd.emit(r))),t.rotateStart.observers.length&&this.mapInstance.on("rotatestart",r=>this.zone.run(()=>t.rotateStart.emit(r))),t.rotate.observers.length&&this.mapInstance.on("rotate",r=>this.zone.run(()=>t.rotate.emit(r))),t.rotateEnd.observers.length&&this.mapInstance.on("rotateend",r=>this.zone.run(()=>t.rotateEnd.emit(r))),t.pitchStart.observers.length&&this.mapInstance.on("pitchstart",r=>this.zone.run(()=>t.pitchStart.emit(r))),t.pitchEvt.observers.length&&this.mapInstance.on("pitch",r=>this.zone.run(()=>t.pitchEvt.emit(r))),t.pitchEnd.observers.length&&this.mapInstance.on("pitchend",r=>this.zone.run(()=>t.pitchEnd.emit(r))),t.boxZoomStart.observers.length&&this.mapInstance.on("boxzoomstart",r=>this.zone.run(()=>t.boxZoomStart.emit(r))),t.boxZoomEnd.observers.length&&this.mapInstance.on("boxzoomend",r=>this.zone.run(()=>t.boxZoomEnd.emit(r))),t.boxZoomCancel.observers.length&&this.mapInstance.on("boxzoomcancel",r=>this.zone.run(()=>t.boxZoomCancel.emit(r))),t.webGlContextLost.observers.length&&this.mapInstance.on("webglcontextlost",r=>this.zone.run(()=>t.webGlContextLost.emit(r))),t.webGlContextRestored.observers.length&&this.mapInstance.on("webglcontextrestored",r=>this.zone.run(()=>t.webGlContextRestored.emit(r))),t.render.observers.length&&this.mapInstance.on("render",r=>this.zone.run(()=>t.render.emit(r))),t.mapError.observers.length&&this.mapInstance.on("error",r=>this.zone.run(()=>{t.mapError.emit(r)})),t.data.observers.length&&this.mapInstance.on("data",r=>this.zone.run(()=>t.data.emit(r))),t.styleData.observers.length&&this.mapInstance.on("styledata",r=>this.zone.run(()=>t.styleData.emit(r))),t.sourceData.observers.length&&this.mapInstance.on("sourcedata",r=>this.zone.run(()=>t.sourceData.emit(r))),t.dataLoading.observers.length&&this.mapInstance.on("dataloading",r=>this.zone.run(()=>t.dataLoading.emit(r))),t.styleDataLoading.observers.length&&this.mapInstance.on("styledataloading",r=>this.zone.run(()=>t.styleDataLoading.emit(r))),t.sourceDataLoading.observers.length&&this.mapInstance.on("sourcedataloading",r=>this.zone.run(()=>t.sourceDataLoading.emit(r))),t.styleImageMissing.observers.length&&this.mapInstance.on("styleimagemissing",r=>this.zone.run(()=>t.styleImageMissing.emit(r))),t.idle.observers.length&&this.mapInstance.on("idle",r=>this.zone.run(()=>t.idle.emit(r)))}static#e=this.\u0275fac=function(r){return new(r||e)(ht(Rn))};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac})}return e})(),YR=(()=>{class e{get mapInstance(){return this.mapService.mapInstance}constructor(t){this.mapService=t,this.movingMethod="flyTo",this.mapResize=new st,this.mapRemove=new st,this.mapMouseDown=new st,this.mapMouseUp=new st,this.mapMouseMove=new st,this.mapClick=new st,this.mapDblClick=new st,this.mapMouseOver=new st,this.mapMouseOut=new st,this.mapContextMenu=new st,this.mapTouchStart=new st,this.mapTouchEnd=new st,this.mapTouchMove=new st,this.mapTouchCancel=new st,this.mapWheel=new st,this.moveStart=new st,this.move=new st,this.moveEnd=new st,this.mapDragStart=new st,this.mapDrag=new st,this.mapDragEnd=new st,this.zoomStart=new st,this.zoomEvt=new st,this.zoomEnd=new st,this.rotateStart=new st,this.rotate=new st,this.rotateEnd=new st,this.pitchStart=new st,this.pitchEvt=new st,this.pitchEnd=new st,this.boxZoomStart=new st,this.boxZoomEnd=new st,this.boxZoomCancel=new st,this.webGlContextLost=new st,this.webGlContextRestored=new st,this.mapLoad=new st,this.idle=new st,this.render=new st,this.mapError=new st,this.data=new st,this.styleData=new st,this.sourceData=new st,this.dataLoading=new st,this.styleDataLoading=new st,this.sourceDataLoading=new st,this.styleImageMissing=new st}ngAfterViewInit(){this.mapService.setup({mapOptions:{collectResourceTiming:this.collectResourceTiming,container:this.mapContainer.nativeElement,crossSourceCollisions:this.crossSourceCollisions,fadeDuration:this.fadeDuration,minZoom:this.minZoom,maxZoom:this.maxZoom,minPitch:this.minPitch,maxPitch:this.maxPitch,style:this.style,hash:this.hash,interactive:this.interactive,bearingSnap:this.bearingSnap,pitchWithRotate:this.pitchWithRotate,clickTolerance:this.clickTolerance,attributionControl:this.attributionControl,logoPosition:this.logoPosition,failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.preserveDrawingBuffer,refreshExpiredTiles:this.refreshExpiredTiles,maxBounds:this.maxBounds,scrollZoom:this.scrollZoom,boxZoom:this.boxZoom,dragRotate:this.dragRotate,dragPan:this.dragPan,keyboard:this.keyboard,doubleClickZoom:this.doubleClickZoom,touchPitch:this.touchPitch,touchZoomRotate:this.touchZoomRotate,trackResize:this.trackResize,center:this.center,zoom:this.zoom,bearing:this.bearing,pitch:this.pitch,renderWorldCopies:this.renderWorldCopies,maxTileCacheSize:this.maxTileCacheSize,localIdeographFontFamily:this.localIdeographFontFamily,transformRequest:this.transformRequest,bounds:this.bounds?this.bounds:this.fitBounds,fitBoundsOptions:this.fitBoundsOptions,antialias:this.antialias,locale:this.locale,cooperativeGestures:this.cooperativeGestures,terrain:this.terrain},mapEvents:this}),this.cursorStyle&&this.mapService.changeCanvasCursor(this.cursorStyle)}ngOnDestroy(){this.mapService.destroyMap()}ngOnChanges(t){var r=this;return aD(function*(){yield r.mapService.mapCreated$.toPromise(),t.cursorStyle&&!t.cursorStyle.isFirstChange()&&r.mapService.changeCanvasCursor(t.cursorStyle.currentValue),t.minZoom&&!t.minZoom.isFirstChange()&&r.mapService.updateMinZoom(t.minZoom.currentValue),t.maxZoom&&!t.maxZoom.isFirstChange()&&r.mapService.updateMaxZoom(t.maxZoom.currentValue),t.minPitch&&!t.minPitch.isFirstChange()&&r.mapService.updateMinPitch(t.minPitch.currentValue),t.maxPitch&&!t.maxPitch.isFirstChange()&&r.mapService.updateMaxPitch(t.maxPitch.currentValue),t.renderWorldCopies&&!t.renderWorldCopies.isFirstChange()&&r.mapService.updateRenderWorldCopies(t.renderWorldCopies.currentValue),t.scrollZoom&&!t.scrollZoom.isFirstChange()&&r.mapService.updateScrollZoom(t.scrollZoom.currentValue),t.dragRotate&&!t.dragRotate.isFirstChange()&&r.mapService.updateDragRotate(t.dragRotate.currentValue),t.touchPitch&&!t.touchPitch.isFirstChange()&&r.mapService.updateTouchPitch(t.touchPitch.currentValue),t.touchZoomRotate&&!t.touchZoomRotate.isFirstChange()&&r.mapService.updateTouchZoomRotate(t.touchZoomRotate.currentValue),t.doubleClickZoom&&!t.doubleClickZoom.isFirstChange()&&r.mapService.updateDoubleClickZoom(t.doubleClickZoom.currentValue),t.keyboard&&!t.keyboard.isFirstChange()&&r.mapService.updateKeyboard(t.keyboard.currentValue),t.dragPan&&!t.dragPan.isFirstChange()&&r.mapService.updateDragPan(t.dragPan.currentValue),t.boxZoom&&!t.boxZoom.isFirstChange()&&r.mapService.updateBoxZoom(t.boxZoom.currentValue),t.style&&!t.style.isFirstChange()&&r.mapService.updateStyle(t.style.currentValue),t.maxBounds&&!t.maxBounds.isFirstChange()&&r.mapService.updateMaxBounds(t.maxBounds.currentValue),t.fitBounds&&t.fitBounds.currentValue&&!t.fitBounds.isFirstChange()&&r.mapService.fitBounds(t.fitBounds.currentValue,r.fitBoundsOptions),t.fitScreenCoordinates&&t.fitScreenCoordinates.currentValue&&((r.center||r.zoom||r.pitch||r.fitBounds)&&t.fitScreenCoordinates.isFirstChange()&&console.warn("[ngx-maplibre-gl] center / zoom / pitch / fitBounds inputs are being overridden by fitScreenCoordinates input"),r.mapService.fitScreenCoordinates(t.fitScreenCoordinates.currentValue,r.bearing?r.bearing[0]:0,r.movingOptions)),!r.centerWithPanTo||!t.center||t.center.isFirstChange()||t.zoom||t.bearing||t.pitch?(t.center&&!t.center.isFirstChange()||t.zoom&&!t.zoom.isFirstChange()||t.bearing&&!t.bearing.isFirstChange()&&!t.fitScreenCoordinates||t.pitch&&!t.pitch.isFirstChange())&&r.mapService.move(r.movingMethod,r.movingOptions,t.zoom&&r.zoom?r.zoom[0]:void 0,t.center?r.center:void 0,t.bearing&&r.bearing?r.bearing[0]:void 0,t.pitch&&r.pitch?r.pitch[0]:void 0):r.mapService.panTo(r.center,r.panToOptions),t.terrain&&!t.terrain.isFirstChange()&&r.mapService.updateTerrain(t.terrain.currentValue)})()}static#e=this.\u0275fac=function(r){return new(r||e)(Ct(hD))};static#t=this.\u0275cmp=ls({type:e,selectors:[["mgl-map"]],viewQuery:function(r,a){if(1&r&&hg(qR,7),2&r){let u;rf(u=sf())&&(a.mapContainer=u.first)}},inputs:{collectResourceTiming:"collectResourceTiming",crossSourceCollisions:"crossSourceCollisions",customMapboxApiUrl:"customMapboxApiUrl",fadeDuration:"fadeDuration",hash:"hash",refreshExpiredTiles:"refreshExpiredTiles",failIfMajorPerformanceCaveat:"failIfMajorPerformanceCaveat",bearingSnap:"bearingSnap",interactive:"interactive",pitchWithRotate:"pitchWithRotate",clickTolerance:"clickTolerance",attributionControl:"attributionControl",logoPosition:"logoPosition",maxTileCacheSize:"maxTileCacheSize",localIdeographFontFamily:"localIdeographFontFamily",preserveDrawingBuffer:"preserveDrawingBuffer",trackResize:"trackResize",transformRequest:"transformRequest",bounds:"bounds",antialias:"antialias",locale:"locale",cooperativeGestures:"cooperativeGestures",minZoom:"minZoom",maxZoom:"maxZoom",minPitch:"minPitch",maxPitch:"maxPitch",scrollZoom:"scrollZoom",dragRotate:"dragRotate",touchPitch:"touchPitch",touchZoomRotate:"touchZoomRotate",doubleClickZoom:"doubleClickZoom",keyboard:"keyboard",dragPan:"dragPan",boxZoom:"boxZoom",style:"style",center:"center",maxBounds:"maxBounds",zoom:"zoom",bearing:"bearing",pitch:"pitch",fitBoundsOptions:"fitBoundsOptions",renderWorldCopies:"renderWorldCopies",movingMethod:"movingMethod",movingOptions:"movingOptions",terrain:"terrain",fitBounds:"fitBounds",fitScreenCoordinates:"fitScreenCoordinates",centerWithPanTo:"centerWithPanTo",panToOptions:"panToOptions",cursorStyle:"cursorStyle"},outputs:{mapResize:"mapResize",mapRemove:"mapRemove",mapMouseDown:"mapMouseDown",mapMouseUp:"mapMouseUp",mapMouseMove:"mapMouseMove",mapClick:"mapClick",mapDblClick:"mapDblClick",mapMouseOver:"mapMouseOver",mapMouseOut:"mapMouseOut",mapContextMenu:"mapContextMenu",mapTouchStart:"mapTouchStart",mapTouchEnd:"mapTouchEnd",mapTouchMove:"mapTouchMove",mapTouchCancel:"mapTouchCancel",mapWheel:"mapWheel",moveStart:"moveStart",move:"move",moveEnd:"moveEnd",mapDragStart:"mapDragStart",mapDrag:"mapDrag",mapDragEnd:"mapDragEnd",zoomStart:"zoomStart",zoomEvt:"zoomEvt",zoomEnd:"zoomEnd",rotateStart:"rotateStart",rotate:"rotate",rotateEnd:"rotateEnd",pitchStart:"pitchStart",pitchEvt:"pitchEvt",pitchEnd:"pitchEnd",boxZoomStart:"boxZoomStart",boxZoomEnd:"boxZoomEnd",boxZoomCancel:"boxZoomCancel",webGlContextLost:"webGlContextLost",webGlContextRestored:"webGlContextRestored",mapLoad:"mapLoad",idle:"idle",render:"render",mapError:"mapError",data:"data",styleData:"styleData",sourceData:"sourceData",dataLoading:"dataLoading",styleDataLoading:"styleDataLoading",sourceDataLoading:"sourceDataLoading",styleImageMissing:"styleImageMissing"},features:[Uw([hD]),Na],decls:2,vars:0,consts:[["container",""]],template:function(r,a){1&r&&ad(0,"div",null,0)},styles:["[_nghost-%COMP%]{display:block}div[_ngcontent-%COMP%]{height:100%;width:100%}"],changeDetection:0})}return e})(),KR=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ki({type:e});static#n=this.\u0275inj=Ai({imports:[FC]})}return e})();const{isArray:JR}=Array,{getPrototypeOf:eO,prototype:tO,keys:nO}=Object;const{isArray:oO}=Array;function Wv(...e){const n=Ht(e),t=function Td(e){return hn(is(e))?e.pop():void 0}(e),{args:r,keys:a}=function rO(e){if(1===e.length){const n=e[0];if(JR(n))return{args:n,keys:null};if(function iO(e){return e&&"object"==typeof e&&eO(e)===tO}(n)){const t=nO(n);return{args:t.map(r=>n[r]),keys:t}}}return{args:e,keys:null}}(e);if(0===r.length)return gt([],n);const u=new Bn(function cO(e,n,t=ir){return r=>{dD(n,()=>{const{length:a}=e,u=new Array(a);let p=a,b=a;for(let w=0;w<a;w++)dD(n,()=>{const M=gt(e[w],n);let R=!1;M.subscribe(an(r,B=>{u[w]=B,R||(R=!0,b--),b||r.next(t(u.slice()))},()=>{--p||r.complete()}))},r)},r)}}(r,n,a?p=>function lO(e,n){return e.reduce((t,r,a)=>(t[r]=n[a],t),{})}(a,p):ir));return t?u.pipe(function aO(e){return rn(n=>function sO(e,n){return oO(n)?e(...n):e(n)}(e,n))}(t)):u}function dD(e,n,t){e?Dt(t,e,n):n()}function Xv(...e){return function uO(){return wn(1)}()(gt(e,Ht(e)))}function pD(e){return new Bn(n=>{Ze(e()).subscribe(n)})}function ff(e,n){const t=hn(e)?e:()=>e,r=a=>a.error(t());return new Bn(n?a=>n.schedule(r,0,a):r)}function Yv(){return _n((e,n)=>{let t=null;e._refCount++;const r=an(n,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(t=null);const a=e._connection,u=t;t=null,a&&(!u||a===u)&&a.unsubscribe(),n.unsubscribe()});e.subscribe(r),r.closed||(t=e.connect())})}class fD extends Bn{constructor(n,t){super(),this.source=n,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,Ps(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new On;const t=this.getSubject();n.add(this.source.subscribe(an(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=On.EMPTY)}return n}refCount(){return Yv()(this)}}function mf(e,n){return hn(n)?Et(e,n,1):Et(e,1)}function Vi(e,n,t){const r=hn(e)||n||t?{next:e,error:n,complete:t}:e;return r?_n((a,u)=>{var p;null===(p=r.subscribe)||void 0===p||p.call(r);let b=!0;a.subscribe(an(u,w=>{var M;null===(M=r.next)||void 0===M||M.call(r,w),u.next(w)},()=>{var w;b=!1,null===(w=r.complete)||void 0===w||w.call(r),u.complete()},w=>{var M;b=!1,null===(M=r.error)||void 0===M||M.call(r,w),u.error(w)},()=>{var w,M;b&&(null===(w=r.unsubscribe)||void 0===w||w.call(r)),null===(M=r.finalize)||void 0===M||M.call(r)}))}):ir}function Vu(e){return _n((n,t)=>{let u,r=null,a=!1;r=n.subscribe(an(t,void 0,void 0,p=>{u=Ze(e(p,Vu(e)(n))),r?(r.unsubscribe(),r=null,u.subscribe(t)):a=!0})),a&&(r.unsubscribe(),r=null,u.subscribe(t))})}function Kv(e){return e<=0?()=>vn:_n((n,t)=>{let r=[];n.subscribe(an(t,a=>{r.push(a),e<r.length&&r.shift()},()=>{for(const a of r)t.next(a);t.complete()},void 0,()=>{r=null}))})}function Qv(e){return _n((n,t)=>{try{n.subscribe(t)}finally{t.add(e)}})}const zt="primary",gf=Symbol("RouteTitle");class yO{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t[0]:t}return null}getAll(n){if(this.has(n)){const t=this.params[n];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function yd(e){return new yO(e)}function _O(e,n,t){const r=t.path.split("/");if(r.length>e.length||"full"===t.pathMatch&&(n.hasChildren()||r.length<e.length))return null;const a={};for(let u=0;u<r.length;u++){const p=r[u],b=e[u];if(p.startsWith(":"))a[p.substring(1)]=b;else if(p!==b.path)return null}return{consumed:e.slice(0,r.length),posParams:a}}function Ka(e,n){const t=e?Object.keys(e):void 0,r=n?Object.keys(n):void 0;if(!t||!r||t.length!=r.length)return!1;let a;for(let u=0;u<t.length;u++)if(a=t[u],!mD(e[a],n[a]))return!1;return!0}function mD(e,n){if(Array.isArray(e)&&Array.isArray(n)){if(e.length!==n.length)return!1;const t=[...e].sort(),r=[...n].sort();return t.every((a,u)=>r[u]===a)}return e===n}function gD(e){return e.length>0?e[e.length-1]:null}function Nc(e){return function QR(e){return!!e&&(e instanceof Bn||hn(e.lift)&&hn(e.subscribe))}(e)?e:tg(e)?gt(Promise.resolve(e)):yt(e)}const xO={exact:function vD(e,n,t){if(!ju(e.segments,n.segments)||!Fg(e.segments,n.segments,t)||e.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children)if(!e.children[r]||!vD(e.children[r],n.children[r],t))return!1;return!0},subset:xD},yD={exact:function bO(e,n){return Ka(e,n)},subset:function wO(e,n){return Object.keys(n).length<=Object.keys(e).length&&Object.keys(n).every(t=>mD(e[t],n[t]))},ignored:()=>!0};function _D(e,n,t){return xO[t.paths](e.root,n.root,t.matrixParams)&&yD[t.queryParams](e.queryParams,n.queryParams)&&!("exact"===t.fragment&&e.fragment!==n.fragment)}function xD(e,n,t){return bD(e,n,n.segments,t)}function bD(e,n,t,r){if(e.segments.length>t.length){const a=e.segments.slice(0,t.length);return!(!ju(a,t)||n.hasChildren()||!Fg(a,t,r))}if(e.segments.length===t.length){if(!ju(e.segments,t)||!Fg(e.segments,t,r))return!1;for(const a in n.children)if(!e.children[a]||!xD(e.children[a],n.children[a],r))return!1;return!0}{const a=t.slice(0,e.segments.length),u=t.slice(e.segments.length);return!!(ju(e.segments,a)&&Fg(e.segments,a,r)&&e.children[zt])&&bD(e.children[zt],n,u,r)}}function Fg(e,n,t){return n.every((r,a)=>yD[t](e[a].parameters,r.parameters))}class _d{constructor(n=new Sn([],{}),t={},r=null){this.root=n,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=yd(this.queryParams)),this._queryParamMap}toString(){return SO.serialize(this)}}class Sn{constructor(n,t){this.segments=n,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ng(this)}}class yf{constructor(n,t){this.path=n,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=yd(this.parameters)),this._parameterMap}toString(){return DD(this)}}function ju(e,n){return e.length===n.length&&e.every((t,r)=>t.path===n[r].path)}let _f=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:function(){return new Jv},providedIn:"root"})}return e})();class Jv{parse(n){const t=new FO(n);return new _d(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(n){const t=`/${vf(n.root,!0)}`,r=function MO(e){const n=Object.keys(e).map(t=>{const r=e[t];return Array.isArray(r)?r.map(a=>`${zg(t)}=${zg(a)}`).join("&"):`${zg(t)}=${zg(r)}`}).filter(t=>!!t);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${t}${r}${"string"==typeof n.fragment?`#${function IO(e){return encodeURI(e)}(n.fragment)}`:""}`}}const SO=new Jv;function Ng(e){return e.segments.map(n=>DD(n)).join("/")}function vf(e,n){if(!e.hasChildren())return Ng(e);if(n){const t=e.children[zt]?vf(e.children[zt],!1):"",r=[];return Object.entries(e.children).forEach(([a,u])=>{a!==zt&&r.push(`${a}:${vf(u,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function DO(e,n){let t=[];return Object.entries(e.children).forEach(([r,a])=>{r===zt&&(t=t.concat(n(a,r)))}),Object.entries(e.children).forEach(([r,a])=>{r!==zt&&(t=t.concat(n(a,r)))}),t}(e,(r,a)=>a===zt?[vf(e.children[zt],!1)]:[`${a}:${vf(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[zt]?`${Ng(e)}/${t[0]}`:`${Ng(e)}/(${t.join("//")})`}}function wD(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function zg(e){return wD(e).replace(/%3B/gi,";")}function e0(e){return wD(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Bg(e){return decodeURIComponent(e)}function CD(e){return Bg(e.replace(/\+/g,"%20"))}function DD(e){return`${e0(e.path)}${function EO(e){return Object.keys(e).map(n=>`;${e0(n)}=${e0(e[n])}`).join("")}(e.parameters)}`}const TO=/^[^\/()?;#]+/;function t0(e){const n=e.match(TO);return n?n[0]:""}const AO=/^[^\/()?;=#]+/,kO=/^[^=?&#]+/,OO=/^[^&#]+/;class FO{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Sn([],{}):new Sn([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(t).length>0)&&(r[zt]=new Sn(n,t)),r}parseSegment(){const n=t0(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new Ve(4009,!1);return this.capture(n),new yf(Bg(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const t=function PO(e){const n=e.match(AO);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const a=t0(this.remaining);a&&(r=a,this.capture(r))}n[Bg(t)]=Bg(r)}parseQueryParam(n){const t=function RO(e){const n=e.match(kO);return n?n[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const p=function LO(e){const n=e.match(OO);return n?n[0]:""}(this.remaining);p&&(r=p,this.capture(r))}const a=CD(t),u=CD(r);if(n.hasOwnProperty(a)){let p=n[a];Array.isArray(p)||(p=[p],n[a]=p),p.push(u)}else n[a]=u}parseParens(n){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=t0(this.remaining),a=this.remaining[r.length];if("/"!==a&&")"!==a&&";"!==a)throw new Ve(4010,!1);let u;r.indexOf(":")>-1?(u=r.slice(0,r.indexOf(":")),this.capture(u),this.capture(":")):n&&(u=zt);const p=this.parseChildren();t[u]=1===Object.keys(p).length?p[zt]:new Sn([],p),this.consumeOptional("//")}return t}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new Ve(4011,!1)}}function SD(e){return e.segments.length>0?new Sn([],{[zt]:e}):e}function ID(e){const n={};for(const r of Object.keys(e.children)){const u=ID(e.children[r]);if(r===zt&&0===u.segments.length&&u.hasChildren())for(const[p,b]of Object.entries(u.children))n[p]=b;else(u.segments.length>0||u.hasChildren())&&(n[r]=u)}return function NO(e){if(1===e.numberOfChildren&&e.children[zt]){const n=e.children[zt];return new Sn(e.segments.concat(n.segments),n.children)}return e}(new Sn(e.segments,n))}function $u(e){return e instanceof _d}function ED(e){let n;const a=SD(function t(u){const p={};for(const w of u.children){const M=t(w);p[w.outlet]=M}const b=new Sn(u.url,p);return u===e&&(n=b),b}(e.root));return n??a}function MD(e,n,t,r){let a=e;for(;a.parent;)a=a.parent;if(0===n.length)return n0(a,a,a,t,r);const u=function BO(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new AD(!0,0,e);let n=0,t=!1;const r=e.reduce((a,u,p)=>{if("object"==typeof u&&null!=u){if(u.outlets){const b={};return Object.entries(u.outlets).forEach(([w,M])=>{b[w]="string"==typeof M?M.split("/"):M}),[...a,{outlets:b}]}if(u.segmentPath)return[...a,u.segmentPath]}return"string"!=typeof u?[...a,u]:0===p?(u.split("/").forEach((b,w)=>{0==w&&"."===b||(0==w&&""===b?t=!0:".."===b?n++:""!=b&&a.push(b))}),a):[...a,u]},[]);return new AD(t,n,r)}(n);if(u.toRoot())return n0(a,a,new Sn([],{}),t,r);const p=function VO(e,n,t){if(e.isAbsolute)return new jg(n,!0,0);if(!t)return new jg(n,!1,NaN);if(null===t.parent)return new jg(t,!0,0);const r=Vg(e.commands[0])?0:1;return function jO(e,n,t){let r=e,a=n,u=t;for(;u>a;){if(u-=a,r=r.parent,!r)throw new Ve(4005,!1);a=r.segments.length}return new jg(r,!1,a-u)}(t,t.segments.length-1+r,e.numberOfDoubleDots)}(u,a,e),b=p.processChildren?bf(p.segmentGroup,p.index,u.commands):PD(p.segmentGroup,p.index,u.commands);return n0(a,p.segmentGroup,b,t,r)}function Vg(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function xf(e){return"object"==typeof e&&null!=e&&e.outlets}function n0(e,n,t,r,a){let p,u={};r&&Object.entries(r).forEach(([w,M])=>{u[w]=Array.isArray(M)?M.map(R=>`${R}`):`${M}`}),p=e===n?t:TD(e,n,t);const b=SD(ID(p));return new _d(b,u,a)}function TD(e,n,t){const r={};return Object.entries(e.children).forEach(([a,u])=>{r[a]=u===n?t:TD(u,n,t)}),new Sn(e.segments,r)}class AD{constructor(n,t,r){if(this.isAbsolute=n,this.numberOfDoubleDots=t,this.commands=r,n&&r.length>0&&Vg(r[0]))throw new Ve(4003,!1);const a=r.find(xf);if(a&&a!==gD(r))throw new Ve(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class jg{constructor(n,t,r){this.segmentGroup=n,this.processChildren=t,this.index=r}}function PD(e,n,t){if(e||(e=new Sn([],{})),0===e.segments.length&&e.hasChildren())return bf(e,n,t);const r=function UO(e,n,t){let r=0,a=n;const u={match:!1,pathIndex:0,commandIndex:0};for(;a<e.segments.length;){if(r>=t.length)return u;const p=e.segments[a],b=t[r];if(xf(b))break;const w=`${b}`,M=r<t.length-1?t[r+1]:null;if(a>0&&void 0===w)break;if(w&&M&&"object"==typeof M&&void 0===M.outlets){if(!RD(w,M,p))return u;r+=2}else{if(!RD(w,{},p))return u;r++}a++}return{match:!0,pathIndex:a,commandIndex:r}}(e,n,t),a=t.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const u=new Sn(e.segments.slice(0,r.pathIndex),{});return u.children[zt]=new Sn(e.segments.slice(r.pathIndex),e.children),bf(u,0,a)}return r.match&&0===a.length?new Sn(e.segments,{}):r.match&&!e.hasChildren()?r0(e,n,t):r.match?bf(e,0,a):r0(e,n,t)}function bf(e,n,t){if(0===t.length)return new Sn(e.segments,{});{const r=function $O(e){return xf(e[0])?e[0].outlets:{[zt]:e}}(t),a={};if(Object.keys(r).some(u=>u!==zt)&&e.children[zt]&&1===e.numberOfChildren&&0===e.children[zt].segments.length){const u=bf(e.children[zt],n,t);return new Sn(e.segments,u.children)}return Object.entries(r).forEach(([u,p])=>{"string"==typeof p&&(p=[p]),null!==p&&(a[u]=PD(e.children[u],n,p))}),Object.entries(e.children).forEach(([u,p])=>{void 0===r[u]&&(a[u]=p)}),new Sn(e.segments,a)}}function r0(e,n,t){const r=e.segments.slice(0,n);let a=0;for(;a<t.length;){const u=t[a];if(xf(u)){const w=HO(u.outlets);return new Sn(r,w)}if(0===a&&Vg(t[0])){r.push(new yf(e.segments[n].path,kD(t[0]))),a++;continue}const p=xf(u)?u.outlets[zt]:`${u}`,b=a<t.length-1?t[a+1]:null;p&&b&&Vg(b)?(r.push(new yf(p,kD(b))),a+=2):(r.push(new yf(p,{})),a++)}return new Sn(r,{})}function HO(e){const n={};return Object.entries(e).forEach(([t,r])=>{"string"==typeof r&&(r=[r]),null!==r&&(n[t]=r0(new Sn([],{}),0,r))}),n}function kD(e){const n={};return Object.entries(e).forEach(([t,r])=>n[t]=`${r}`),n}function RD(e,n,t){return e==t.path&&Ka(n,t.parameters)}const wf="imperative";class Qa{constructor(n,t){this.id=n,this.url=t}}class $g extends Qa{constructor(n,t,r="imperative",a=null){super(n,t),this.type=0,this.navigationTrigger=r,this.restoredState=a}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class zc extends Qa{constructor(n,t,r){super(n,t),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Cf extends Qa{constructor(n,t,r,a){super(n,t),this.reason=r,this.code=a,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class vd extends Qa{constructor(n,t,r,a){super(n,t),this.reason=r,this.code=a,this.type=16}}class Ug extends Qa{constructor(n,t,r,a){super(n,t),this.error=r,this.target=a,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class OD extends Qa{constructor(n,t,r,a){super(n,t),this.urlAfterRedirects=r,this.state=a,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class qO extends Qa{constructor(n,t,r,a){super(n,t),this.urlAfterRedirects=r,this.state=a,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class GO extends Qa{constructor(n,t,r,a,u){super(n,t),this.urlAfterRedirects=r,this.state=a,this.shouldActivate=u,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class ZO extends Qa{constructor(n,t,r,a){super(n,t),this.urlAfterRedirects=r,this.state=a,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class WO extends Qa{constructor(n,t,r,a){super(n,t),this.urlAfterRedirects=r,this.state=a,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class XO{constructor(n){this.route=n,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class YO{constructor(n){this.route=n,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class KO{constructor(n){this.snapshot=n,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class QO{constructor(n){this.snapshot=n,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class JO{constructor(n){this.snapshot=n,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class eL{constructor(n){this.snapshot=n,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class LD{constructor(n,t,r){this.routerEvent=n,this.position=t,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class o0{}class s0{constructor(n){this.url=n}}class tL{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Df,this.attachRef=null}}let Df=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(t,r){const a=this.getOrCreateContext(t);a.outlet=r,this.contexts.set(t,a)}onChildOutletDestroyed(t){const r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new tL,this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class FD{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const t=this.pathFromRoot(n);return t.length>1?t[t.length-2]:null}children(n){const t=a0(n,this._root);return t?t.children.map(r=>r.value):[]}firstChild(n){const t=a0(n,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(n){const t=l0(n,this._root);return t.length<2?[]:t[t.length-2].children.map(a=>a.value).filter(a=>a!==n)}pathFromRoot(n){return l0(n,this._root).map(t=>t.value)}}function a0(e,n){if(e===n.value)return n;for(const t of n.children){const r=a0(e,t);if(r)return r}return null}function l0(e,n){if(e===n.value)return[n];for(const t of n.children){const r=l0(e,t);if(r.length)return r.unshift(n),r}return[]}class Gl{constructor(n,t){this.value=n,this.children=t}toString(){return`TreeNode(${this.value})`}}function xd(e){const n={};return e&&e.children.forEach(t=>n[t.value.outlet]=t),n}class ND extends FD{constructor(n,t){super(n),this.snapshot=t,c0(this,n)}toString(){return this.snapshot.toString()}}function zD(e,n){const t=function nL(e,n){const p=new Hg([],{},{},"",{},zt,n,null,{});return new VD("",new Gl(p,[]))}(0,n),r=new qt([new yf("",{})]),a=new qt({}),u=new qt({}),p=new qt({}),b=new qt(""),w=new bd(r,a,p,b,u,zt,n,t.root);return w.snapshot=t.root,new ND(new Gl(w,[]),t)}class bd{constructor(n,t,r,a,u,p,b,w){this.urlSubject=n,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=a,this.dataSubject=u,this.outlet=p,this.component=b,this._futureSnapshot=w,this.title=this.dataSubject?.pipe(rn(M=>M[gf]))??yt(void 0),this.url=n,this.params=t,this.queryParams=r,this.fragment=a,this.data=u}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(rn(n=>yd(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(rn(n=>yd(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function BD(e,n="emptyOnly"){const t=e.pathFromRoot;let r=0;if("always"!==n)for(r=t.length-1;r>=1;){const a=t[r],u=t[r-1];if(a.routeConfig&&""===a.routeConfig.path)r--;else{if(u.component)break;r--}}return function rL(e){return e.reduce((n,t)=>({params:{...n.params,...t.params},data:{...n.data,...t.data},resolve:{...t.data,...n.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(r))}class Hg{get title(){return this.data?.[gf]}constructor(n,t,r,a,u,p,b,w,M){this.url=n,this.params=t,this.queryParams=r,this.fragment=a,this.data=u,this.outlet=p,this.component=b,this.routeConfig=w,this._resolve=M}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=yd(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=yd(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class VD extends FD{constructor(n,t){super(t),this.url=n,c0(this,t)}toString(){return jD(this._root)}}function c0(e,n){n.value._routerState=e,n.children.forEach(t=>c0(e,t))}function jD(e){const n=e.children.length>0?` { ${e.children.map(jD).join(", ")} } `:"";return`${e.value}${n}`}function u0(e){if(e.snapshot){const n=e.snapshot,t=e._futureSnapshot;e.snapshot=t,Ka(n.queryParams,t.queryParams)||e.queryParamsSubject.next(t.queryParams),n.fragment!==t.fragment&&e.fragmentSubject.next(t.fragment),Ka(n.params,t.params)||e.paramsSubject.next(t.params),function vO(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;++t)if(!Ka(e[t],n[t]))return!1;return!0}(n.url,t.url)||e.urlSubject.next(t.url),Ka(n.data,t.data)||e.dataSubject.next(t.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function h0(e,n){const t=Ka(e.params,n.params)&&function CO(e,n){return ju(e,n)&&e.every((t,r)=>Ka(t.parameters,n[r].parameters))}(e.url,n.url);return t&&!(!e.parent!=!n.parent)&&(!e.parent||h0(e.parent,n.parent))}let d0=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=zt,this.activateEvents=new st,this.deactivateEvents=new st,this.attachEvents=new st,this.detachEvents=new st,this.parentContexts=Je(Df),this.location=Je(ua),this.changeDetector=Je(pv),this.environmentInjector=Je(xs),this.inputBinder=Je(qg,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(t){if(t.name){const{firstChange:r,previousValue:a}=t.name;if(r)return;this.isTrackedInParentContexts(a)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(a)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ve(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ve(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ve(4012,!1);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new Ve(4013,!1);this._activatedRoute=t;const a=this.location,p=t.snapshot.component,b=this.parentContexts.getOrCreateContext(this.name).children,w=new iL(t,b,a.injector);this.activated=a.createComponent(p,{index:a.length,injector:w,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=Lr({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Na]})}return e})();class iL{constructor(n,t,r){this.route=n,this.childContexts=t,this.parent=r}get(n,t){return n===bd?this.route:n===Df?this.childContexts:this.parent.get(n,t)}}const qg=new ot("");let $D=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){const{activatedRoute:r}=t,a=Wv([r.queryParams,r.params,r.data]).pipe(Cr(([u,p,b],w)=>(b={...u,...p,...b},0===w?yt(b):Promise.resolve(b)))).subscribe(u=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(t);const p=function yP(e){const n=$t(e);if(!n)return null;const t=new Hp(n);return{get selector(){return t.selector},get type(){return t.componentType},get inputs(){return t.inputs},get outputs(){return t.outputs},get ngContentSelectors(){return t.ngContentSelectors},get isStandalone(){return n.standalone},get isSignal(){return n.signals}}}(r.component);if(p)for(const{templateName:b}of p.inputs)t.activatedComponentRef.setInput(b,u[b]);else this.unsubscribeFromRouteData(t)});this.outletDataSubscriptions.set(t,a)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac})}return e})();function Sf(e,n,t){if(t&&e.shouldReuseRoute(n.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=n.value;const a=function sL(e,n,t){return n.children.map(r=>{for(const a of t.children)if(e.shouldReuseRoute(r.value,a.value.snapshot))return Sf(e,r,a);return Sf(e,r)})}(e,n,t);return new Gl(r,a)}{if(e.shouldAttach(n.value)){const u=e.retrieve(n.value);if(null!==u){const p=u.route;return p.value._futureSnapshot=n.value,p.children=n.children.map(b=>Sf(e,b)),p}}const r=function aL(e){return new bd(new qt(e.url),new qt(e.params),new qt(e.queryParams),new qt(e.fragment),new qt(e.data),e.outlet,e.component,e)}(n.value),a=n.children.map(u=>Sf(e,u));return new Gl(r,a)}}const p0="ngNavigationCancelingError";function UD(e,n){const{redirectTo:t,navigationBehaviorOptions:r}=$u(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,a=HD(!1,0,n);return a.url=t,a.navigationBehaviorOptions=r,a}function HD(e,n,t){const r=new Error("NavigationCancelingError: "+(e||""));return r[p0]=!0,r.cancellationCode=n,t&&(r.url=t),r}function qD(e){return e&&e[p0]}let GD=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=ls({type:e,selectors:[["ng-component"]],standalone:!0,features:[Gw],decls:1,vars:0,template:function(r,a){1&r&&ad(0,"router-outlet")},dependencies:[d0],encapsulation:2})}return e})();function f0(e){const n=e.children&&e.children.map(f0),t=n?{...e,children:n}:{...e};return!t.component&&!t.loadComponent&&(n||t.loadChildren)&&t.outlet&&t.outlet!==zt&&(t.component=GD),t}function pa(e){return e.outlet||zt}function If(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let n=e.parent;n;n=n.parent){const t=n.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class mL{constructor(n,t,r,a,u){this.routeReuseStrategy=n,this.futureState=t,this.currState=r,this.forwardEvent=a,this.inputBindingEnabled=u}activate(n){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,n),u0(this.futureState.root),this.activateChildRoutes(t,r,n)}deactivateChildRoutes(n,t,r){const a=xd(t);n.children.forEach(u=>{const p=u.value.outlet;this.deactivateRoutes(u,a[p],r),delete a[p]}),Object.values(a).forEach(u=>{this.deactivateRouteAndItsChildren(u,r)})}deactivateRoutes(n,t,r){const a=n.value,u=t?t.value:null;if(a===u)if(a.component){const p=r.getContext(a.outlet);p&&this.deactivateChildRoutes(n,t,p.children)}else this.deactivateChildRoutes(n,t,r);else u&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(n,t){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,t):this.deactivateRouteAndOutlet(n,t)}detachAndStoreRouteSubtree(n,t){const r=t.getContext(n.value.outlet),a=r&&n.value.component?r.children:t,u=xd(n);for(const p of Object.keys(u))this.deactivateRouteAndItsChildren(u[p],a);if(r&&r.outlet){const p=r.outlet.detach(),b=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:p,route:n,contexts:b})}}deactivateRouteAndOutlet(n,t){const r=t.getContext(n.value.outlet),a=r&&n.value.component?r.children:t,u=xd(n);for(const p of Object.keys(u))this.deactivateRouteAndItsChildren(u[p],a);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,t,r){const a=xd(t);n.children.forEach(u=>{this.activateRoutes(u,a[u.value.outlet],r),this.forwardEvent(new eL(u.value.snapshot))}),n.children.length&&this.forwardEvent(new QO(n.value.snapshot))}activateRoutes(n,t,r){const a=n.value,u=t?t.value:null;if(u0(a),a===u)if(a.component){const p=r.getOrCreateContext(a.outlet);this.activateChildRoutes(n,t,p.children)}else this.activateChildRoutes(n,t,r);else if(a.component){const p=r.getOrCreateContext(a.outlet);if(this.routeReuseStrategy.shouldAttach(a.snapshot)){const b=this.routeReuseStrategy.retrieve(a.snapshot);this.routeReuseStrategy.store(a.snapshot,null),p.children.onOutletReAttached(b.contexts),p.attachRef=b.componentRef,p.route=b.route.value,p.outlet&&p.outlet.attach(b.componentRef,b.route.value),u0(b.route.value),this.activateChildRoutes(n,null,p.children)}else{const b=If(a.snapshot);p.attachRef=null,p.route=a,p.injector=b,p.outlet&&p.outlet.activateWith(a,p.injector),this.activateChildRoutes(n,null,p.children)}}else this.activateChildRoutes(n,null,r)}}class ZD{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class Gg{constructor(n,t){this.component=n,this.route=t}}function gL(e,n,t){const r=e._root;return Ef(r,n?n._root:null,t,[r.value])}function wd(e,n){const t=Symbol(),r=n.get(e,t);return r===t?"function"!=typeof e||function Qu(e){return null!==ul(e)}(e)?n.get(e):e:r}function Ef(e,n,t,r,a={canDeactivateChecks:[],canActivateChecks:[]}){const u=xd(n);return e.children.forEach(p=>{(function _L(e,n,t,r,a={canDeactivateChecks:[],canActivateChecks:[]}){const u=e.value,p=n?n.value:null,b=t?t.getContext(e.value.outlet):null;if(p&&u.routeConfig===p.routeConfig){const w=function vL(e,n,t){if("function"==typeof t)return t(e,n);switch(t){case"pathParamsChange":return!ju(e.url,n.url);case"pathParamsOrQueryParamsChange":return!ju(e.url,n.url)||!Ka(e.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!h0(e,n)||!Ka(e.queryParams,n.queryParams);default:return!h0(e,n)}}(p,u,u.routeConfig.runGuardsAndResolvers);w?a.canActivateChecks.push(new ZD(r)):(u.data=p.data,u._resolvedData=p._resolvedData),Ef(e,n,u.component?b?b.children:null:t,r,a),w&&b&&b.outlet&&b.outlet.isActivated&&a.canDeactivateChecks.push(new Gg(b.outlet.component,p))}else p&&Mf(n,b,a),a.canActivateChecks.push(new ZD(r)),Ef(e,null,u.component?b?b.children:null:t,r,a)})(p,u[p.value.outlet],t,r.concat([p.value]),a),delete u[p.value.outlet]}),Object.entries(u).forEach(([p,b])=>Mf(b,t.getContext(p),a)),a}function Mf(e,n,t){const r=xd(e),a=e.value;Object.entries(r).forEach(([u,p])=>{Mf(p,a.component?n?n.children.getContext(u):null:n,t)}),t.canDeactivateChecks.push(new Gg(a.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,a))}function Tf(e){return"function"==typeof e}function WD(e){return e instanceof Og||"EmptyError"===e?.name}const Zg=Symbol("INITIAL_VALUE");function Cd(){return Cr(e=>Wv(e.map(n=>n.pipe(gd(1),function hO(...e){const n=Ht(e);return _n((t,r)=>{(n?Xv(e,t,n):Xv(e,t)).subscribe(r)})}(Zg)))).pipe(rn(n=>{for(const t of n)if(!0!==t){if(t===Zg)return Zg;if(!1===t||t instanceof _d)return t}return!0}),Lc(n=>n!==Zg),gd(1)))}function XD(e){return function Ts(...e){return ga(e)}(Vi(n=>{if($u(n))throw UD(0,n)}),rn(n=>!0===n))}class Wg{constructor(n){this.segmentGroup=n||null}}class YD{constructor(n){this.urlTree=n}}function Dd(e){return ff(new Wg(e))}function KD(e){return ff(new YD(e))}class BL{constructor(n,t){this.urlSerializer=n,this.urlTree=t}noMatchError(n){return new Ve(4002,!1)}lineralizeSegments(n,t){let r=[],a=t.root;for(;;){if(r=r.concat(a.segments),0===a.numberOfChildren)return yt(r);if(a.numberOfChildren>1||!a.children[zt])return ff(new Ve(4e3,!1));a=a.children[zt]}}applyRedirectCommands(n,t,r){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),n,r)}applyRedirectCreateUrlTree(n,t,r,a){const u=this.createSegmentGroup(n,t.root,r,a);return new _d(u,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(n,t){const r={};return Object.entries(n).forEach(([a,u])=>{if("string"==typeof u&&u.startsWith(":")){const b=u.substring(1);r[a]=t[b]}else r[a]=u}),r}createSegmentGroup(n,t,r,a){const u=this.createSegments(n,t.segments,r,a);let p={};return Object.entries(t.children).forEach(([b,w])=>{p[b]=this.createSegmentGroup(n,w,r,a)}),new Sn(u,p)}createSegments(n,t,r,a){return t.map(u=>u.path.startsWith(":")?this.findPosParam(n,u,a):this.findOrReturn(u,r))}findPosParam(n,t,r){const a=r[t.path.substring(1)];if(!a)throw new Ve(4001,!1);return a}findOrReturn(n,t){let r=0;for(const a of t){if(a.path===n.path)return t.splice(r),a;r++}return n}}const m0={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function VL(e,n,t,r,a){const u=g0(e,n,t);return u.matched?(r=function cL(e,n){return e.providers&&!e._injector&&(e._injector=$_(e.providers,n,`Route: ${e.path}`)),e._injector??n}(n,r),function FL(e,n,t,r){const a=n.canMatch;return a&&0!==a.length?yt(a.map(p=>{const b=wd(p,e);return Nc(function SL(e){return e&&Tf(e.canMatch)}(b)?b.canMatch(n,t):e.runInContext(()=>b(n,t)))})).pipe(Cd(),XD()):yt(!0)}(r,n,t).pipe(rn(p=>!0===p?u:{...m0}))):yt(u)}function g0(e,n,t){if(""===n.path)return"full"===n.pathMatch&&(e.hasChildren()||t.length>0)?{...m0}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const a=(n.matcher||_O)(t,e,n);if(!a)return{...m0};const u={};Object.entries(a.posParams??{}).forEach(([b,w])=>{u[b]=w.path});const p=a.consumed.length>0?{...u,...a.consumed[a.consumed.length-1].parameters}:u;return{matched:!0,consumedSegments:a.consumed,remainingSegments:t.slice(a.consumed.length),parameters:p,positionalParamSegments:a.posParams??{}}}function QD(e,n,t,r){return t.length>0&&function UL(e,n,t){return t.some(r=>Xg(e,n,r)&&pa(r)!==zt)}(e,t,r)?{segmentGroup:new Sn(n,$L(r,new Sn(t,e.children))),slicedSegments:[]}:0===t.length&&function HL(e,n,t){return t.some(r=>Xg(e,n,r))}(e,t,r)?{segmentGroup:new Sn(e.segments,jL(e,0,t,r,e.children)),slicedSegments:t}:{segmentGroup:new Sn(e.segments,e.children),slicedSegments:t}}function jL(e,n,t,r,a){const u={};for(const p of r)if(Xg(e,t,p)&&!a[pa(p)]){const b=new Sn([],{});u[pa(p)]=b}return{...a,...u}}function $L(e,n){const t={};t[zt]=n;for(const r of e)if(""===r.path&&pa(r)!==zt){const a=new Sn([],{});t[pa(r)]=a}return t}function Xg(e,n,t){return(!(e.hasChildren()||n.length>0)||"full"!==t.pathMatch)&&""===t.path}class WL{constructor(n,t,r,a,u,p,b){this.injector=n,this.configLoader=t,this.rootComponentType=r,this.config=a,this.urlTree=u,this.paramsInheritanceStrategy=p,this.urlSerializer=b,this.allowRedirects=!0,this.applyRedirects=new BL(this.urlSerializer,this.urlTree)}noMatchError(n){return new Ve(4002,!1)}recognize(){const n=QD(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,n,zt).pipe(Vu(t=>{if(t instanceof YD)return this.allowRedirects=!1,this.urlTree=t.urlTree,this.match(t.urlTree);throw t instanceof Wg?this.noMatchError(t):t}),rn(t=>{const r=new Hg([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},zt,this.rootComponentType,null,{}),a=new Gl(r,t),u=new VD("",a),p=function zO(e,n,t=null,r=null){return MD(ED(e),n,t,r)}(r,[],this.urlTree.queryParams,this.urlTree.fragment);return p.queryParams=this.urlTree.queryParams,u.url=this.urlSerializer.serialize(p),this.inheritParamsAndData(u._root),{state:u,tree:p}}))}match(n){return this.processSegmentGroup(this.injector,this.config,n.root,zt).pipe(Vu(r=>{throw r instanceof Wg?this.noMatchError(r):r}))}inheritParamsAndData(n){const t=n.value,r=BD(t,this.paramsInheritanceStrategy);t.params=Object.freeze(r.params),t.data=Object.freeze(r.data),n.children.forEach(a=>this.inheritParamsAndData(a))}processSegmentGroup(n,t,r,a){return 0===r.segments.length&&r.hasChildren()?this.processChildren(n,t,r):this.processSegment(n,t,r,r.segments,a,!0)}processChildren(n,t,r){const a=[];for(const u of Object.keys(r.children))"primary"===u?a.unshift(u):a.push(u);return gt(a).pipe(mf(u=>{const p=r.children[u],b=function pL(e,n){const t=e.filter(r=>pa(r)===n);return t.push(...e.filter(r=>pa(r)!==n)),t}(t,u);return this.processSegmentGroup(n,b,p,u)}),function pO(e,n){return _n(function dO(e,n,t,r,a){return(u,p)=>{let b=t,w=n,M=0;u.subscribe(an(p,R=>{const B=M++;w=b?e(w,R,B):(b=!0,R),r&&p.next(w)},a&&(()=>{b&&p.next(w),p.complete()})))}}(e,n,arguments.length>=2,!0))}((u,p)=>(u.push(...p),u)),Lg(null),function fO(e,n){const t=arguments.length>=2;return r=>r.pipe(e?Lc((a,u)=>e(a,u,r)):ir,Kv(1),t?Lg(n):cD(()=>new Og))}(),Et(u=>{if(null===u)return Dd(r);const p=JD(u);return function XL(e){e.sort((n,t)=>n.value.outlet===zt?-1:t.value.outlet===zt?1:n.value.outlet.localeCompare(t.value.outlet))}(p),yt(p)}))}processSegment(n,t,r,a,u,p){return gt(t).pipe(mf(b=>this.processSegmentAgainstRoute(b._injector??n,t,b,r,a,u,p).pipe(Vu(w=>{if(w instanceof Wg)return yt(null);throw w}))),Fc(b=>!!b),Vu(b=>{if(WD(b))return function GL(e,n,t){return 0===n.length&&!e.children[t]}(r,a,u)?yt([]):Dd(r);throw b}))}processSegmentAgainstRoute(n,t,r,a,u,p,b){return function qL(e,n,t,r){return!!(pa(e)===r||r!==zt&&Xg(n,t,e))&&("**"===e.path||g0(n,e,t).matched)}(r,a,u,p)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(n,a,r,u,p,b):b&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,a,t,r,u,p):Dd(a):Dd(a)}expandSegmentAgainstRouteUsingRedirect(n,t,r,a,u,p){return"**"===a.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,r,a,p):this.expandRegularSegmentAgainstRouteUsingRedirect(n,t,r,a,u,p)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,t,r,a){const u=this.applyRedirects.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?KD(u):this.applyRedirects.lineralizeSegments(r,u).pipe(Et(p=>{const b=new Sn(p,{});return this.processSegment(n,t,b,p,a,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,t,r,a,u,p){const{matched:b,consumedSegments:w,remainingSegments:M,positionalParamSegments:R}=g0(t,a,u);if(!b)return Dd(t);const B=this.applyRedirects.applyRedirectCommands(w,a.redirectTo,R);return a.redirectTo.startsWith("/")?KD(B):this.applyRedirects.lineralizeSegments(a,B).pipe(Et(W=>this.processSegment(n,r,t,W.concat(M),p,!1)))}matchSegmentAgainstRoute(n,t,r,a,u,p){let b;if("**"===r.path){const w=a.length>0?gD(a).parameters:{};b=yt({snapshot:new Hg(a,w,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,eS(r),pa(r),r.component??r._loadedComponent??null,r,tS(r)),consumedSegments:[],remainingSegments:[]}),t.children={}}else b=VL(t,r,a,n).pipe(rn(({matched:w,consumedSegments:M,remainingSegments:R,parameters:B})=>w?{snapshot:new Hg(M,B,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,eS(r),pa(r),r.component??r._loadedComponent??null,r,tS(r)),consumedSegments:M,remainingSegments:R}:null));return b.pipe(Cr(w=>null===w?Dd(t):this.getChildConfig(n=r._injector??n,r,a).pipe(Cr(({routes:M})=>{const R=r._loadedInjector??n,{snapshot:B,consumedSegments:W,remainingSegments:re}=w,{segmentGroup:pe,slicedSegments:ve}=QD(t,W,re,M);if(0===ve.length&&pe.hasChildren())return this.processChildren(R,M,pe).pipe(rn(Be=>null===Be?null:[new Gl(B,Be)]));if(0===M.length&&0===ve.length)return yt([new Gl(B,[])]);const Ae=pa(r)===u;return this.processSegment(R,M,pe,ve,Ae?zt:u,!0).pipe(rn(Be=>[new Gl(B,Be)]))}))))}getChildConfig(n,t,r){return t.children?yt({routes:t.children,injector:n}):t.loadChildren?void 0!==t._loadedRoutes?yt({routes:t._loadedRoutes,injector:t._loadedInjector}):function LL(e,n,t,r){const a=n.canLoad;return void 0===a||0===a.length?yt(!0):yt(a.map(p=>{const b=wd(p,e);return Nc(function bL(e){return e&&Tf(e.canLoad)}(b)?b.canLoad(n,t):e.runInContext(()=>b(n,t)))})).pipe(Cd(),XD())}(n,t,r).pipe(Et(a=>a?this.configLoader.loadChildren(n,t).pipe(Vi(u=>{t._loadedRoutes=u.routes,t._loadedInjector=u.injector})):function zL(e){return ff(HD(!1,3))}())):yt({routes:[],injector:n})}}function YL(e){const n=e.value.routeConfig;return n&&""===n.path}function JD(e){const n=[],t=new Set;for(const r of e){if(!YL(r)){n.push(r);continue}const a=n.find(u=>r.value.routeConfig===u.value.routeConfig);void 0!==a?(a.children.push(...r.children),t.add(a)):n.push(r)}for(const r of t){const a=JD(r.children);n.push(new Gl(r.value,a))}return n.filter(r=>!t.has(r))}function eS(e){return e.data||{}}function tS(e){return e.resolve||{}}function nS(e){return"string"==typeof e.title||null===e.title}function y0(e){return Cr(n=>{const t=e(n);return t?gt(t).pipe(rn(()=>n)):yt(n)})}const Sd=new ot("ROUTES");let _0=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=Je(N1)}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return yt(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const r=Nc(t.loadComponent()).pipe(rn(rS),Vi(u=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=u}),Qv(()=>{this.componentLoaders.delete(t)})),a=new fD(r,()=>new dr).pipe(Yv());return this.componentLoaders.set(t,a),a}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return yt({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const u=function rF(e,n,t,r){return Nc(e.loadChildren()).pipe(rn(rS),Et(a=>a instanceof Hw||Array.isArray(a)?yt(a):gt(n.compileModuleAsync(a))),rn(a=>{r&&r(e);let u,p,b=!1;return Array.isArray(a)?(p=a,!0):(u=a.create(t).injector,p=u.get(Sd,[],{optional:!0,self:!0}).flat()),{routes:p.map(f0),injector:u}}))}(r,this.compiler,t,this.onLoadEndListener).pipe(Qv(()=>{this.childrenLoaders.delete(r)})),p=new fD(u,()=>new dr).pipe(Yv());return this.childrenLoaders.set(r,p),p}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function rS(e){return function iF(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let Yg=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new dr,this.transitionAbortSubject=new dr,this.configLoader=Je(_0),this.environmentInjector=Je(xs),this.urlSerializer=Je(_f),this.rootContexts=Je(Df),this.inputBindingEnabled=null!==Je(qg,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>yt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=a=>this.events.next(new YO(a)),this.configLoader.onLoadStartListener=a=>this.events.next(new XO(a))}complete(){this.transitions?.complete()}handleNavigationRequest(t){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:r})}setupNavigations(t,r,a){return this.transitions=new qt({id:0,currentUrlTree:r,currentRawUrl:r,currentBrowserUrl:r,extractedUrl:t.urlHandlingStrategy.extract(r),urlAfterRedirects:t.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:wf,restoredState:null,currentSnapshot:a.snapshot,targetSnapshot:null,currentRouterState:a,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Lc(u=>0!==u.id),rn(u=>({...u,extractedUrl:t.urlHandlingStrategy.extract(u.rawUrl)})),Cr(u=>{this.currentTransition=u;let p=!1,b=!1;return yt(u).pipe(Vi(w=>{this.currentNavigation={id:w.id,initialUrl:w.rawUrl,extractedUrl:w.extractedUrl,trigger:w.source,extras:w.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Cr(w=>{const M=w.currentBrowserUrl.toString(),R=!t.navigated||w.extractedUrl.toString()!==M||M!==w.currentUrlTree.toString();if(!R&&"reload"!==(w.extras.onSameUrlNavigation??t.onSameUrlNavigation)){const W="";return this.events.next(new vd(w.id,this.urlSerializer.serialize(w.rawUrl),W,0)),w.resolve(null),vn}if(t.urlHandlingStrategy.shouldProcessUrl(w.rawUrl))return yt(w).pipe(Cr(W=>{const re=this.transitions?.getValue();return this.events.next(new $g(W.id,this.urlSerializer.serialize(W.extractedUrl),W.source,W.restoredState)),re!==this.transitions?.getValue()?vn:Promise.resolve(W)}),function KL(e,n,t,r,a,u){return Et(p=>function ZL(e,n,t,r,a,u,p="emptyOnly"){return new WL(e,n,t,r,a,p,u).recognize()}(e,n,t,r,p.extractedUrl,a,u).pipe(rn(({state:b,tree:w})=>({...p,targetSnapshot:b,urlAfterRedirects:w}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),Vi(W=>{u.targetSnapshot=W.targetSnapshot,u.urlAfterRedirects=W.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:W.urlAfterRedirects};const re=new OD(W.id,this.urlSerializer.serialize(W.extractedUrl),this.urlSerializer.serialize(W.urlAfterRedirects),W.targetSnapshot);this.events.next(re)}));if(R&&t.urlHandlingStrategy.shouldProcessUrl(w.currentRawUrl)){const{id:W,extractedUrl:re,source:pe,restoredState:ve,extras:Ae}=w,Be=new $g(W,this.urlSerializer.serialize(re),pe,ve);this.events.next(Be);const Ce=zD(0,this.rootComponentType).snapshot;return this.currentTransition=u={...w,targetSnapshot:Ce,urlAfterRedirects:re,extras:{...Ae,skipLocationChange:!1,replaceUrl:!1}},yt(u)}{const W="";return this.events.next(new vd(w.id,this.urlSerializer.serialize(w.extractedUrl),W,1)),w.resolve(null),vn}}),Vi(w=>{const M=new qO(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects),w.targetSnapshot);this.events.next(M)}),rn(w=>(this.currentTransition=u={...w,guards:gL(w.targetSnapshot,w.currentSnapshot,this.rootContexts)},u)),function EL(e,n){return Et(t=>{const{targetSnapshot:r,currentSnapshot:a,guards:{canActivateChecks:u,canDeactivateChecks:p}}=t;return 0===p.length&&0===u.length?yt({...t,guardsResult:!0}):function ML(e,n,t,r){return gt(e).pipe(Et(a=>function OL(e,n,t,r,a){const u=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return u&&0!==u.length?yt(u.map(b=>{const w=If(n)??a,M=wd(b,w);return Nc(function DL(e){return e&&Tf(e.canDeactivate)}(M)?M.canDeactivate(e,n,t,r):w.runInContext(()=>M(e,n,t,r))).pipe(Fc())})).pipe(Cd()):yt(!0)}(a.component,a.route,t,n,r)),Fc(a=>!0!==a,!0))}(p,r,a,e).pipe(Et(b=>b&&function xL(e){return"boolean"==typeof e}(b)?function TL(e,n,t,r){return gt(n).pipe(mf(a=>Xv(function PL(e,n){return null!==e&&n&&n(new KO(e)),yt(!0)}(a.route.parent,r),function AL(e,n){return null!==e&&n&&n(new JO(e)),yt(!0)}(a.route,r),function RL(e,n,t){const r=n[n.length-1],u=n.slice(0,n.length-1).reverse().map(p=>function yL(e){const n=e.routeConfig?e.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:e,guards:n}:null}(p)).filter(p=>null!==p).map(p=>pD(()=>yt(p.guards.map(w=>{const M=If(p.node)??t,R=wd(w,M);return Nc(function CL(e){return e&&Tf(e.canActivateChild)}(R)?R.canActivateChild(r,e):M.runInContext(()=>R(r,e))).pipe(Fc())})).pipe(Cd())));return yt(u).pipe(Cd())}(e,a.path,t),function kL(e,n,t){const r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||0===r.length)return yt(!0);const a=r.map(u=>pD(()=>{const p=If(n)??t,b=wd(u,p);return Nc(function wL(e){return e&&Tf(e.canActivate)}(b)?b.canActivate(n,e):p.runInContext(()=>b(n,e))).pipe(Fc())}));return yt(a).pipe(Cd())}(e,a.route,t))),Fc(a=>!0!==a,!0))}(r,u,e,n):yt(b)),rn(b=>({...t,guardsResult:b})))})}(this.environmentInjector,w=>this.events.next(w)),Vi(w=>{if(u.guardsResult=w.guardsResult,$u(w.guardsResult))throw UD(0,w.guardsResult);const M=new GO(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects),w.targetSnapshot,!!w.guardsResult);this.events.next(M)}),Lc(w=>!!w.guardsResult||(this.cancelNavigationTransition(w,"",3),!1)),y0(w=>{if(w.guards.canActivateChecks.length)return yt(w).pipe(Vi(M=>{const R=new ZO(M.id,this.urlSerializer.serialize(M.extractedUrl),this.urlSerializer.serialize(M.urlAfterRedirects),M.targetSnapshot);this.events.next(R)}),Cr(M=>{let R=!1;return yt(M).pipe(function QL(e,n){return Et(t=>{const{targetSnapshot:r,guards:{canActivateChecks:a}}=t;if(!a.length)return yt(t);let u=0;return gt(a).pipe(mf(p=>function JL(e,n,t,r){const a=e.routeConfig,u=e._resolve;return void 0!==a?.title&&!nS(a)&&(u[gf]=a.title),function eF(e,n,t,r){const a=function tF(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===a.length)return yt({});const u={};return gt(a).pipe(Et(p=>function nF(e,n,t,r){const a=If(n)??r,u=wd(e,a);return Nc(u.resolve?u.resolve(n,t):a.runInContext(()=>u(n,t)))}(e[p],n,t,r).pipe(Fc(),Vi(b=>{u[p]=b}))),Kv(1),function mO(e){return rn(()=>e)}(u),Vu(p=>WD(p)?vn:ff(p)))}(u,e,n,r).pipe(rn(p=>(e._resolvedData=p,e.data=BD(e,t).resolve,a&&nS(a)&&(e.data[gf]=a.title),null)))}(p.route,r,e,n)),Vi(()=>u++),Kv(1),Et(p=>u===a.length?yt(t):vn))})}(t.paramsInheritanceStrategy,this.environmentInjector),Vi({next:()=>R=!0,complete:()=>{R||this.cancelNavigationTransition(M,"",2)}}))}),Vi(M=>{const R=new WO(M.id,this.urlSerializer.serialize(M.extractedUrl),this.urlSerializer.serialize(M.urlAfterRedirects),M.targetSnapshot);this.events.next(R)}))}),y0(w=>{const M=R=>{const B=[];R.routeConfig?.loadComponent&&!R.routeConfig._loadedComponent&&B.push(this.configLoader.loadComponent(R.routeConfig).pipe(Vi(W=>{R.component=W}),rn(()=>{})));for(const W of R.children)B.push(...M(W));return B};return Wv(M(w.targetSnapshot.root)).pipe(Lg(),gd(1))}),y0(()=>this.afterPreactivation()),rn(w=>{const M=function oL(e,n,t){const r=Sf(e,n._root,t?t._root:void 0);return new ND(r,n)}(t.routeReuseStrategy,w.targetSnapshot,w.currentRouterState);return this.currentTransition=u={...w,targetRouterState:M},u}),Vi(()=>{this.events.next(new o0)}),((e,n,t,r)=>rn(a=>(new mL(n,a.targetRouterState,a.currentRouterState,t,r).activate(e),a)))(this.rootContexts,t.routeReuseStrategy,w=>this.events.next(w),this.inputBindingEnabled),gd(1),Vi({next:w=>{p=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new zc(w.id,this.urlSerializer.serialize(w.extractedUrl),this.urlSerializer.serialize(w.urlAfterRedirects))),t.titleStrategy?.updateTitle(w.targetRouterState.snapshot),w.resolve(!0)},complete:()=>{p=!0}}),function gO(e){return _n((n,t)=>{Ze(e).subscribe(an(t,()=>t.complete(),Jo)),!t.closed&&n.subscribe(t)})}(this.transitionAbortSubject.pipe(Vi(w=>{throw w}))),Qv(()=>{p||b||this.cancelNavigationTransition(u,"",1),this.currentNavigation?.id===u.id&&(this.currentNavigation=null)}),Vu(w=>{if(b=!0,qD(w))this.events.next(new Cf(u.id,this.urlSerializer.serialize(u.extractedUrl),w.message,w.cancellationCode)),function lL(e){return qD(e)&&$u(e.url)}(w)?this.events.next(new s0(w.url)):u.resolve(!1);else{this.events.next(new Ug(u.id,this.urlSerializer.serialize(u.extractedUrl),w,u.targetSnapshot??void 0));try{u.resolve(t.errorHandler(w))}catch(M){u.reject(M)}}return vn}))}))}cancelNavigationTransition(t,r,a){const u=new Cf(t.id,this.urlSerializer.serialize(t.extractedUrl),r,a);this.events.next(u),t.resolve(!1)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function iS(e){return e!==wf}let oS=(()=>{class e{buildTitle(t){let r,a=t.root;for(;void 0!==a;)r=this.getResolvedTitleForRoute(a)??r,a=a.children.find(u=>u.outlet===zt);return r}getResolvedTitleForRoute(t){return t.data[gf]}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:function(){return Je(oF)},providedIn:"root"})}return e})(),oF=(()=>{class e extends oS{constructor(t){super(),this.title=t}updateTitle(t){const r=this.buildTitle(t);void 0!==r&&this.title.setTitle(r)}static#e=this.\u0275fac=function(r){return new(r||e)(ht(nD))};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),sF=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:function(){return Je(lF)},providedIn:"root"})}return e})();class aF{shouldDetach(n){return!1}store(n,t){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,t){return n.routeConfig===t.routeConfig}}let lF=(()=>{class e extends aF{static#e=this.\u0275fac=function(){let t;return function(a){return(t||(t=function ap(e){return ki(()=>{const n=e.prototype.constructor,t=n[Yr]||Sh(n),r=Object.prototype;let a=Object.getPrototypeOf(e.prototype).constructor;for(;a&&a!==r;){const u=a[Yr]||Sh(a);if(u&&u!==t)return u;a=Object.getPrototypeOf(a)}return u=>new u})}(e)))(a||e)}}();static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Kg=new ot("",{providedIn:"root",factory:()=>({})});let cF=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:function(){return Je(uF)},providedIn:"root"})}return e})(),uF=(()=>{class e{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var Af=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(Af||{});function sS(e,n){e.events.pipe(Lc(t=>t instanceof zc||t instanceof Cf||t instanceof Ug||t instanceof vd),rn(t=>t instanceof zc||t instanceof vd?Af.COMPLETE:t instanceof Cf&&(0===t.code||1===t.code)?Af.REDIRECTING:Af.FAILED),Lc(t=>t!==Af.REDIRECTING),gd(1)).subscribe(()=>{n()})}function hF(e){throw e}function dF(e,n,t){return n.parse("/")}const pF={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},fF={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Es=(()=>{class e{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.location.getState()?.\u0275routerPageId??this.currentPageId}get events(){return this._events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=Je(L1),this.isNgZoneEnabled=!1,this._events=new dr,this.options=Je(Kg,{optional:!0})||{},this.pendingTasks=Je(F1),this.errorHandler=this.options.errorHandler||hF,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||dF,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=Je(cF),this.routeReuseStrategy=Je(sF),this.titleStrategy=Je(oS),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Je(Sd,{optional:!0})?.flat()??[],this.navigationTransitions=Je(Yg),this.urlSerializer=Je(_f),this.location=Je(Cv),this.componentInputBindingEnabled=!!Je(qg,{optional:!0}),this.eventsSubscription=new On,this.isNgZoneEnabled=Je(Rn)instanceof Rn&&Rn.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new _d,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=zD(0,null),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const t=this.navigationTransitions.events.subscribe(r=>{try{const{currentTransition:a}=this.navigationTransitions;if(null===a)return void(aS(r)&&this._events.next(r));if(r instanceof $g)iS(a.source)&&(this.browserUrlTree=a.extractedUrl);else if(r instanceof vd)this.rawUrlTree=a.rawUrl;else if(r instanceof OD){if("eager"===this.urlUpdateStrategy){if(!a.extras.skipLocationChange){const u=this.urlHandlingStrategy.merge(a.urlAfterRedirects,a.rawUrl);this.setBrowserUrl(u,a)}this.browserUrlTree=a.urlAfterRedirects}}else if(r instanceof o0)this.currentUrlTree=a.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(a.urlAfterRedirects,a.rawUrl),this.routerState=a.targetRouterState,"deferred"===this.urlUpdateStrategy&&(a.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,a),this.browserUrlTree=a.urlAfterRedirects);else if(r instanceof Cf)0!==r.code&&1!==r.code&&(this.navigated=!0),(3===r.code||2===r.code)&&this.restoreHistory(a);else if(r instanceof s0){const u=this.urlHandlingStrategy.merge(r.url,a.currentRawUrl),p={skipLocationChange:a.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||iS(a.source)};this.scheduleNavigation(u,wf,null,p,{resolve:a.resolve,reject:a.reject,promise:a.promise})}r instanceof Ug&&this.restoreHistory(a,!0),r instanceof zc&&(this.navigated=!0),aS(r)&&this._events.next(r)}catch(a){this.navigationTransitions.transitionAbortSubject.next(a)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const t=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),wf,t)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const r="popstate"===t.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(t.url,r,t.state)},0)}))}navigateToSyncWithBrowser(t,r,a){const u={replaceUrl:!0},p=a?.navigationId?a:null;if(a){const w={...a};delete w.navigationId,delete w.\u0275routerPageId,0!==Object.keys(w).length&&(u.state=w)}const b=this.parseUrl(t);this.scheduleNavigation(b,r,p,u)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(f0),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,r={}){const{relativeTo:a,queryParams:u,fragment:p,queryParamsHandling:b,preserveFragment:w}=r,M=w?this.currentUrlTree.fragment:p;let B,R=null;switch(b){case"merge":R={...this.currentUrlTree.queryParams,...u};break;case"preserve":R=this.currentUrlTree.queryParams;break;default:R=u||null}null!==R&&(R=this.removeEmptyProps(R));try{B=ED(a?a.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof t[0]||!t[0].startsWith("/"))&&(t=[]),B=this.currentUrlTree.root}return MD(B,t,R,M??null)}navigateByUrl(t,r={skipLocationChange:!1}){const a=$u(t)?t:this.parseUrl(t),u=this.urlHandlingStrategy.merge(a,this.rawUrlTree);return this.scheduleNavigation(u,wf,null,r)}navigate(t,r={skipLocationChange:!1}){return function mF(e){for(let n=0;n<e.length;n++)if(null==e[n])throw new Ve(4008,!1)}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let r;try{r=this.urlSerializer.parse(t)}catch(a){r=this.malformedUriErrorHandler(a,this.urlSerializer,t)}return r}isActive(t,r){let a;if(a=!0===r?{...pF}:!1===r?{...fF}:r,$u(t))return _D(this.currentUrlTree,t,a);const u=this.parseUrl(t);return _D(this.currentUrlTree,u,a)}removeEmptyProps(t){return Object.keys(t).reduce((r,a)=>{const u=t[a];return null!=u&&(r[a]=u),r},{})}scheduleNavigation(t,r,a,u,p){if(this.disposed)return Promise.resolve(!1);let b,w,M;p?(b=p.resolve,w=p.reject,M=p.promise):M=new Promise((B,W)=>{b=B,w=W});const R=this.pendingTasks.add();return sS(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(R))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:a,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,currentBrowserUrl:this.browserUrlTree,rawUrl:t,extras:u,resolve:b,reject:w,promise:M,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),M.catch(B=>Promise.reject(B))}setBrowserUrl(t,r){const a=this.urlSerializer.serialize(t);if(this.location.isCurrentPathEqualTo(a)||r.extras.replaceUrl){const p={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(a,"",p)}else{const u={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId+1)};this.location.go(a,"",u)}}restoreHistory(t,r=!1){if("computed"===this.canceledNavigationResolution){const u=this.currentPageId-this.browserPageId;0!==u?this.location.historyGo(u):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===u&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function aS(e){return!(e instanceof o0||e instanceof s0)}class lS{}let _F=(()=>{class e{constructor(t,r,a,u,p){this.router=t,this.injector=a,this.preloadingStrategy=u,this.loader=p}setUpPreloading(){this.subscription=this.router.events.pipe(Lc(t=>t instanceof zc),mf(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const a=[];for(const u of r){u.providers&&!u._injector&&(u._injector=$_(u.providers,t,`Route: ${u.path}`));const p=u._injector??t,b=u._loadedInjector??p;(u.loadChildren&&!u._loadedRoutes&&void 0===u.canLoad||u.loadComponent&&!u._loadedComponent)&&a.push(this.preloadConfig(p,u)),(u.children||u._loadedRoutes)&&a.push(this.processRoutes(b,u.children??u._loadedRoutes))}return gt(a).pipe(wn())}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>{let a;a=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(t,r):yt(null);const u=a.pipe(Et(p=>null===p?yt(void 0):(r._loadedRoutes=p.routes,r._loadedInjector=p.injector,this.processRoutes(p.injector??t,p.routes))));return r.loadComponent&&!r._loadedComponent?gt([u,this.loader.loadComponent(r)]).pipe(wn()):u})}static#e=this.\u0275fac=function(r){return new(r||e)(ht(Es),ht(N1),ht(xs),ht(lS),ht(_0))};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const x0=new ot("");let cS=(()=>{class e{constructor(t,r,a,u,p={}){this.urlSerializer=t,this.transitions=r,this.viewportScroller=a,this.zone=u,this.options=p,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},p.scrollPositionRestoration=p.scrollPositionRestoration||"disabled",p.anchorScrolling=p.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof $g?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof zc?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof vd&&0===t.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof LD&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new LD(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){!function Ex(){throw new Error("invalid")}()};static#t=this.\u0275prov=ct({token:e,factory:e.\u0275fac})}return e})();function Zl(e,n){return{\u0275kind:e,\u0275providers:n}}function hS(){const e=Je(bs);return n=>{const t=e.get(pd);if(n!==t.components[0])return;const r=e.get(Es),a=e.get(dS);1===e.get(b0)&&r.initialNavigation(),e.get(pS,null,Lt.Optional)?.setUpPreloading(),e.get(x0,null,Lt.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),a.closed||(a.next(),a.complete(),a.unsubscribe())}}const dS=new ot("",{factory:()=>new dr}),b0=new ot("",{providedIn:"root",factory:()=>1}),pS=new ot("");function wF(e){return Zl(0,[{provide:pS,useExisting:_F},{provide:lS,useExisting:e}])}const fS=new ot("ROUTER_FORROOT_GUARD"),DF=[Cv,{provide:_f,useClass:Jv},Es,Df,{provide:bd,useFactory:function uS(e){return e.routerState.root},deps:[Es]},_0,[]];function SF(){return new H1("Router",Es)}let mS=(()=>{class e{constructor(t){}static forRoot(t,r){return{ngModule:e,providers:[DF,[],{provide:Sd,multi:!0,useValue:t},{provide:fS,useFactory:TF,deps:[[Es,new Va,new Go]]},{provide:Kg,useValue:r||{}},r?.useHash?{provide:Bu,useClass:wP}:{provide:Bu,useClass:xC},{provide:x0,useFactory:()=>{const e=Je(Uk),n=Je(Rn),t=Je(Kg),r=Je(Yg),a=Je(_f);return t.scrollOffset&&e.setOffset(t.scrollOffset),new cS(a,r,e,n,t)}},r?.preloadingStrategy?wF(r.preloadingStrategy).\u0275providers:[],{provide:H1,multi:!0,useFactory:SF},r?.initialNavigation?AF(r):[],r?.bindToComponentInputs?Zl(8,[$D,{provide:qg,useExisting:$D}]).\u0275providers:[],[{provide:gS,useFactory:hS},{provide:hv,multi:!0,useExisting:gS}]]}}static forChild(t){return{ngModule:e,providers:[{provide:Sd,multi:!0,useValue:t}]}}static#e=this.\u0275fac=function(r){return new(r||e)(ht(fS,8))};static#t=this.\u0275mod=Ki({type:e});static#n=this.\u0275inj=Ai({})}return e})();function TF(e){return"guarded"}function AF(e){return["disabled"===e.initialNavigation?Zl(3,[{provide:rv,multi:!0,useFactory:()=>{const n=Je(Es);return()=>{n.setUpLocationChangeListener()}}},{provide:b0,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Zl(2,[{provide:b0,useValue:0},{provide:rv,multi:!0,deps:[bs],useFactory:n=>{const t=n.get(xP,Promise.resolve());return()=>t.then(()=>new Promise(r=>{const a=n.get(Es),u=n.get(dS);sS(a,()=>{r(!0)}),n.get(Yg).afterPreactivation=()=>(r(!0),u.closed?yt(void 0):u),a.initialNavigation()}))}}]).\u0275providers:[]]}const gS=new ot(""),kF=["mapa"],RF=["powerplantinfo"],OF=function(){return[6.4]},LF=function(){return[15.5,49.8]},FF=[{path:"",component:(()=>{class e{mapLoaded(t){this.map=t,this.map.on("click","elektrarny",r=>{var a=r.features[0].properties,u=r.features[0].geometry;let p=[u.coordinates[0],u.coordinates[1]];(new Rg.Popup).setLngLat(p).setHTML("<b>"+a.name+"</b><br>"+a.description1).addTo(t),this.powerplant_info.nativeElement.innerHTML="<b>"+a.name+"</b><br>"+a.description1}),this.map.on("mouseenter","elektrarny",()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave","elektrarny",()=>{this.map.getCanvas().style.cursor=""})}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=ls({type:e,selectors:[["app-main-page"]],viewQuery:function(r,a){if(1&r&&(hg(kF,5),hg(RF,5)),2&r){let u;rf(u=sf())&&(a.map=u.first),rf(u=sf())&&(a.powerplant_info=u.first)}},decls:20,vars:6,consts:[[1,"main-page"],[1,"map-container"],[3,"zoom","center","mapLoad"],["mapa",""],["powerplantinfo",""]],template:function(r,a){1&r&&(sa(0,"div",0)(1,"h1"),kc(2,"Uheln\xe9 elektr\xe1rny v \u010cR"),Cs(),sa(3,"p"),kc(4," Tady bude naps\xe1no co to je, jak to funguje a k \u010demu to bylo. "),Cs(),sa(5,"h2"),kc(6,"Historick\xfd kontext"),Cs(),sa(7,"p"),kc(8," Tady bude n\u011bjak\xfd p\u0159ehled k historii. "),Cs(),sa(9,"h2"),kc(10,"Dne\u0161n\xed kontext"),Cs(),sa(11,"p"),kc(12," Tady bude shrnut\xed aktu\xe1ln\xedho stavu. "),Cs(),sa(13,"h2"),kc(14,"P\u0159ehled uheln\xfdch elektr\xe1ren v \u010cR"),Cs(),sa(15,"div",1)(16,"mgl-map",2,3),ng("mapLoad",function(p){return a.mapLoaded(p)}),Cs()(),ad(18,"div",null,4),Cs()),2&r&&(function Sx(e){Ix(Kt(),Me(),di()+e,!1)}(16),aa("/assets/slepa_mapa_osm_prod.json"),D_("zoom",H_(4,OF))("center",H_(5,LF)))},dependencies:[YR],styles:[".map-container[_ngcontent-%COMP%]{width:100%;height:500px}mgl-map[_ngcontent-%COMP%]{height:100%;width:100%}"]})}return e})()}];let NF=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ki({type:e});static#n=this.\u0275inj=Ai({imports:[mS.forRoot(FF),mS]})}return e})(),zF=(()=>{class e{constructor(){this.title="hvt-uhelne-elektrarny"}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=ls({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(r,a){1&r&&ad(0,"router-outlet")},dependencies:[d0]})}return e})(),BF=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=Ki({type:e,bootstrap:[zF]});static#n=this.\u0275inj=Ai({imports:[NR,NF,KR]})}return e})();LR().bootstrapModule(BF).catch(e=>console.error(e))},624:function(Ed){Ed.exports=function(){"use strict";var Xl,Yl,hn;function Bc(g,On){if(Xl)if(Yl){var ye="var sharedChunk = {}; ("+Xl+")(sharedChunk); ("+Yl+")(sharedChunk);",ji={};Xl(ji),hn=On(ji),typeof window<"u"&&(hn.workerUrl=window.URL.createObjectURL(new Blob([ye],{type:"text/javascript"})))}else Yl=On;else Xl=On}return Bc(0,function(g){function On(s,i,l,h){return new(l||(l=Promise))(function(f,_){function x(T){try{I(h.next(T))}catch(P){_(P)}}function C(T){try{I(h.throw(T))}catch(P){_(P)}}function I(T){var P;T.done?f(T.value):(P=T.value,P instanceof l?P:new l(function(L){L(P)})).then(x,C)}I((h=h.apply(s,i||[])).next())})}function ye(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}"function"==typeof SuppressedError&&SuppressedError;var ji=Gr;function Gr(s,i){this.x=s,this.y=i}Gr.prototype={clone:function(){return new Gr(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,l=s.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),l=Math.sin(s),h=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=h,this},_rotateAround:function(s,i){var l=Math.cos(s),h=Math.sin(s),f=i.y+h*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-h*(this.y-i.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Gr.convert=function(s){return s instanceof Gr?s:Array.isArray(s)?new Gr(s[0],s[1]):s};var tt=ye(ji),To=fa;function fa(s,i,l,h){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=l,this.p2y=h}fa.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(void 0===i&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,h=0;h<8;h++){var f=this.sampleCurveX(l)-s;if(Math.abs(f)<i)return l;var _=this.sampleCurveDerivativeX(l);if(Math.abs(_)<1e-6)break;l-=f/_}var x=0,C=1;for(l=s,h=0;h<20&&(f=this.sampleCurveX(l),!(Math.abs(f-s)<i));h++)s>f?x=l:C=l,l=.5*(C-x)+x;return l},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var Jo=ye(To);let Zr,Yn;function Kl(){return null==Zr&&(Zr=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),Zr}function lo(){if(null==Yn&&(Yn=!1,Kl())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let h=0;h<25;h++){const f=4*h;i.fillStyle=`rgb(${f},${f+1},${f+2})`,i.fillRect(h%5,Math.floor(h/5),1,1)}const l=i.getImageData(0,0,5,5).data;for(let h=0;h<100;h++)if(h%4!=3&&l[h]!==h){Yn=!0;break}}}return Yn||!1}function $i(s,i,l,h){const f=new Jo(s,i,l,h);return function(_){return f.solve(_)}}const Ao=$i(.25,.1,.25,1);function co(s,i,l){return Math.min(l,Math.max(i,s))}function Ms(s,i,l){const h=l-i,f=((s-i)%h+h)%h+i;return f===i?l:f}function vr(s,...i){for(const l of i)for(const h in l)s[h]=l[h];return s}let ma=1;function In(s,i,l){const h={};for(const f in s)h[f]=i.call(l||this,s[f],f,s);return h}function uo(s,i,l){const h={};for(const f in s)i.call(l||this,s[f],f,s)&&(h[f]=s[f]);return h}function ai(s){return Array.isArray(s)?s.map(ai):"object"==typeof s&&s?In(s,ai):s}const es={};function xr(s){es[s]||(typeof console<"u"&&console.warn(s),es[s]=!0)}function gi(s,i,l){return(l.y-s.y)*(i.x-s.x)>(i.y-s.y)*(l.x-s.x)}function Ui(s){let i=0;for(let l,h,f=0,_=s.length,x=_-1;f<_;x=f++)l=s[f],h=s[x],i+=(h.x-l.x)*(l.y+h.y);return i}function ir(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Ts=null;function ga(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Bn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ya(s,i,l,h,f){return On(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(s,{timestamp:0});try{const x=_?.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const C=x.startsWith("BGR"),I=new Uint8ClampedArray(h*f*4);if(yield _.copyTo(I,function(T,P,L,N,j){const $=4*Math.max(-P,0),q=(Math.max(0,L)-L)*N*4+$,Q=4*N,te=Math.max(0,P),ae=Math.max(0,L);return{rect:{x:te,y:ae,width:Math.min(T.width,P+N)-te,height:Math.min(T.height,L+j)-ae},layout:[{offset:q,stride:Q}]}}(s,i,l,h,f)),C)for(let T=0;T<I.length;T+=4){const P=I[T];I[T]=I[T+2],I[T+2]=P}return I}finally{_.close()}})}let ho,yn,li,dr;const As={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(s){const i=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(s,i=0){return this.getImageCanvasContext(s).getImageData(-i,-i,s.width+2*i,s.height+2*i)},getImageCanvasContext(s){const i=window.document.createElement("canvas"),l=i.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return i.width=s.width,i.height=s.height,l.drawImage(s,0,0,s.width,s.height),l},resolveURL:s=>(li||(li=document.createElement("a")),li.href=s,li.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==dr&&(dr=matchMedia("(prefers-reduced-motion: reduce)")),dr.matches)}},Ps={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class _n extends Error{constructor(i,l,h,f){super(`AJAXError: ${l} (${i}): ${h}`),this.status=i,this.statusText=l,this.url=h,this.body=f}}const an=ir()?()=>self.worker&&self.worker.referrer:()=>("blob:"===window.location.protocol?window.parent:window).location.href,Si=s=>Ps.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))];function rn(s,i){const l=new AbortController,h=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:an(),signal:l.signal});let f=!1,_=!1;return"json"===s.type&&h.headers.set("Accept","application/json"),_||fetch(h).then(x=>{return x.ok?(C=x,void("arrayBuffer"===s.type||"image"===s.type?C.arrayBuffer():"json"===s.type?C.json():C.text()).then(I=>{_||(f=!0,i(null,I,C.headers.get("Cache-Control"),C.headers.get("Expires")))}).catch(I=>{_||i(new Error(I.message))})):x.blob().then(C=>i(new _n(x.status,x.statusText,s.url,C)));var C}).catch(x=>{20!==x.code&&i(new Error(x.message))}),{cancel:()=>{_=!0,f||l.abort()}}}const po=function(s,i){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){if(ir()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,i);if(!ir())return(Si(s.url)||rn)(s,i)}if(!(/^file:/.test(l=s.url)||/^file:/.test(an())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return rn(s,i);if(ir()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,i,void 0,!0)}var l;return function(h,f){const _=new XMLHttpRequest;_.open(h.method||"GET",h.url,!0),"arrayBuffer"!==h.type&&"image"!==h.type||(_.responseType="arraybuffer");for(const x in h.headers)_.setRequestHeader(x,h.headers[x]);return"json"===h.type&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials="include"===h.credentials,_.onerror=()=>{f(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||0===_.status)&&null!==_.response){let x=_.response;if("json"===h.type)try{x=JSON.parse(_.response)}catch(C){return f(C)}f(null,x,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else{const x=new Blob([_.response],{type:_.getResponseHeader("Content-Type")});f(new _n(_.status,_.statusText,h.url,x))}},_.send(h.body),{cancel:()=>_.abort()}}(s,i)},Ja=function(s,i){return po(vr(s,{type:"arrayBuffer"}),i)};function Hi(s){if(!s||s.indexOf("://")<=0||0===s.indexOf("data:image/")||0===s.indexOf("blob:"))return!0;const i=new URL(s),l=window.location;return i.protocol===l.protocol&&i.host===l.host}function _a(s,i,l){l[s]&&-1!==l[s].indexOf(i)||(l[s]=l[s]||[],l[s].push(i))}function ks(s,i,l){if(l&&l[s]){const h=l[s].indexOf(i);-1!==h&&l[s].splice(h,1)}}class ts{constructor(i,l={}){vr(this,l),this.type=i}}class Rs extends ts{constructor(i,l={}){super("error",vr({error:i},l))}}class va{on(i,l){return this._listeners=this._listeners||{},_a(i,l,this._listeners),this}off(i,l){return ks(i,l,this._listeners),ks(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},_a(i,l,this._oneTimeListeners),this):new Promise(h=>this.once(i,h))}fire(i,l){"string"==typeof i&&(i=new ts(i,l||{}));const h=i.type;if(this.listens(h)){i.target=this;const f=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const C of f)C.call(this,i);const _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const C of _)ks(h,C,this._oneTimeListeners),C.call(this,i);const x=this._eventedParent;x&&(vr(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),x.fire(i))}else i instanceof Rs&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var _e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const yi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ii(s,i){const l={};for(const h in s)"ref"!==h&&(l[h]=s[h]);return yi.forEach(h=>{h in i&&(l[h]=i[h])}),l}function ln(s,i){if(Array.isArray(s)){if(!Array.isArray(i)||s.length!==i.length)return!1;for(let l=0;l<s.length;l++)if(!ln(s[l],i[l]))return!1;return!0}if("object"==typeof s&&null!==s&&null!==i){if("object"!=typeof i||Object.keys(s).length!==Object.keys(i).length)return!1;for(const l in s)if(!ln(s[l],i[l]))return!1;return!0}return s===i}const Ut={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ei(s,i,l){l.push({command:Ut.addSource,args:[s,i[s]]})}function xa(s,i,l){i.push({command:Ut.removeSource,args:[s]}),l[s]=!0}function qi(s,i,l,h){xa(s,l,h),Ei(s,i,l)}function el(s,i,l){let h;for(h in s[l])if(Object.prototype.hasOwnProperty.call(s[l],h)&&"data"!==h&&!ln(s[l][h],i[l][h]))return!1;for(h in i[l])if(Object.prototype.hasOwnProperty.call(i[l],h)&&"data"!==h&&!ln(s[l][h],i[l][h]))return!1;return!0}function ba(s,i,l,h,f,_){let x;for(x in i=i||{},s=s||{})Object.prototype.hasOwnProperty.call(s,x)&&(ln(s[x],i[x])||l.push({command:_,args:[h,x,i[x],f]}));for(x in i)Object.prototype.hasOwnProperty.call(i,x)&&!Object.prototype.hasOwnProperty.call(s,x)&&(ln(s[x],i[x])||l.push({command:_,args:[h,x,i[x],f]}))}function ns(s){return s.id}function Os(s,i){return s[i.id]=i,s}class Pe{constructor(i,l,h,f){this.message=(i?`${i}: `:"")+h,f&&(this.identifier=f),null!=l&&l.__line__&&(this.line=l.__line__)}}function Gi(s,...i){for(const l of i)for(const h in l)s[h]=l[h];return s}class Ln extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class rs{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[h,f]of l)this.bindings[h]=f}concat(i){return new rs(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Po={kind:"null"},ze={kind:"number"},St={kind:"string"},ft={kind:"boolean"},Wr={kind:"color"},fo={kind:"object"},wt={kind:"value"},ko={kind:"collator"},X={kind:"formatted"},F={kind:"padding"},z={kind:"resolvedImage"},U={kind:"variableAnchorOffsetCollection"};function K(s,i){return{kind:"array",itemType:s,N:i}}function J(s){if("array"===s.kind){const i=J(s.itemType);return"number"==typeof s.N?`array<${i}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${i}>`}return s.kind}const ue=[Po,ze,St,ft,Wr,X,fo,K(wt),F,z,U];function oe(s,i){if("error"===i.kind)return null;if("array"===s.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!oe(s.itemType,i.itemType))&&("number"!=typeof s.N||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if("value"===s.kind)for(const l of ue)if(!oe(l,i))return null}return`Expected ${J(s)} but found ${J(i)} instead.`}function ne(s,i){return i.some(l=>l.kind===s.kind)}function le(s,i){return i.some(l=>"null"===l?null===s:"array"===l?Array.isArray(s):"object"===l?s&&!Array.isArray(s)&&"object"==typeof s:l===typeof s)}function xe(s,i){return"array"===s.kind&&"array"===i.kind?s.itemType.kind===i.itemType.kind&&"number"==typeof s.N:s.kind===i.kind}const Ze=4/29,lt=6/29,Ye=3*lt*lt,nt=lt*lt*lt,mt=Math.PI/180,Gt=180/Math.PI;function cn(s){return(s%=360)<0&&(s+=360),s}function jt([s,i,l,h]){let f,_;const x=kr((.2225045*(s=Dt(s))+.7168786*(i=Dt(i))+.0606169*(l=Dt(l)))/1);s===i&&i===l?f=_=x:(f=kr((.4360747*s+.3850649*i+.1430804*l)/.96422),_=kr((.0139322*s+.0971045*i+.7141733*l)/.82521));const C=116*x-16;return[C<0?0:C,500*(f-x),200*(x-_),h]}function Dt(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function kr(s){return s>nt?Math.pow(s,1/3):s/Ye+Ze}function Et([s,i,l,h]){let f=(s+16)/116,_=isNaN(i)?f:f+i/500,x=isNaN(l)?f:f-l/200;return f=1*vn(f),_=.96422*vn(_),x=.82521*vn(x),[wn(3.1338561*_-1.6168667*f-.4906146*x),wn(-.9787684*_+1.9161415*f+.033454*x),wn(.0719453*_-.2289914*f+1.4052427*x),h]}function wn(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function vn(s){return s>lt?s*s*s:Ye*(s-Ze)}function Zi(s){return parseInt(s.padEnd(2,s),16)/255}function Uu(s,i){return wa(i?s/100:s,0,1)}function wa(s,i,l){return Math.min(Math.max(i,s),l)}function is(s){return!s.some(Number.isNaN)}const Td={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ht{constructor(i,l,h,f=1,_=!0){this.r=i,this.g=l,this.b=h,this.a=f,_||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[i,l,h,f]))}static parse(i){if(i instanceof Ht)return i;if("string"!=typeof i)return;const l=function(h){if("transparent"===(h=h.toLowerCase().trim()))return[0,0,0,0];const f=Td[h];if(f){const[x,C,I]=f;return[x/255,C/255,I/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const x=h.length<6?1:2;let C=1;return[Zi(h.slice(C,C+=x)),Zi(h.slice(C,C+=x)),Zi(h.slice(C,C+=x)),Zi(h.slice(C,C+x)||"ff")]}if(h.startsWith("rgb")){const x=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[C,I,T,P,L,N,j,$,q,Q,te,ae]=x,ie=[P||" ",j||" ",Q].join("");if("  "===ie||"  /"===ie||",,"===ie||",,,"===ie){const he=[T,N,q].join(""),fe="%%%"===he?100:""===he?255:0;if(fe){const De=[wa(+I/fe,0,1),wa(+L/fe,0,1),wa(+$/fe,0,1),te?Uu(+te,ae):1];if(is(De))return De}}return}}const _=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[x,C,I,T,P,L,N,j,$]=_,q=[I||" ",P||" ",N].join("");if("  "===q||"  /"===q||",,"===q||",,,"===q){const Q=[+C,wa(+T,0,100),wa(+L,0,100),j?Uu(+j,$):1];if(is(Q))return function([te,ae,ie,he]){function fe(De){const Ue=(De+te/30)%12,Xe=ae*Math.min(ie,1-ie);return ie-Xe*Math.max(-1,Math.min(Ue-3,9-Ue,1))}return te=cn(te),ae/=100,ie/=100,[fe(0),fe(8),fe(4),he]}(Q)}}}(i);return l?new Ht(...l,!1):void 0}get rgb(){const{r:i,g:l,b:h,a:f}=this,_=f||1/0;return this.overwriteGetter("rgb",[i/_,l/_,h/_,f])}get hcl(){return this.overwriteGetter("hcl",function(i){const[l,h,f,_]=jt(i),x=Math.sqrt(h*h+f*f);return[Math.round(1e4*x)?cn(Math.atan2(f,h)*Gt):NaN,x,l,_]}(this.rgb))}get lab(){return this.overwriteGetter("lab",jt(this.rgb))}overwriteGetter(i,l){return Object.defineProperty(this,i,{value:l}),l}toString(){const[i,l,h,f]=this.rgb;return`rgba(${[i,l,h].map(_=>Math.round(255*_)).join(",")},${f})`}}Ht.black=new Ht(0,0,0,1),Ht.white=new Ht(1,1,1,1),Ht.transparent=new Ht(0,0,0,0),Ht.red=new Ht(1,0,0,1);class Vc{constructor(i,l,h){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class tl{constructor(i,l,h,f,_){this.text=i,this.image=l,this.scale=h,this.fontStack=f,this.textColor=_}}class br{constructor(i){this.sections=i}static fromString(i){return new br([new tl(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof br?i:br.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}}class _i{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof _i)return i;if("number"==typeof i)return new _i([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const l of i)if("number"!=typeof l)return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new _i(i)}}toString(){return JSON.stringify(this.values)}}const Ad=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Mi{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Mi)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let l=0;l<i.length;l+=2){const h=i[l],f=i[l+1];if("string"!=typeof h||!Ad.has(h)||!Array.isArray(f)||2!==f.length||"number"!=typeof f[0]||"number"!=typeof f[1])return}return new Mi(i)}}toString(){return JSON.stringify(this.values)}}class wr{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new wr({name:i,available:!1}):null}}function nl(s,i,l,h){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===h||"number"==typeof h&&h>=0&&h<=1?null:`Invalid rgba value [${[s,i,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof h?[s,i,l,h]:[s,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ca(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof Ht||s instanceof Vc||s instanceof br||s instanceof _i||s instanceof Mi||s instanceof wr)return!0;if(Array.isArray(s)){for(const i of s)if(!Ca(i))return!1;return!0}if("object"==typeof s){for(const i in s)if(!Ca(s[i]))return!1;return!0}return!1}function En(s){if(null===s)return Po;if("string"==typeof s)return St;if("boolean"==typeof s)return ft;if("number"==typeof s)return ze;if(s instanceof Ht)return Wr;if(s instanceof Vc)return ko;if(s instanceof br)return X;if(s instanceof _i)return F;if(s instanceof Mi)return U;if(s instanceof wr)return z;if(Array.isArray(s)){const i=s.length;let l;for(const h of s){const f=En(h);if(l){if(l===f)continue;l=wt;break}l=f}return K(l||wt,i)}return fo}function gt(s){const i=typeof s;return null===s?"":"string"===i||"number"===i||"boolean"===i?String(s):s instanceof Ht||s instanceof br||s instanceof _i||s instanceof Mi||s instanceof wr?s.toString():JSON.stringify(s)}class Ls{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(2!==i.length)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Ca(i[1]))return l.error("invalid value");const h=i[1];let f=En(h);const _=l.expectedType;return"array"!==f.kind||0!==f.N||!_||"array"!==_.kind||"number"==typeof _.N&&0!==_.N||(f=_),new Ls(f,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class qt{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const yt={string:St,number:ze,boolean:ft,object:fo};class vi{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let h,f=1;const _=i[0];if("array"===_){let C,I;if(i.length>2){const T=i[1];if("string"!=typeof T||!(T in yt)||"object"===T)return l.error('The item type argument of "array" must be one of string, number, boolean',1);C=yt[T],f++}else C=wt;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);I=i[2],f++}h=K(C,I)}else{if(!yt[_])throw new Error(`Types doesn't contain name = ${_}`);h=yt[_]}const x=[];for(;f<i.length;f++){const C=l.parse(i[f],f,wt);if(!C)return null;x.push(C)}return new vi(h,x)}evaluate(i){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(i);if(!oe(this.type,En(h)))return h;if(l===this.args.length-1)throw new qt(`Expected value to be of type ${J(this.type)}, but found ${J(En(h))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const rl={"to-boolean":ft,"to-color":Wr,"to-number":ze,"to-string":St};class Cr{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const h=i[0];if(!rl[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if(("to-boolean"===h||"to-string"===h)&&2!==i.length)return l.error("Expected one argument.");const f=rl[h],_=[];for(let x=1;x<i.length;x++){const C=l.parse(i[x],x,wt);if(!C)return null;_.push(C)}return new Cr(f,_)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let l,h;for(const f of this.args){if(l=f.evaluate(i),h=null,l instanceof Ht)return l;if("string"==typeof l){const _=i.parseColor(l);if(_)return _}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:nl(l[0],l[1],l[2],l[3]),!h))return new Ht(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new qt(h||`Could not parse color from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const h of this.args){l=h.evaluate(i);const f=_i.parse(l);if(f)return f}throw new qt(`Could not parse padding from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const h of this.args){l=h.evaluate(i);const f=Mi.parse(l);if(f)return f}throw new qt(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof l?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const h of this.args){if(l=h.evaluate(i),null===l)return 0;const f=Number(l);if(!isNaN(f))return f}throw new qt(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return br.fromString(gt(this.args[0].evaluate(i)));case"resolvedImage":return wr.fromString(gt(this.args[0].evaluate(i)));default:return gt(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const Hu=["Unknown","Point","LineString","Polygon"];class jc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Hu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=Ht.parse(i)),l}}class Wt{constructor(i,l,h=[],f,_=new rs,x=[]){this.registry=i,this.path=h,this.key=h.map(C=>`[${C}]`).join(""),this.scope=_,this.errors=x,this.expectedType=f,this._isConstant=l}parse(i,l,h,f,_={}){return l?this.concat(l,h,f)._parse(i,_):this._parse(i,_)}_parse(i,l){function h(f,_,x){return"assert"===x?new vi(_,[f]):"coerce"===x?new Cr(_,[f]):f}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=i[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[f];if(_){let x=_.parse(i,this);if(!x)return null;if(this.expectedType){const C=this.expectedType,I=x.type;if("string"!==C.kind&&"number"!==C.kind&&"boolean"!==C.kind&&"object"!==C.kind&&"array"!==C.kind||"value"!==I.kind)if("color"!==C.kind&&"formatted"!==C.kind&&"resolvedImage"!==C.kind||"value"!==I.kind&&"string"!==I.kind)if("padding"!==C.kind||"value"!==I.kind&&"number"!==I.kind&&"array"!==I.kind)if("variableAnchorOffsetCollection"!==C.kind||"value"!==I.kind&&"array"!==I.kind){if(this.checkSubtype(C,I))return null}else x=h(x,C,l.typeAnnotation||"coerce");else x=h(x,C,l.typeAnnotation||"coerce");else x=h(x,C,l.typeAnnotation||"coerce");else x=h(x,C,l.typeAnnotation||"assert")}if(!(x instanceof Ls)&&"resolvedImage"!==x.type.kind&&this._isConstant(x)){const C=new jc;try{x=new Ls(x.type,x.evaluate(C))}catch(I){return this.error(I.message),null}}return x}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,h){const f="number"==typeof i?this.path.concat(i):this.path,_=h?this.scope.concat(h):this.scope;return new Wt(this.registry,this._isConstant,f,l||null,_,this.errors)}error(i,...l){const h=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new Ln(h,i))}checkSubtype(i,l){const h=oe(i,l);return h&&this.error(h),h}}class Fs{constructor(i,l,h){this.type=ko,this.locale=h,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(2!==i.length)return l.error("Expected one argument.");const h=i[1];if("object"!=typeof h||Array.isArray(h))return l.error("Collator options argument must be an object.");const f=l.parse(void 0!==h["case-sensitive"]&&h["case-sensitive"],1,ft);if(!f)return null;const _=l.parse(void 0!==h["diacritic-sensitive"]&&h["diacritic-sensitive"],1,ft);if(!_)return null;let x=null;return h.locale&&(x=l.parse(h.locale,1,St),!x)?null:new Fs(f,_,x)}evaluate(i){return new Vc(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}const xn=8192;function il(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function ol(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function Ql(s,i){const l=(180+s[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,f=Math.pow(2,i.z);return[Math.round(l*f*xn),Math.round(h*f*xn)]}function xt(s,i,l){const h=s[0]-i[0],f=s[1]-i[1],_=s[0]-l[0],x=s[1]-l[1];return h*x-_*f==0&&h*_<=0&&f*x<=0}function sl(s,i){let l=!1;for(let x=0,C=i.length;x<C;x++){const I=i[x];for(let T=0,P=I.length;T<P-1;T++){if(xt(s,I[T],I[T+1]))return!1;(f=I[T])[1]>(h=s)[1]!=(_=I[T+1])[1]>h[1]&&h[0]<(_[0]-f[0])*(h[1]-f[1])/(_[1]-f[1])+f[0]&&(l=!l)}}var h,f,_;return l}function al(s,i){for(let l=0;l<i.length;l++)if(sl(s,i[l]))return!0;return!1}function Pd(s,i,l,h){const f=h[0]-l[0],_=h[1]-l[1],x=(s[0]-l[0])*_-f*(s[1]-l[1]),C=(i[0]-l[0])*_-f*(i[1]-l[1]);return x>0&&C<0||x<0&&C>0}function qu(s,i,l){for(const T of l)for(let P=0;P<T.length-1;++P)if((C=[(x=T[P+1])[0]-(_=T[P])[0],x[1]-_[1]])[0]*(I=[(f=i)[0]-(h=s)[0],f[1]-h[1]])[1]-C[1]*I[0]!=0&&Pd(h,f,_,x)&&Pd(_,x,h,f))return!0;var h,f,_,x,C,I;return!1}function Ve(s,i){for(let l=0;l<s.length;++l)if(!sl(s[l],i))return!1;for(let l=0;l<s.length-1;++l)if(qu(s[l],s[l+1],i))return!1;return!0}function ll(s,i){for(let l=0;l<i.length;l++)if(Ve(s,i[l]))return!0;return!1}function _t(s,i,l){const h=[];for(let f=0;f<s.length;f++){const _=[];for(let x=0;x<s[f].length;x++){const C=Ql(s[f][x],l);il(i,C),_.push(C)}h.push(_)}return h}function Jt(s,i,l){const h=[];for(let f=0;f<s.length;f++){const _=_t(s[f],i,l);h.push(_)}return h}function Gu(s,i,l,h){if(s[0]<l[0]||s[0]>l[2]){const f=.5*h;let _=s[0]-l[0]>f?-h:l[0]-s[0]>f?h:0;0===_&&(_=s[0]-l[2]>f?-h:l[2]-s[0]>f?h:0),s[0]+=_}il(i,s)}function Zu(s,i,l,h){const f=Math.pow(2,h.z)*xn,_=[h.x*xn,h.y*xn],x=[];for(const C of s)for(const I of C){const T=[I.x+_[0],I.y+_[1]];Gu(T,i,l,f),x.push(T)}return x}function $c(s,i,l,h){const f=Math.pow(2,h.z)*xn,_=[h.x*xn,h.y*xn],x=[];for(const I of s){const T=[];for(const P of I){const L=[P.x+_[0],P.y+_[1]];il(i,L),T.push(L)}x.push(T)}if(i[2]-i[0]<=f/2){(C=i)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const I of x)for(const T of I)Gu(T,i,l,f)}var C;return x}class Ro{constructor(i,l){this.type=ft,this.geojson=i,this.geometries=l}static parse(i,l){if(2!==i.length)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Ca(i[1])){const h=i[1];if("FeatureCollection"===h.type)for(let f=0;f<h.features.length;++f){const _=h.features[f].geometry.type;if("Polygon"===_||"MultiPolygon"===_)return new Ro(h,h.features[f].geometry)}else if("Feature"===h.type){const f=h.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new Ro(h,h.geometry)}else if("Polygon"===h.type||"MultiPolygon"===h.type)return new Ro(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(l,h){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if("Polygon"===h.type){const C=_t(h.coordinates,_,x),I=Zu(l.geometry(),f,_,x);if(!ol(f,_))return!1;for(const T of I)if(!sl(T,C))return!1}if("MultiPolygon"===h.type){const C=Jt(h.coordinates,_,x),I=Zu(l.geometry(),f,_,x);if(!ol(f,_))return!1;for(const T of I)if(!al(T,C))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(l,h){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if("Polygon"===h.type){const C=_t(h.coordinates,_,x),I=$c(l.geometry(),f,_,x);if(!ol(f,_))return!1;for(const T of I)if(!Ve(T,C))return!1}if("MultiPolygon"===h.type){const C=Jt(h.coordinates,_,x),I=$c(l.geometry(),f,_,x);if(!ol(f,_))return!1;for(const T of I)if(!ll(T,C))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Rr{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(2!==i.length||"string"!=typeof i[1])return l.error("'var' expression requires exactly one string literal argument.");const h=i[1];return l.scope.has(h)?new Rr(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class Wi{constructor(i,l,h,f){this.name=i,this.type=l,this._evaluate=h,this.args=f}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,l){const h=i[0],f=Wi.definitions[h];if(!f)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(f)?f[0]:f.type,x=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,C=x.filter(([T])=>!Array.isArray(T)||T.length===i.length-1);let I=null;for(const[T,P]of C){I=new Wt(l.registry,Jl,l.path,null,l.scope);const L=[];let N=!1;for(let j=1;j<i.length;j++){const $=i[j],q=Array.isArray(T)?T[j-1]:T.type,Q=I.parse($,1+L.length,q);if(!Q){N=!0;break}L.push(Q)}if(!N)if(Array.isArray(T)&&T.length!==L.length)I.error(`Expected ${T.length} arguments, but found ${L.length} instead.`);else{for(let j=0;j<L.length;j++){const $=Array.isArray(T)?T[j]:T.type,q=L[j];I.concat(j+1).checkSubtype($,q.type)}if(0===I.errors.length)return new Wi(h,_,P,L)}}if(1===C.length)l.errors.push(...I.errors);else{const T=(C.length?C:x).map(([L])=>{return N=L,Array.isArray(N)?`(${N.map(J).join(", ")})`:`(${J(N.type)}...)`;var N}).join(" | "),P=[];for(let L=1;L<i.length;L++){const N=l.parse(i[L],1+P.length);if(!N)return null;P.push(J(N.type))}l.error(`Expected arguments of type ${T}, but found (${P.join(", ")}) instead.`)}return null}static register(i,l){Wi.definitions=l;for(const h in l)i[h]=Wi}}function Jl(s){if(s instanceof Rr)return Jl(s.boundExpression);if(s instanceof Wi&&"error"===s.name||s instanceof Fs||s instanceof Ro)return!1;const i=s instanceof Cr||s instanceof vi;let l=!0;return s.eachChild(h=>{l=i?l&&Jl(h):l&&h instanceof Ls}),!!l&&Uc(s)&&Hc(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Uc(s){if(s instanceof Wi&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof Ro)return!1;let i=!0;return s.eachChild(l=>{i&&!Uc(l)&&(i=!1)}),i}function Xi(s){if(s instanceof Wi&&"feature-state"===s.name)return!1;let i=!0;return s.eachChild(l=>{i&&!Xi(l)&&(i=!1)}),i}function Hc(s,i){if(s instanceof Wi&&i.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild(h=>{l&&!Hc(h,i)&&(l=!1)}),l}function cl(s,i){const l=s.length-1;let h,f,_=0,x=l,C=0;for(;_<=x;)if(C=Math.floor((_+x)/2),h=s[C],f=s[C+1],h<=i){if(C===l||i<f)return C;_=C+1}else{if(!(h>i))throw new qt("Input is not a number.");x=C-1}return 0}class Ns{constructor(i,l,h){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[f,_]of h)this.labels.push(f),this.outputs.push(_)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(i[1],1,ze);if(!h)return null;const f=[];let _=null;l.expectedType&&"value"!==l.expectedType.kind&&(_=l.expectedType);for(let x=1;x<i.length;x+=2){const C=1===x?-1/0:i[x],I=i[x+1],T=x,P=x+1;if("number"!=typeof C)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(f.length&&f[f.length-1][0]>=C)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const L=l.parse(I,P,_);if(!L)return null;_=_||L.type,f.push([C,L])}return new Ns(_,h,f)}evaluate(i){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(i);const f=this.input.evaluate(i);if(f<=l[0])return h[0].evaluate(i);const _=l.length;return f>=l[_-1]?h[_-1].evaluate(i):h[cl(l,f)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Bt(s,i,l){return s+l*(i-s)}function ec(s,i,l){return s.map((h,f)=>Bt(h,i[f],l))}const Ti={number:Bt,color:function(s,i,l,h="rgb"){switch(h){case"rgb":{const[f,_,x,C]=ec(s.rgb,i.rgb,l);return new Ht(f,_,x,C,!1)}case"hcl":{const[f,_,x,C]=s.hcl,[I,T,P,L]=i.hcl;let N,j;if(isNaN(f)||isNaN(I))isNaN(f)?isNaN(I)?N=NaN:(N=I,1!==x&&0!==x||(j=T)):(N=f,1!==P&&0!==P||(j=_));else{let ae=I-f;I>f&&ae>180?ae-=360:I<f&&f-I>180&&(ae+=360),N=f+l*ae}const[$,q,Q,te]=function([ae,ie,he,fe]){return ae=isNaN(ae)?0:ae*mt,Et([he,Math.cos(ae)*ie,Math.sin(ae)*ie,fe])}([N,j??Bt(_,T,l),Bt(x,P,l),Bt(C,L,l)]);return new Ht($,q,Q,te,!1)}case"lab":{const[f,_,x,C]=Et(ec(s.lab,i.lab,l));return new Ht(f,_,x,C,!1)}}},array:ec,padding:function(s,i,l){return new _i(ec(s.values,i.values,l))},variableAnchorOffsetCollection:function(s,i,l){const h=s.values,f=i.values;if(h.length!==f.length)throw new qt(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${i.toString()}`);const _=[];for(let x=0;x<h.length;x+=2){if(h[x]!==f[x])throw new qt(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${h[x]}, to[${x}]: ${f[x]}`);_.push(h[x]);const[C,I]=h[x+1],[T,P]=f[x+1];_.push([Bt(C,T,l),Bt(I,P,l)])}return new Mi(_)}};class xi{constructor(i,l,h,f,_){this.type=i,this.operator=l,this.interpolation=h,this.input=f,this.labels=[],this.outputs=[];for(const[x,C]of _)this.labels.push(x),this.outputs.push(C)}static interpolationFactor(i,l,h,f){let _=0;if("exponential"===i.name)_=Wu(l,i.base,h,f);else if("linear"===i.name)_=Wu(l,1,h,f);else if("cubic-bezier"===i.name){const x=i.controlPoints;_=new Jo(x[0],x[1],x[2],x[3]).solve(Wu(l,1,h,f))}return _}static parse(i,l){let[h,f,_,...x]=i;if(!Array.isArray(f)||0===f.length)return l.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const T=f[1];if("number"!=typeof T)return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:T}}else{if("cubic-bezier"!==f[0])return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const T=f.slice(1);if(4!==T.length||T.some(P=>"number"!=typeof P||P<0||P>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:T}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(_=l.parse(_,2,ze),!_)return null;const C=[];let I=null;"interpolate-hcl"===h||"interpolate-lab"===h?I=Wr:l.expectedType&&"value"!==l.expectedType.kind&&(I=l.expectedType);for(let T=0;T<x.length;T+=2){const P=x[T],L=x[T+1],N=T+3,j=T+4;if("number"!=typeof P)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(C.length&&C[C.length-1][0]>=P)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const $=l.parse(L,j,I);if(!$)return null;I=I||$.type,C.push([P,$])}return xe(I,ze)||xe(I,Wr)||xe(I,F)||xe(I,U)||xe(I,K(ze))?new xi(I,h,f,_,C):l.error(`Type ${J(I)} is not interpolatable.`)}evaluate(i){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(i);const f=this.input.evaluate(i);if(f<=l[0])return h[0].evaluate(i);const _=l.length;if(f>=l[_-1])return h[_-1].evaluate(i);const x=cl(l,f),C=xi.interpolationFactor(this.interpolation,f,l[x],l[x+1]),I=h[x].evaluate(i),T=h[x+1].evaluate(i);switch(this.operator){case"interpolate":return Ti[this.type.kind](I,T,C);case"interpolate-hcl":return Ti.color(I,T,C,"hcl");case"interpolate-lab":return Ti.color(I,T,C,"lab")}}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Wu(s,i,l,h){const f=h-l,_=s-l;return 0===f?0:1===i?_/f:(Math.pow(i,_)-1)/(Math.pow(i,f)-1)}class Xr{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let h=null;const f=l.expectedType;f&&"value"!==f.kind&&(h=f);const _=[];for(const C of i.slice(1)){const I=l.parse(C,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!I)return null;h=h||I.type,_.push(I)}if(!h)throw new Error("No output type");const x=f&&_.some(C=>oe(f,C.type));return new Xr(x?wt:h,_)}evaluate(i){let l,h=null,f=0;for(const _ of this.args)if(f++,h=_.evaluate(i),h&&h instanceof wr&&!h.available&&(l||(l=h.name),h=null,f===this.args.length&&(h=l)),null!==h)break;return h}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}class ut{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const h=[];for(let _=1;_<i.length-1;_+=2){const x=i[_];if("string"!=typeof x)return l.error(`Expected string, but found ${typeof x} instead.`,_);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",_);const C=l.parse(i[_+1],_+1);if(!C)return null;h.push([x,C])}const f=l.parse(i[i.length-1],i.length-1,l.expectedType,h);return f?new ut(h,f):null}outputDefined(){return this.result.outputDefined()}}class Xu{constructor(i,l,h){this.type=i,this.index=l,this.input=h}static parse(i,l){if(3!==i.length)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,ze),f=l.parse(i[2],2,K(l.expectedType||wt));return h&&f?new Xu(f.type.itemType,h,f):null}evaluate(i){const l=this.index.evaluate(i),h=this.input.evaluate(i);if(l<0)throw new qt(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new qt(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new qt(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class Yu{constructor(i,l){this.type=ft,this.needle=i,this.haystack=l}static parse(i,l){if(3!==i.length)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,wt),f=l.parse(i[2],2,wt);return h&&f?ne(h.type,[ft,St,ze,Po,wt])?new Yu(h,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(h.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!h)return!1;if(!le(l,["boolean","string","number","null"]))throw new qt(`Expected first argument to be of type boolean, string, number or null, but found ${J(En(l))} instead.`);if(!le(h,["string","array"]))throw new qt(`Expected second argument to be of type array or string, but found ${J(En(h))} instead.`);return h.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class qc{constructor(i,l,h){this.type=ze,this.needle=i,this.haystack=l,this.fromIndex=h}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,wt),f=l.parse(i[2],2,wt);if(!h||!f)return null;if(!ne(h.type,[ft,St,ze,Po,wt]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(h.type)} instead`);if(4===i.length){const _=l.parse(i[3],3,ze);return _?new qc(h,f,_):null}return new qc(h,f)}evaluate(i){const l=this.needle.evaluate(i),h=this.haystack.evaluate(i);if(!le(l,["boolean","string","number","null"]))throw new qt(`Expected first argument to be of type boolean, string, number or null, but found ${J(En(l))} instead.`);if(!le(h,["string","array"]))throw new qt(`Expected second argument to be of type array or string, but found ${J(En(h))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(i);return h.indexOf(l,f)}return h.indexOf(l)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class ct{constructor(i,l,h,f,_,x){this.inputType=i,this.type=l,this.input=h,this.cases=f,this.outputs=_,this.otherwise=x}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let h,f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const _={},x=[];for(let T=2;T<i.length-1;T+=2){let P=i[T];const L=i[T+1];Array.isArray(P)||(P=[P]);const N=l.concat(T);if(0===P.length)return N.error("Expected at least one branch label.");for(const $ of P){if("number"!=typeof $&&"string"!=typeof $)return N.error("Branch labels must be numbers or strings.");if("number"==typeof $&&Math.abs($)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof $&&Math.floor($)!==$)return N.error("Numeric branch labels must be integer values.");if(h){if(N.checkSubtype(h,En($)))return null}else h=En($);if(void 0!==_[String($)])return N.error("Branch labels must be unique.");_[String($)]=x.length}const j=l.parse(L,T,f);if(!j)return null;f=f||j.type,x.push(j)}const C=l.parse(i[1],1,wt);if(!C)return null;const I=l.parse(i[i.length-1],i.length-1,f);return I?"value"!==C.type.kind&&l.concat(1).checkSubtype(h,C.type)?null:new ct(h,f,C,_,x,I):null}evaluate(i){const l=this.input.evaluate(i);return(En(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class Ku{constructor(i,l,h){this.type=i,this.branches=l,this.otherwise=h}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&"value"!==l.expectedType.kind&&(h=l.expectedType);const f=[];for(let x=1;x<i.length-1;x+=2){const C=l.parse(i[x],x,ft);if(!C)return null;const I=l.parse(i[x+1],x+1,h);if(!I)return null;f.push([C,I]),h=h||I.type}const _=l.parse(i[i.length-1],i.length-1,h);if(!_)return null;if(!h)throw new Error("Can't infer output type");return new Ku(h,f,_)}evaluate(i){for(const[l,h]of this.branches)if(l.evaluate(i))return h.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,h]of this.branches)i(l),i(h);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class Ai{constructor(i,l,h,f){this.type=i,this.input=l,this.beginIndex=h,this.endIndex=f}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const h=l.parse(i[1],1,wt),f=l.parse(i[2],2,ze);if(!h||!f)return null;if(!ne(h.type,[K(wt),St,wt]))return l.error(`Expected first argument to be of type array or string, but found ${J(h.type)} instead`);if(4===i.length){const _=l.parse(i[3],3,ze);return _?new Ai(h.type,h,f,_):null}return new Ai(h.type,h,f)}evaluate(i){const l=this.input.evaluate(i),h=this.beginIndex.evaluate(i);if(!le(l,["string","array"]))throw new qt(`Expected first argument to be of type array or string, but found ${J(En(l))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(i);return l.slice(h,f)}return l.slice(h)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function ul(s,i){return"=="===s||"!="===s?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function Qu(s,i,l,h){return 0===h.compare(i,l)}function zs(s,i,l){const h="=="!==s&&"!="!==s;return class yS{constructor(_,x,C){this.type=ft,this.lhs=_,this.rhs=x,this.collator=C,this.hasUntypedArgument="value"===_.type.kind||"value"===x.type.kind}static parse(_,x){if(3!==_.length&&4!==_.length)return x.error("Expected two or three arguments.");const C=_[0];let I=x.parse(_[1],1,wt);if(!I)return null;if(!ul(C,I.type))return x.concat(1).error(`"${C}" comparisons are not supported for type '${J(I.type)}'.`);let T=x.parse(_[2],2,wt);if(!T)return null;if(!ul(C,T.type))return x.concat(2).error(`"${C}" comparisons are not supported for type '${J(T.type)}'.`);if(I.type.kind!==T.type.kind&&"value"!==I.type.kind&&"value"!==T.type.kind)return x.error(`Cannot compare types '${J(I.type)}' and '${J(T.type)}'.`);h&&("value"===I.type.kind&&"value"!==T.type.kind?I=new vi(T.type,[I]):"value"!==I.type.kind&&"value"===T.type.kind&&(T=new vi(I.type,[T])));let P=null;if(4===_.length){if("string"!==I.type.kind&&"string"!==T.type.kind&&"value"!==I.type.kind&&"value"!==T.type.kind)return x.error("Cannot use collator to compare non-string types.");if(P=x.parse(_[3],3,ko),!P)return null}return new yS(I,T,P)}evaluate(_){const x=this.lhs.evaluate(_),C=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){const I=En(x),T=En(C);if(I.kind!==T.kind||"string"!==I.kind&&"number"!==I.kind)throw new qt(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${I.kind}, ${T.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const I=En(x),T=En(C);if("string"!==I.kind||"string"!==T.kind)return i(_,x,C)}return this.collator?l(_,x,C,this.collator.evaluate(_)):i(_,x,C)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const kd=zs("==",function(s,i,l){return i===l},Qu),tc=zs("!=",function(s,i,l){return i!==l},function(s,i,l,h){return!Qu(0,i,l,h)}),nc=zs("<",function(s,i,l){return i<l},function(s,i,l,h){return h.compare(i,l)<0}),Gc=zs(">",function(s,i,l){return i>l},function(s,i,l,h){return h.compare(i,l)>0}),Ju=zs("<=",function(s,i,l){return i<=l},function(s,i,l,h){return h.compare(i,l)<=0}),Rd=zs(">=",function(s,i,l){return i>=l},function(s,i,l,h){return h.compare(i,l)>=0});class Lt{constructor(i,l,h,f,_){this.type=St,this.number=i,this.locale=l,this.currency=h,this.minFractionDigits=f,this.maxFractionDigits=_}static parse(i,l){if(3!==i.length)return l.error("Expected two arguments.");const h=l.parse(i[1],1,ze);if(!h)return null;const f=i[2];if("object"!=typeof f||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let _=null;if(f.locale&&(_=l.parse(f.locale,1,St),!_))return null;let x=null;if(f.currency&&(x=l.parse(f.currency,1,St),!x))return null;let C=null;if(f["min-fraction-digits"]&&(C=l.parse(f["min-fraction-digits"],1,ze),!C))return null;let I=null;return f["max-fraction-digits"]&&(I=l.parse(f["max-fraction-digits"],1,ze),!I)?null:new Lt(h,_,x,C,I)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class Da{constructor(i){this.type=X,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const h=i[1];if(!Array.isArray(h)&&"object"==typeof h)return l.error("First argument must be an image or text section.");const f=[];let _=!1;for(let x=1;x<=i.length-1;++x){const C=i[x];if(_&&"object"==typeof C&&!Array.isArray(C)){_=!1;let I=null;if(C["font-scale"]&&(I=l.parse(C["font-scale"],1,ze),!I))return null;let T=null;if(C["text-font"]&&(T=l.parse(C["text-font"],1,K(St)),!T))return null;let P=null;if(C["text-color"]&&(P=l.parse(C["text-color"],1,Wr),!P))return null;const L=f[f.length-1];L.scale=I,L.font=T,L.textColor=P}else{const I=l.parse(i[x],1,wt);if(!I)return null;const T=I.type.kind;if("string"!==T&&"value"!==T&&"null"!==T&&"resolvedImage"!==T)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,f.push({content:I,scale:null,font:null,textColor:null})}}return new Da(f)}evaluate(i){return new br(this.sections.map(l=>{const h=l.content.evaluate(i);return En(h)===z?new tl("",h,null,null,null):new tl(gt(h),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}}class rc{constructor(i){this.type=z,this.input=i}static parse(i,l){if(2!==i.length)return l.error("Expected two arguments.");const h=l.parse(i[1],1,St);return h?new rc(h):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),h=wr.fromString(l);return h&&i.availableImages&&(h.available=i.availableImages.indexOf(l)>-1),h}eachChild(i){i(this.input)}outputDefined(){return!1}}class Or{constructor(i){this.type=ze,this.input=i}static parse(i,l){if(2!==i.length)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const h=l.parse(i[1],1);return h?"array"!==h.type.kind&&"string"!==h.type.kind&&"value"!==h.type.kind?l.error(`Expected argument of type string or array, but found ${J(h.type)} instead.`):new Or(h):null}evaluate(i){const l=this.input.evaluate(i);if("string"==typeof l||Array.isArray(l))return l.length;throw new qt(`Expected value to be of type string or array, but found ${J(En(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const Bs={"==":kd,"!=":tc,">":Gc,"<":nc,">=":Rd,"<=":Ju,array:vi,at:Xu,boolean:vi,case:Ku,coalesce:Xr,collator:Fs,format:Da,image:rc,in:Yu,"index-of":qc,interpolate:xi,"interpolate-hcl":xi,"interpolate-lab":xi,length:Or,let:ut,literal:Ls,match:ct,number:vi,"number-format":Lt,object:vi,slice:Ai,step:Ns,string:vi,"to-boolean":Cr,"to-color":Cr,"to-number":Cr,"to-string":Cr,var:Rr,within:Ro};function Od(s,[i,l,h,f]){i=i.evaluate(s),l=l.evaluate(s),h=h.evaluate(s);const _=f?f.evaluate(s):1,x=nl(i,l,h,_);if(x)throw new qt(x);return new Ht(i/255,l/255,h/255,_,!1)}function dn(s,i){return s in i}function eh(s,i){const l=i[s];return void 0===l?null:l}function Sa(s){return{type:s}}function ot(s){return{result:"success",value:s}}function mo(s){return{result:"error",value:s}}function os(s){return"data-driven"===s["property-type"]||"cross-faded-data-driven"===s["property-type"]}function Zc(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function hl(s){return!!s.expression&&s.expression.interpolated}function Zt(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function bn(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function Pf(s){return s}function Vt(s,i){const l="color"===i.type,h=s.stops&&"object"==typeof s.stops[0][0],f=h||!(h||void 0!==s.property),_=s.type||(hl(i)?"exponential":"interval");if(l||"padding"===i.type){const P=l?Ht.parse:_i.parse;(s=Gi({},s)).stops&&(s.stops=s.stops.map(L=>[L[0],P(L[1])])),s.default=P(s.default?s.default:i.default)}if(s.colorSpace&&"rgb"!==(x=s.colorSpace)&&"hcl"!==x&&"lab"!==x)throw new Error(`Unknown color space: "${s.colorSpace}"`);var x;let C,I,T;if("exponential"===_)C=Oo;else if("interval"===_)C=Mn;else if("categorical"===_){C=Fn,I=Object.create(null);for(const P of s.stops)I[P[0]]=P[1];T=typeof s.stops[0][0]}else{if("identity"!==_)throw new Error(`Unknown function type "${_}"`);C=ic}if(h){const P={},L=[];for(let $=0;$<s.stops.length;$++){const q=s.stops[$],Q=q[0].zoom;void 0===P[Q]&&(P[Q]={zoom:Q,type:s.type,property:s.property,default:s.default,stops:[]},L.push(Q)),P[Q].stops.push([q[0].value,q[1]])}const N=[];for(const $ of L)N.push([P[$].zoom,Vt(P[$],i)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:xi.interpolationFactor.bind(void 0,j),zoomStops:N.map($=>$[0]),evaluate:({zoom:$},q)=>Oo({stops:N,base:s.base},i,$).evaluate($,q)}}if(f){const P="exponential"===_?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:xi.interpolationFactor.bind(void 0,P),zoomStops:s.stops.map(L=>L[0]),evaluate:({zoom:L})=>C(s,i,L,I,T)}}return{kind:"source",evaluate(P,L){const N=L&&L.properties?L.properties[s.property]:void 0;return void 0===N?Ia(s.default,i.default):C(s,i,N,I,T)}}}function Ia(s,i,l){return void 0!==s?s:void 0!==i?i:void 0!==l?l:void 0}function Fn(s,i,l,h,f){return Ia(typeof l===f?h[l]:void 0,s.default,i.default)}function Mn(s,i,l){if("number"!==Zt(l))return Ia(s.default,i.default);const h=s.stops.length;if(1===h||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[h-1][0])return s.stops[h-1][1];const f=cl(s.stops.map(_=>_[0]),l);return s.stops[f][1]}function Oo(s,i,l){const h=void 0!==s.base?s.base:1;if("number"!==Zt(l))return Ia(s.default,i.default);const f=s.stops.length;if(1===f||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[f-1][0])return s.stops[f-1][1];const _=cl(s.stops.map(P=>P[0]),l),x=function(P,L,N,j){const $=j-N,q=P-N;return 0===$?0:1===L?q/$:(Math.pow(L,q)-1)/(Math.pow(L,$)-1)}(l,h,s.stops[_][0],s.stops[_+1][0]),C=s.stops[_][1],I=s.stops[_+1][1],T=Ti[i.type]||Pf;return"function"==typeof C.evaluate?{evaluate(...P){const L=C.evaluate.apply(void 0,P),N=I.evaluate.apply(void 0,P);if(void 0!==L&&void 0!==N)return T(L,N,x,s.colorSpace)}}:T(C,I,x,s.colorSpace)}function ic(s,i,l){switch(i.type){case"color":l=Ht.parse(l);break;case"formatted":l=br.fromString(l.toString());break;case"resolvedImage":l=wr.fromString(l.toString());break;case"padding":l=_i.parse(l);break;default:Zt(l)===i.type||"enum"===i.type&&i.values[l]||(l=void 0)}return Ia(l,s.default,i.default)}Wi.register(Bs,{error:[{kind:"error"},[St],(s,[i])=>{throw new qt(i.evaluate(s))}],typeof:[St,[wt],(s,[i])=>J(En(i.evaluate(s)))],"to-rgba":[K(ze,4),[Wr],(s,[i])=>{const[l,h,f,_]=i.evaluate(s).rgb;return[255*l,255*h,255*f,_]}],rgb:[Wr,[ze,ze,ze],Od],rgba:[Wr,[ze,ze,ze,ze],Od],has:{type:ft,overloads:[[[St],(s,[i])=>dn(i.evaluate(s),s.properties())],[[St,fo],(s,[i,l])=>dn(i.evaluate(s),l.evaluate(s))]]},get:{type:wt,overloads:[[[St],(s,[i])=>eh(i.evaluate(s),s.properties())],[[St,fo],(s,[i,l])=>eh(i.evaluate(s),l.evaluate(s))]]},"feature-state":[wt,[St],(s,[i])=>eh(i.evaluate(s),s.featureState||{})],properties:[fo,[],s=>s.properties()],"geometry-type":[St,[],s=>s.geometryType()],id:[wt,[],s=>s.id()],zoom:[ze,[],s=>s.globals.zoom],"heatmap-density":[ze,[],s=>s.globals.heatmapDensity||0],"line-progress":[ze,[],s=>s.globals.lineProgress||0],accumulated:[wt,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[ze,Sa(ze),(s,i)=>{let l=0;for(const h of i)l+=h.evaluate(s);return l}],"*":[ze,Sa(ze),(s,i)=>{let l=1;for(const h of i)l*=h.evaluate(s);return l}],"-":{type:ze,overloads:[[[ze,ze],(s,[i,l])=>i.evaluate(s)-l.evaluate(s)],[[ze],(s,[i])=>-i.evaluate(s)]]},"/":[ze,[ze,ze],(s,[i,l])=>i.evaluate(s)/l.evaluate(s)],"%":[ze,[ze,ze],(s,[i,l])=>i.evaluate(s)%l.evaluate(s)],ln2:[ze,[],()=>Math.LN2],pi:[ze,[],()=>Math.PI],e:[ze,[],()=>Math.E],"^":[ze,[ze,ze],(s,[i,l])=>Math.pow(i.evaluate(s),l.evaluate(s))],sqrt:[ze,[ze],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[ze,[ze],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[ze,[ze],(s,[i])=>Math.log(i.evaluate(s))],log2:[ze,[ze],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[ze,[ze],(s,[i])=>Math.sin(i.evaluate(s))],cos:[ze,[ze],(s,[i])=>Math.cos(i.evaluate(s))],tan:[ze,[ze],(s,[i])=>Math.tan(i.evaluate(s))],asin:[ze,[ze],(s,[i])=>Math.asin(i.evaluate(s))],acos:[ze,[ze],(s,[i])=>Math.acos(i.evaluate(s))],atan:[ze,[ze],(s,[i])=>Math.atan(i.evaluate(s))],min:[ze,Sa(ze),(s,i)=>Math.min(...i.map(l=>l.evaluate(s)))],max:[ze,Sa(ze),(s,i)=>Math.max(...i.map(l=>l.evaluate(s)))],abs:[ze,[ze],(s,[i])=>Math.abs(i.evaluate(s))],round:[ze,[ze],(s,[i])=>{const l=i.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[ze,[ze],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[ze,[ze],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[ft,[St,wt],(s,[i,l])=>s.properties()[i.value]===l.value],"filter-id-==":[ft,[wt],(s,[i])=>s.id()===i.value],"filter-type-==":[ft,[St],(s,[i])=>s.geometryType()===i.value],"filter-<":[ft,[St,wt],(s,[i,l])=>{const h=s.properties()[i.value],f=l.value;return typeof h==typeof f&&h<f}],"filter-id-<":[ft,[wt],(s,[i])=>{const l=s.id(),h=i.value;return typeof l==typeof h&&l<h}],"filter->":[ft,[St,wt],(s,[i,l])=>{const h=s.properties()[i.value],f=l.value;return typeof h==typeof f&&h>f}],"filter-id->":[ft,[wt],(s,[i])=>{const l=s.id(),h=i.value;return typeof l==typeof h&&l>h}],"filter-<=":[ft,[St,wt],(s,[i,l])=>{const h=s.properties()[i.value],f=l.value;return typeof h==typeof f&&h<=f}],"filter-id-<=":[ft,[wt],(s,[i])=>{const l=s.id(),h=i.value;return typeof l==typeof h&&l<=h}],"filter->=":[ft,[St,wt],(s,[i,l])=>{const h=s.properties()[i.value],f=l.value;return typeof h==typeof f&&h>=f}],"filter-id->=":[ft,[wt],(s,[i])=>{const l=s.id(),h=i.value;return typeof l==typeof h&&l>=h}],"filter-has":[ft,[wt],(s,[i])=>i.value in s.properties()],"filter-has-id":[ft,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[ft,[K(St)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[ft,[K(wt)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[ft,[St,K(wt)],(s,[i,l])=>l.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[ft,[St,K(wt)],(s,[i,l])=>function(h,f,_,x){for(;_<=x;){const C=_+x>>1;if(f[C]===h)return!0;f[C]>h?x=C-1:_=C+1}return!1}(s.properties()[i.value],l.value,0,l.value.length-1)],all:{type:ft,overloads:[[[ft,ft],(s,[i,l])=>i.evaluate(s)&&l.evaluate(s)],[Sa(ft),(s,i)=>{for(const l of i)if(!l.evaluate(s))return!1;return!0}]]},any:{type:ft,overloads:[[[ft,ft],(s,[i,l])=>i.evaluate(s)||l.evaluate(s)],[Sa(ft),(s,i)=>{for(const l of i)if(l.evaluate(s))return!0;return!1}]]},"!":[ft,[ft],(s,[i])=>!i.evaluate(s)],"is-supported-script":[ft,[St],(s,[i])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(i.evaluate(s))}],upcase:[St,[St],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[St,[St],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[St,Sa(wt),(s,i)=>i.map(l=>gt(l.evaluate(s))).join("")],"resolved-locale":[St,[ko],(s,[i])=>i.evaluate(s).resolvedLocale()]});class Ea{constructor(i,l){var h;this.expression=i,this._warningHistory={},this._evaluator=new jc,this._defaultValue=l?"color"===(h=l).type&&bn(h.default)?new Ht(0,0,0,0):"color"===h.type?Ht.parse(h.default)||null:"padding"===h.type?_i.parse(h.default)||null:"variableAnchorOffsetCollection"===h.type?Mi.parse(h.default)||null:void 0===h.default?null:h.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(i,l,h,f,_,x){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=f,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(i,l,h,f,_,x){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=f,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=x||null;try{const C=this.expression.evaluate(this._evaluator);if(null==C||"number"==typeof C&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new qt(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(C.message)),this._defaultValue}}}function oc(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in Bs}function sc(s,i){const l=new Wt(Bs,Jl,[],i?function(f){const _={color:Wr,string:St,number:ze,enum:St,boolean:ft,formatted:X,padding:F,resolvedImage:z,variableAnchorOffsetCollection:U};return"array"===f.type?K(_[f.value]||wt,f.length):_[f.type]}(i):void 0),h=l.parse(s,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return h?ot(new Ea(h,i)):mo(l.errors)}class Wc{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent="constant"!==i&&!Xi(l.expression)}evaluateWithoutErrorHandling(i,l,h,f,_,x){return this._styleExpression.evaluateWithoutErrorHandling(i,l,h,f,_,x)}evaluate(i,l,h,f,_,x){return this._styleExpression.evaluate(i,l,h,f,_,x)}}class dl{constructor(i,l,h,f){this.kind=i,this.zoomStops=h,this._styleExpression=l,this.isStateDependent="camera"!==i&&!Xi(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(i,l,h,f,_,x){return this._styleExpression.evaluateWithoutErrorHandling(i,l,h,f,_,x)}evaluate(i,l,h,f,_,x){return this._styleExpression.evaluate(i,l,h,f,_,x)}interpolationFactor(i,l,h){return this.interpolationType?xi.interpolationFactor(this.interpolationType,i,l,h):0}}function ss(s,i){const l=sc(s,i);if("error"===l.result)return l;const h=l.value.expression,f=Uc(h);if(!f&&!os(i))return mo([new Ln("","data expressions not supported")]);const _=Hc(h,["zoom"]);if(!_&&!Zc(i))return mo([new Ln("","zoom expressions not supported")]);const x=Pi(h);return x||_?x instanceof Ln?mo([x]):x instanceof xi&&!hl(i)?mo([new Ln("",'"interpolate" expressions cannot be used with this property')]):ot(x?new dl(f?"camera":"composite",l.value,x.labels,x instanceof xi?x.interpolation:void 0):new Wc(f?"constant":"source",l.value)):mo([new Ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class pl{constructor(i,l){this._parameters=i,this._specification=l,Gi(this,Vt(this._parameters,this._specification))}static deserialize(i){return new pl(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Pi(s){let i=null;if(s instanceof ut)i=Pi(s.result);else if(s instanceof Xr){for(const l of s.args)if(i=Pi(l),i)break}else(s instanceof Ns||s instanceof xi)&&s.input instanceof Wi&&"zoom"===s.input.name&&(i=s);return i instanceof Ln||s.eachChild(l=>{const h=Pi(l);h instanceof Ln?i=h:!i&&h?i=new Ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&h&&i!==h&&(i=new Ln("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function fl(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!fl(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}const ht={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ac(s){if(null==s)return{filter:()=>!0,needGeometry:!1};fl(s)||(s=Ma(s));const i=sc(s,ht);if("error"===i.result)throw new Error(i.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,h,f)=>i.value.evaluate(l,h,{},f),needGeometry:ml(s)}}function Je(s,i){return s<i?-1:s>i?1:0}function ml(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let i=1;i<s.length;i++)if(ml(s[i]))return!0;return!1}function Ma(s){if(!s)return!0;const i=s[0];return s.length<=1?"any"!==i:"=="===i?Vs(s[1],s[2],"=="):"!="===i?gl(Vs(s[1],s[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Vs(s[1],s[2],i):"any"===i?(l=s.slice(1),["any"].concat(l.map(Ma))):"all"===i?["all"].concat(s.slice(1).map(Ma)):"none"===i?["all"].concat(s.slice(1).map(Ma).map(gl)):"in"===i?th(s[1],s.slice(2)):"!in"===i?gl(th(s[1],s.slice(2))):"has"===i?nh(s[1]):"!has"===i?gl(nh(s[1])):"within"!==i||s;var l}function Vs(s,i,l){switch(s){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,s,i]}}function th(s,i){if(0===i.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",s,["literal",i.sort(Je)]]:["filter-in-small",s,["literal",i]]}}function nh(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function gl(s){return["!",s]}function ki(s){const i=typeof s;if("number"===i||"boolean"===i||"string"===i||null==s)return JSON.stringify(s);if(Array.isArray(s)){let f="[";for(const _ of s)f+=`${ki(_)},`;return`${f}]`}const l=Object.keys(s).sort();let h="{";for(let f=0;f<l.length;f++)h+=`${JSON.stringify(l[f])}:${ki(s[l[f]])},`;return`${h}}`}function js(s){let i="";for(const l of yi)i+=`/${ki(s[l])}`;return i}function Ri(s){const i=s.value;return i?[new Pe(s.key,i,"constants have been deprecated as of v8")]:[]}function Xt(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Nt(s){if(Array.isArray(s))return s.map(Nt);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const l in s)i[l]=Nt(s[l]);return i}return Xt(s)}function Dr(s){const i=s.key,l=s.value,h=s.valueSpec||{},f=s.objectElementValidators||{},_=s.style,x=s.styleSpec,C=s.validateSpec;let I=[];const T=Zt(l);if("object"!==T)return[new Pe(i,l,`object expected, ${T} found`)];for(const P in l){const L=P.split(".")[0],N=h[L]||h["*"];let j;if(f[L])j=f[L];else if(h[L])j=C;else if(f["*"])j=f["*"];else{if(!h["*"]){I.push(new Pe(i,l[P],`unknown property "${P}"`));continue}j=C}I=I.concat(j({key:(i&&`${i}.`)+P,value:l[P],valueSpec:N,style:_,styleSpec:x,object:l,objectKey:P,validateSpec:C},l))}for(const P in h)f[P]||h[P].required&&void 0===h[P].default&&void 0===l[P]&&I.push(new Pe(i,l,`missing required property "${P}"`));return I}function as(s){const i=s.value,l=s.valueSpec,h=s.style,f=s.styleSpec,_=s.key,x=s.arrayElementValidator||s.validateSpec;if("array"!==Zt(i))return[new Pe(_,i,`array expected, ${Zt(i)} found`)];if(l.length&&i.length!==l.length)return[new Pe(_,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new Pe(_,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let C={type:l.value,values:l.values};f.$version<7&&(C.function=l.function),"object"===Zt(l.value)&&(C=l.value);let I=[];for(let T=0;T<i.length;T++)I=I.concat(x({array:i,arrayIndex:T,value:i[T],valueSpec:C,validateSpec:s.validateSpec,style:h,styleSpec:f,key:`${_}[${T}]`}));return I}function $s(s){const i=s.key,l=s.value,h=s.valueSpec;let f=Zt(l);return"number"===f&&l!=l&&(f="NaN"),"number"!==f?[new Pe(i,l,`number expected, ${f} found`)]:"minimum"in h&&l<h.minimum?[new Pe(i,l,`${l} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&l>h.maximum?[new Pe(i,l,`${l} is greater than the maximum value ${h.maximum}`)]:[]}function yl(s){const i=s.valueSpec,l=Xt(s.value.type);let h,f,_,x={};const C="categorical"!==l&&void 0===s.value.property,I=!C,T="array"===Zt(s.value.stops)&&"array"===Zt(s.value.stops[0])&&"object"===Zt(s.value.stops[0][0]),P=Dr({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(j){if("identity"===l)return[new Pe(j.key,j.value,'identity function may not have a "stops" property')];let $=[];const q=j.value;return $=$.concat(as({key:j.key,value:q,valueSpec:j.valueSpec,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:L})),"array"===Zt(q)&&0===q.length&&$.push(new Pe(j.key,q,"array must have at least one stop")),$},default:function(j){return j.validateSpec({key:j.key,value:j.value,valueSpec:i,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec})}}});return"identity"===l&&C&&P.push(new Pe(s.key,s.value,'missing required property "property"')),"identity"===l||s.value.stops||P.push(new Pe(s.key,s.value,'missing required property "stops"')),"exponential"===l&&s.valueSpec.expression&&!hl(s.valueSpec)&&P.push(new Pe(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(I&&!os(s.valueSpec)?P.push(new Pe(s.key,s.value,"property functions not supported")):C&&!Zc(s.valueSpec)&&P.push(new Pe(s.key,s.value,"zoom functions not supported"))),"categorical"!==l&&!T||void 0!==s.value.property||P.push(new Pe(s.key,s.value,'"property" property is required')),P;function L(j){let $=[];const q=j.value,Q=j.key;if("array"!==Zt(q))return[new Pe(Q,q,`array expected, ${Zt(q)} found`)];if(2!==q.length)return[new Pe(Q,q,`array length 2 expected, length ${q.length} found`)];if(T){if("object"!==Zt(q[0]))return[new Pe(Q,q,`object expected, ${Zt(q[0])} found`)];if(void 0===q[0].zoom)return[new Pe(Q,q,"object stop key must have zoom")];if(void 0===q[0].value)return[new Pe(Q,q,"object stop key must have value")];if(_&&_>Xt(q[0].zoom))return[new Pe(Q,q[0].zoom,"stop zoom values must appear in ascending order")];Xt(q[0].zoom)!==_&&(_=Xt(q[0].zoom),f=void 0,x={}),$=$.concat(Dr({key:`${Q}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:$s,value:N}}))}else $=$.concat(N({key:`${Q}[0]`,value:q[0],valueSpec:{},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec},q));return oc(Nt(q[1]))?$.concat([new Pe(`${Q}[1]`,q[1],"expressions are not allowed in function stops.")]):$.concat(j.validateSpec({key:`${Q}[1]`,value:q[1],valueSpec:i,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec}))}function N(j,$){const q=Zt(j.value),Q=Xt(j.value),te=null!==j.value?j.value:$;if(h){if(q!==h)return[new Pe(j.key,te,`${q} stop domain type must match previous stop domain type ${h}`)]}else h=q;if("number"!==q&&"string"!==q&&"boolean"!==q)return[new Pe(j.key,te,"stop domain value must be a number, string, or boolean")];if("number"!==q&&"categorical"!==l){let ae=`number expected, ${q} found`;return os(i)&&void 0===l&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pe(j.key,te,ae)]}return"categorical"!==l||"number"!==q||isFinite(Q)&&Math.floor(Q)===Q?"categorical"!==l&&"number"===q&&void 0!==f&&Q<f?[new Pe(j.key,te,"stop domain values must appear in ascending order")]:(f=Q,"categorical"===l&&Q in x?[new Pe(j.key,te,"stop domain values must be unique")]:(x[Q]=!0,[])):[new Pe(j.key,te,`integer expected, found ${Q}`)]}}function Yr(s){const i=("property"===s.expressionContext?ss:sc)(Nt(s.value),s.valueSpec);if("error"===i.result)return i.value.map(h=>new Pe(`${s.key}${h.key}`,s.value,h.message));const l=i.value.expression||i.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!l.outputDefined())return[new Pe(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!Xi(l))return[new Pe(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext&&!Xi(l))return[new Pe(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!Hc(l,["zoom","feature-state"]))return[new Pe(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!Uc(l))return[new Pe(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Lo(s){const i=s.key,l=s.value,h=s.valueSpec,f=[];return Array.isArray(h.values)?-1===h.values.indexOf(Xt(l))&&f.push(new Pe(i,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(h.values).indexOf(Xt(l))&&f.push(new Pe(i,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function Us(s){return fl(Nt(s.value))?Yr(Gi({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Xc(s)}function Xc(s){const i=s.value,l=s.key;if("array"!==Zt(i))return[new Pe(l,i,`array expected, ${Zt(i)} found`)];const h=s.styleSpec;let f,_=[];if(i.length<1)return[new Pe(l,i,"filter array must have at least 1 element")];switch(_=_.concat(Lo({key:`${l}[0]`,value:i[0],valueSpec:h.filter_operator,style:s.style,styleSpec:s.styleSpec})),Xt(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===Xt(i[1])&&_.push(new Pe(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&_.push(new Pe(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(f=Zt(i[1]),"string"!==f&&_.push(new Pe(`${l}[1]`,i[1],`string expected, ${f} found`)));for(let x=2;x<i.length;x++)f=Zt(i[x]),"$type"===Xt(i[1])?_=_.concat(Lo({key:`${l}[${x}]`,value:i[x],valueSpec:h.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&_.push(new Pe(`${l}[${x}]`,i[x],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let x=1;x<i.length;x++)_=_.concat(Xc({key:`${l}[${x}]`,value:i[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":f=Zt(i[1]),2!==i.length?_.push(new Pe(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==f&&_.push(new Pe(`${l}[1]`,i[1],`string expected, ${f} found`));break;case"within":f=Zt(i[1]),2!==i.length?_.push(new Pe(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==f&&_.push(new Pe(`${l}[1]`,i[1],`object expected, ${f} found`))}return _}function lc(s,i){const l=s.key,h=s.validateSpec,f=s.style,_=s.styleSpec,x=s.value,C=s.objectKey,I=_[`${i}_${s.layerType}`];if(!I)return[];const T=C.match(/^(.*)-transition$/);if("paint"===i&&T&&I[T[1]]&&I[T[1]].transition)return h({key:l,value:x,valueSpec:_.transition,style:f,styleSpec:_});const P=s.valueSpec||I[C];if(!P)return[new Pe(l,x,`unknown property "${C}"`)];let L;if("string"===Zt(x)&&os(P)&&!P.tokens&&(L=/^{([^}]+)}$/.exec(x)))return[new Pe(l,x,`"${C}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const N=[];return"symbol"===s.layerType&&("text-field"===C&&f&&!f.glyphs&&N.push(new Pe(l,x,'use of "text-field" requires a style "glyphs" property')),"text-font"===C&&bn(Nt(x))&&"identity"===Xt(x.type)&&N.push(new Pe(l,x,'"text-font" does not support identity functions'))),N.concat(h({key:s.key,value:x,valueSpec:P,style:f,styleSpec:_,expressionContext:"property",propertyType:i,propertyKey:C}))}function Yc(s){return lc(s,"paint")}function Kc(s){return lc(s,"layout")}function Ta(s){let i=[];const l=s.value,h=s.key,f=s.style,_=s.styleSpec;l.type||l.ref||i.push(new Pe(h,l,'either "type" or "ref" is required'));let x=Xt(l.type);const C=Xt(l.ref);if(l.id){const I=Xt(l.id);for(let T=0;T<s.arrayIndex;T++){const P=f.layers[T];Xt(P.id)===I&&i.push(new Pe(h,l.id,`duplicate layer id "${l.id}", previously used at line ${P.id.__line__}`))}}if("ref"in l){let I;["type","source","source-layer","filter","layout"].forEach(T=>{T in l&&i.push(new Pe(h,l[T],`"${T}" is prohibited for ref layers`))}),f.layers.forEach(T=>{Xt(T.id)===C&&(I=T)}),I?I.ref?i.push(new Pe(h,l.ref,"ref cannot reference another ref layer")):x=Xt(I.type):i.push(new Pe(h,l.ref,`ref layer "${C}" not found`))}else if("background"!==x)if(l.source){const I=f.sources&&f.sources[l.source],T=I&&Xt(I.type);I?"vector"===T&&"raster"===x?i.push(new Pe(h,l.source,`layer "${l.id}" requires a raster source`)):"raster-dem"!==T&&"hillshade"===x?i.push(new Pe(h,l.source,`layer "${l.id}" requires a raster-dem source`)):"raster"===T&&"raster"!==x?i.push(new Pe(h,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==T||l["source-layer"]?"raster-dem"===T&&"hillshade"!==x?i.push(new Pe(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==x||!l.paint||!l.paint["line-gradient"]||"geojson"===T&&I.lineMetrics||i.push(new Pe(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Pe(h,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new Pe(h,l.source,`source "${l.source}" not found`))}else i.push(new Pe(h,l,'missing required property "source"'));return i=i.concat(Dr({key:h,value:l,valueSpec:_.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${h}.type`,value:l.type,valueSpec:_.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:l,objectKey:"type"}),filter:Us,layout:I=>Dr({layer:l,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":T=>Kc(Gi({layerType:x},T))}}),paint:I=>Dr({layer:l,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":T=>Yc(Gi({layerType:x},T))}})}})),i}function Yi(s){const i=s.value,l=s.key,h=Zt(i);return"string"!==h?[new Pe(l,i,`string expected, ${h} found`)]:[]}const Aa={promoteId:function({key:s,value:i}){if("string"===Zt(i))return Yi({key:s,value:i});{const l=[];for(const h in i)l.push(...Yi({key:`${s}.${h}`,value:i[h]}));return l}}};function bi(s){const i=s.value,l=s.key,h=s.styleSpec,f=s.style,_=s.validateSpec;if(!i.type)return[new Pe(l,i,'"type" is required')];const x=Xt(i.type);let C;switch(x){case"vector":case"raster":return C=Dr({key:l,value:i,valueSpec:h[`source_${x.replace("-","_")}`],style:s.style,styleSpec:h,objectElementValidators:Aa,validateSpec:_}),C;case"raster-dem":return C=function(I){var T;const P=null!==(T=I.sourceName)&&void 0!==T?T:"",L=I.value,N=I.styleSpec,j=N.source_raster_dem,$=I.style;let q=[];const Q=Zt(L);if(void 0===L)return q;if("object"!==Q)return q.push(new Pe("source_raster_dem",L,`object expected, ${Q} found`)),q;const te="custom"===Xt(L.encoding),ae=["redFactor","greenFactor","blueFactor","baseShift"],ie=I.value.encoding?`"${I.value.encoding}"`:"Default";for(const he in L)!te&&ae.includes(he)?q.push(new Pe(he,L[he],`In "${P}": "${he}" is only valid when "encoding" is set to "custom". ${ie} encoding found`)):j[he]?q=q.concat(I.validateSpec({key:he,value:L[he],valueSpec:j[he],validateSpec:I.validateSpec,style:$,styleSpec:N})):q.push(new Pe(he,L[he],`unknown property "${he}"`));return q}({sourceName:l,value:i,style:s.style,styleSpec:h,validateSpec:_}),C;case"geojson":if(C=Dr({key:l,value:i,valueSpec:h.source_geojson,style:f,styleSpec:h,validateSpec:_,objectElementValidators:Aa}),i.cluster)for(const I in i.clusterProperties){const[T,P]=i.clusterProperties[I],L="string"==typeof T?[T,["accumulated"],["get",I]]:T;C.push(...Yr({key:`${l}.${I}.map`,value:P,validateSpec:_,expressionContext:"cluster-map"})),C.push(...Yr({key:`${l}.${I}.reduce`,value:L,validateSpec:_,expressionContext:"cluster-reduce"}))}return C;case"video":return Dr({key:l,value:i,valueSpec:h.source_video,style:f,validateSpec:_,styleSpec:h});case"image":return Dr({key:l,value:i,valueSpec:h.source_image,style:f,validateSpec:_,styleSpec:h});case"canvas":return[new Pe(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Lo({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,validateSpec:_,styleSpec:h})}}function Pa(s){const i=s.value,l=s.styleSpec,h=l.light,f=s.style;let _=[];const x=Zt(i);if(void 0===i)return _;if("object"!==x)return _=_.concat([new Pe("light",i,`object expected, ${x} found`)]),_;for(const C in i){const I=C.match(/^(.*)-transition$/);_=_.concat(I&&h[I[1]]&&h[I[1]].transition?s.validateSpec({key:C,value:i[C],valueSpec:l.transition,validateSpec:s.validateSpec,style:f,styleSpec:l}):h[C]?s.validateSpec({key:C,value:i[C],valueSpec:h[C],validateSpec:s.validateSpec,style:f,styleSpec:l}):[new Pe(C,i[C],`unknown property "${C}"`)])}return _}function rh(s){const i=s.value,l=s.styleSpec,h=l.terrain,f=s.style;let _=[];const x=Zt(i);if(void 0===i)return _;if("object"!==x)return _=_.concat([new Pe("terrain",i,`object expected, ${x} found`)]),_;for(const C in i)_=_.concat(h[C]?s.validateSpec({key:C,value:i[C],valueSpec:h[C],validateSpec:s.validateSpec,style:f,styleSpec:l}):[new Pe(C,i[C],`unknown property "${C}"`)]);return _}function ih(s){let i=[];const l=s.value,h=s.key;if(Array.isArray(l)){const f=[],_=[];for(const x in l)l[x].id&&f.includes(l[x].id)&&i.push(new Pe(h,l,`all the sprites' ids must be unique, but ${l[x].id} is duplicated`)),f.push(l[x].id),l[x].url&&_.includes(l[x].url)&&i.push(new Pe(h,l,`all the sprites' URLs must be unique, but ${l[x].url} is duplicated`)),_.push(l[x].url),i=i.concat(Dr({key:`${h}[${x}]`,value:l[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return i}return Yi({key:h,value:l})}const Oi={"*":()=>[],array:as,boolean:function(s){const i=s.value,l=s.key,h=Zt(i);return"boolean"!==h?[new Pe(l,i,`boolean expected, ${h} found`)]:[]},number:$s,color:function(s){const i=s.key,l=s.value,h=Zt(l);return"string"!==h?[new Pe(i,l,`color expected, ${h} found`)]:Ht.parse(String(l))?[]:[new Pe(i,l,`color expected, "${l}" found`)]},constants:Ri,enum:Lo,filter:Us,function:yl,layer:Ta,object:Dr,source:bi,light:Pa,terrain:rh,string:Yi,formatted:function(s){return 0===Yi(s).length?[]:Yr(s)},resolvedImage:function(s){return 0===Yi(s).length?[]:Yr(s)},padding:function(s){const i=s.key,l=s.value;if("array"===Zt(l)){if(l.length<1||l.length>4)return[new Pe(i,l,`padding requires 1 to 4 values; ${l.length} values found`)];const h={type:"number"};let f=[];for(let _=0;_<l.length;_++)f=f.concat(s.validateSpec({key:`${i}[${_}]`,value:l[_],validateSpec:s.validateSpec,valueSpec:h}));return f}return $s({key:i,value:l,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const i=s.key,l=s.value,h=Zt(l),f=s.styleSpec;if("array"!==h||l.length<1||l.length%2!=0)return[new Pe(i,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let x=0;x<l.length;x+=2)_=_.concat(Lo({key:`${i}[${x}]`,value:l[x],valueSpec:f.layout_symbol["text-anchor"]})),_=_.concat(as({key:`${i}[${x+1}]`,value:l[x+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:f}));return _},sprite:ih};function Fo(s){const i=s.value,l=s.valueSpec,h=s.styleSpec;return s.validateSpec=Fo,l.expression&&bn(Xt(i))?yl(s):l.expression&&oc(Nt(i))?Yr(s):l.type&&Oi[l.type]?Oi[l.type](s):Dr(Gi({},s,{valueSpec:l.type?h[l.type]:l}))}function Qc(s){const i=s.value,l=s.key,h=Yi(s);return h.length||(-1===i.indexOf("{fontstack}")&&h.push(new Pe(l,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&h.push(new Pe(l,i,'"glyphs" url must include a "{range}" token'))),h}function Li(s,i=_e){let l=[];return l=l.concat(Fo({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,validateSpec:Fo,objectElementValidators:{glyphs:Qc,"*":()=>[]}})),s.constants&&(l=l.concat(Ri({key:"constants",value:s.constants,style:s,styleSpec:i,validateSpec:Fo}))),cc(l)}function No(s){return function(i){return s({...i,validateSpec:Fo})}}function cc(s){return[].concat(s).sort((i,l)=>i.line-l.line)}function zo(s){return function(...i){return cc(s.apply(this,i))}}Li.source=zo(No(bi)),Li.sprite=zo(No(ih)),Li.glyphs=zo(No(Qc)),Li.light=zo(No(Pa)),Li.terrain=zo(No(rh)),Li.layer=zo(No(Ta)),Li.filter=zo(No(Us)),Li.paintProperty=zo(No(Yc)),Li.layoutProperty=zo(No(Kc));const go=Li,Ld=go.light,Jc=go.paintProperty,oh=go.layoutProperty;function ls(s,i){let l=!1;if(i&&i.length)for(const h of i)s.fire(new Rs(new Error(h.message))),l=!0;return l}class ka{constructor(i,l,h){const f=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const x=new Int32Array(this.arrayBuffer);i=x[0],this.d=(l=x[1])+2*(h=x[2]);for(let I=0;I<this.d*this.d;I++){const T=x[3+I],P=x[3+I+1];f.push(T===P?null:x.subarray(T,P))}const C=x[3+f.length+1];this.keys=x.subarray(x[3+f.length],C),this.bboxes=x.subarray(C),this.insert=this._insertReadonly}else{this.d=l+2*h;for(let x=0;x<this.d*this.d;x++)f.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=h,this.scale=l/i,this.uid=0;const _=h/l*i;this.min=-_,this.max=i+_}insert(i,l,h,f,_){this._forEachCell(l,h,f,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,l,h,f,_,x){this.cells[_].push(x)}query(i,l,h,f,_){const x=this.min,C=this.max;if(i<=x&&l<=x&&C<=h&&C<=f&&!_)return Array.prototype.slice.call(this.keys);{const I=[];return this._forEachCell(i,l,h,f,this._queryCell,I,{},_),I}}_queryCell(i,l,h,f,_,x,C,I){const T=this.cells[_];if(null!==T){const P=this.keys,L=this.bboxes;for(let N=0;N<T.length;N++){const j=T[N];if(void 0===C[j]){const $=4*j;(I?I(L[$+0],L[$+1],L[$+2],L[$+3]):i<=L[$+2]&&l<=L[$+3]&&h>=L[$+0]&&f>=L[$+1])?(C[j]=!0,x.push(P[j])):C[j]=!1}}}}_forEachCell(i,l,h,f,_,x,C,I){const T=this._convertToCellCoord(i),P=this._convertToCellCoord(l),L=this._convertToCellCoord(h),N=this._convertToCellCoord(f);for(let j=T;j<=L;j++)for(let $=P;$<=N;$++){const q=this.d*$+j;if((!I||I(this._convertFromCellCoord(j),this._convertFromCellCoord($),this._convertFromCellCoord(j+1),this._convertFromCellCoord($+1)))&&_.call(this,i,l,h,f,q,x,C,I))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,l=3+this.cells.length+1+1;let h=0;for(let x=0;x<this.cells.length;x++)h+=this.cells[x].length;const f=new Int32Array(l+h+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let _=l;for(let x=0;x<i.length;x++){const C=i[x];f[3+x]=_,f.set(C,_),_+=C.length}return f[3+i.length]=_,f.set(this.keys,_),_+=this.keys.length,f[3+i.length+1]=_,f.set(this.bboxes,_),_+=this.bboxes.length,f.buffer}static serialize(i,l){const h=i.toArrayBuffer();return l&&l.push(h),{buffer:h}}static deserialize(i){return new ka(i.buffer)}}const Bo={};function qe(s,i,l={}){if(Bo[s])throw new Error(`${s} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:s,writeable:!1}),Bo[s]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}qe("Object",Object),qe("TransferableGridIndex",ka),qe("Color",Ht),qe("Error",Error),qe("AJAXError",_n),qe("ResolvedImage",wr),qe("StylePropertyFunction",pl),qe("StyleExpression",Ea,{omit:["_evaluator"]}),qe("ZoomDependentExpression",dl),qe("ZoomConstantExpression",Wc),qe("CompoundExpression",Wi,{omit:["_evaluate"]});for(const s in Bs)Bs[s]._classRegistryKey||qe(`Expression_${s}`,Bs[s]);function Ki(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function cs(s,i){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob)return s;if(Ki(s)||ga(s))return i&&i.push(s),s;if(ArrayBuffer.isView(s)){const l=s;return i&&i.push(l.buffer),l}if(s instanceof ImageData)return i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const l=[];for(const h of s)l.push(cs(h,i));return l}if("object"==typeof s){const l=s.constructor,h=l._classRegistryKey;if(!h)throw new Error("can't serialize object of unregistered class");if(!Bo[h])throw new Error(`${h} is not registered.`);const f=l.serialize?l.serialize(s,i):{};if(l.serialize){if(i&&f===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in s){if(!s.hasOwnProperty(_)||Bo[h].omit.indexOf(_)>=0)continue;const x=s[_];f[_]=Bo[h].shallow.indexOf(_)>=0?x:cs(x,i)}s instanceof Error&&(f.message=s.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==h&&(f.$name=h),f}throw new Error("can't serialize object of type "+typeof s)}function Hs(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||Ki(s)||ga(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Hs);if("object"==typeof s){const i=s.$name||"Object";if(!Bo[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:l}=Bo[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(s);const h=Object.create(l.prototype);for(const f of Object.keys(s)){if("$name"===f)continue;const _=s[f];h[f]=Bo[i].shallow.indexOf(f)>=0?_:Hs(_)}return h}throw new Error("can't deserialize object of type "+typeof s)}class Lr{constructor(){this.first=!0}update(i,l){const h=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=h,!0))}}const Oe={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function $t(s){for(const i of s)if(us(i.charCodeAt(0)))return!0;return!1}function or(s){for(const i of s)if(!Kr(i.charCodeAt(0)))return!1;return!0}function Kr(s){return!(Oe.Arabic(s)||Oe["Arabic Supplement"](s)||Oe["Arabic Extended-A"](s)||Oe["Arabic Presentation Forms-A"](s)||Oe["Arabic Presentation Forms-B"](s))}function us(s){return!(746!==s&&747!==s&&(s<4352||!(Oe["Bopomofo Extended"](s)||Oe.Bopomofo(s)||Oe["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Oe["CJK Compatibility Ideographs"](s)||Oe["CJK Compatibility"](s)||Oe["CJK Radicals Supplement"](s)||Oe["CJK Strokes"](s)||!(!Oe["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||Oe["CJK Unified Ideographs Extension A"](s)||Oe["CJK Unified Ideographs"](s)||Oe["Enclosed CJK Letters and Months"](s)||Oe["Hangul Compatibility Jamo"](s)||Oe["Hangul Jamo Extended-A"](s)||Oe["Hangul Jamo Extended-B"](s)||Oe["Hangul Jamo"](s)||Oe["Hangul Syllables"](s)||Oe.Hiragana(s)||Oe["Ideographic Description Characters"](s)||Oe.Kanbun(s)||Oe["Kangxi Radicals"](s)||Oe["Katakana Phonetic Extensions"](s)||Oe.Katakana(s)&&12540!==s||!(!Oe["Halfwidth and Fullwidth Forms"](s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!Oe["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Oe["Unified Canadian Aboriginal Syllabics"](s)||Oe["Unified Canadian Aboriginal Syllabics Extended"](s)||Oe["Vertical Forms"](s)||Oe["Yijing Hexagram Symbols"](s)||Oe["Yi Syllables"](s)||Oe["Yi Radicals"](s))))}function ci(s){return!(us(s)||(i=s,Oe["Latin-1 Supplement"](i)&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||Oe["General Punctuation"](i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||Oe["Letterlike Symbols"](i)||Oe["Number Forms"](i)||Oe["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||Oe["Control Pictures"](i)&&9251!==i||Oe["Optical Character Recognition"](i)||Oe["Enclosed Alphanumerics"](i)||Oe["Geometric Shapes"](i)||Oe["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Oe["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Oe["CJK Symbols and Punctuation"](i)||Oe.Katakana(i)||Oe["Private Use Area"](i)||Oe["CJK Compatibility Forms"](i)||Oe["Small Form Variants"](i)||Oe["Halfwidth and Fullwidth Forms"](i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i}function eu(s){return s>=1424&&s<=2303||Oe["Arabic Presentation Forms-A"](s)||Oe["Arabic Presentation Forms-B"](s)}function tu(s,i){return!(!i&&eu(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Oe.Khmer(s))}function uc(s){for(const i of s)if(eu(i.charCodeAt(0)))return!0;return!1}const nu="deferred",ru="loading",Tn="loaded";let Ge=null,at="unavailable",en=null;const Qr=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(at="error"),Ge&&Ge(s)};function qs(){Kn.fire(new ts("pluginStateChange",{pluginStatus:at,pluginURL:en}))}const Kn=new va,hs=function(){return at},Vn=function(){if(at!==nu||!en)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");at=ru,qs(),en&&Ja({url:en},s=>{s?Qr(s):(at=Tn,qs())})},Qn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>at===Tn||null!=Qn.applyArabicShaping,isLoading:()=>at===ru,setState(s){if(!ir())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");at=s.pluginStatus,en=s.pluginURL},isParsed(){if(!ir())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return null!=Qn.applyArabicShaping&&null!=Qn.processBidirectionalText&&null!=Qn.processStyledBidirectionalText},getPluginURL(){if(!ir())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return en}};class tn{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Lr,this.transition={})}isSupportedScript(i){return function(l,h){for(const f of l)if(!tu(f.charCodeAt(0),h))return!1;return!0}(i,Qn.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),h=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*l}}}class vt{constructor(i,l){this.property=i,this.value=l,this.expression=function(h,f){if(bn(h))return new pl(h,f);if(oc(h)){const _=ss(h,f);if("error"===_.result)throw new Error(_.value.map(x=>`${x.key}: ${x.message}`).join(", "));return _.value}{let _=h;return"color"===f.type&&"string"==typeof h?_=Ht.parse(h):"padding"!==f.type||"number"!=typeof h&&!Array.isArray(h)?"variableAnchorOffsetCollection"===f.type&&Array.isArray(h)&&(_=Mi.parse(h)):_=_i.parse(h),{kind:"constant",evaluate:()=>_}}}(void 0===l?i.specification.default:l,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,l,h){return this.property.possiblyEvaluate(this,i,l,h)}}class Gs{constructor(i){this.property=i,this.value=new vt(i,void 0)}transitioned(i,l){return new Zs(this.property,this.value,l,vr({},i.transition,this.transition),i.now)}untransitioned(){return new Zs(this.property,this.value,null,{},0)}}class iu{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return ai(this._values[i].value.value)}setValue(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Gs(this._values[i].property)),this._values[i].value=new vt(this._values[i].property,null===l?void 0:ai(l))}getTransition(i){return ai(this._values[i].transition)}setTransition(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Gs(this._values[i].property)),this._values[i].transition=ai(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(i[l]=h);const f=this.getTransition(l);void 0!==f&&(i[`${l}-transition`]=f)}return i}transitioned(i,l){const h=new jn(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].transitioned(i,l._values[f]);return h}untransitioned(){const i=new jn(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class Zs{constructor(i,l,h,f,_){this.property=i,this.value=l,this.begin=_+f.delay||0,this.end=this.begin+f.duration||0,i.specification.transition&&(f.delay||f.duration)&&(this.prior=h)}possiblyEvaluate(i,l,h){const f=i.now||0,_=this.value.possiblyEvaluate(i,l,h),x=this.prior;if(x){if(f>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(f<this.begin)return x.possiblyEvaluate(i,l,h);{const C=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(i,l,h),_,function(I){if(I<=0)return 0;if(I>=1)return 1;const T=I*I,P=T*I;return 4*(I<.5?P:3*(I-T)+P-.75)}(C))}}return _}}class jn{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,h){const f=new wi(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(i,l,h);return f}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class _l{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return void 0!==this._values[i].value}getValue(i){return ai(this._values[i].value)}setValue(i,l){this._values[i]=new vt(this._values[i].property,null===l?void 0:ai(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(i[l]=h)}return i}possiblyEvaluate(i,l,h){const f=new wi(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(i,l,h);return f}}class Jn{constructor(i,l,h){this.property=i,this.value=l,this.parameters=h}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,l,h,f){return this.property.evaluate(this.value,this.parameters,i,l,h,f)}}class wi{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Ke{constructor(i){this.specification=i}possiblyEvaluate(i,l){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(l)}interpolate(i,l,h){const f=Ti[this.specification.type];return f?f(i,l,h):i}}class rt{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,h,f){return new Jn(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(l,null,{},h,f)}:i.expression,l)}interpolate(i,l,h){if("constant"!==i.value.kind||"constant"!==l.value.kind)return i;if(void 0===i.value.value||void 0===l.value.value)return new Jn(this,{kind:"constant",value:void 0},i.parameters);const f=Ti[this.specification.type];if(f){const _=f(i.value.value,l.value.value,h);return new Jn(this,{kind:"constant",value:_},i.parameters)}return i}evaluate(i,l,h,f,_,x){return"constant"===i.kind?i.value:i.evaluate(l,h,f,_,x)}}class Fi extends rt{possiblyEvaluate(i,l,h,f){if(void 0===i.value)return new Jn(this,{kind:"constant",value:void 0},l);if("constant"===i.expression.kind){const _=i.expression.evaluate(l,null,{},h,f),x="resolvedImage"===i.property.specification.type&&"string"!=typeof _?_.name:_,C=this._calculate(x,x,x,l);return new Jn(this,{kind:"constant",value:C},l)}if("camera"===i.expression.kind){const _=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new Jn(this,{kind:"constant",value:_},l)}return new Jn(this,i.expression,l)}evaluate(i,l,h,f,_,x){if("source"===i.kind){const C=i.evaluate(l,h,f,_,x);return this._calculate(C,C,C,l)}return"composite"===i.kind?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},h,f),i.evaluate({zoom:Math.floor(l.zoom)},h,f),i.evaluate({zoom:Math.floor(l.zoom)+1},h,f),l):i.value}_calculate(i,l,h,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:h,to:l}}interpolate(i){return i}}class Qi{constructor(i){this.specification=i}possiblyEvaluate(i,l,h,f){if(void 0!==i.value){if("constant"===i.expression.kind){const _=i.expression.evaluate(l,null,{},h,f);return this._calculate(_,_,_,l)}return this._calculate(i.expression.evaluate(new tn(Math.floor(l.zoom-1),l)),i.expression.evaluate(new tn(Math.floor(l.zoom),l)),i.expression.evaluate(new tn(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,h,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:h,to:l}}interpolate(i){return i}}class Ws{constructor(i){this.specification=i}possiblyEvaluate(i,l,h,f){return!!i.expression.evaluate(l,null,{},h,f)}interpolate(){return!1}}class Cn{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in i){const h=i[l];h.specification.overridable&&this.overridableProperties.push(l);const f=this.defaultPropertyValues[l]=new vt(h,void 0),_=this.defaultTransitionablePropertyValues[l]=new Gs(h);this.defaultTransitioningPropertyValues[l]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=f.possiblyEvaluate({})}}}qe("DataDrivenProperty",rt),qe("DataConstantProperty",Ke),qe("CrossFadedDataDrivenProperty",Fi),qe("CrossFadedProperty",Qi),qe("ColorRampProperty",Ws);const Ft="-transition";class Ji extends va{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new _l(l.layout)),l.paint)){this._transitionablePaint=new iu(l.paint);for(const h in i.paint)this.setPaintProperty(h,i.paint[h],{validate:!1});for(const h in i.layout)this.setLayoutProperty(h,i.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wi(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,h={}){null!=l&&this._validate(oh,`layers.${this.id}.layout.${i}`,i,l,h)||("visibility"!==i?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return i.endsWith(Ft)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,h={}){if(null!=l&&this._validate(Jc,`layers.${this.id}.paint.${i}`,i,l,h))return!1;if(i.endsWith(Ft))return this._transitionablePaint.setTransition(i.slice(0,-11),l||void 0),!1;{const f=this._transitionablePaint._values[i],_="cross-faded-data-driven"===f.property.specification["property-type"],x=f.value.isDataDriven(),C=f.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const I=this._transitionablePaint._values[i].value;return I.isDataDriven()||x||_||this._handleOverridablePaintPropertyUpdate(i,C,I)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,l,h){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),uo(i,(l,h)=>!(void 0===l||"layout"===h&&!Object.keys(l).length||"paint"===h&&!Object.keys(l).length))}_validate(i,l,h,f,_={}){return(!_||!1!==_.validate)&&ls(this,i.call(go,{key:l,layerType:this.type,objectKey:h,value:f,styleSpec:_e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof Jn&&os(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}}const hc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ds{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Yt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function pn(s,i=1){let l=0,h=0;return{members:s.map(f=>{const _=hc[f.type].BYTES_PER_ELEMENT,x=l=eo(l,Math.max(i,_)),C=f.components||1;return h=Math.max(h,_),l+=_*C,{name:f.name,type:f.type,components:C,offset:x}}),size:eo(l,Math.max(h,i)),alignment:i}}function eo(s,i){return Math.ceil(s/i)*i}class Vo extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const f=2*i;return this.int16[f+0]=l,this.int16[f+1]=h,i}}Vo.prototype.bytesPerElement=4,qe("StructArrayLayout2i4",Vo);class qn extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,h)}emplace(i,l,h,f){const _=3*i;return this.int16[_+0]=l,this.int16[_+1]=h,this.int16[_+2]=f,i}}qn.prototype.bytesPerElement=6,qe("StructArrayLayout3i6",qn);class Ra extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,i,l,h,f)}emplace(i,l,h,f,_){const x=4*i;return this.int16[x+0]=l,this.int16[x+1]=h,this.int16[x+2]=f,this.int16[x+3]=_,i}}Ra.prototype.bytesPerElement=8,qe("StructArrayLayout4i8",Ra);class Fr extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,f,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,i,l,h,f,_,x)}emplace(i,l,h,f,_,x,C){const I=6*i;return this.int16[I+0]=l,this.int16[I+1]=h,this.int16[I+2]=f,this.int16[I+3]=_,this.int16[I+4]=x,this.int16[I+5]=C,i}}Fr.prototype.bytesPerElement=12,qe("StructArrayLayout2i4i12",Fr);class Sr extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,f,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,i,l,h,f,_,x)}emplace(i,l,h,f,_,x,C){const I=4*i,T=8*i;return this.int16[I+0]=l,this.int16[I+1]=h,this.uint8[T+4]=f,this.uint8[T+5]=_,this.uint8[T+6]=x,this.uint8[T+7]=C,i}}Sr.prototype.bytesPerElement=8,qe("StructArrayLayout2i4ub8",Sr);class ps extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const f=2*i;return this.float32[f+0]=l,this.float32[f+1]=h,i}}ps.prototype.bytesPerElement=8,qe("StructArrayLayout2f8",ps);class jo extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,f,_,x,C,I,T,P){const L=this.length;return this.resize(L+1),this.emplace(L,i,l,h,f,_,x,C,I,T,P)}emplace(i,l,h,f,_,x,C,I,T,P,L){const N=10*i;return this.uint16[N+0]=l,this.uint16[N+1]=h,this.uint16[N+2]=f,this.uint16[N+3]=_,this.uint16[N+4]=x,this.uint16[N+5]=C,this.uint16[N+6]=I,this.uint16[N+7]=T,this.uint16[N+8]=P,this.uint16[N+9]=L,i}}jo.prototype.bytesPerElement=20,qe("StructArrayLayout10ui20",jo);class Oa extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,f,_,x,C,I,T,P,L,N){const j=this.length;return this.resize(j+1),this.emplace(j,i,l,h,f,_,x,C,I,T,P,L,N)}emplace(i,l,h,f,_,x,C,I,T,P,L,N,j){const $=12*i;return this.int16[$+0]=l,this.int16[$+1]=h,this.int16[$+2]=f,this.int16[$+3]=_,this.uint16[$+4]=x,this.uint16[$+5]=C,this.uint16[$+6]=I,this.uint16[$+7]=T,this.int16[$+8]=P,this.int16[$+9]=L,this.int16[$+10]=N,this.int16[$+11]=j,i}}Oa.prototype.bytesPerElement=24,qe("StructArrayLayout4i4ui4i24",Oa);class Mt extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,h)}emplace(i,l,h,f){const _=3*i;return this.float32[_+0]=l,this.float32[_+1]=h,this.float32[_+2]=f,i}}Mt.prototype.bytesPerElement=12,qe("StructArrayLayout3f12",Mt);class y extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}y.prototype.bytesPerElement=4,qe("StructArrayLayout1ul4",y);class o extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h,f,_,x,C,I,T){const P=this.length;return this.resize(P+1),this.emplace(P,i,l,h,f,_,x,C,I,T)}emplace(i,l,h,f,_,x,C,I,T,P){const L=10*i,N=5*i;return this.int16[L+0]=l,this.int16[L+1]=h,this.int16[L+2]=f,this.int16[L+3]=_,this.int16[L+4]=x,this.int16[L+5]=C,this.uint32[N+3]=I,this.uint16[L+8]=T,this.uint16[L+9]=P,i}}o.prototype.bytesPerElement=20,qe("StructArrayLayout6i1ul2ui20",o);class c extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,f,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,i,l,h,f,_,x)}emplace(i,l,h,f,_,x,C){const I=6*i;return this.int16[I+0]=l,this.int16[I+1]=h,this.int16[I+2]=f,this.int16[I+3]=_,this.int16[I+4]=x,this.int16[I+5]=C,i}}c.prototype.bytesPerElement=12,qe("StructArrayLayout2i2i2i12",c);class d extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,h,f,_){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,h,f,_)}emplace(i,l,h,f,_,x){const C=4*i,I=8*i;return this.float32[C+0]=l,this.float32[C+1]=h,this.float32[C+2]=f,this.int16[I+6]=_,this.int16[I+7]=x,i}}d.prototype.bytesPerElement=16,qe("StructArrayLayout2f1f2i16",d);class m extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,i,l,h,f)}emplace(i,l,h,f,_){const x=12*i,C=3*i;return this.uint8[x+0]=l,this.uint8[x+1]=h,this.float32[C+1]=f,this.float32[C+2]=_,i}}m.prototype.bytesPerElement=12,qe("StructArrayLayout2ub2f12",m);class v extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,h)}emplace(i,l,h,f){const _=3*i;return this.uint16[_+0]=l,this.uint16[_+1]=h,this.uint16[_+2]=f,i}}v.prototype.bytesPerElement=6,qe("StructArrayLayout3ui6",v);class D extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,f,_,x,C,I,T,P,L,N,j,$,q,Q,te){const ae=this.length;return this.resize(ae+1),this.emplace(ae,i,l,h,f,_,x,C,I,T,P,L,N,j,$,q,Q,te)}emplace(i,l,h,f,_,x,C,I,T,P,L,N,j,$,q,Q,te,ae){const ie=24*i,he=12*i,fe=48*i;return this.int16[ie+0]=l,this.int16[ie+1]=h,this.uint16[ie+2]=f,this.uint16[ie+3]=_,this.uint32[he+2]=x,this.uint32[he+3]=C,this.uint32[he+4]=I,this.uint16[ie+10]=T,this.uint16[ie+11]=P,this.uint16[ie+12]=L,this.float32[he+7]=N,this.float32[he+8]=j,this.uint8[fe+36]=$,this.uint8[fe+37]=q,this.uint8[fe+38]=Q,this.uint32[he+10]=te,this.int16[ie+22]=ae,i}}D.prototype.bytesPerElement=48,qe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",D);class S extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,f,_,x,C,I,T,P,L,N,j,$,q,Q,te,ae,ie,he,fe,De,Ue,Xe,je,Ne,Le,He){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,i,l,h,f,_,x,C,I,T,P,L,N,j,$,q,Q,te,ae,ie,he,fe,De,Ue,Xe,je,Ne,Le,He)}emplace(i,l,h,f,_,x,C,I,T,P,L,N,j,$,q,Q,te,ae,ie,he,fe,De,Ue,Xe,je,Ne,Le,He,Fe){const Te=32*i,et=16*i;return this.int16[Te+0]=l,this.int16[Te+1]=h,this.int16[Te+2]=f,this.int16[Te+3]=_,this.int16[Te+4]=x,this.int16[Te+5]=C,this.int16[Te+6]=I,this.int16[Te+7]=T,this.uint16[Te+8]=P,this.uint16[Te+9]=L,this.uint16[Te+10]=N,this.uint16[Te+11]=j,this.uint16[Te+12]=$,this.uint16[Te+13]=q,this.uint16[Te+14]=Q,this.uint16[Te+15]=te,this.uint16[Te+16]=ae,this.uint16[Te+17]=ie,this.uint16[Te+18]=he,this.uint16[Te+19]=fe,this.uint16[Te+20]=De,this.uint16[Te+21]=Ue,this.uint16[Te+22]=Xe,this.uint32[et+12]=je,this.float32[et+13]=Ne,this.float32[et+14]=Le,this.uint16[Te+30]=He,this.uint16[Te+31]=Fe,i}}S.prototype.bytesPerElement=64,qe("StructArrayLayout8i15ui1ul2f2ui64",S);class E extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}E.prototype.bytesPerElement=4,qe("StructArrayLayout1f4",E);class A extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,h)}emplace(i,l,h,f){const _=3*i;return this.uint16[6*i+0]=l,this.float32[_+1]=h,this.float32[_+2]=f,i}}A.prototype.bytesPerElement=12,qe("StructArrayLayout1ui2f12",A);class k extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,i,l,h)}emplace(i,l,h,f){const _=4*i;return this.uint32[2*i+0]=l,this.uint16[_+2]=h,this.uint16[_+3]=f,i}}k.prototype.bytesPerElement=8,qe("StructArrayLayout1ul2ui8",k);class O extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const h=this.length;return this.resize(h+1),this.emplace(h,i,l)}emplace(i,l,h){const f=2*i;return this.uint16[f+0]=l,this.uint16[f+1]=h,i}}O.prototype.bytesPerElement=4,qe("StructArrayLayout2ui4",O);class V extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}V.prototype.bytesPerElement=2,qe("StructArrayLayout1ui2",V);class Z extends Yt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,i,l,h,f)}emplace(i,l,h,f,_){const x=4*i;return this.float32[x+0]=l,this.float32[x+1]=h,this.float32[x+2]=f,this.float32[x+3]=_,i}}Z.prototype.bytesPerElement=16,qe("StructArrayLayout4f16",Z);class G extends ds{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new tt(this.anchorPointX,this.anchorPointY)}}G.prototype.size=20;class Y extends o{get(i){return new G(this,i)}}qe("CollisionBoxArray",Y);class H extends ds{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}H.prototype.size=48;class se extends D{get(i){return new H(this,i)}}qe("PlacedSymbolArray",se);class de extends ds{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}de.prototype.size=64;class ee extends S{get(i){return new de(this,i)}}qe("SymbolInstanceArray",ee);class ce extends E{getoffsetX(i){return this.float32[1*i+0]}}qe("GlyphOffsetArray",ce);class me extends qn{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}qe("SymbolLineVertexArray",me);class ge extends ds{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ge.prototype.size=12;class be extends A{get(i){return new ge(this,i)}}qe("TextAnchorOffsetArray",be);class Ee extends ds{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ee.prototype.size=8;class Ie extends k{get(i){return new Ee(this,i)}}qe("FeatureIndexArray",Ie);class Re extends Vo{}class $e extends Vo{}class Tt extends Vo{}class ke extends Fr{}class it extends Sr{}class Qe extends ps{}class nn extends jo{}class At extends Oa{}class bt extends Mt{}class kt extends y{}class An extends c{}class un extends m{}class pr extends v{}class er extends O{}const $n=pn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Nr}=$n;class on{constructor(i=[]){this.segments=i}prepareSegment(i,l,h,f){let _=this.segments[this.segments.length-1];return i>on.MAX_VERTEX_ARRAY_LENGTH&&xr(`Max vertices per segment is ${on.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!_||_.vertexLength+i>on.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==f)&&(_={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},void 0!==f&&(_.sortKey=f),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,h,f){return new on([{vertexOffset:i,primitiveOffset:l,vertexLength:h,primitiveLength:f,vaos:{},sortKey:0}])}}function Jr(s,i){return 256*(s=co(Math.floor(s),0,255))+co(Math.floor(i),0,255)}on.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qe("SegmentVector",on);const to=pn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Xs={exports:{}},Ir=function(s,i){var l,h,f,_,x,C,I,T;for(h=s.length-(l=3&s.length),f=i,x=3432918353,C=461845907,T=0;T<h;)I=255&s.charCodeAt(T)|(255&s.charCodeAt(++T))<<8|(255&s.charCodeAt(++T))<<16|(255&s.charCodeAt(++T))<<24,++T,f=27492+(65535&(_=5*(65535&(f=(f^=I=(65535&(I=(I=(65535&I)*x+(((I>>>16)*x&65535)<<16)&4294967295)<<15|I>>>17))*C+(((I>>>16)*C&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(I=0,l){case 3:I^=(255&s.charCodeAt(T+2))<<16;case 2:I^=(255&s.charCodeAt(T+1))<<8;case 1:f^=I=(65535&(I=(I=(65535&(I^=255&s.charCodeAt(T)))*x+(((I>>>16)*x&65535)<<16)&4294967295)<<15|I>>>17))*C+(((I>>>16)*C&65535)<<16)&4294967295}return f^=s.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0},ui=function(s,i){for(var l,h=s.length,f=i^h,_=0;h>=4;)l=1540483477*(65535&(l=255&s.charCodeAt(_)|(255&s.charCodeAt(++_))<<8|(255&s.charCodeAt(++_))<<16|(255&s.charCodeAt(++_))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:f^=(255&s.charCodeAt(_+2))<<16;case 2:f^=(255&s.charCodeAt(_+1))<<8;case 1:f=1540483477*(65535&(f^=255&s.charCodeAt(_)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};Xs.exports=Ir,Xs.exports.murmur3=Ir,Xs.exports.murmur2=ui;var fs=ye(Xs.exports);class Pn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,h,f){this.ids.push(sr(i)),this.positions.push(l,h,f)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=sr(i);let h=0,f=this.ids.length-1;for(;h<f;){const x=h+f>>1;this.ids[x]>=l?f=x:h=x+1}const _=[];for(;this.ids[h]===l;)_.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return _}static serialize(i,l){const h=new Float64Array(i.ids),f=new Uint32Array(i.positions);return Br(h,f,0,h.length-1),l&&l.push(h.buffer,f.buffer),{ids:h,positions:f}}static deserialize(i){const l=new Pn;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function sr(s){const i=+s;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:fs(String(s))}function Br(s,i,l,h){for(;l<h;){const f=s[l+h>>1];let _=l-1,x=h+1;for(;;){do{_++}while(s[_]<f);do{x--}while(s[x]>f);if(_>=x)break;Gn(s,_,x),Gn(i,3*_,3*x),Gn(i,3*_+1,3*x+1),Gn(i,3*_+2,3*x+2)}x-l<h-x?(Br(s,i,l,x),l=x+1):(Br(s,i,x+1,h),h=x)}}function Gn(s,i,l){const h=s[i];s[i]=s[l],s[l]=h}qe("FeaturePositionMap",Pn);class Fa{constructor(i,l){this.gl=i.gl,this.location=l}}class dc extends Fa{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class ou extends Fa{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class su extends Fa{constructor(i,l){super(i,l),this.current=Ht.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Fd=new Float32Array(16);function au(s){return[Jr(255*s.r,255*s.g),Jr(255*s.b,255*s.a)]}class yo{constructor(i,l,h){this.value=i,this.uniformNames=l.map(f=>`u_${f}`),this.type=h}setUniform(i,l,h){i.set(h.constantOr(this.value))}getBinding(i,l,h){return"color"===this.type?new su(i,l):new dc(i,l)}}class ms{constructor(i,l){this.uniformNames=l.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=i.tlbr}setUniform(i,l,h,f){const _="u_pattern_to"===f?this.patternTo:"u_pattern_from"===f?this.patternFrom:"u_pixel_ratio_to"===f?this.pixelRatioTo:"u_pixel_ratio_from"===f?this.pixelRatioFrom:null;_&&i.set(_)}getBinding(i,l,h){return"u_pattern"===h.substr(0,9)?new ou(i,l):new dc(i,l)}}class _o{constructor(i,l,h,f){this.expression=i,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(_=>({name:`a_${_}`,type:"Float32",components:"color"===h?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(i,l,h,f,_){const x=this.paintVertexArray.length,C=this.expression.evaluate(new tn(0),l,{},f,[],_);this.paintVertexArray.resize(i),this._setPaintValue(x,i,C)}updatePaintArray(i,l,h,f){const _=this.expression.evaluate({zoom:0},h,f);this._setPaintValue(i,l,_)}_setPaintValue(i,l,h){if("color"===this.type){const f=au(h);for(let _=i;_<l;_++)this.paintVertexArray.emplace(_,f[0],f[1])}else{for(let f=i;f<l;f++)this.paintVertexArray.emplace(f,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ci{constructor(i,l,h,f,_,x){this.expression=i,this.uniformNames=l.map(C=>`u_${C}_t`),this.type=h,this.useIntegerZoom=f,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=l.map(C=>({name:`a_${C}`,type:"Float32",components:"color"===h?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(i,l,h,f,_){const x=this.expression.evaluate(new tn(this.zoom),l,{},f,[],_),C=this.expression.evaluate(new tn(this.zoom+1),l,{},f,[],_),I=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(I,i,x,C)}updatePaintArray(i,l,h,f){const _=this.expression.evaluate({zoom:this.zoom},h,f),x=this.expression.evaluate({zoom:this.zoom+1},h,f);this._setPaintValue(i,l,_,x)}_setPaintValue(i,l,h,f){if("color"===this.type){const _=au(h),x=au(f);for(let C=i;C<l;C++)this.paintVertexArray.emplace(C,_[0],_[1],x[0],x[1])}else{for(let _=i;_<l;_++)this.paintVertexArray.emplace(_,h,f);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const h=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,f=co(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);i.set(f)}getBinding(i,l,h){return new dc(i,l)}}class vo{constructor(i,l,h,f,_,x){this.expression=i,this.type=l,this.useIntegerZoom=h,this.zoom=f,this.layerId=x,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(i,l,h){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(f,i,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(i,l,h,f,_){this._setPaintValues(i,l,h.patterns&&h.patterns[this.layerId],_)}_setPaintValues(i,l,h,f){if(!f||!h)return;const{min:_,mid:x,max:C}=h,I=f[_],T=f[x],P=f[C];if(I&&T&&P)for(let L=i;L<l;L++)this.zoomInPaintVertexArray.emplace(L,T.tl[0],T.tl[1],T.br[0],T.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],T.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,T.tl[0],T.tl[1],T.br[0],T.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],T.pixelRatio,P.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,to.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,to.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class sh{constructor(i,l,h){this.binders={},this._buffers=[];const f=[];for(const _ in i.paint._values){if(!h(_))continue;const x=i.paint.get(_);if(!(x instanceof Jn&&os(x.property.specification)))continue;const C=Na(_,i.type),I=x.value,T=x.property.specification.type,P=x.property.useIntegerZoom,L=x.property.specification["property-type"],N="cross-faded"===L||"cross-faded-data-driven"===L;if("constant"===I.kind)this.binders[_]=N?new ms(I.value,C):new yo(I.value,C,T),f.push(`/u_${_}`);else if("source"===I.kind||N){const j=Nd(_,T,"source");this.binders[_]=N?new vo(I,T,P,l,j,i.id):new _o(I,C,T,j),f.push(`/a_${_}`)}else{const j=Nd(_,T,"composite");this.binders[_]=new Ci(I,C,T,P,l,j),f.push(`/z_${_}`)}}this.cacheKey=f.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof _o||l instanceof Ci?l.maxValue:0}populatePaintArrays(i,l,h,f,_){for(const x in this.binders){const C=this.binders[x];(C instanceof _o||C instanceof Ci||C instanceof vo)&&C.populatePaintArray(i,l,h,f,_)}}setConstantPatternPositions(i,l){for(const h in this.binders){const f=this.binders[h];f instanceof ms&&f.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,h,f,_){let x=!1;for(const C in i){const I=l.getPositions(C);for(const T of I){const P=h.feature(T.index);for(const L in this.binders){const N=this.binders[L];if((N instanceof _o||N instanceof Ci||N instanceof vo)&&!0===N.expression.isStateDependent){const j=f.paint.get(L);N.expression=j.value,N.updatePaintArray(T.start,T.end,P,i[C],_),x=!0}}}}return x}defines(){const i=[];for(const l in this.binders){const h=this.binders[l];(h instanceof yo||h instanceof ms)&&i.push(...h.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof _o||h instanceof Ci)for(let f=0;f<h.paintVertexAttributes.length;f++)i.push(h.paintVertexAttributes[f].name);else if(h instanceof vo)for(let f=0;f<to.members.length;f++)i.push(to.members[f].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof yo||h instanceof ms||h instanceof Ci)for(const f of h.uniformNames)i.push(f)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const h=[];for(const f in this.binders){const _=this.binders[f];if(_ instanceof yo||_ instanceof ms||_ instanceof Ci)for(const x of _.uniformNames)if(l[x]){const C=_.getBinding(i,l[x],x);h.push({name:x,property:f,binding:C})}}return h}setUniforms(i,l,h,f){for(const{name:_,property:x,binding:C}of l)this.binders[x].setUniform(C,f,h.get(x),_)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const h=this.binders[l];if(i&&h instanceof vo){const f=2===i.fromScale?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(h instanceof _o||h instanceof Ci)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(i){for(const l in this.binders){const h=this.binders[l];(h instanceof _o||h instanceof Ci||h instanceof vo)&&h.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof _o||l instanceof Ci||l instanceof vo)&&l.destroy()}}}class $o{constructor(i,l,h=(()=>!0)){this.programConfigurations={};for(const f of i)this.programConfigurations[f.id]=new sh(f,l,h);this.needsUpload=!1,this._featureMap=new Pn,this._bufferOffset=0}populatePaintArrays(i,l,h,f,_,x){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(i,l,f,_,x);void 0!==l.id&&this._featureMap.add(l.id,h,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,h,f){for(const _ of h)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(i,this._featureMap,l,_,f)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function Na(s,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}function Nd(s,i,l){const f={"line-pattern":{source:nn,composite:nn},"fill-pattern":{source:nn,composite:nn},"fill-extrusion-pattern":{source:nn,composite:nn}}[s];return f&&f[l]||{color:{source:ps,composite:Z},number:{source:E,composite:ps}}[i][l]}qe("ConstantBinder",yo),qe("CrossFadedConstantBinder",ms),qe("SourceExpressionBinder",_o),qe("CrossFadedCompositeBinder",vo),qe("CompositeExpressionBinder",Ci),qe("ProgramConfiguration",sh,{omit:["_buffers"]}),qe("ProgramConfigurationSet",$o);const tr=8192,zd=Math.pow(2,14)-1,Bd=-zd-1;function za(s){const i=tr/s.extent,l=s.loadGeometry();for(let h=0;h<l.length;h++){const f=l[h];for(let _=0;_<f.length;_++){const x=f[_],C=Math.round(x.x*i),I=Math.round(x.y*i);x.x=co(C,Bd,zd),x.y=co(I,Bd,zd),(C<x.x||C>x.x+1||I<x.y||I>x.y+1)&&xr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function xl(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?za(s):[]}}function pc(s,i,l,h,f){s.emplaceBack(2*i+(h+1)/2,2*l+(f+1)/2)}class Vd{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new $e,this.indexArray=new pr,this.segments=new on,this.programConfigurations=new $o(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){const f=this.layers[0],_=[];let x=null,C=!1;"circle"===f.type&&(x=f.layout.get("circle-sort-key"),C=!x.isConstant());for(const{feature:I,id:T,index:P,sourceLayerIndex:L}of i){const N=this.layers[0]._featureFilter.needGeometry,j=xl(I,N);if(!this.layers[0]._featureFilter.filter(new tn(this.zoom),j,h))continue;const $=C?x.evaluate(j,{},h):void 0,q={id:T,properties:I.properties,type:I.type,sourceLayerIndex:L,index:P,geometry:N?j.geometry:za(I),patterns:{},sortKey:$};_.push(q)}C&&_.sort((I,T)=>I.sortKey-T.sortKey);for(const I of _){const{geometry:T,index:P,sourceLayerIndex:L}=I,N=i[P].feature;this.addFeature(I,T,P,h),l.featureIndex.insert(N,T,P,L,this.index)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Nr),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,h,f){for(const _ of l)for(const x of _){const C=x.x,I=x.y;if(C<0||C>=tr||I<0||I>=tr)continue;const T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),P=T.vertexLength;pc(this.layoutVertexArray,C,I,-1,-1),pc(this.layoutVertexArray,C,I,1,-1),pc(this.layoutVertexArray,C,I,1,1),pc(this.layoutVertexArray,C,I,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,{},f)}}function Uo(s,i){for(let l=0;l<s.length;l++)if(Ho(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(Ho(s,i[l]))return!0;return!!lu(s,i)}function kf(s,i,l){return!!Ho(s,i)||!!hi(i,s,l)}function jd(s,i){if(1===s.length)return $d(i,s[0]);for(let l=0;l<i.length;l++){const h=i[l];for(let f=0;f<h.length;f++)if(Ho(s,h[f]))return!0}for(let l=0;l<s.length;l++)if($d(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(lu(s,i[l]))return!0;return!1}function kn(s,i,l){if(s.length>1){if(lu(s,i))return!0;for(let h=0;h<i.length;h++)if(hi(i[h],s,l))return!0}for(let h=0;h<s.length;h++)if(hi(s[h],i,l))return!0;return!1}function lu(s,i){if(0===s.length||0===i.length)return!1;for(let l=0;l<s.length-1;l++){const h=s[l],f=s[l+1];for(let _=0;_<i.length-1;_++)if(ah(h,f,i[_],i[_+1]))return!0}return!1}function ah(s,i,l,h){return gi(s,l,h)!==gi(i,l,h)&&gi(s,i,l)!==gi(s,i,h)}function hi(s,i,l){const h=l*l;if(1===i.length)return s.distSqr(i[0])<h;for(let f=1;f<i.length;f++)if(Rf(s,i[f-1],i[f])<h)return!0;return!1}function Rf(s,i,l){const h=i.distSqr(l);if(0===h)return s.distSqr(i);const f=((s.x-i.x)*(l.x-i.x)+(s.y-i.y)*(l.y-i.y))/h;return s.distSqr(f<0?i:f>1?l:l.sub(i)._mult(f)._add(i))}function $d(s,i){let l,h,f,_=!1;for(let x=0;x<s.length;x++){l=s[x];for(let C=0,I=l.length-1;C<l.length;I=C++)h=l[C],f=l[I],h.y>i.y!=f.y>i.y&&i.x<(f.x-h.x)*(i.y-h.y)/(f.y-h.y)+h.x&&(_=!_)}return _}function Ho(s,i){let l=!1;for(let h=0,f=s.length-1;h<s.length;f=h++){const _=s[h],x=s[f];_.y>i.y!=x.y>i.y&&i.x<(x.x-_.x)*(i.y-_.y)/(x.y-_.y)+_.x&&(l=!l)}return l}function no(s,i,l){const h=l[0],f=l[2];if(s.x<h.x&&i.x<h.x||s.x>f.x&&i.x>f.x||s.y<h.y&&i.y<h.y||s.y>f.y&&i.y>f.y)return!1;const _=gi(s,i,l[0]);return _!==gi(s,i,l[1])||_!==gi(s,i,l[2])||_!==gi(s,i,l[3])}function cu(s,i,l){const h=i.paint.get(s).value;return"constant"===h.kind?h.value:l.programConfigurations.get(i.id).getMaxValue(s)}function lh(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function ch(s,i,l,h,f){if(!i[0]&&!i[1])return s;const _=tt.convert(i)._mult(f);"viewport"===l&&_._rotate(-h);const x=[];for(let C=0;C<s.length;C++)x.push(s[C].sub(_));return x}let Ys,Ud;qe("CircleBucket",Vd,{omit:["layers"]});var Qg={get paint(){return Ud=Ud||new Cn({"circle-radius":new rt(_e.paint_circle["circle-radius"]),"circle-color":new rt(_e.paint_circle["circle-color"]),"circle-blur":new rt(_e.paint_circle["circle-blur"]),"circle-opacity":new rt(_e.paint_circle["circle-opacity"]),"circle-translate":new Ke(_e.paint_circle["circle-translate"]),"circle-translate-anchor":new Ke(_e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ke(_e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ke(_e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new rt(_e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new rt(_e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new rt(_e.paint_circle["circle-stroke-opacity"])})},get layout(){return Ys=Ys||new Cn({"circle-sort-key":new rt(_e.layout_circle["circle-sort-key"])})}},ei=1e-6,bl=typeof Float32Array<"u"?Float32Array:Array;function uh(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Of(s,i,l){var h=i[0],f=i[1],_=i[2],x=i[3],C=i[4],I=i[5],T=i[6],P=i[7],L=i[8],N=i[9],j=i[10],$=i[11],q=i[12],Q=i[13],te=i[14],ae=i[15],ie=l[0],he=l[1],fe=l[2],De=l[3];return s[0]=ie*h+he*C+fe*L+De*q,s[1]=ie*f+he*I+fe*N+De*Q,s[2]=ie*_+he*T+fe*j+De*te,s[3]=ie*x+he*P+fe*$+De*ae,s[4]=(ie=l[4])*h+(he=l[5])*C+(fe=l[6])*L+(De=l[7])*q,s[5]=ie*f+he*I+fe*N+De*Q,s[6]=ie*_+he*T+fe*j+De*te,s[7]=ie*x+he*P+fe*$+De*ae,s[8]=(ie=l[8])*h+(he=l[9])*C+(fe=l[10])*L+(De=l[11])*q,s[9]=ie*f+he*I+fe*N+De*Q,s[10]=ie*_+he*T+fe*j+De*te,s[11]=ie*x+he*P+fe*$+De*ae,s[12]=(ie=l[12])*h+(he=l[13])*C+(fe=l[14])*L+(De=l[15])*q,s[13]=ie*f+he*I+fe*N+De*Q,s[14]=ie*_+he*T+fe*j+De*te,s[15]=ie*x+he*P+fe*$+De*ae,s}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var pt,Lf=Of;function Hd(s,i,l){var h=i[0],f=i[1],_=i[2],x=i[3];return s[0]=l[0]*h+l[4]*f+l[8]*_+l[12]*x,s[1]=l[1]*h+l[5]*f+l[9]*_+l[13]*x,s[2]=l[2]*h+l[6]*f+l[10]*_+l[14]*x,s[3]=l[3]*h+l[7]*f+l[11]*_+l[15]*x,s}pt=new bl(4),bl!=Float32Array&&(pt[0]=0,pt[1]=0,pt[2]=0,pt[3]=0);class Jg extends Ji{constructor(i){super(i,Qg)}createBucket(i){return new Vd(i)}queryRadius(i){const l=i;return cu("circle-radius",this,l)+cu("circle-stroke-width",this,l)+lh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,l,h,f,_,x,C,I){const T=ch(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,C),P=this.paint.get("circle-radius").evaluate(l,h)+this.paint.get("circle-stroke-width").evaluate(l,h),L="map"===this.paint.get("circle-pitch-alignment"),N=L?T:(q=I,T.map(Q=>Ff(Q,q))),j=L?P*C:P;var q;for(const $ of f)for(const q of $){const Q=L?q:Ff(q,I);let te=j;const ae=Hd([],[q.x,q.y,0,1],I);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?te*=ae[3]/x.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(te*=x.cameraToCenterDistance/ae[3]),kf(N,Q,te))return!0}return!1}}function Ff(s,i){const l=Hd([],[s.x,s.y,0,1],i);return new tt(l[0]/l[3],l[1]/l[3])}class Nf extends Vd{}let qd;qe("HeatmapBucket",Nf,{omit:["layers"]});var fc={get paint(){return qd=qd||new Cn({"heatmap-radius":new rt(_e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new rt(_e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ke(_e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ws(_e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ke(_e.paint_heatmap["heatmap-opacity"])})}};function Gd(s,{width:i,height:l},h,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==i*l*h)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${i*l*h}`)}else f=new Uint8Array(i*l*h);return s.width=i,s.height=l,s.data=f,s}function zf(s,{width:i,height:l},h){if(i===s.width&&l===s.height)return;const f=Gd({},{width:i,height:l},h);Zd(s,f,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,i),height:Math.min(s.height,l)},h),s.width=i,s.height=l,s.data=f.data}function Zd(s,i,l,h,f,_){if(0===f.width||0===f.height)return i;if(f.width>s.width||f.height>s.height||l.x>s.width-f.width||l.y>s.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>i.width||f.height>i.height||h.x>i.width-f.width||h.y>i.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,C=i.data;if(x===C)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<f.height;I++){const T=((l.y+I)*s.width+l.x)*_,P=((h.y+I)*i.width+h.x)*_;for(let L=0;L<f.width*_;L++)C[P+L]=x[T+L]}return i}class uu{constructor(i,l){Gd(this,i,1,l)}resize(i){zf(this,i,1)}clone(){return new uu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,f,_){Zd(i,l,h,f,_,1)}}class ro{constructor(i,l){Gd(this,i,4,l)}resize(i){zf(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new ro({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,h,f,_){Zd(i,l,h,f,_,4)}}function Me(s){const i={},l=s.resolution||256,h=s.clips?s.clips.length:1,f=s.image||new ro({width:l,height:h});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const _=(x,C,I)=>{i[s.evaluationKey]=I;const T=s.expression.evaluate(i);f.data[x+C+0]=Math.floor(255*T.r/T.a),f.data[x+C+1]=Math.floor(255*T.g/T.a),f.data[x+C+2]=Math.floor(255*T.b/T.a),f.data[x+C+3]=Math.floor(255*T.a)};if(s.clips)for(let x=0,C=0;x<h;++x,C+=4*l)for(let I=0,T=0;I<l;I++,T+=4){const P=I/(l-1),{start:L,end:N}=s.clips[x];_(C,T,L*(1-P)+N*P)}else for(let x=0,C=0;x<l;x++,C+=4)_(0,C,x/(l-1));return f}qe("AlphaImage",uu),qe("RGBAImage",ro);class Kt extends Ji{createBucket(i){return new Nf(i)}constructor(i){super(i,fc),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"heatmap-color"===i&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Me({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let Bf;var ey={get paint(){return Bf=Bf||new Cn({"hillshade-illumination-direction":new Ke(_e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ke(_e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ke(_e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ke(_e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ke(_e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ke(_e.paint_hillshade["hillshade-accent-color"])})}};class ti extends Ji{constructor(i){super(i,ey)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}const Vf=pn([{name:"a_pos",components:2,type:"Int16"}],4),{members:hu}=Vf;var xo={exports:{}};function mc(s,i,l){l=l||2;var h,f,_,x,C,I,T,P=i&&i.length,L=P?i[0]*l:s.length,N=hh(s,0,L,l,!0),j=[];if(!N||N.next===N.prev)return j;if(P&&(N=function(q,Q,te,ae){var ie,he,fe,De=[];for(ie=0,he=Q.length;ie<he;ie++)(fe=hh(q,Q[ie]*ae,ie<he-1?Q[ie+1]*ae:q.length,ae,!1))===fe.next&&(fe.steiner=!0),De.push(ny(fe));for(De.sort(gc),ie=0;ie<De.length;ie++)te=Qs(De[ie],te);return te}(s,i,N,l)),s.length>80*l){h=_=s[0],f=x=s[1];for(var $=l;$<L;$+=l)(C=s[$])<h&&(h=C),(I=s[$+1])<f&&(f=I),C>_&&(_=C),I>x&&(x=I);T=0!==(T=Math.max(_-h,x-f))?32767/T:0}return dh(N,j,l,h,f,T,0),j}function hh(s,i,l,h,f){var _,x;if(f===fu(s,i,l,h)>0)for(_=i;_<l;_+=h)x=Yd(_,s[_],s[_+1],x);else for(_=l-h;_>=i;_-=h)x=Yd(_,s[_],s[_+1],x);return x&&du(x,x.next)&&(_c(x),x=x.next),x}function wl(s,i){if(!s)return s;i||(i=s);var l,h=s;do{if(l=!1,h.steiner||!du(h,h.next)&&0!==Nn(h.prev,h,h.next))h=h.next;else{if(_c(h),(h=i=h.prev)===h.next)break;l=!0}}while(l||h!==i);return i}function dh(s,i,l,h,f,_,x){if(s){!x&&_&&function(P,L,N,j){var $=P;do{0===$.z&&($.z=ph($.x,$.y,L,N,j)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next}while($!==P);$.prevZ.nextZ=null,$.prevZ=null,function(q){var Q,te,ae,ie,he,fe,De,Ue,Xe=1;do{for(te=q,q=null,he=null,fe=0;te;){for(fe++,ae=te,De=0,Q=0;Q<Xe&&(De++,ae=ae.nextZ);Q++);for(Ue=Xe;De>0||Ue>0&&ae;)0!==De&&(0===Ue||!ae||te.z<=ae.z)?(ie=te,te=te.nextZ,De--):(ie=ae,ae=ae.nextZ,Ue--),he?he.nextZ=ie:q=ie,ie.prevZ=he,he=ie;te=ae}he.nextZ=null,Xe*=2}while(fe>1)}($)}(s,h,f,_);for(var C,I,T=s;s.prev!==s.next;)if(C=s.prev,I=s.next,_?Di(s,h,f,_):jf(s))i.push(C.i/l|0),i.push(s.i/l|0),i.push(I.i/l|0),_c(s),s=I.next,T=I.next;else if((s=I)===T){x?1===x?dh(s=Ks(wl(s),i,l),i,l,h,f,_,2):2===x&&$f(s,i,l,h,f,_):dh(wl(s),i,l,h,f,_,1);break}}}function jf(s){var i=s.prev,l=s,h=s.next;if(Nn(i,l,h)>=0)return!1;for(var f=i.x,_=l.x,x=h.x,C=i.y,I=l.y,T=h.y,P=f<_?f<x?f:x:_<x?_:x,L=C<I?C<T?C:T:I<T?I:T,N=f>_?f>x?f:x:_>x?_:x,j=C>I?C>T?C:T:I>T?I:T,$=h.next;$!==i;){if($.x>=P&&$.x<=N&&$.y>=L&&$.y<=j&&yc(f,C,_,I,x,T,$.x,$.y)&&Nn($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function Di(s,i,l,h){var f=s.prev,_=s,x=s.next;if(Nn(f,_,x)>=0)return!1;for(var C=f.x,I=_.x,T=x.x,P=f.y,L=_.y,N=x.y,j=C<I?C<T?C:T:I<T?I:T,$=P<L?P<N?P:N:L<N?L:N,q=C>I?C>T?C:T:I>T?I:T,Q=P>L?P>N?P:N:L>N?L:N,te=ph(j,$,i,l,h),ae=ph(q,Q,i,l,h),ie=s.prevZ,he=s.nextZ;ie&&ie.z>=te&&he&&he.z<=ae;){if(ie.x>=j&&ie.x<=q&&ie.y>=$&&ie.y<=Q&&ie!==f&&ie!==x&&yc(C,P,I,L,T,N,ie.x,ie.y)&&Nn(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,he.x>=j&&he.x<=q&&he.y>=$&&he.y<=Q&&he!==f&&he!==x&&yc(C,P,I,L,T,N,he.x,he.y)&&Nn(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;ie&&ie.z>=te;){if(ie.x>=j&&ie.x<=q&&ie.y>=$&&ie.y<=Q&&ie!==f&&ie!==x&&yc(C,P,I,L,T,N,ie.x,ie.y)&&Nn(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;he&&he.z<=ae;){if(he.x>=j&&he.x<=q&&he.y>=$&&he.y<=Q&&he!==f&&he!==x&&yc(C,P,I,L,T,N,he.x,he.y)&&Nn(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function Ks(s,i,l){var h=s;do{var f=h.prev,_=h.next.next;!du(f,_)&&fh(f,h,h.next,_)&&Cl(f,_)&&Cl(_,f)&&(i.push(f.i/l|0),i.push(h.i/l|0),i.push(_.i/l|0),_c(h),_c(h.next),h=s=_),h=h.next}while(h!==s);return wl(h)}function $f(s,i,l,h,f,_){var x=s;do{for(var C=x.next.next;C!==x.prev;){if(x.i!==C.i&&Wd(x,C)){var I=Xd(x,C);return x=wl(x,x.next),I=wl(I,I.next),dh(x,i,l,h,f,_,0),void dh(I,i,l,h,f,_,0)}C=C.next}x=x.next}while(x!==s)}function gc(s,i){return s.x-i.x}function Qs(s,i){var l=function(f,_){var x,C=_,I=f.x,T=f.y,P=-1/0;do{if(T<=C.y&&T>=C.next.y&&C.next.y!==C.y){var L=C.x+(T-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(L<=I&&L>P&&(P=L,x=C.x<C.next.x?C:C.next,L===I))return x}C=C.next}while(C!==_);if(!x)return null;var N,j=x,$=x.x,q=x.y,Q=1/0;C=x;do{I>=C.x&&C.x>=$&&I!==C.x&&yc(T<q?I:P,T,$,q,T<q?P:I,T,C.x,C.y)&&(N=Math.abs(T-C.y)/(I-C.x),Cl(C,f)&&(N<Q||N===Q&&(C.x>x.x||C.x===x.x&&ty(x,C)))&&(x=C,Q=N)),C=C.next}while(C!==j);return x}(s,i);if(!l)return i;var h=Xd(l,s);return wl(h,h.next),wl(l,l.next)}function ty(s,i){return Nn(s.prev,s,i.prev)<0&&Nn(i.next,s,s.next)<0}function ph(s,i,l,h,f){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-l)*f|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-h)*f|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function ny(s){var i=s,l=s;do{(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next}while(i!==s);return l}function yc(s,i,l,h,f,_,x,C){return(f-x)*(i-C)>=(s-x)*(_-C)&&(s-x)*(h-C)>=(l-x)*(i-C)&&(l-x)*(_-C)>=(f-x)*(h-C)}function Wd(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(l,h){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==h.i&&f.next.i!==h.i&&fh(f,f.next,l,h))return!0;f=f.next}while(f!==l);return!1}(s,i)&&(Cl(s,i)&&Cl(i,s)&&function(l,h){var f=l,_=!1,x=(l.x+h.x)/2,C=(l.y+h.y)/2;do{f.y>C!=f.next.y>C&&f.next.y!==f.y&&x<(f.next.x-f.x)*(C-f.y)/(f.next.y-f.y)+f.x&&(_=!_),f=f.next}while(f!==l);return _}(s,i)&&(Nn(s.prev,s,i.prev)||Nn(s,i.prev,i))||du(s,i)&&Nn(s.prev,s,s.next)>0&&Nn(i.prev,i,i.next)>0)}function Nn(s,i,l){return(i.y-s.y)*(l.x-i.x)-(i.x-s.x)*(l.y-i.y)}function du(s,i){return s.x===i.x&&s.y===i.y}function fh(s,i,l,h){var f=pu(Nn(s,i,l)),_=pu(Nn(s,i,h)),x=pu(Nn(l,h,s)),C=pu(Nn(l,h,i));return f!==_&&x!==C||!(0!==f||!mh(s,l,i))||!(0!==_||!mh(s,h,i))||!(0!==x||!mh(l,s,h))||!(0!==C||!mh(l,i,h))}function mh(s,i,l){return i.x<=Math.max(s.x,l.x)&&i.x>=Math.min(s.x,l.x)&&i.y<=Math.max(s.y,l.y)&&i.y>=Math.min(s.y,l.y)}function pu(s){return s>0?1:s<0?-1:0}function Cl(s,i){return Nn(s.prev,s,s.next)<0?Nn(s,i,s.next)>=0&&Nn(s,s.prev,i)>=0:Nn(s,i,s.prev)<0||Nn(s,s.next,i)<0}function Xd(s,i){var l=new gh(s.i,s.x,s.y),h=new gh(i.i,i.x,i.y),f=s.next,_=i.prev;return s.next=i,i.prev=s,l.next=f,f.prev=l,h.next=l,l.prev=h,_.next=h,h.prev=_,h}function Yd(s,i,l,h){var f=new gh(s,i,l);return h?(f.next=h.next,f.prev=h,h.next.prev=f,h.next=f):(f.prev=f,f.next=f),f}function _c(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function gh(s,i,l){this.i=s,this.x=i,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fu(s,i,l,h){for(var f=0,_=i,x=l-h;_<l;_+=h)f+=(s[x]-s[_])*(s[_+1]+s[x+1]),x=_;return f}xo.exports=mc,xo.exports.default=mc,mc.deviation=function(s,i,l,h){var f=i&&i.length,_=Math.abs(fu(s,0,f?i[0]*l:s.length,l));if(f)for(var x=0,C=i.length;x<C;x++)_-=Math.abs(fu(s,i[x]*l,x<C-1?i[x+1]*l:s.length,l));var I=0;for(x=0;x<h.length;x+=3){var T=h[x]*l,P=h[x+1]*l,L=h[x+2]*l;I+=Math.abs((s[T]-s[L])*(s[P+1]-s[T+1])-(s[T]-s[P])*(s[L+1]-s[T+1]))}return 0===_&&0===I?0:Math.abs((I-_)/_)},mc.flatten=function(s){for(var i=s[0][0].length,l={vertices:[],holes:[],dimensions:i},h=0,f=0;f<s.length;f++){for(var _=0;_<s[f].length;_++)for(var x=0;x<i;x++)l.vertices.push(s[f][_][x]);f>0&&l.holes.push(h+=s[f-1].length)}return l};var Uf=ye(xo.exports);function ry(s,i,l,h,f){di(s,i,l||0,h||s.length-1,f||Zn)}function di(s,i,l,h,f){for(;h>l;){if(h-l>600){var _=h-l+1,x=i-l+1,C=Math.log(_),I=.5*Math.exp(2*C/3),T=.5*Math.sqrt(C*I*(_-I)/_)*(x-_/2<0?-1:1);di(s,i,Math.max(l,Math.floor(i-x*I/_+T)),Math.min(h,Math.floor(i+(_-x)*I/_+T)),f)}var P=s[i],L=l,N=h;for(qo(s,l,i),f(s[h],P)>0&&qo(s,l,h);L<N;){for(qo(s,L,N),L++,N--;f(s[L],P)<0;)L++;for(;f(s[N],P)>0;)N--}0===f(s[l],P)?qo(s,l,N):qo(s,++N,h),N<=i&&(l=N+1),i<=N&&(h=N-1)}}function qo(s,i,l){var h=s[i];s[i]=s[l],s[l]=h}function Zn(s,i){return s<i?-1:s>i?1:0}function Kd(s,i){const l=s.length;if(l<=1)return[s];const h=[];let f,_;for(let x=0;x<l;x++){const C=Ui(s[x]);0!==C&&(s[x].area=Math.abs(C),void 0===_&&(_=C<0),_===C<0?(f&&h.push(f),f=[s[x]]):f.push(s[x]))}if(f&&h.push(f),i>1)for(let x=0;x<h.length;x++)h[x].length<=i||(ry(h[x],i,1,h[x].length-1,iy),h[x]=h[x].slice(0,i));return h}function iy(s,i){return i.area-s.area}function Qd(s,i,l){const h=l.patternDependencies;let f=!1;for(const _ of i){const x=_.paint.get(`${s}-pattern`);x.isConstant()||(f=!0);const C=x.constantOr(null);C&&(f=!0,h[C.to]=!0,h[C.from]=!0)}return f}function Jd(s,i,l,h,f){const _=f.patternDependencies;for(const x of i){const C=x.paint.get(`${s}-pattern`).value;if("constant"!==C.kind){let I=C.evaluate({zoom:h-1},l,{},f.availableImages),T=C.evaluate({zoom:h},l,{},f.availableImages),P=C.evaluate({zoom:h+1},l,{},f.availableImages);I=I&&I.name?I.name:I,T=T&&T.name?T.name:T,P=P&&P.name?P.name:P,_[I]=!0,_[T]=!0,_[P]=!0,l.patterns[x.id]={min:I,mid:T,max:P}}}return l}class yh{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Tt,this.indexArray=new pr,this.indexArray2=new er,this.programConfigurations=new $o(i.layers,i.zoom),this.segments=new on,this.segments2=new on,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.hasPattern=Qd("fill",this.layers,l);const f=this.layers[0].layout.get("fill-sort-key"),_=!f.isConstant(),x=[];for(const{feature:C,id:I,index:T,sourceLayerIndex:P}of i){const L=this.layers[0]._featureFilter.needGeometry,N=xl(C,L);if(!this.layers[0]._featureFilter.filter(new tn(this.zoom),N,h))continue;const j=_?f.evaluate(N,{},h,l.availableImages):void 0,$={id:I,properties:C.properties,type:C.type,sourceLayerIndex:P,index:T,geometry:L?N.geometry:za(C),patterns:{},sortKey:j};x.push($)}_&&x.sort((C,I)=>C.sortKey-I.sortKey);for(const C of x){const{geometry:I,index:T,sourceLayerIndex:P}=C;if(this.hasPattern){const L=Jd("fill",this.layers,C,this.zoom,l);this.patternFeatures.push(L)}else this.addFeature(C,I,T,h,{});l.featureIndex.insert(i[T].feature,I,T,P,this.index)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}addFeatures(i,l,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,hu),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,h,f,_){for(const x of Kd(l,500)){let C=0;for(const j of x)C+=j.length;const I=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray),T=I.vertexLength,P=[],L=[];for(const j of x){if(0===j.length)continue;j!==x[0]&&L.push(P.length/2);const $=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),q=$.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(q+j.length-1,q),P.push(j[0].x),P.push(j[0].y);for(let Q=1;Q<j.length;Q++)this.layoutVertexArray.emplaceBack(j[Q].x,j[Q].y),this.indexArray2.emplaceBack(q+Q-1,q+Q),P.push(j[Q].x),P.push(j[Q].y);$.vertexLength+=j.length,$.primitiveLength+=j.length}const N=Uf(P,L);for(let j=0;j<N.length;j+=3)this.indexArray.emplaceBack(T+N[j],T+N[j+1],T+N[j+2]);I.vertexLength+=C,I.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,_,f)}}let ep,mu;qe("FillBucket",yh,{omit:["layers","patternFeatures"]});var Ba={get paint(){return mu=mu||new Cn({"fill-antialias":new Ke(_e.paint_fill["fill-antialias"]),"fill-opacity":new rt(_e.paint_fill["fill-opacity"]),"fill-color":new rt(_e.paint_fill["fill-color"]),"fill-outline-color":new rt(_e.paint_fill["fill-outline-color"]),"fill-translate":new Ke(_e.paint_fill["fill-translate"]),"fill-translate-anchor":new Ke(_e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fi(_e.paint_fill["fill-pattern"])})},get layout(){return ep=ep||new Cn({"fill-sort-key":new rt(_e.layout_fill["fill-sort-key"])})}};class oy extends Ji{constructor(i){super(i,Ba)}recalculate(i,l){super.recalculate(i,l);const h=this.paint._values["fill-outline-color"];"constant"===h.value.kind&&void 0===h.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new yh(i)}queryRadius(){return lh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,l,h,f,_,x,C){return jd(ch(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,C),f)}isTileClipped(){return!0}}const _h=pn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),vh=pn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:xh}=_h;var gs={},Hf=ji,tp=vc;function vc(s,i,l,h,f){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=h,this._values=f,s.readFields(xc,this,i)}function xc(s,i,l){1==s?i.id=l.readVarint():2==s?function(h,f){for(var _=h.readVarint()+h.pos;h.pos<_;){var x=f._keys[h.readVarint()],C=f._values[h.readVarint()];f.properties[x]=C}}(l,i):3==s?i.type=l.readVarint():4==s&&(i._geometry=l.pos)}function gu(s){for(var i,l,h=0,f=0,_=s.length,x=_-1;f<_;x=f++)h+=((l=s[x]).x-(i=s[f]).x)*(i.y+l.y);return h}vc.types=["Unknown","Point","LineString","Polygon"],vc.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,l=s.readVarint()+s.pos,h=1,f=0,_=0,x=0,C=[];s.pos<l;){if(f<=0){var I=s.readVarint();h=7&I,f=I>>3}if(f--,1===h||2===h)_+=s.readSVarint(),x+=s.readSVarint(),1===h&&(i&&C.push(i),i=[]),i.push(new Hf(_,x));else{if(7!==h)throw new Error("unknown command "+h);i&&i.push(i[0].clone())}}return i&&C.push(i),C},vc.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,l=1,h=0,f=0,_=0,x=1/0,C=-1/0,I=1/0,T=-1/0;s.pos<i;){if(h<=0){var P=s.readVarint();l=7&P,h=P>>3}if(h--,1===l||2===l)(f+=s.readSVarint())<x&&(x=f),f>C&&(C=f),(_+=s.readSVarint())<I&&(I=_),_>T&&(T=_);else if(7!==l)throw new Error("unknown command "+l)}return[x,I,C,T]},vc.prototype.toGeoJSON=function(s,i,l){var h,f,_=this.extent*Math.pow(2,l),x=this.extent*s,C=this.extent*i,I=this.loadGeometry(),T=vc.types[this.type];function P(j){for(var $=0;$<j.length;$++){var q=j[$];j[$]=[360*(q.x+x)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+C)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(h=0;h<I.length;h++)L[h]=I[h][0];P(I=L);break;case 2:for(h=0;h<I.length;h++)P(I[h]);break;case 3:for(I=function(j){var $=j.length;if($<=1)return[j];for(var q,Q,te=[],ae=0;ae<$;ae++){var ie=gu(j[ae]);0!==ie&&(void 0===Q&&(Q=ie<0),Q===ie<0?(q&&te.push(q),q=[j[ae]]):q.push(j[ae]))}return q&&te.push(q),te}(I),h=0;h<I.length;h++)for(f=0;f<I[h].length;f++)P(I[h][f])}1===I.length?I=I[0]:T="Multi"+T;var N={type:"Feature",geometry:{type:T,coordinates:I},properties:this.properties};return"id"in this&&(N.id=this.id),N};var sy=tp,ay=bh;function bh(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(C0,this,i),this.length=this._features.length}function C0(s,i,l){15===s?i.version=l.readVarint():1===s?i.name=l.readString():5===s?i.extent=l.readVarint():2===s?i._features.push(l.pos):3===s?i._keys.push(l.readString()):4===s&&i._values.push(function(h){for(var f=null,_=h.readVarint()+h.pos;h.pos<_;){var x=h.readVarint()>>3;f=1===x?h.readString():2===x?h.readFloat():3===x?h.readDouble():4===x?h.readVarint64():5===x?h.readVarint():6===x?h.readSVarint():7===x?h.readBoolean():null}return f}(l))}bh.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new sy(this._pbf,i,this.extent,this._keys,this._values)};var ly=ay;function cy(s,i,l){if(3===s){var h=new ly(l,l.readVarint()+l.pos);h.length&&(i[h.name]=h)}}gs.VectorTile=function(s,i){this.layers=s.readFields(cy,{},i)},gs.VectorTileFeature=tp,gs.VectorTileLayer=ay;const D0=gs.VectorTileFeature.types,qf=Math.pow(2,13);function Dl(s,i,l,h,f,_,x,C){s.emplaceBack(i,l,2*Math.floor(h*qf)+x,f*qf*2,_*qf*2,Math.round(C))}class Sl{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new ke,this.centroidVertexArray=new Re,this.indexArray=new pr,this.programConfigurations=new $o(i.layers,i.zoom),this.segments=new on,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.features=[],this.hasPattern=Qd("fill-extrusion",this.layers,l);for(const{feature:f,id:_,index:x,sourceLayerIndex:C}of i){const I=this.layers[0]._featureFilter.needGeometry,T=xl(f,I);if(!this.layers[0]._featureFilter.filter(new tn(this.zoom),T,h))continue;const P={id:_,sourceLayerIndex:C,index:x,geometry:I?T.geometry:za(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(Jd("fill-extrusion",this.layers,P,this.zoom,l)):this.addFeature(P,P.geometry,x,h,{}),l.featureIndex.insert(f,P.geometry,x,C,this.index,!0)}}addFeatures(i,l,h){for(const f of this.features){const{geometry:_}=f;this.addFeature(f,_,f.index,l,h)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,xh),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,vh.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,l,h,f,_){const x={x:0,y:0,vertexCount:0};for(const C of Kd(l,500)){let I=0;for(const $ of C)I+=$.length;let T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const $ of C){if(0===$.length||((s=$).every(i=>i.x<0)||s.every(i=>i.x>tr)||s.every(i=>i.y<0)||s.every(i=>i.y>tr)))continue;let q=0;for(let Q=0;Q<$.length;Q++){const te=$[Q];if(Q>=1){const ae=$[Q-1];if(!uy(te,ae)){T.vertexLength+4>on.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ie=te.sub(ae)._perp()._unit(),he=ae.dist(te);q+he>32768&&(q=0),Dl(this.layoutVertexArray,te.x,te.y,ie.x,ie.y,0,0,q),Dl(this.layoutVertexArray,te.x,te.y,ie.x,ie.y,0,1,q),x.x+=2*te.x,x.y+=2*te.y,x.vertexCount+=2,q+=he,Dl(this.layoutVertexArray,ae.x,ae.y,ie.x,ie.y,0,0,q),Dl(this.layoutVertexArray,ae.x,ae.y,ie.x,ie.y,0,1,q),x.x+=2*ae.x,x.y+=2*ae.y,x.vertexCount+=2;const fe=T.vertexLength;this.indexArray.emplaceBack(fe,fe+2,fe+1),this.indexArray.emplaceBack(fe+1,fe+2,fe+3),T.vertexLength+=4,T.primitiveLength+=2}}}}if(T.vertexLength+I>on.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),"Polygon"!==D0[i.type])continue;const P=[],L=[],N=T.vertexLength;for(const $ of C)if(0!==$.length){$!==C[0]&&L.push(P.length/2);for(let q=0;q<$.length;q++){const Q=$[q];Dl(this.layoutVertexArray,Q.x,Q.y,0,0,1,1,0),x.x+=Q.x,x.y+=Q.y,x.vertexCount+=1,P.push(Q.x),P.push(Q.y)}}const j=Uf(P,L);for(let $=0;$<j.length;$+=3)this.indexArray.emplaceBack(N+j[$],N+j[$+2],N+j[$+1]);T.primitiveLength+=j.length/3,T.vertexLength+=I}var s;for(let C=0;C<x.vertexCount;C++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,_,f)}}function uy(s,i){return s.x===i.x&&(s.x<0||s.x>tr)||s.y===i.y&&(s.y<0||s.y>tr)}let wh;qe("FillExtrusionBucket",Sl,{omit:["layers","features"]});var Ch={get paint(){return wh=wh||new Cn({"fill-extrusion-opacity":new Ke(_e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new rt(_e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ke(_e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ke(_e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fi(_e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new rt(_e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new rt(_e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ke(_e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class S0 extends Ji{constructor(i){super(i,Ch)}createBucket(i){return new Sl(i)}queryRadius(){return lh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,l,h,f,_,x,C,I){const T=ch(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,C),P=this.paint.get("fill-extrusion-height").evaluate(l,h),L=this.paint.get("fill-extrusion-base").evaluate(l,h),N=function($,q,Q,te){const ae=[];for(const ie of $){const he=[ie.x,ie.y,0,1];Hd(he,he,q),ae.push(new tt(he[0]/he[3],he[1]/he[3]))}return ae}(T,I),j=function($,q,Q,te){const ae=[],ie=[],he=te[8]*q,fe=te[9]*q,De=te[10]*q,Ue=te[11]*q,Xe=te[8]*Q,je=te[9]*Q,Ne=te[10]*Q,Le=te[11]*Q;for(const He of $){const Fe=[],Te=[];for(const et of He){const We=et.x,Pt=et.y,fn=te[0]*We+te[4]*Pt+te[12],Dn=te[1]*We+te[5]*Pt+te[13],cr=te[2]*We+te[6]*Pt+te[14],zi=te[3]*We+te[7]*Pt+te[15],ri=cr+De,Wn=zi+Ue,nr=fn+Xe,fr=Dn+je,ur=cr+Ne,fi=zi+Le,hr=new tt((fn+he)/Wn,(Dn+fe)/Wn);hr.z=ri/Wn,Fe.push(hr);const mr=new tt(nr/fi,fr/fi);mr.z=ur/fi,Te.push(mr)}ae.push(Fe),ie.push(Te)}return[ae,ie]}(f,L,P,I);return function($,q,Q){let te=1/0;jd(Q,q)&&(te=np(Q,q[0]));for(let ae=0;ae<q.length;ae++){const ie=q[ae],he=$[ae];for(let fe=0;fe<ie.length-1;fe++){const De=ie[fe],Ue=[De,ie[fe+1],he[fe+1],he[fe],De];Uo(Q,Ue)&&(te=Math.min(te,np(Q,Ue)))}}return te!==1/0&&te}(j[0],j[1],N)}}function bc(s,i){return s.x*i.x+s.y*i.y}function np(s,i){if(1===s.length){let l=0;const h=i[l++];let f;for(;!f||h.equals(f);)if(f=i[l++],!f)return 1/0;for(;l<i.length;l++){const _=i[l],x=s[0],C=f.sub(h),I=_.sub(h),T=x.sub(h),P=bc(C,C),L=bc(C,I),N=bc(I,I),j=bc(T,C),$=bc(T,I),q=P*N-L*L,Q=(N*j-L*$)/q,te=(P*$-L*j)/q,ae=h.z*(1-Q-te)+f.z*Q+_.z*te;if(isFinite(ae))return ae}return 1/0}{let l=1/0;for(const h of i)l=Math.min(l,h.z);return l}}const hy=pn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ys}=hy,dy=pn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Dh}=dy,rp=gs.VectorTileFeature.types,Gf=Math.cos(Math.PI/180*37.5),_u=Math.pow(2,14)/.5;class vu{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new it,this.layoutVertexArray2=new Qe,this.indexArray=new pr,this.programConfigurations=new $o(i.layers,i.zoom),this.segments=new on,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,h){this.hasPattern=Qd("line",this.layers,l);const f=this.layers[0].layout.get("line-sort-key"),_=!f.isConstant(),x=[];for(const{feature:C,id:I,index:T,sourceLayerIndex:P}of i){const L=this.layers[0]._featureFilter.needGeometry,N=xl(C,L);if(!this.layers[0]._featureFilter.filter(new tn(this.zoom),N,h))continue;const j=_?f.evaluate(N,{},h):void 0,$={id:I,properties:C.properties,type:C.type,sourceLayerIndex:P,index:T,geometry:L?N.geometry:za(C),patterns:{},sortKey:j};x.push($)}_&&x.sort((C,I)=>C.sortKey-I.sortKey);for(const C of x){const{geometry:I,index:T,sourceLayerIndex:P}=C;if(this.hasPattern){const L=Jd("line",this.layers,C,this.zoom,l);this.patternFeatures.push(L)}else this.addFeature(C,I,T,h,{});l.featureIndex.insert(i[T].feature,I,T,P,this.index)}}update(i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,h)}addFeatures(i,l,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Dh)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ys),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,h,f,_){const x=this.layers[0].layout,C=x.get("line-join").evaluate(i,{}),I=x.get("line-cap"),T=x.get("line-miter-limit"),P=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const L of l)this.addLine(L,i,C,I,T,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,_,f)}addLine(i,l,h,f,_,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<i.length-1;te++)this.totalDistance+=i[te].dist(i[te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C="Polygon"===rp[l.type];let I=i.length;for(;I>=2&&i[I-1].equals(i[I-2]);)I--;let T=0;for(;T<I-1&&i[T].equals(i[T+1]);)T++;if(I<(C?3:2))return;"bevel"===h&&(_=1.05);const P=this.overscaling<=16?15*tr/(512*this.overscaling):0,L=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let N,j,$,q,Q;this.e1=this.e2=-1,C&&(N=i[I-2],Q=i[T].sub(N)._unit()._perp());for(let te=T;te<I;te++){if($=te===I-1?C?i[T+1]:void 0:i[te+1],$&&i[te].equals($))continue;Q&&(q=Q),N&&(j=N),N=i[te],Q=$?$.sub(N)._unit()._perp():q,q=q||Q;let ae=q.add(Q);0===ae.x&&0===ae.y||ae._unit();const ie=q.x*Q.x+q.y*Q.y,he=ae.x*Q.x+ae.y*Q.y,fe=0!==he?1/he:1/0,De=2*Math.sqrt(2-2*he),Ue=he<Gf&&j&&$,Xe=q.x*Q.y-q.y*Q.x>0;if(Ue&&te>T){const Le=N.dist(j);if(Le>2*P){const He=N.sub(N.sub(j)._mult(P/Le)._round());this.updateDistance(j,He),this.addCurrentVertex(He,q,0,0,L),j=He}}const je=j&&$;let Ne=je?h:C?"butt":f;if(je&&"round"===Ne&&(fe<x?Ne="miter":fe<=2&&(Ne="fakeround")),"miter"===Ne&&fe>_&&(Ne="bevel"),"bevel"===Ne&&(fe>2&&(Ne="flipbevel"),fe<_&&(Ne="miter")),j&&this.updateDistance(j,N),"miter"===Ne)ae._mult(fe),this.addCurrentVertex(N,ae,0,0,L);else if("flipbevel"===Ne){if(fe>100)ae=Q.mult(-1);else{const Le=fe*q.add(Q).mag()/q.sub(Q).mag();ae._perp()._mult(Le*(Xe?-1:1))}this.addCurrentVertex(N,ae,0,0,L),this.addCurrentVertex(N,ae.mult(-1),0,0,L)}else if("bevel"===Ne||"fakeround"===Ne){const Le=-Math.sqrt(fe*fe-1),He=Xe?Le:0,Fe=Xe?0:Le;if(j&&this.addCurrentVertex(N,q,He,Fe,L),"fakeround"===Ne){const Te=Math.round(180*De/Math.PI/20);for(let et=1;et<Te;et++){let We=et/Te;if(.5!==We){const fn=We-.5;We+=We*fn*(We-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*fn*fn+(.848013+ie*(.215638*ie-1.06021)))}const Pt=Q.sub(q)._mult(We)._add(q)._unit()._mult(Xe?-1:1);this.addHalfVertex(N,Pt.x,Pt.y,!1,Xe,0,L)}}$&&this.addCurrentVertex(N,Q,-He,-Fe,L)}else if("butt"===Ne)this.addCurrentVertex(N,ae,0,0,L);else if("square"===Ne){const Le=j?1:-1;this.addCurrentVertex(N,ae,Le,Le,L)}else"round"===Ne&&(j&&(this.addCurrentVertex(N,q,0,0,L),this.addCurrentVertex(N,q,1,1,L,!0)),$&&(this.addCurrentVertex(N,Q,-1,-1,L,!0),this.addCurrentVertex(N,Q,0,0,L)));if(Ue&&te<I-1){const Le=N.dist($);if(Le>2*P){const He=N.add($.sub(N)._mult(P/Le)._round());this.updateDistance(N,He),this.addCurrentVertex(He,Q,0,0,L),N=He}}}}addCurrentVertex(i,l,h,f,_,x=!1){const C=l.y*f-l.x,I=-l.y-l.x*f;this.addHalfVertex(i,l.x+l.y*h,l.y-l.x*h,x,!1,h,_),this.addHalfVertex(i,C,I,x,!0,-f,_),this.distance>_u/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,l,h,f,_,x))}addHalfVertex({x:i,y:l},h,f,_,x,C,I){const T=.5*(this.lineClips?this.scaledDistance*(_u-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(_?1:0),(l<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*f)+128,1+(0===C?0:C<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const P=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),I.primitiveLength++),x?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}let Zf,ip;qe("LineBucket",vu,{omit:["layers","patternFeatures"]});var op={get paint(){return ip=ip||new Cn({"line-opacity":new rt(_e.paint_line["line-opacity"]),"line-color":new rt(_e.paint_line["line-color"]),"line-translate":new Ke(_e.paint_line["line-translate"]),"line-translate-anchor":new Ke(_e.paint_line["line-translate-anchor"]),"line-width":new rt(_e.paint_line["line-width"]),"line-gap-width":new rt(_e.paint_line["line-gap-width"]),"line-offset":new rt(_e.paint_line["line-offset"]),"line-blur":new rt(_e.paint_line["line-blur"]),"line-dasharray":new Qi(_e.paint_line["line-dasharray"]),"line-pattern":new Fi(_e.paint_line["line-pattern"]),"line-gradient":new Ws(_e.paint_line["line-gradient"])})},get layout(){return Zf=Zf||new Cn({"line-cap":new Ke(_e.layout_line["line-cap"]),"line-join":new rt(_e.layout_line["line-join"]),"line-miter-limit":new Ke(_e.layout_line["line-miter-limit"]),"line-round-limit":new Ke(_e.layout_line["line-round-limit"]),"line-sort-key":new rt(_e.layout_line["line-sort-key"])})}};class Wf extends rt{possiblyEvaluate(i,l){return l=new tn(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(i,l)}evaluate(i,l,h,f){return l=vr({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(i,l,h,f)}}let xu;class py extends Ji{constructor(i){super(i,op),this.gradientVersion=0,xu||(xu=new Wf(op.paint.properties["line-width"].specification),xu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if("line-gradient"===i){const l=this.gradientExpression();this.stepInterpolant=!(void 0===l._styleExpression)&&l._styleExpression.expression instanceof Ns,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,l){super.recalculate(i,l),this.paint._values["line-floorwidth"]=xu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new vu(i)}queryRadius(i){const l=i,h=bu(cu("line-width",this,l),cu("line-gap-width",this,l)),f=cu("line-offset",this,l);return h/2+Math.abs(f)+lh(this.paint.get("line-translate"))}queryIntersectsFeature(i,l,h,f,_,x,C){const I=ch(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,C),T=C/2*bu(this.paint.get("line-width").evaluate(l,h),this.paint.get("line-gap-width").evaluate(l,h)),P=this.paint.get("line-offset").evaluate(l,h);return P&&(f=function(L,N){const j=[];for(let $=0;$<L.length;$++){const q=L[$],Q=[];for(let te=0;te<q.length;te++){const ae=q[te-1],ie=q[te],he=q[te+1],fe=0===te?new tt(0,0):ie.sub(ae)._unit()._perp(),De=te===q.length-1?new tt(0,0):he.sub(ie)._unit()._perp(),Ue=fe._add(De)._unit(),Xe=Ue.x*De.x+Ue.y*De.y;0!==Xe&&Ue._mult(1/Xe),Q.push(Ue._mult(N)._add(ie))}j.push(Q)}return j}(f,P*C)),function(L,N,j){for(let $=0;$<N.length;$++){const q=N[$];if(L.length>=3)for(let Q=0;Q<q.length;Q++)if(Ho(L,q[Q]))return!0;if(kn(L,q,j))return!0}return!1}(I,f,T)}isTileClipped(){return!0}}function bu(s,i){return i>0?i+2*s:s}const Il=pn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fy=pn([{name:"a_projected_pos",components:3,type:"Float32"}],4);pn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Xf=pn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);pn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const sp=pn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),wu=pn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function my(s,i,l){return s.sections.forEach(h=>{h.text=function(f,_,x){const C=_.layout.get("text-transform").evaluate(x,{});return"uppercase"===C?f=f.toLocaleUpperCase():"lowercase"===C&&(f=f.toLocaleLowerCase()),Qn.applyArabicShaping&&(f=Qn.applyArabicShaping(f)),f}(h.text,i,l)}),s}pn([{name:"triangle",components:3,type:"Uint16"}]),pn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),pn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),pn([{type:"Float32",name:"offsetX"}]),pn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),pn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Er={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};var ar=24,ap=sn,Sh=function(s,i,l,h,f){var _,x,C=8*f-h-1,I=(1<<C)-1,T=I>>1,P=-7,L=l?f-1:0,N=l?-1:1,j=s[i+L];for(L+=N,_=j&(1<<-P)-1,j>>=-P,P+=C;P>0;_=256*_+s[i+L],L+=N,P-=8);for(x=_&(1<<-P)-1,_>>=-P,P+=h;P>0;x=256*x+s[i+L],L+=N,P-=8);if(0===_)_=1-T;else{if(_===I)return x?NaN:1/0*(j?-1:1);x+=Math.pow(2,h),_-=T}return(j?-1:1)*x*Math.pow(2,_-h)},Yf=function(s,i,l,h,f,_){var x,C,I,T=8*_-f-1,P=(1<<T)-1,L=P>>1,N=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,j=h?0:_-1,$=h?1:-1,q=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(C=isNaN(i)?1:0,x=P):(x=Math.floor(Math.log(i)/Math.LN2),i*(I=Math.pow(2,-x))<1&&(x--,I*=2),(i+=x+L>=1?N/I:N*Math.pow(2,1-L))*I>=2&&(x++,I/=2),x+L>=P?(C=0,x=P):x+L>=1?(C=(i*I-1)*Math.pow(2,f),x+=L):(C=i*Math.pow(2,L-1)*Math.pow(2,f),x=0));f>=8;s[l+j]=255&C,j+=$,C/=256,f-=8);for(x=x<<f|C,T+=f;T>0;s[l+j]=255&x,j+=$,x/=256,T-=8);s[l+j-$]|=128*q};function sn(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}sn.Varint=0,sn.Fixed64=1,sn.Bytes=2,sn.Fixed32=5;var wc=4294967296,El=1/wc,Ml=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ni(s){return s.type===sn.Bytes?s.readVarint()+s.pos:s.pos+1}function Ih(s,i,l){var h=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(h);for(var f=l.pos-1;f>=s;f--)l.buf[f+h]=l.buf[f]}function Cc(s,i){for(var l=0;l<s.length;l++)i.writeVarint(s[l])}function I0(s,i){for(var l=0;l<s.length;l++)i.writeSVarint(s[l])}function gy(s,i){for(var l=0;l<s.length;l++)i.writeFloat(s[l])}function E0(s,i){for(var l=0;l<s.length;l++)i.writeDouble(s[l])}function M0(s,i){for(var l=0;l<s.length;l++)i.writeBoolean(s[l])}function T0(s,i){for(var l=0;l<s.length;l++)i.writeFixed32(s[l])}function A0(s,i){for(var l=0;l<s.length;l++)i.writeSFixed32(s[l])}function P0(s,i){for(var l=0;l<s.length;l++)i.writeFixed64(s[l])}function k0(s,i){for(var l=0;l<s.length;l++)i.writeSFixed64(s[l])}function Js(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function Dc(s,i,l){s[l]=i,s[l+1]=i>>>8,s[l+2]=i>>>16,s[l+3]=i>>>24}function Kf(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}sn.prototype={destroy:function(){this.buf=null},readFields:function(s,i,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),f=h>>3,_=this.pos;this.type=7&h,s(f,i,this),this.pos===_&&this.skip(h)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=Js(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Kf(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Js(this.buf,this.pos)+Js(this.buf,this.pos+4)*wc;return this.pos+=8,s},readSFixed64:function(){var s=Js(this.buf,this.pos)+Kf(this.buf,this.pos+4)*wc;return this.pos+=8,s},readFloat:function(){var s=Sh(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Sh(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,l,h=this.buf;return i=127&(l=h[this.pos++]),l<128?i:(i|=(127&(l=h[this.pos++]))<<7,l<128?i:(i|=(127&(l=h[this.pos++]))<<14,l<128?i:(i|=(127&(l=h[this.pos++]))<<21,l<128?i:function(f,_,x){var C,I,T=x.buf;if(C=(112&(I=T[x.pos++]))>>4,I<128||(C|=(127&(I=T[x.pos++]))<<3,I<128)||(C|=(127&(I=T[x.pos++]))<<10,I<128)||(C|=(127&(I=T[x.pos++]))<<17,I<128)||(C|=(127&(I=T[x.pos++]))<<24,I<128)||(C|=(1&(I=T[x.pos++]))<<31,I<128))return function Tl(s,i,l){return l?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}(f,C,_);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(l=h[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&Ml?Ml.decode(this.buf.subarray(i,s)):function(l,h,f){for(var _="",x=h;x<f;){var C,I,T,P=l[x],L=null,N=P>239?4:P>223?3:P>191?2:1;if(x+N>f)break;1===N?P<128&&(L=P):2===N?128==(192&(C=l[x+1]))&&(L=(31&P)<<6|63&C)<=127&&(L=null):3===N?(I=l[x+2],128==(192&(C=l[x+1]))&&128==(192&I)&&((L=(15&P)<<12|(63&C)<<6|63&I)<=2047||L>=55296&&L<=57343)&&(L=null)):4===N&&(I=l[x+2],T=l[x+3],128==(192&(C=l[x+1]))&&128==(192&I)&&128==(192&T)&&((L=(15&P)<<18|(63&C)<<12|(63&I)<<6|63&T)<=65535||L>=1114112)&&(L=null)),null===L?(L=65533,N=1):L>65535&&(L-=65536,_+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),_+=String.fromCharCode(L),x+=N}return _}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==sn.Bytes)return s.push(this.readVarint(i));var l=Ni(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==sn.Bytes)return s.push(this.readSVarint());var i=Ni(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==sn.Bytes)return s.push(this.readBoolean());var i=Ni(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==sn.Bytes)return s.push(this.readFloat());var i=Ni(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==sn.Bytes)return s.push(this.readDouble());var i=Ni(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==sn.Bytes)return s.push(this.readFixed32());var i=Ni(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==sn.Bytes)return s.push(this.readSFixed32());var i=Ni(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==sn.Bytes)return s.push(this.readFixed64());var i=Ni(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==sn.Bytes)return s.push(this.readSFixed64());var i=Ni(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===sn.Varint)for(;this.buf[this.pos++]>127;);else if(i===sn.Bytes)this.pos=this.readVarint()+this.pos;else if(i===sn.Fixed32)this.pos+=4;else{if(i!==sn.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Dc(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Dc(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Dc(this.buf,-1&s,this.pos),Dc(this.buf,Math.floor(s*El),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Dc(this.buf,-1&s,this.pos),Dc(this.buf,Math.floor(s*El),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,l){var h,f,_,C;if(i>=0?(h=i%4294967296|0,f=i/4294967296|0):(f=~(-i/4294967296),4294967295^(h=~(-i%4294967296))?h=h+1|0:(h=0,f=f+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),_=h,(C=l).buf[C.pos++]=127&_|128,_>>>=7,C.buf[C.pos++]=127&_|128,_>>>=7,C.buf[C.pos++]=127&_|128,_>>>=7,C.buf[C.pos++]=127&_|128,C.buf[C.pos]=127&(_>>>=7),function(_,x){var C=(7&_)<<4;x.buf[x.pos++]|=C|((_>>>=3)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_|((_>>>=7)?128:0),_&&(x.buf[x.pos++]=127&_)))))}(f,l)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(h,f,_){for(var x,C,I=0;I<f.length;I++){if((x=f.charCodeAt(I))>55295&&x<57344){if(!C){x>56319||I+1===f.length?(h[_++]=239,h[_++]=191,h[_++]=189):C=x;continue}if(x<56320){h[_++]=239,h[_++]=191,h[_++]=189,C=x;continue}x=C-55296<<10|x-56320|65536,C=null}else C&&(h[_++]=239,h[_++]=191,h[_++]=189,C=null);x<128?h[_++]=x:(x<2048?h[_++]=x>>6|192:(x<65536?h[_++]=x>>12|224:(h[_++]=x>>18|240,h[_++]=x>>12&63|128),h[_++]=x>>6&63|128),h[_++]=63&x|128)}return _}(this.buf,s,this.pos);var l=this.pos-i;l>=128&&Ih(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),Yf(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Yf(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var l=0;l<i;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,i){this.pos++;var l=this.pos;s(i,this);var h=this.pos-l;h>=128&&Ih(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(s,i,l){this.writeTag(s,sn.Bytes),this.writeRawMessage(i,l)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,Cc,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,I0,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,M0,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,gy,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,E0,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,T0,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,A0,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,P0,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,k0,i)},writeBytesField:function(s,i){this.writeTag(s,sn.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,sn.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,sn.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,sn.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,sn.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,sn.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,sn.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,sn.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,sn.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,sn.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,!!i)}};var lr=ye(ap);const lp=3;function Cu(s,i,l){1===s&&l.readMessage(yy,i)}function yy(s,i,l){if(3===s){const{id:h,bitmap:f,width:_,height:x,left:C,top:I,advance:T}=l.readMessage(bo,{});i.push({id:h,bitmap:new uu({width:_+2*lp,height:x+2*lp},f),metrics:{width:_,height:x,left:C,top:I,advance:T}})}}function bo(s,i,l){1===s?i.id=l.readVarint():2===s?i.bitmap=l.readBytes():3===s?i.width=l.readVarint():4===s?i.height=l.readVarint():5===s?i.left=l.readSVarint():6===s?i.top=l.readSVarint():7===s&&(i.advance=l.readVarint())}const Al=lp;function cp(s){let i=0,l=0;for(const x of s)i+=x.w*x.h,l=Math.max(l,x.w);s.sort((x,C)=>C.h-x.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let f=0,_=0;for(const x of s)for(let C=h.length-1;C>=0;C--){const I=h[C];if(!(x.w>I.w||x.h>I.h)){if(x.x=I.x,x.y=I.y,_=Math.max(_,x.y+x.h),f=Math.max(f,x.x+x.w),x.w===I.w&&x.h===I.h){const T=h.pop();C<h.length&&(h[C]=T)}else x.h===I.h?(I.x+=x.w,I.w-=x.w):x.w===I.w?(I.y+=x.h,I.h-=x.h):(h.push({x:I.x+x.w,y:I.y,w:I.w-x.w,h:x.h}),I.y+=x.h,I.h-=x.h);break}}return{w:f,h:_,fill:i/(f*_)||0}}const Vr=1;class Pl{constructor(i,{pixelRatio:l,version:h,stretchX:f,stretchY:_,content:x}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=f,this.stretchY=_,this.content=x,this.version=h}get tl(){return[this.paddedRect.x+Vr,this.paddedRect.y+Vr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Vr,this.paddedRect.y+this.paddedRect.h-Vr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Vr)/this.pixelRatio,(this.paddedRect.h-2*Vr)/this.pixelRatio]}}class Qf{constructor(i,l){const h={},f={};this.haveRenderCallbacks=[];const _=[];this.addImages(i,h,_),this.addImages(l,f,_);const{w:x,h:C}=cp(_),I=new ro({width:x||1,height:C||1});for(const T in i){const P=i[T],L=h[T].paddedRect;ro.copy(P.data,I,{x:0,y:0},{x:L.x+Vr,y:L.y+Vr},P.data)}for(const T in l){const P=l[T],L=f[T].paddedRect,N=L.x+Vr,j=L.y+Vr,$=P.data.width,q=P.data.height;ro.copy(P.data,I,{x:0,y:0},{x:N,y:j},P.data),ro.copy(P.data,I,{x:0,y:q-1},{x:N,y:j-1},{width:$,height:1}),ro.copy(P.data,I,{x:0,y:0},{x:N,y:j+q},{width:$,height:1}),ro.copy(P.data,I,{x:$-1,y:0},{x:N-1,y:j},{width:1,height:q}),ro.copy(P.data,I,{x:0,y:0},{x:N+$,y:j},{width:1,height:q})}this.image=I,this.iconPositions=h,this.patternPositions=f}addImages(i,l,h){for(const f in i){const _=i[f],x={x:0,y:0,w:_.data.width+2*Vr,h:_.data.height+2*Vr};h.push(x),l[f]=new Pl(x,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in i.updatedImages)this.patchUpdatedImage(this.iconPositions[h],i.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],i.getImage(h),l)}patchUpdatedImage(i,l,h){if(!i||!l||i.version===l.version)return;i.version=l.version;const[f,_]=i.tl;h.update(l.data,void 0,{x:f,y:_})}}var kl;qe("ImagePosition",Pl),qe("ImageAtlas",Qf),g.ai=void 0,(kl=g.ai||(g.ai={}))[kl.none=0]="none",kl[kl.horizontal=1]="horizontal",kl[kl.vertical=2]="vertical",kl[kl.horizontalOnly=3]="horizontalOnly";const Du=-17;class Eh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,l){const h=new Eh;return h.scale=i||1,h.fontStack=l,h}static forImage(i){const l=new Eh;return l.imageName=i,l}}class jr{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const h=new jr;for(let f=0;f<i.sections.length;f++){const _=i.sections[f];_.image?h.addImageSection(_):h.addTextSection(_,l)}return h}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let l="";for(let h=0;h<i.length;h++){const f=i.charCodeAt(h+1)||null,_=i.charCodeAt(h-1)||null;l+=f&&ci(f)&&!Er[i[h+1]]||_&&ci(_)&&!Er[i[h-1]]||!Er[i[h]]?i[h]:Er[i[h]]}return l}(this.text)}trim(){let i=0;for(let h=0;h<this.text.length&&ea[this.text.charCodeAt(h)];h++)i++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=i&&ea[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const h=new jr;return h.text=this.text.substring(i,l),h.sectionIndex=this.sectionIndex.slice(i,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(Eh.forText(i.scale,i.fontStack||l));const h=this.sections.length-1;for(let f=0;f<i.text.length;++f)this.sectionIndex.push(h)}addImageSection(i){const l=i.image?i.image.name:"";if(0===l.length)return void xr("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(Eh.forImage(l)),this.sectionIndex.push(this.sections.length-1)):xr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Sc(s,i,l,h,f,_,x,C,I,T,P,L,N,j,$,q){const Q=jr.fromFeature(s,f);let te;L===g.ai.vertical&&Q.verticalizePunctuation();const{processBidirectionalText:ae,processStyledBidirectionalText:ie}=Qn;if(ae&&1===Q.sections.length){te=[];const De=ae(Q.toString(),hp(Q,T,_,i,h,j,$));for(const Ue of De){const Xe=new jr;Xe.text=Ue,Xe.sections=Q.sections;for(let je=0;je<Ue.length;je++)Xe.sectionIndex.push(0);te.push(Xe)}}else if(ie){te=[];const De=ie(Q.text,Q.sectionIndex,hp(Q,T,_,i,h,j,$));for(const Ue of De){const Xe=new jr;Xe.text=Ue[0],Xe.sectionIndex=Ue[1],Xe.sections=Q.sections,te.push(Xe)}}else te=function(De,Ue){const Xe=[],je=De.text;let Ne=0;for(const Le of Ue)Xe.push(De.substring(Ne,Le)),Ne=Le;return Ne<je.length&&Xe.push(De.substring(Ne,je.length)),Xe}(Q,hp(Q,T,_,i,h,j,$));const he=[],fe={positionedLines:he,text:Q.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(De,Ue,Xe,je,Ne,Le,He,Fe,Te,et,We,Pt){let fn=0,Dn=Du,cr=0,zi=0;const ri="right"===Fe?1:"left"===Fe?0:.5;let Wn=0;for(const hr of Ne){hr.trim();const mr=hr.getMaxScale(),ii=(mr-1)*ar,$r={positionedGlyphs:[],lineOffset:0};De.positionedLines[Wn]=$r;const oi=$r.positionedGlyphs;let gr=0;if(!hr.length()){Dn+=Le,++Wn;continue}for(let Xn=0;Xn<hr.length();Xn++){const Rt=hr.getSection(Xn),Hr=hr.getSectionIndex(Xn),Tr=hr.getCharCode(Xn);let rr=0,wo=null,Wo=null,Xo=null,ra=ar;const Co=!(Te===g.ai.horizontal||!We&&!us(Tr)||We&&(ea[Tr]||(nr=Tr,Oe.Arabic(nr)||Oe["Arabic Supplement"](nr)||Oe["Arabic Extended-A"](nr)||Oe["Arabic Presentation Forms-A"](nr)||Oe["Arabic Presentation Forms-B"](nr))));if(Rt.imageName){const yr=je[Rt.imageName];if(!yr)continue;Xo=Rt.imageName,De.iconsInText=De.iconsInText||!0,Wo=yr.paddedRect;const Ar=yr.displaySize;Rt.scale=Rt.scale*ar/Pt,wo={width:Ar[0],height:Ar[1],left:Vr,top:-Al,advance:Co?Ar[1]:Ar[0]},rr=ii+(ar-Ar[1]*Rt.scale),ra=wo.advance;const ia=Co?Ar[0]*Rt.scale-ar*mr:Ar[1]*Rt.scale-ar*mr;ia>0&&ia>gr&&(gr=ia)}else{const yr=Xe[Rt.fontStack],Ar=yr&&yr[Tr];if(Ar&&Ar.rect)Wo=Ar.rect,wo=Ar.metrics;else{const ia=Ue[Rt.fontStack],jh=ia&&ia[Tr];if(!jh)continue;wo=jh.metrics}rr=(mr-Rt.scale)*ar}Co?(De.verticalizable=!0,oi.push({glyph:Tr,imageName:Xo,x:fn,y:Dn+rr,vertical:Co,scale:Rt.scale,fontStack:Rt.fontStack,sectionIndex:Hr,metrics:wo,rect:Wo}),fn+=ra*Rt.scale+et):(oi.push({glyph:Tr,imageName:Xo,x:fn,y:Dn+rr,vertical:Co,scale:Rt.scale,fontStack:Rt.fontStack,sectionIndex:Hr,metrics:wo,rect:Wo}),fn+=wo.advance*Rt.scale+et)}0!==oi.length&&(cr=Math.max(fn-et,cr),pp(oi,0,oi.length-1,ri,gr)),fn=0;const Ur=Le*mr+gr;$r.lineOffset=Math.max(gr,ii),Dn+=Ur,zi=Math.max(Ur,zi),++Wn}var nr;const fr=Dn-Du,{horizontalAlign:ur,verticalAlign:fi}=dp(He);(function(hr,mr,ii,$r,oi,gr,Ur,Xn,Rt){const Hr=(mr-ii)*oi;let Tr=0;Tr=gr!==Ur?-Xn*$r-Du:(-$r*Rt+.5)*Ur;for(const rr of hr)for(const wo of rr.positionedGlyphs)wo.x+=Hr,wo.y+=Tr})(De.positionedLines,ri,ur,fi,cr,zi,Le,fr,Ne.length),De.top+=-fi*fr,De.bottom=De.top+fr,De.left+=-ur*cr,De.right=De.left+cr}(fe,i,l,h,te,x,C,I,L,T,N,q),!function(De){for(const Ue of De)if(0!==Ue.positionedGlyphs.length)return!1;return!0}(he)&&fe}const ea={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},R0={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function up(s,i,l,h,f,_){if(i.imageName){const x=h[i.imageName];return x?x.displaySize[0]*i.scale*ar/_+f:0}{const x=l[i.fontStack],C=x&&x[s];return C?C.metrics.advance*i.scale+f:0}}function Jf(s,i,l,h){const f=Math.pow(s-i,2);return h?s<i?f/2:2*f:f+Math.abs(l)*l}function _y(s,i,l){let h=0;return 10===s&&(h-=1e4),l&&(h+=150),40!==s&&65288!==s||(h+=50),41!==i&&65289!==i||(h+=50),h}function em(s,i,l,h,f,_){let x=null,C=Jf(i,l,f,_);for(const I of h){const T=Jf(i-I.x,l,f,_)+I.badness;T<=C&&(x=I,C=T)}return{index:s,x:i,priorBreak:x,badness:C}}function tm(s){return s?tm(s.priorBreak).concat(s.index):[]}function hp(s,i,l,h,f,_,x){if("point"!==_)return[];if(!s)return[];const C=[],I=function(N,j,$,q,Q,te){let ae=0;for(let ie=0;ie<N.length();ie++){const he=N.getSection(ie);ae+=up(N.getCharCode(ie),he,q,Q,j,te)}return ae/Math.max(1,Math.ceil(ae/$))}(s,i,l,h,f,x),T=s.text.indexOf("\u200b")>=0;let P=0;for(let N=0;N<s.length();N++){const j=s.getSection(N),$=s.getCharCode(N);if(ea[$]||(P+=up($,j,h,f,i,x)),N<s.length()-1){const q=!((L=$)<11904||!(Oe["Bopomofo Extended"](L)||Oe.Bopomofo(L)||Oe["CJK Compatibility Forms"](L)||Oe["CJK Compatibility Ideographs"](L)||Oe["CJK Compatibility"](L)||Oe["CJK Radicals Supplement"](L)||Oe["CJK Strokes"](L)||Oe["CJK Symbols and Punctuation"](L)||Oe["CJK Unified Ideographs Extension A"](L)||Oe["CJK Unified Ideographs"](L)||Oe["Enclosed CJK Letters and Months"](L)||Oe["Halfwidth and Fullwidth Forms"](L)||Oe.Hiragana(L)||Oe["Ideographic Description Characters"](L)||Oe["Kangxi Radicals"](L)||Oe["Katakana Phonetic Extensions"](L)||Oe.Katakana(L)||Oe["Vertical Forms"](L)||Oe["Yi Radicals"](L)||Oe["Yi Syllables"](L)));(R0[$]||q||j.imageName)&&C.push(em(N+1,P,I,C,_y($,s.getCharCode(N+1),q&&T),!1))}}var L;return tm(em(s.length(),P,I,C,0,!0))}function dp(s){let i=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function pp(s,i,l,h,f){if(!h&&!f)return;const _=s[l],x=(s[l].x+_.metrics.advance*_.scale)*h;for(let C=i;C<=l;C++)s[C].x-=x,s[C].y+=f}function Mh(s,i,l){const{horizontalAlign:h,verticalAlign:f}=dp(l),_=i[0]-s.displaySize[0]*h,x=i[1]-s.displaySize[1]*f;return{image:s,top:x,bottom:x+s.displaySize[1],left:_,right:_+s.displaySize[0]}}function nm(s,i,l,h,f,_){const x=s.image;let C;if(x.content){const Q=x.content,te=x.pixelRatio||1;C=[Q[0]/te,Q[1]/te,x.displaySize[0]-Q[2]/te,x.displaySize[1]-Q[3]/te]}const I=i.left*_,T=i.right*_;let P,L,N,j;"width"===l||"both"===l?(j=f[0]+I-h[3],L=f[0]+T+h[1]):(j=f[0]+(I+T-x.displaySize[0])/2,L=j+x.displaySize[0]);const $=i.top*_,q=i.bottom*_;return"height"===l||"both"===l?(P=f[1]+$-h[0],N=f[1]+q+h[2]):(P=f[1]+($+q-x.displaySize[1])/2,N=P+x.displaySize[1]),{image:x,top:P,right:L,bottom:N,left:j,collisionPadding:C}}const Va=255,_s=128,Go=Va*_s;function rm(s,i){const{expression:l}=i;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new tn(s+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:h,interpolationType:f}=l;let _=0;for(;_<h.length&&h[_]<=s;)_++;_=Math.max(0,_-1);let x=_;for(;x<h.length&&h[x]<s+1;)x++;x=Math.min(h.length-1,x);const C=h[_],I=h[x];return"composite"===l.kind?{kind:"composite",minZoom:C,maxZoom:I,interpolationType:f}:{kind:"camera",minZoom:C,maxZoom:I,minSize:l.evaluate(new tn(C)),maxSize:l.evaluate(new tn(I)),interpolationType:f}}}function Th(s,i,l){let h="never";const f=s.get(i);return f?h=f:s.get(l)&&(h="always"),h}const fp=gs.VectorTileFeature.types,Ah=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Su(s,i,l,h,f,_,x,C,I,T,P,L,N){const j=C?Math.min(Go,Math.round(C[0])):0,$=C?Math.min(Go,Math.round(C[1])):0;s.emplaceBack(i,l,Math.round(32*h),Math.round(32*f),_,x,(j<<1)+(I?1:0),$,16*T,16*P,256*L,256*N)}function mp(s,i,l){s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l)}function vy(s){for(const i of s.sections)if(uc(i.text))return!0;return!1}class ja{constructor(i){this.layoutVertexArray=new At,this.indexArray=new pr,this.programConfigurations=i,this.segments=new on,this.dynamicLayoutVertexArray=new bt,this.opacityVertexArray=new kt,this.hasVisibleVertices=!1,this.placedSymbolArray=new se}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,l,h,f){this.isEmpty()||(h&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Il.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,fy.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Ah,!0),this.opacityVertexBuffer.itemSize=1),(h||f)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}qe("SymbolBuffers",ja);class Rl{constructor(i,l,h){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new h,this.segments=new on,this.collisionVertexArray=new un}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Xf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}qe("CollisionBuffers",Rl);class Ic{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(x=>x.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=uh([]),this.placementViewportMatrix=uh([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rm(this.zoom,l["text-size"]),this.iconSizeData=rm(this.zoom,l["icon-size"]);const h=this.layers[0].layout,f=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.canOverlap="never"!==Th(h,"text-overlap","text-allow-overlap")||"never"!==Th(h,"icon-overlap","icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==_&&!f.isConstant(),this.sortFeaturesByY=("viewport-y"===_||"auto"===_&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===h.get("symbol-placement")&&(this.writingModes=h.get("text-writing-mode").map(x=>g.ai[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=i.sourceID}createArrays(){this.text=new ja(new $o(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new ja(new $o(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new ce,this.lineVertexArray=new me,this.symbolInstances=new ee,this.textAnchorOffsets=new be}calculateGlyphDependencies(i,l,h,f,_){for(let x=0;x<i.length;x++)if(l[i.charCodeAt(x)]=!0,(h||f)&&_){const C=Er[i.charAt(x)];C&&(l[C.charCodeAt(0)]=!0)}}populate(i,l,h){const f=this.layers[0],_=f.layout,x=_.get("text-font"),C=_.get("text-field"),I=_.get("icon-image"),T=("constant"!==C.value.kind||C.value.value instanceof br&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),P="constant"!==I.value.kind||!!I.value.value||Object.keys(I.parameters).length>0,L=_.get("symbol-sort-key");if(this.features=[],!T&&!P)return;const N=l.iconDependencies,j=l.glyphDependencies,$=l.availableImages,q=new tn(this.zoom);for(const{feature:Q,id:te,index:ae,sourceLayerIndex:ie}of i){const he=f._featureFilter.needGeometry,fe=xl(Q,he);if(!f._featureFilter.filter(q,fe,h))continue;let De,Ue;if(he||(fe.geometry=za(Q)),T){const je=f.getValueAndResolveTokens("text-field",fe,h,$),Ne=br.factory(je);vy(Ne)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===hs()||this.hasRTLText&&Qn.isParsed())&&(De=my(Ne,f,fe))}if(P){const je=f.getValueAndResolveTokens("icon-image",fe,h,$);Ue=je instanceof wr?je:wr.fromString(je)}if(!De&&!Ue)continue;const Xe=this.sortFeaturesByKey?L.evaluate(fe,{},h):void 0;if(this.features.push({id:te,text:De,icon:Ue,index:ae,sourceLayerIndex:ie,geometry:fe.geometry,properties:Q.properties,type:fp[Q.type],sortKey:Xe}),Ue&&(N[Ue.name]=!0),De){const je=x.evaluate(fe,{},h).join(","),Ne="viewport"!==_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(g.ai.vertical)>=0;for(const Le of De.sections)if(Le.image)N[Le.image.name]=!0;else{const He=$t(De.toString()),Fe=Le.fontStack||je,Te=j[Fe]=j[Fe]||{};this.calculateGlyphDependencies(Le.text,Te,Ne,this.allowVerticalPlacement,He)}}}"line"===_.get("symbol-placement")&&(this.features=function(Q){const te={},ae={},ie=[];let he=0;function fe(je){ie.push(Q[je]),he++}function De(je,Ne,Le){const He=ae[je];return delete ae[je],ae[Ne]=He,ie[He].geometry[0].pop(),ie[He].geometry[0]=ie[He].geometry[0].concat(Le[0]),He}function Ue(je,Ne,Le){const He=te[Ne];return delete te[Ne],te[je]=He,ie[He].geometry[0].shift(),ie[He].geometry[0]=Le[0].concat(ie[He].geometry[0]),He}function Xe(je,Ne,Le){const He=Le?Ne[0][Ne[0].length-1]:Ne[0][0];return`${je}:${He.x}:${He.y}`}for(let je=0;je<Q.length;je++){const Ne=Q[je],Le=Ne.geometry,He=Ne.text?Ne.text.toString():null;if(!He){fe(je);continue}const Fe=Xe(He,Le),Te=Xe(He,Le,!0);if(Fe in ae&&Te in te&&ae[Fe]!==te[Te]){const et=Ue(Fe,Te,Le),We=De(Fe,Te,ie[et].geometry);delete te[Fe],delete ae[Te],ae[Xe(He,ie[We].geometry,!0)]=We,ie[et].geometry=null}else Fe in ae?De(Fe,Te,Le):Te in te?Ue(Fe,Te,Le):(fe(je),te[Fe]=he-1,ae[Te]=he-1)}return ie.filter(je=>je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Q,te)=>Q.sortKey-te.sortKey)}update(i,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,h),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const h=this.lineVertexArray.length;if(void 0!==i.segment){let f=i.dist(l[i.segment+1]),_=i.dist(l[i.segment]);const x={};for(let C=i.segment+1;C<l.length;C++)x[C]={x:l[C].x,y:l[C].y,tileUnitDistanceFromAnchor:f},C<l.length-1&&(f+=l[C+1].dist(l[C]));for(let C=i.segment||0;C>=0;C--)x[C]={x:l[C].x,y:l[C].y,tileUnitDistanceFromAnchor:_},C>0&&(_+=l[C-1].dist(l[C]));for(let C=0;C<l.length;C++){const I=x[C];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(i,l,h,f,_,x,C,I,T,P,L,N){const j=i.indexArray,$=i.layoutVertexArray,q=i.segments.prepareSegment(4*l.length,$,j,this.canOverlap?x.sortKey:void 0),Q=this.glyphOffsetArray.length,te=q.vertexLength,ae=this.allowVerticalPlacement&&C===g.ai.vertical?Math.PI/2:0,ie=x.text&&x.text.sections;for(let he=0;he<l.length;he++){const{tl:fe,tr:De,bl:Ue,br:Xe,tex:je,pixelOffsetTL:Ne,pixelOffsetBR:Le,minFontScaleX:He,minFontScaleY:Fe,glyphOffset:Te,isSDF:et,sectionIndex:We}=l[he],Pt=q.vertexLength,fn=Te[1];Su($,I.x,I.y,fe.x,fn+fe.y,je.x,je.y,h,et,Ne.x,Ne.y,He,Fe),Su($,I.x,I.y,De.x,fn+De.y,je.x+je.w,je.y,h,et,Le.x,Ne.y,He,Fe),Su($,I.x,I.y,Ue.x,fn+Ue.y,je.x,je.y+je.h,h,et,Ne.x,Le.y,He,Fe),Su($,I.x,I.y,Xe.x,fn+Xe.y,je.x+je.w,je.y+je.h,h,et,Le.x,Le.y,He,Fe),mp(i.dynamicLayoutVertexArray,I,ae),j.emplaceBack(Pt,Pt+1,Pt+2),j.emplaceBack(Pt+1,Pt+2,Pt+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Te[0]),he!==l.length-1&&We===l[he+1].sectionIndex||i.programConfigurations.populatePaintArrays($.length,x,x.index,{},N,ie&&ie[We])}i.placedSymbolArray.emplaceBack(I.x,I.y,Q,this.glyphOffsetArray.length-Q,te,T,P,I.segment,h?h[0]:0,h?h[1]:0,f[0],f[1],C,0,!1,0,L)}_addCollisionDebugVertex(i,l,h,f,_,x){return l.emplaceBack(0,0),i.emplaceBack(h.x,h.y,f,_,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(i,l,h,f,_,x,C){const I=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),T=I.vertexLength,P=_.layoutVertexArray,L=_.collisionVertexArray,N=C.anchorX,j=C.anchorY;this._addCollisionDebugVertex(P,L,x,N,j,new tt(i,l)),this._addCollisionDebugVertex(P,L,x,N,j,new tt(h,l)),this._addCollisionDebugVertex(P,L,x,N,j,new tt(h,f)),this._addCollisionDebugVertex(P,L,x,N,j,new tt(i,f)),I.vertexLength+=4;const $=_.indexArray;$.emplaceBack(T,T+1),$.emplaceBack(T+1,T+2),$.emplaceBack(T+2,T+3),$.emplaceBack(T+3,T),I.primitiveLength+=4}addDebugCollisionBoxes(i,l,h,f){for(let _=i;_<l;_++){const x=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,f?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rl(An,sp.members,er),this.iconCollisionBox=new Rl(An,sp.members,er);for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(i,l,h,f,_,x,C,I,T){const P={};for(let L=l;L<h;L++){const N=i.get(L);P.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},P.textFeatureIndex=N.featureIndex;break}for(let L=f;L<_;L++){const N=i.get(L);P.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},P.verticalTextFeatureIndex=N.featureIndex;break}for(let L=x;L<C;L++){const N=i.get(L);P.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},P.iconFeatureIndex=N.featureIndex;break}for(let L=I;L<T;L++){const N=i.get(L);P.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},P.verticalIconFeatureIndex=N.featureIndex;break}return P}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const h=i.placedSymbolArray.get(l),f=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<f;_+=4)i.indexArray.emplaceBack(_,_+1,_+2),i.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(i),h=Math.cos(i),f=[],_=[],x=[];for(let C=0;C<this.symbolInstances.length;++C){x.push(C);const I=this.symbolInstances.get(C);f.push(0|Math.round(l*I.anchorX+h*I.anchorY)),_.push(I.featureIndex)}return x.sort((C,I)=>f[C]-f[I]||_[I]-_[C]),x}addToSortKeyRanges(i,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((f,_,x)=>{f>=0&&x.indexOf(f)===_&&this.addIndicesForPlacedSymbol(this.text,f)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let xy,gp;qe("SymbolBucket",Ic,{omit:["layers","collisionBoxArray","features","compareText"]}),Ic.MAX_GLYPHS=65535,Ic.addDynamicAttributes=mp;var yp={get paint(){return gp=gp||new Cn({"icon-opacity":new rt(_e.paint_symbol["icon-opacity"]),"icon-color":new rt(_e.paint_symbol["icon-color"]),"icon-halo-color":new rt(_e.paint_symbol["icon-halo-color"]),"icon-halo-width":new rt(_e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new rt(_e.paint_symbol["icon-halo-blur"]),"icon-translate":new Ke(_e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ke(_e.paint_symbol["icon-translate-anchor"]),"text-opacity":new rt(_e.paint_symbol["text-opacity"]),"text-color":new rt(_e.paint_symbol["text-color"],{runtimeType:Wr,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new rt(_e.paint_symbol["text-halo-color"]),"text-halo-width":new rt(_e.paint_symbol["text-halo-width"]),"text-halo-blur":new rt(_e.paint_symbol["text-halo-blur"]),"text-translate":new Ke(_e.paint_symbol["text-translate"]),"text-translate-anchor":new Ke(_e.paint_symbol["text-translate-anchor"])})},get layout(){return xy=xy||new Cn({"symbol-placement":new Ke(_e.layout_symbol["symbol-placement"]),"symbol-spacing":new Ke(_e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ke(_e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new rt(_e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ke(_e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ke(_e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ke(_e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ke(_e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ke(_e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ke(_e.layout_symbol["icon-rotation-alignment"]),"icon-size":new rt(_e.layout_symbol["icon-size"]),"icon-text-fit":new Ke(_e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ke(_e.layout_symbol["icon-text-fit-padding"]),"icon-image":new rt(_e.layout_symbol["icon-image"]),"icon-rotate":new rt(_e.layout_symbol["icon-rotate"]),"icon-padding":new rt(_e.layout_symbol["icon-padding"]),"icon-keep-upright":new Ke(_e.layout_symbol["icon-keep-upright"]),"icon-offset":new rt(_e.layout_symbol["icon-offset"]),"icon-anchor":new rt(_e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ke(_e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ke(_e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ke(_e.layout_symbol["text-rotation-alignment"]),"text-field":new rt(_e.layout_symbol["text-field"]),"text-font":new rt(_e.layout_symbol["text-font"]),"text-size":new rt(_e.layout_symbol["text-size"]),"text-max-width":new rt(_e.layout_symbol["text-max-width"]),"text-line-height":new Ke(_e.layout_symbol["text-line-height"]),"text-letter-spacing":new rt(_e.layout_symbol["text-letter-spacing"]),"text-justify":new rt(_e.layout_symbol["text-justify"]),"text-radial-offset":new rt(_e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ke(_e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new rt(_e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new rt(_e.layout_symbol["text-anchor"]),"text-max-angle":new Ke(_e.layout_symbol["text-max-angle"]),"text-writing-mode":new Ke(_e.layout_symbol["text-writing-mode"]),"text-rotate":new rt(_e.layout_symbol["text-rotate"]),"text-padding":new Ke(_e.layout_symbol["text-padding"]),"text-keep-upright":new Ke(_e.layout_symbol["text-keep-upright"]),"text-transform":new rt(_e.layout_symbol["text-transform"]),"text-offset":new rt(_e.layout_symbol["text-offset"]),"text-allow-overlap":new Ke(_e.layout_symbol["text-allow-overlap"]),"text-overlap":new Ke(_e.layout_symbol["text-overlap"]),"text-ignore-placement":new Ke(_e.layout_symbol["text-ignore-placement"]),"text-optional":new Ke(_e.layout_symbol["text-optional"])})}};class by{constructor(i){if(void 0===i.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:Po,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qe("FormatSectionOverride",by,{omit:["defaultValue"]});class Ph extends Ji{constructor(i){super(i,yp)}recalculate(i,l){if(super.recalculate(i,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const h=this.layout.get("text-writing-mode");if(h){const f=[];for(const _ of h)f.indexOf(_)<0&&f.push(_);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,l,h,f){const _=this.layout.get(i).evaluate(l,{},h,f),x=this._unevaluatedLayout._values[i];return x.isDataDriven()||oc(x.value)||!_?_:(C=l.properties,_.replace(/{([^{}]+)}/g,(T,P)=>P in C?String(C[P]):""));var C}createBucket(i){return new Ic(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of yp.paint.overridableProperties){if(!Ph.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),h=new by(l),f=new Ea(h,l.property.specification);let _=null;_="constant"===l.value.kind||"source"===l.value.kind?new Wc("source",f):new dl("composite",f,l.value.zoomStops),this.paint._values[i]=new Jn(l.property,_,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&Ph.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const h=i.get("text-field"),f=yp.paint.properties[l];let _=!1;const x=C=>{for(const I of C)if(f.overrides&&f.overrides.hasOverride(I))return void(_=!0)};if("constant"===h.value.kind&&h.value.value instanceof br)x(h.value.value.sections);else if("source"===h.value.kind){const C=T=>{_||(T instanceof Ls&&En(T.value)===X?x(T.value.sections):T instanceof Da?x(T.sections):T.eachChild(C))},I=h.value;I._styleExpression&&C(I._styleExpression.expression)}return _}}let im;var wy={get paint(){return im=im||new Cn({"background-color":new Ke(_e.paint_background["background-color"]),"background-pattern":new Qi(_e.paint_background["background-pattern"]),"background-opacity":new Ke(_e.paint_background["background-opacity"])})}};class kh extends Ji{constructor(i){super(i,wy)}}let _p;var Cy={get paint(){return _p=_p||new Cn({"raster-opacity":new Ke(_e.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ke(_e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ke(_e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ke(_e.paint_raster["raster-brightness-max"]),"raster-saturation":new Ke(_e.paint_raster["raster-saturation"]),"raster-contrast":new Ke(_e.paint_raster["raster-contrast"]),"raster-resampling":new Ke(_e.paint_raster["raster-resampling"]),"raster-fade-duration":new Ke(_e.paint_raster["raster-fade-duration"])})}};class om extends Ji{constructor(i){super(i,Cy)}}class O0 extends Ji{constructor(i){super(i,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class sm{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const am=6371008.8;class $a{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new $a(Ms(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,h=this.lat*l,f=i.lat*l,_=Math.sin(h)*Math.sin(f)+Math.cos(h)*Math.cos(f)*Math.cos((i.lng-this.lng)*l);return am*Math.acos(Math.min(_,1))}static convert(i){if(i instanceof $a)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new $a(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new $a(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const lm=2*Math.PI*am;function Rh(s){return lm*Math.cos(s*Math.PI/180)}function Dy(s){return(180+s)/360}function Sy(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Oh(s,i){return s/Rh(i)}function cm(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class vp{constructor(i,l,h=0){this.x=+i,this.y=+l,this.z=+h}static fromLngLat(i,l=0){const h=$a.convert(i);return new vp(Dy(h.lng),Sy(h.lat),Oh(l,h.lat))}toLngLat(){return new $a(360*this.x-180,cm(this.y))}toAltitude(){return this.z*Rh(cm(this.y))}meterInMercatorCoordinateUnits(){return 1/lm*(i=cm(this.y),1/Math.cos(i*Math.PI/180));var i}}function Iy(s,i,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[s*h-2*Math.PI*6378137/2,i*h-2*Math.PI*6378137/2]}class um{constructor(i,l,h){if(i<0||i>25||h<0||h>=Math.pow(2,i)||l<0||l>=Math.pow(2,i))throw new Error(`x=${l}, y=${h}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=l,this.y=h,this.key=Ua(0,i,i,l,h)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l,h){const f=(x=this.y,C=this.z,I=Iy(256*(_=this.x),256*(x=Math.pow(2,C)-x-1),C),T=Iy(256*(_+1),256*(x+1),C),I[0]+","+I[1]+","+T[0]+","+T[1]);var _,x,C,I,T;const P=function(L,N,j){let $,q="";for(let Q=L;Q>0;Q--)$=1<<Q-1,q+=(N&$?1:0)+(j&$?2:0);return q}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===h?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,f)}isChildOf(i){const l=this.z-i.z;return l>0&&i.x===this.x>>l&&i.y===this.y>>l}getTilePoint(i){const l=Math.pow(2,this.z);return new tt((i.x*l-this.x)*tr,(i.y*l-this.y)*tr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ey{constructor(i,l){this.wrap=i,this.canonical=l,this.key=Ua(i,l.z,l.z,l.x,l.y)}}class io{constructor(i,l,h,f,_){if(i<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${h}`);this.overscaledZ=i,this.wrap=l,this.canonical=new um(h,+f,+_),this.key=Ua(l,i,h,f,_)}clone(){return new io(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-i;return i>this.canonical.z?new io(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new io(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-i;return i>this.canonical.z?Ua(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y):Ua(this.wrap*+l,i,i,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new io(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,f=2*this.canonical.y;return[new io(l,this.wrap,l,h,f),new io(l,this.wrap,l,h+1,f),new io(l,this.wrap,l,h,f+1),new io(l,this.wrap,l,h+1,f+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new io(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new io(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ey(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new vp(i.x-this.wrap,i.y))}}function Ua(s,i,l,h,f){(s*=2)<0&&(s=-1*s-1);const _=1<<l;return(_*_*s+_*f+h).toString(36)+l.toString(36)+i.toString(36)}qe("CanonicalTileID",um),qe("OverscaledTileID",io,{omit:["posMatrix"]});class Iu{constructor(i,l,h,f=1,_=1,x=1,C=0){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void xr(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const I=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=_,this.blueFactor=x,this.baseShift=C;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<I;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(I,T)]=this.data[this._idx(I-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,I)]=this.data[this._idx(T,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<I;T++)for(let P=0;P<I;P++){const L=this.get(T,P);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(i,l){const h=new Uint8Array(this.data.buffer),f=4*this._idx(i,l);return this.unpack(h[f],h[f+1],h[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}unpack(i,l,h){return i*this.redFactor+l*this.greenFactor+h*this.blueFactor-this.baseShift}getPixels(){return new ro({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,h){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,_=l*this.dim+this.dim,x=h*this.dim,C=h*this.dim+this.dim;switch(l){case-1:f=_-1;break;case 1:_=f+1}switch(h){case-1:x=C-1;break;case 1:C=x+1}const I=-l*this.dim,T=-h*this.dim;for(let P=x;P<C;P++)for(let L=f;L<_;L++)this.data[this._idx(L,P)]=i.data[this._idx(L+I,P+T)]}}qe("DEMData",Iu);class xp{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const h=i[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class bp{constructor(i,l,h,f,_){this.type="Feature",this._vectorTileFeature=i,i._z=l,i._x=h,i._y=f,this.properties=i.properties,this.id=_}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const l in this)"_geometry"!==l&&"_vectorTileFeature"!==l&&(i[l]=this[l]);return i}}class wp{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new ka(tr,16,0),this.grid3D=new ka(tr,16,0),this.featureIndexArray=new Ie,this.promoteId=l}insert(i,l,h,f,_,x){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,f,_);const I=x?this.grid3D:this.grid;for(let T=0;T<l.length;T++){const P=l[T],L=[1/0,1/0,-1/0,-1/0];for(let N=0;N<P.length;N++){const j=P[N];L[0]=Math.min(L[0],j.x),L[1]=Math.min(L[1],j.y),L[2]=Math.max(L[2],j.x),L[3]=Math.max(L[3],j.y)}L[0]<tr&&L[1]<tr&&L[2]>=0&&L[3]>=0&&I.insert(C,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new gs.VectorTile(new lr(this.rawTileData)).layers,this.sourceLayerCoder=new xp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,l,h,f){this.loadVTLayers();const _=i.params||{},x=tr/i.tileSize/i.scale,C=ac(_.filter),I=i.queryGeometry,T=i.queryPadding*x,P=Cp(I),L=this.grid.query(P.minX-T,P.minY-T,P.maxX+T,P.maxY+T),N=Cp(i.cameraQueryGeometry),j=this.grid3D.query(N.minX-T,N.minY-T,N.maxX+T,N.maxY+T,(Q,te,ae,ie)=>function(he,fe,De,Ue,Xe){for(const Ne of he)if(fe<=Ne.x&&De<=Ne.y&&Ue>=Ne.x&&Xe>=Ne.y)return!0;const je=[new tt(fe,De),new tt(fe,Xe),new tt(Ue,Xe),new tt(Ue,De)];if(he.length>2)for(const Ne of je)if(Ho(he,Ne))return!0;for(let Ne=0;Ne<he.length-1;Ne++)if(no(he[Ne],he[Ne+1],je))return!0;return!1}(i.cameraQueryGeometry,Q-T,te-T,ae+T,ie+T));for(const Q of j)L.push(Q);L.sort(hm);const $={};let q;for(let Q=0;Q<L.length;Q++){const te=L[Q];if(te===q)continue;q=te;const ae=this.featureIndexArray.get(te);let ie=null;this.loadMatchingFeature($,ae.bucketIndex,ae.sourceLayerIndex,ae.featureIndex,C,_.layers,_.availableImages,l,h,f,(he,fe,De)=>(ie||(ie=za(he)),fe.queryIntersectsFeature(I,he,De,ie,this.z,i.transform,x,i.pixelPosMatrix)))}return $}loadMatchingFeature(i,l,h,f,_,x,C,I,T,P,L){const N=this.bucketLayerIDs[l];if(x&&!function(Q,te){for(let ae=0;ae<Q.length;ae++)if(te.indexOf(Q[ae])>=0)return!0;return!1}(x,N))return;const j=this.sourceLayerCoder.decode(h),$=this.vtLayers[j].feature(f);if(_.needGeometry){const Q=xl($,!0);if(!_.filter(new tn(this.tileID.overscaledZ),Q,this.tileID.canonical))return}else if(!_.filter(new tn(this.tileID.overscaledZ),$))return;const q=this.getId($,j);for(let Q=0;Q<N.length;Q++){const te=N[Q];if(x&&x.indexOf(te)<0)continue;const ae=I[te];if(!ae)continue;let ie={};q&&P&&(ie=P.getState(ae.sourceLayer||"_geojsonTileLayer",q));const he=vr({},T[te]);he.paint=Ol(he.paint,ae.paint,$,ie,C),he.layout=Ol(he.layout,ae.layout,$,ie,C);const fe=!L||L($,ae,ie);if(!fe)continue;const De=new bp($,this.z,this.x,this.y,q);De.layer=he;let Ue=i[te];void 0===Ue&&(Ue=i[te]=[]),Ue.push({featureIndex:f,feature:De,intersectionZ:fe})}}lookupSymbolFeatures(i,l,h,f,_,x,C,I){const T={};this.loadVTLayers();const P=ac(_);for(const L of i)this.loadMatchingFeature(T,h,f,L,P,x,C,I,l);return T}hasLayer(i){for(const l of this.bucketLayerIDs)for(const h of l)if(i===h)return!0;return!1}getId(i,l){let h=i.id;return this.promoteId&&(h=i.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[l]],"boolean"==typeof h&&(h=Number(h))),h}}function Ol(s,i,l,h,f){return In(s,(_,x)=>{const C=i instanceof wi?i.get(x):null;return C&&C.evaluate?C.evaluate(l,h,f):C})}function Cp(s){let i=1/0,l=1/0,h=-1/0,f=-1/0;for(const _ of s)i=Math.min(i,_.x),l=Math.min(l,_.y),h=Math.max(h,_.x),f=Math.max(f,_.y);return{minX:i,minY:l,maxX:h,maxY:f}}function hm(s,i){return i-s}function Eu(s,i,l,h,f){const _=[];for(let x=0;x<s.length;x++){const C=s[x];let I;for(let T=0;T<C.length-1;T++){let P=C[T],L=C[T+1];P.x<i&&L.x<i||(P.x<i?P=new tt(i,P.y+(i-P.x)/(L.x-P.x)*(L.y-P.y))._round():L.x<i&&(L=new tt(i,P.y+(i-P.x)/(L.x-P.x)*(L.y-P.y))._round()),P.y<l&&L.y<l||(P.y<l?P=new tt(P.x+(l-P.y)/(L.y-P.y)*(L.x-P.x),l)._round():L.y<l&&(L=new tt(P.x+(l-P.y)/(L.y-P.y)*(L.x-P.x),l)._round()),P.x>=h&&L.x>=h||(P.x>=h?P=new tt(h,P.y+(h-P.x)/(L.x-P.x)*(L.y-P.y))._round():L.x>=h&&(L=new tt(h,P.y+(h-P.x)/(L.x-P.x)*(L.y-P.y))._round()),P.y>=f&&L.y>=f||(P.y>=f?P=new tt(P.x+(f-P.y)/(L.y-P.y)*(L.x-P.x),f)._round():L.y>=f&&(L=new tt(P.x+(f-P.y)/(L.y-P.y)*(L.x-P.x),f)._round()),I&&P.equals(I[I.length-1])||(I=[P],_.push(I)),I.push(L)))))}}return _}qe("FeatureIndex",wp,{omit:["rawTileData","sourceLayerCoder"]});class Zo extends tt{constructor(i,l,h,f){super(i,l),this.angle=h,void 0!==f&&(this.segment=f)}clone(){return new Zo(this.x,this.y,this.angle,this.segment)}}function ta(s,i,l,h,f){if(void 0===i.segment||0===l)return!0;let _=i,x=i.segment+1,C=0;for(;C>-l/2;){if(x--,x<0)return!1;C-=s[x].dist(_),_=s[x]}C+=s[x].dist(s[x+1]),x++;const I=[];let T=0;for(;C<l/2;){const P=s[x],L=s[x+1];if(!L)return!1;let N=s[x-1].angleTo(P)-P.angleTo(L);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:C,angleDelta:N}),T+=N;C-I[0].distance>h;)T-=I.shift().angleDelta;if(T>f)return!1;x++,C+=P.dist(L)}return!0}function dm(s){let i=0;for(let l=0;l<s.length-1;l++)i+=s[l].dist(s[l+1]);return i}function pm(s,i,l){return s?.6*i*l:0}function fm(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function mm(s,i,l,h,f,_){const x=pm(l,f,_),C=fm(l,h)*_;let I=0;const T=dm(s)/2;for(let P=0;P<s.length-1;P++){const L=s[P],N=s[P+1],j=L.dist(N);if(I+j>T){const $=(T-I)/j,q=Ti.number(L.x,N.x,$),Q=Ti.number(L.y,N.y,$),te=new Zo(q,Q,N.angleTo(L),P);return te._round(),!x||ta(s,te,C,x,i)?te:void 0}I+=j}}function Dp(s,i,l,h,f,_,x,C,I){const T=pm(h,_,x),P=fm(h,f),L=P*x,N=0===s[0].x||s[0].x===I||0===s[0].y||s[0].y===I;return i-L<i/4&&(i=L+i/4),gm(s,N?i/2*C%i:(P/2+2*_)*x*C%i,i,T,l,L,N,!1,I)}function gm(s,i,l,h,f,_,x,C,I){const T=_/2,P=dm(s);let L=0,N=i-l,j=[];for(let $=0;$<s.length-1;$++){const q=s[$],Q=s[$+1],te=q.dist(Q),ae=Q.angleTo(q);for(;N+l<L+te;){N+=l;const ie=(N-L)/te,he=Ti.number(q.x,Q.x,ie),fe=Ti.number(q.y,Q.y,ie);if(he>=0&&he<I&&fe>=0&&fe<I&&N-T>=0&&N+T<=P){const De=new Zo(he,fe,ae,$);De._round(),h&&!ta(s,De,_,h,f)||j.push(De)}}L+=te}return C||j.length||x||(j=gm(s,L/2,l,h,f,_,x,!0,I)),j}qe("Anchor",Zo);const Ec=Vr;function ym(s,i,l,h){const f=[],_=s.image,x=_.pixelRatio,C=_.paddedRect.w-2*Ec,I=_.paddedRect.h-2*Ec,T=s.right-s.left,P=s.bottom-s.top,L=_.stretchX||[[0,C]],N=_.stretchY||[[0,I]],j=(Le,He)=>Le+He[1]-He[0],$=L.reduce(j,0),q=N.reduce(j,0),Q=C-$,te=I-q;let ae=0,ie=$,he=0,fe=q,De=0,Ue=Q,Xe=0,je=te;if(_.content&&h){const Le=_.content;ae=Mu(L,0,Le[0]),he=Mu(N,0,Le[1]),ie=Mu(L,Le[0],Le[2]),fe=Mu(N,Le[1],Le[3]),De=Le[0]-ae,Xe=Le[1]-he,Ue=Le[2]-Le[0]-ie,je=Le[3]-Le[1]-fe}const Ne=(Le,He,Fe,Te)=>{const et=Lh(Le.stretch-ae,ie,T,s.left),We=ni(Le.fixed-De,Ue,Le.stretch,$),Pt=Lh(He.stretch-he,fe,P,s.top),fn=ni(He.fixed-Xe,je,He.stretch,q),Dn=Lh(Fe.stretch-ae,ie,T,s.left),cr=ni(Fe.fixed-De,Ue,Fe.stretch,$),zi=Lh(Te.stretch-he,fe,P,s.top),ri=ni(Te.fixed-Xe,je,Te.stretch,q),Wn=new tt(et,Pt),nr=new tt(Dn,Pt),fr=new tt(Dn,zi),ur=new tt(et,zi),fi=new tt(We/x,fn/x),hr=new tt(cr/x,ri/x),mr=i*Math.PI/180;if(mr){const oi=Math.sin(mr),gr=Math.cos(mr),Ur=[gr,-oi,oi,gr];Wn._matMult(Ur),nr._matMult(Ur),ur._matMult(Ur),fr._matMult(Ur)}const ii=Le.stretch+Le.fixed,$r=He.stretch+He.fixed;return{tl:Wn,tr:nr,bl:ur,br:fr,tex:{x:_.paddedRect.x+Ec+ii,y:_.paddedRect.y+Ec+$r,w:Fe.stretch+Fe.fixed-ii,h:Te.stretch+Te.fixed-$r},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fi,pixelOffsetBR:hr,minFontScaleX:Ue/x/T,minFontScaleY:je/x/P,isSDF:l}};if(h&&(_.stretchX||_.stretchY)){const Le=_m(L,Q,$),He=_m(N,te,q);for(let Fe=0;Fe<Le.length-1;Fe++){const Te=Le[Fe],et=Le[Fe+1];for(let We=0;We<He.length-1;We++)f.push(Ne(Te,He[We],et,He[We+1]))}}else f.push(Ne({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:I+1}));return f}function Mu(s,i,l){let h=0;for(const f of s)h+=Math.max(i,Math.min(l,f[1]))-Math.max(i,Math.min(l,f[0]));return h}function _m(s,i,l){const h=[{fixed:-Ec,stretch:0}];for(const[f,_]of s){const x=h[h.length-1];h.push({fixed:f-x.stretch,stretch:x.stretch}),h.push({fixed:f-x.stretch,stretch:x.stretch+(_-f)})}return h.push({fixed:i+Ec,stretch:l}),h}function Lh(s,i,l,h){return s/i*l+h}function ni(s,i,l,h){return s-i*l/h}class Mc{constructor(i,l,h,f,_,x,C,I,T,P){if(this.boxStartIndex=i.length,T){let L=x.top,N=x.bottom;const j=x.collisionPadding;j&&(L-=j[1],N+=j[3]);let $=N-L;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{let L=x.top*C-I[0],N=x.bottom*C+I[2],j=x.left*C-I[3],$=x.right*C+I[1];const q=x.collisionPadding;if(q&&(j-=q[0]*C,L-=q[1]*C,$+=q[2]*C,N+=q[3]*C),P){const Q=new tt(j,L),te=new tt($,L),ae=new tt(j,N),ie=new tt($,N),he=P*Math.PI/180;Q._rotate(he),te._rotate(he),ae._rotate(he),ie._rotate(he),j=Math.min(Q.x,te.x,ae.x,ie.x),$=Math.max(Q.x,te.x,ae.x,ie.x),L=Math.min(Q.y,te.y,ae.y,ie.y),N=Math.max(Q.y,te.y,ae.y,ie.y)}i.emplaceBack(l.x,l.y,j,L,$,N,h,f,_)}this.boxEndIndex=i.length}}class vm{constructor(i=[],l=Sp){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:h}=this,f=l[i];for(;i>0;){const _=i-1>>1,x=l[_];if(h(f,x)>=0)break;l[i]=x,i=_}l[i]=f}_down(i){const{data:l,compare:h}=this,f=this.length>>1,_=l[i];for(;i<f;){let x=1+(i<<1),C=l[x];const I=x+1;if(I<this.length&&h(l[I],C)<0&&(x=I,C=l[I]),h(C,_)>=0)break;l[i]=C,i=x}l[i]=_}}function Sp(s,i){return s<i?-1:s>i?1:0}function pi(s,i=1,l=!1){let h=1/0,f=1/0,_=-1/0,x=-1/0;const C=s[0];for(let j=0;j<C.length;j++){const $=C[j];(!j||$.x<h)&&(h=$.x),(!j||$.y<f)&&(f=$.y),(!j||$.x>_)&&(_=$.x),(!j||$.y>x)&&(x=$.y)}const I=Math.min(_-h,x-f);let T=I/2;const P=new vm([],Tu);if(0===I)return new tt(h,f);for(let j=h;j<_;j+=I)for(let $=f;$<x;$+=I)P.push(new Ll(j+T,$+T,T,s));let L=function(j){let $=0,q=0,Q=0;const te=j[0];for(let ae=0,ie=te.length,he=ie-1;ae<ie;he=ae++){const fe=te[ae],De=te[he],Ue=fe.x*De.y-De.x*fe.y;q+=(fe.x+De.x)*Ue,Q+=(fe.y+De.y)*Ue,$+=3*Ue}return new Ll(q/$,Q/$,0,j)}(s),N=P.length;for(;P.length;){const j=P.pop();(j.d>L.d||!L.d)&&(L=j,l&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,N)),j.max-L.d<=i||(T=j.h/2,P.push(new Ll(j.p.x-T,j.p.y-T,T,s)),P.push(new Ll(j.p.x+T,j.p.y-T,T,s)),P.push(new Ll(j.p.x-T,j.p.y+T,T,s)),P.push(new Ll(j.p.x+T,j.p.y+T,T,s)),N+=4)}return l&&(console.log(`num probes: ${N}`),console.log(`best distance: ${L.d}`)),L.p}function Tu(s,i){return i.max-s.max}function Ll(s,i,l,h){this.p=new tt(s,i),this.h=l,this.d=function(f,_){let x=!1,C=1/0;for(let I=0;I<_.length;I++){const T=_[I];for(let P=0,L=T.length,N=L-1;P<L;N=P++){const j=T[P],$=T[N];j.y>f.y!=$.y>f.y&&f.x<($.x-j.x)*(f.y-j.y)/($.y-j.y)+j.x&&(x=!x),C=Math.min(C,Rf(f,j,$))}}return(x?1:-1)*Math.sqrt(C)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}var Mr;g.aq=void 0,(Mr=g.aq||(g.aq={}))[Mr.center=1]="center",Mr[Mr.left=2]="left",Mr[Mr.right=3]="right",Mr[Mr.top=4]="top",Mr[Mr.bottom=5]="bottom",Mr[Mr["top-left"]=6]="top-left",Mr[Mr["top-right"]=7]="top-right",Mr[Mr["bottom-left"]=8]="bottom-left",Mr[Mr["bottom-right"]=9]="bottom-right";const Ha=7,Fh=Number.POSITIVE_INFINITY;function xm(s,i){return i[1]!==Fh?function(l,h,f){let _=0,x=0;switch(h=Math.abs(h),f=Math.abs(f),l){case"top-right":case"top-left":case"top":x=f-Ha;break;case"bottom-right":case"bottom-left":case"bottom":x=-f+Ha}switch(l){case"top-right":case"bottom-right":case"right":_=-h;break;case"top-left":case"bottom-left":case"left":_=h}return[_,x]}(s,i[0],i[1]):function(l,h){let f=0,_=0;h<0&&(h=0);const x=h/Math.SQRT2;switch(l){case"top-right":case"top-left":_=x-Ha;break;case"bottom-right":case"bottom-left":_=-x+Ha;break;case"bottom":_=-h+Ha;break;case"top":_=h-Ha}switch(l){case"top-right":case"bottom-right":f=-x;break;case"top-left":case"bottom-left":f=x;break;case"left":f=h;break;case"right":f=-h}return[f,_]}(s,i[0])}function Ip(s,i,l){var h;const f=s.layout,_=null===(h=f.get("text-variable-anchor-offset"))||void 0===h?void 0:h.evaluate(i,{},l);if(_){const C=_.values,I=[];for(let T=0;T<C.length;T+=2){const P=I[T]=C[T],L=C[T+1].map(N=>N*ar);P.startsWith("top")?L[1]-=Ha:P.startsWith("bottom")&&(L[1]+=Ha),I[T+1]=L}return new Mi(I)}const x=f.get("text-variable-anchor");if(x){let C;C=void 0!==s._unevaluatedLayout.getValue("text-radial-offset")?[f.get("text-radial-offset").evaluate(i,{},l)*ar,Fh]:f.get("text-offset").evaluate(i,{},l).map(T=>T*ar);const I=[];for(const T of x)I.push(T,xm(T,C));return new Mi(I)}return null}function Ep(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bm(s,i,l,h,f,_,x,C,I,T,P){let L=_.textMaxSize.evaluate(i,{});void 0===L&&(L=x);const N=s.layers[0].layout,j=N.get("icon-offset").evaluate(i,{},P),$=Cm(l.horizontal),q=x/24,Q=s.tilePixelRatio*q,te=s.tilePixelRatio*L/24,ae=s.tilePixelRatio*C,ie=s.tilePixelRatio*N.get("symbol-spacing"),he=N.get("text-padding")*s.tilePixelRatio,fe=function(Te,et,We,Pt=1){const fn=Te.get("icon-padding").evaluate(et,{},We),Dn=fn&&fn.values;return[Dn[0]*Pt,Dn[1]*Pt,Dn[2]*Pt,Dn[3]*Pt]}(N,i,P,s.tilePixelRatio),De=N.get("text-max-angle")/180*Math.PI,Ue="viewport"!==N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),Xe="map"===N.get("icon-rotation-alignment")&&"point"!==N.get("symbol-placement"),je=N.get("symbol-placement"),Ne=ie/2,Le=N.get("icon-text-fit");let He;h&&"none"!==Le&&(s.allowVerticalPlacement&&l.vertical&&(He=nm(h,l.vertical,Le,N.get("icon-text-fit-padding"),j,q)),$&&(h=nm(h,$,Le,N.get("icon-text-fit-padding"),j,q)));const Fe=(Te,et)=>{et.x<0||et.x>=tr||et.y<0||et.y>=tr||function(We,Pt,fn,Dn,cr,zi,ri,Wn,nr,fr,ur,fi,hr,mr,ii,$r,oi,gr,Ur,Xn,Rt,Hr,Tr,rr,wo){const Wo=We.addToLineVertexArray(Pt,fn);let Xo,ra,Co,yr,Ar=0,ia=0,jh=0,Ty=0,Sm=-1,Im=-1;const Ga={};let Pp=fs("");if(We.allowVerticalPlacement&&Dn.vertical){const mi=Wn.layout.get("text-rotate").evaluate(Rt,{},rr)+90;Co=new Mc(nr,Pt,fr,ur,fi,Dn.vertical,hr,mr,ii,mi),ri&&(yr=new Mc(nr,Pt,fr,ur,fi,ri,oi,gr,ii,mi))}if(cr){const mi=Wn.layout.get("icon-rotate").evaluate(Rt,{}),So="none"!==Wn.layout.get("icon-text-fit"),Za=ym(cr,mi,Tr,So),Yo=ri?ym(ri,mi,Tr,So):void 0;ra=new Mc(nr,Pt,fr,ur,fi,cr,oi,gr,!1,mi),Ar=4*Za.length;const Nl=We.iconSizeData;let vs=null;"source"===Nl.kind?(vs=[_s*Wn.layout.get("icon-size").evaluate(Rt,{})],vs[0]>Go&&xr(`${We.layerIds[0]}: Value for "icon-size" is >= ${Va}. Reduce your "icon-size".`)):"composite"===Nl.kind&&(vs=[_s*Hr.compositeIconSizes[0].evaluate(Rt,{},rr),_s*Hr.compositeIconSizes[1].evaluate(Rt,{},rr)],(vs[0]>Go||vs[1]>Go)&&xr(`${We.layerIds[0]}: Value for "icon-size" is >= ${Va}. Reduce your "icon-size".`)),We.addSymbols(We.icon,Za,vs,Xn,Ur,Rt,g.ai.none,Pt,Wo.lineStartIndex,Wo.lineLength,-1,rr),Sm=We.icon.placedSymbolArray.length-1,Yo&&(ia=4*Yo.length,We.addSymbols(We.icon,Yo,vs,Xn,Ur,Rt,g.ai.vertical,Pt,Wo.lineStartIndex,Wo.lineLength,-1,rr),Im=We.icon.placedSymbolArray.length-1)}const Em=Object.keys(Dn.horizontal);for(const mi of Em){const So=Dn.horizontal[mi];if(!Xo){Pp=fs(So.text);const Yo=Wn.layout.get("text-rotate").evaluate(Rt,{},rr);Xo=new Mc(nr,Pt,fr,ur,fi,So,hr,mr,ii,Yo)}const Za=1===So.positionedLines.length;if(jh+=wm(We,Pt,So,zi,Wn,ii,Rt,$r,Wo,Dn.vertical?g.ai.horizontal:g.ai.horizontalOnly,Za?Em:[mi],Ga,Sm,Hr,rr),Za)break}Dn.vertical&&(Ty+=wm(We,Pt,Dn.vertical,zi,Wn,ii,Rt,$r,Wo,g.ai.vertical,["vertical"],Ga,Im,Hr,rr));const Ay=Xo?Xo.boxStartIndex:We.collisionBoxArray.length,Py=Xo?Xo.boxEndIndex:We.collisionBoxArray.length,ky=Co?Co.boxStartIndex:We.collisionBoxArray.length,kp=Co?Co.boxEndIndex:We.collisionBoxArray.length,oa=ra?ra.boxStartIndex:We.collisionBoxArray.length,ku=ra?ra.boxEndIndex:We.collisionBoxArray.length,Mm=yr?yr.boxStartIndex:We.collisionBoxArray.length,Tm=yr?yr.boxEndIndex:We.collisionBoxArray.length;let Do=-1;const Rp=(mi,So)=>mi&&mi.circleDiameter?Math.max(mi.circleDiameter,So):So;Do=Rp(Xo,Do),Do=Rp(Co,Do),Do=Rp(ra,Do),Do=Rp(yr,Do);const Ry=Do>-1?1:0;Ry&&(Do*=wo/ar),We.glyphOffsetArray.length>=Ic.MAX_GLYPHS&&xr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Rt.sortKey&&We.addToSortKeyRanges(We.symbolInstances.length,Rt.sortKey);const L0=Ip(Wn,Rt,rr),[Op,Lp]=function(mi,So){const Za=mi.length,Yo=So?.values;if(Yo?.length>0)for(let Nl=0;Nl<Yo.length;Nl+=2){const vs=Yo[Nl+1];mi.emplaceBack(g.aq[Yo[Nl]],vs[0],vs[1])}return[Za,mi.length]}(We.textAnchorOffsets,L0);We.symbolInstances.emplaceBack(Pt.x,Pt.y,Ga.right>=0?Ga.right:-1,Ga.center>=0?Ga.center:-1,Ga.left>=0?Ga.left:-1,Ga.vertical||-1,Sm,Im,Pp,Ay,Py,ky,kp,oa,ku,Mm,Tm,fr,jh,Ty,Ar,ia,Ry,0,hr,Do,Op,Lp)}(s,et,Te,l,h,f,He,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,Q,[he,he,he,he],Ue,I,ae,fe,Xe,j,i,_,T,P,x)};if("line"===je)for(const Te of Eu(i.geometry,0,0,tr,tr)){const et=Dp(Te,ie,De,l.vertical||$,h,24,te,s.overscaling,tr);for(const We of et)$&&Mp(s,$.text,Ne,We)||Fe(Te,We)}else if("line-center"===je){for(const Te of i.geometry)if(Te.length>1){const et=mm(Te,De,l.vertical||$,h,24,te);et&&Fe(Te,et)}}else if("Polygon"===i.type)for(const Te of Kd(i.geometry,0)){const et=pi(Te,16);Fe(Te[0],new Zo(et.x,et.y,0))}else if("LineString"===i.type)for(const Te of i.geometry)Fe(Te,new Zo(Te[0].x,Te[0].y,0));else if("Point"===i.type)for(const Te of i.geometry)for(const et of Te)Fe([et],new Zo(et.x,et.y,0))}function wm(s,i,l,h,f,_,x,C,I,T,P,L,N,j,$){const q=function(ae,ie,he,fe,De,Ue,Xe,je){const Ne=fe.layout.get("text-rotate").evaluate(Ue,{})*Math.PI/180,Le=[];for(const He of ie.positionedLines)for(const Fe of He.positionedGlyphs){if(!Fe.rect)continue;const Te=Fe.rect||{};let et=Al+1,We=!0,Pt=1,fn=0;const Dn=(De||je)&&Fe.vertical,cr=Fe.metrics.advance*Fe.scale/2;if(je&&ie.verticalizable&&(fn=He.lineOffset/2-(Fe.imageName?-(ar-Fe.metrics.width*Fe.scale)/2:(Fe.scale-1)*ar)),Fe.imageName){const Xn=Xe[Fe.imageName];We=Xn.sdf,Pt=Xn.pixelRatio,et=Vr/Pt}const zi=De?[Fe.x+cr,Fe.y]:[0,0];let ri=De?[0,0]:[Fe.x+cr+he[0],Fe.y+he[1]-fn],Wn=[0,0];Dn&&(Wn=ri,ri=[0,0]);const nr=Fe.metrics.isDoubleResolution?2:1,fr=(Fe.metrics.left-et)*Fe.scale-cr+ri[0],ur=(-Fe.metrics.top-et)*Fe.scale+ri[1],fi=fr+Te.w/nr*Fe.scale/Pt,hr=ur+Te.h/nr*Fe.scale/Pt,mr=new tt(fr,ur),ii=new tt(fi,ur),$r=new tt(fr,hr),oi=new tt(fi,hr);if(Dn){const Xn=new tt(-cr,cr-Du),Rt=-Math.PI/2,Hr=ar/2-cr,Tr=new tt(5-Du-Hr,-(Fe.imageName?Hr:0)),rr=new tt(...Wn);mr._rotateAround(Rt,Xn)._add(Tr)._add(rr),ii._rotateAround(Rt,Xn)._add(Tr)._add(rr),$r._rotateAround(Rt,Xn)._add(Tr)._add(rr),oi._rotateAround(Rt,Xn)._add(Tr)._add(rr)}if(Ne){const Xn=Math.sin(Ne),Rt=Math.cos(Ne),Hr=[Rt,-Xn,Xn,Rt];mr._matMult(Hr),ii._matMult(Hr),$r._matMult(Hr),oi._matMult(Hr)}const gr=new tt(0,0),Ur=new tt(0,0);Le.push({tl:mr,tr:ii,bl:$r,br:oi,tex:Te,writingMode:ie.writingMode,glyphOffset:zi,sectionIndex:Fe.sectionIndex,isSDF:We,pixelOffsetTL:gr,pixelOffsetBR:Ur,minFontScaleX:0,minFontScaleY:0})}return Le}(0,l,C,f,_,x,h,s.allowVerticalPlacement),Q=s.textSizeData;let te=null;"source"===Q.kind?(te=[_s*f.layout.get("text-size").evaluate(x,{})],te[0]>Go&&xr(`${s.layerIds[0]}: Value for "text-size" is >= ${Va}. Reduce your "text-size".`)):"composite"===Q.kind&&(te=[_s*j.compositeTextSizes[0].evaluate(x,{},$),_s*j.compositeTextSizes[1].evaluate(x,{},$)],(te[0]>Go||te[1]>Go)&&xr(`${s.layerIds[0]}: Value for "text-size" is >= ${Va}. Reduce your "text-size".`)),s.addSymbols(s.text,q,te,C,_,x,T,i,I.lineStartIndex,I.lineLength,N,$);for(const ae of P)L[ae]=s.text.placedSymbolArray.length-1;return 4*q.length}function Cm(s){for(const i in s)return s[i];return null}function Mp(s,i,l,h){const f=s.compareText;if(i in f){const _=f[i];for(let x=_.length-1;x>=0;x--)if(h.dist(_[x])<l)return!0}else f[i]=[];return f[i].push(h),!1}const Nh=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Tp{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,h]=new Uint8Array(i,0,2);if(219!==l)throw new Error("Data does not appear to be in a KDBush format.");const f=h>>4;if(1!==f)throw new Error(`Got v${f} data when expected v1.`);const _=Nh[15&h];if(!_)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(i,2,1),[C]=new Uint32Array(i,4,1);return new Tp(C,x,_,i)}constructor(i,l=64,h=Float64Array,f){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const _=Nh.indexOf(this.ArrayType),x=2*i*this.ArrayType.BYTES_PER_ELEMENT,C=i*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-C%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${h}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+C+I,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+x+C+I),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+C+I,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=i)}add(i,l){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=i,this.coords[this._pos++]=l,h}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Fl(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,l,h,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:x,nodeSize:C}=this,I=[0,_.length-1,0],T=[];for(;I.length;){const P=I.pop()||0,L=I.pop()||0,N=I.pop()||0;if(L-N<=C){for(let Q=N;Q<=L;Q++){const te=x[2*Q],ae=x[2*Q+1];te>=i&&te<=h&&ae>=l&&ae<=f&&T.push(_[Q])}continue}const j=N+L>>1,$=x[2*j],q=x[2*j+1];$>=i&&$<=h&&q>=l&&q<=f&&T.push(_[j]),(0===P?i<=$:l<=q)&&(I.push(N),I.push(j-1),I.push(1-P)),(0===P?h>=$:f>=q)&&(I.push(j+1),I.push(L),I.push(1-P))}return T}within(i,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:_,nodeSize:x}=this,C=[0,f.length-1,0],I=[],T=h*h;for(;C.length;){const P=C.pop()||0,L=C.pop()||0,N=C.pop()||0;if(L-N<=x){for(let Q=N;Q<=L;Q++)Ap(_[2*Q],_[2*Q+1],i,l)<=T&&I.push(f[Q]);continue}const j=N+L>>1,$=_[2*j],q=_[2*j+1];Ap($,q,i,l)<=T&&I.push(f[j]),(0===P?i-h<=$:l-h<=q)&&(C.push(N),C.push(j-1),C.push(1-P)),(0===P?i+h>=$:l+h>=q)&&(C.push(j+1),C.push(L),C.push(1-P))}return I}}function Fl(s,i,l,h,f,_){if(f-h<=l)return;const x=h+f>>1;Dm(s,i,x,h,f,_),Fl(s,i,l,h,x-1,1-_),Fl(s,i,l,x+1,f,1-_)}function Dm(s,i,l,h,f,_){for(;f>h;){if(f-h>600){const T=f-h+1,P=l-h+1,L=Math.log(T),N=.5*Math.exp(2*L/3),j=.5*Math.sqrt(L*N*(T-N)/T)*(P-T/2<0?-1:1);Dm(s,i,l,Math.max(h,Math.floor(l-P*N/T+j)),Math.min(f,Math.floor(l+(T-P)*N/T+j)),_)}const x=i[2*l+_];let C=h,I=f;for(Au(s,i,h,l),i[2*f+_]>x&&Au(s,i,h,f);C<I;){for(Au(s,i,C,I),C++,I--;i[2*C+_]<x;)C++;for(;i[2*I+_]>x;)I--}i[2*h+_]===x?Au(s,i,h,I):(I++,Au(s,i,I,f)),I<=l&&(h=I+1),l<=I&&(f=I-1)}}function Au(s,i,l,h){zh(s,l,h),zh(i,2*l,2*h),zh(i,2*l+1,2*h+1)}function zh(s,i,l){const h=s[i];s[i]=s[l],s[l]=h}function Ap(s,i,l,h){const f=s-l,_=i-h;return f*f+_*_}var Bh;g.bg=void 0,(Bh=g.bg||(g.bg={})).create="create",Bh.load="load",Bh.fullLoad="fullLoad";let na=null,qa=[];const Vh=1e3/60,Pu="loadTime",Tc="fullLoadTime",My={mark(s){performance.mark(s)},frame(s){const i=s;null!=na&&qa.push(i-na),na=i},clearMetrics(){na=null,qa=[],performance.clearMeasures(Pu),performance.clearMeasures(Tc);for(const s in g.bg)performance.clearMarks(g.bg[s])},getPerformanceMetrics(){performance.measure(Pu,g.bg.create,g.bg.load),performance.measure(Tc,g.bg.create,g.bg.fullLoad);const s=performance.getEntriesByName(Pu)[0].duration,i=performance.getEntriesByName(Tc)[0].duration,l=qa.length,h=1/(qa.reduce((_,x)=>_+x,0)/l/1e3),f=qa.filter(_=>_>Vh).reduce((_,x)=>_+(x-Vh)/Vh,0);return{loadTime:s,fullLoadTime:i,fps:h,percentDroppedFrames:f/(l+f)*100,totalFrames:l}}};g.$=function(s,i,l){var h,f,_,x,C,I,T,P,L,N,j,$,q=l[0],Q=l[1],te=l[2];return i===s?(s[12]=i[0]*q+i[4]*Q+i[8]*te+i[12],s[13]=i[1]*q+i[5]*Q+i[9]*te+i[13],s[14]=i[2]*q+i[6]*Q+i[10]*te+i[14],s[15]=i[3]*q+i[7]*Q+i[11]*te+i[15]):(f=i[1],_=i[2],x=i[3],C=i[4],I=i[5],T=i[6],P=i[7],L=i[8],N=i[9],j=i[10],$=i[11],s[0]=h=i[0],s[1]=f,s[2]=_,s[3]=x,s[4]=C,s[5]=I,s[6]=T,s[7]=P,s[8]=L,s[9]=N,s[10]=j,s[11]=$,s[12]=h*q+C*Q+L*te+i[12],s[13]=f*q+I*Q+N*te+i[13],s[14]=_*q+T*Q+j*te+i[14],s[15]=x*q+P*Q+$*te+i[15]),s},g.A=bl,g.B=Ti,g.C=class{constructor(s,i,l){this.receive=h=>{const f=h.data,_=f.id;if(_&&(!f.targetMapId||this.mapId===f.targetMapId))if("<cancel>"===f.type){delete this.tasks[_];const x=this.cancelCallbacks[_];delete this.cancelCallbacks[_],x&&x()}else ir()||f.mustQueue?(this.tasks[_]=f,this.taskQueue.push(_),this.invoker.trigger()):this.processTask(_,f)},this.process=()=>{if(!this.taskQueue.length)return;const h=this.taskQueue.shift(),f=this.tasks[h];delete this.tasks[h],this.taskQueue.length&&this.invoker.trigger(),f&&this.processTask(h,f)},this.target=s,this.parent=i,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new sm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ir()?s:window}send(s,i,l,h,f=!1){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[_]=l);const x=[],C={id:_,type:s,hasCallback:!!l,targetMapId:h,mustQueue:f,sourceMapId:this.mapId,data:cs(i,x)};return this.target.postMessage(C,{transfer:x}),{cancel:()=>{l&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}processTask(s,i){if("<response>"===i.type){const l=this.callbacks[s];delete this.callbacks[s],l&&(i.error?l(Hs(i.error)):l(null,Hs(i.data)))}else{let l=!1;const h=[],f=i.hasCallback?(C,I)=>{l=!0,delete this.cancelCallbacks[s];const T={id:s,type:"<response>",sourceMapId:this.mapId,error:C?cs(C):null,data:cs(I,h)};this.target.postMessage(T,{transfer:h})}:C=>{l=!0};let _=null;const x=Hs(i.data);if(this.parent[i.type])_=this.parent[i.type](i.sourceMapId,x,f);else if("getWorkerSource"in this.parent){const C=i.type.split(".");_=this.parent.getWorkerSource(i.sourceMapId,C[0],x.source)[C[1]](x,f)}else f(new Error(`Could not find function ${i.type}`));!l&&_&&_.cancel&&(this.cancelCallbacks[s]=_.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},g.D=Ke,g.E=va,g.F=function(s,i){const l={};for(let h=0;h<i.length;h++){const f=i[h];f in s&&(l[f]=s[f])}return l},g.G=Dy,g.H=Sy,g.I=Pl,g.J=Kl,g.K=lo,g.L=$a,g.M=ya,g.N=tr,g.O=io,g.P=tt,g.Q=pn,g.R=ro,g.S=on,g.T=iu,g.U=vp,g.V=class extends Ra{},g.W=um,g.X=function(s,i){const l=window.document.createElement("video");l.muted=!0,l.onloadstart=function(){i(null,l)};for(let h=0;h<s.length;h++){const f=window.document.createElement("source");Hi(s[h])||(l.crossOrigin="Anonymous"),f.src=s[h],l.appendChild(f)}return{cancel:()=>{}}},g.Y=Pe,g.Z=function(){var s=new bl(16);return bl!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},g._=On,g.a=ga,g.a$=class extends V{},g.a0=function(s,i,l){var h=l[0],f=l[1],_=l[2];return s[0]=i[0]*h,s[1]=i[1]*h,s[2]=i[2]*h,s[3]=i[3]*h,s[4]=i[4]*f,s[5]=i[5]*f,s[6]=i[6]*f,s[7]=i[7]*f,s[8]=i[8]*_,s[9]=i[9]*_,s[10]=i[10]*_,s[11]=i[11]*_,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},g.a1=Of,g.a2=function(){return ma++},g.a3=Y,g.a4=Ic,g.a5=function(){Qn.isLoading()||Qn.isLoaded()||"deferred"!==hs()||Vn()},g.a6=ac,g.a7=xl,g.a8=tn,g.a9=bp,g.aA=Qr,g.aB=function(s){s=s.slice();const i=Object.create(null);for(let l=0;l<s.length;l++)i[s[l].id]=s[l];for(let l=0;l<s.length;l++)"ref"in s[l]&&(s[l]=Ii(s[l],i[s[l].ref]));return s},g.aC=function(s){if("custom"===s.type)return new O0(s);switch(s.type){case"background":return new kh(s);case"circle":return new Jg(s);case"fill":return new oy(s);case"fill-extrusion":return new S0(s);case"heatmap":return new Kt(s);case"hillshade":return new ti(s);case"line":return new py(s);case"raster":return new om(s);case"symbol":return new Ph(s)}},g.aD=ai,g.aE=function(s,i){if(!s)return[{command:Ut.setStyle,args:[i]}];let l=[];try{if(!ln(s.version,i.version))return[{command:Ut.setStyle,args:[i]}];ln(s.center,i.center)||l.push({command:Ut.setCenter,args:[i.center]}),ln(s.zoom,i.zoom)||l.push({command:Ut.setZoom,args:[i.zoom]}),ln(s.bearing,i.bearing)||l.push({command:Ut.setBearing,args:[i.bearing]}),ln(s.pitch,i.pitch)||l.push({command:Ut.setPitch,args:[i.pitch]}),ln(s.sprite,i.sprite)||l.push({command:Ut.setSprite,args:[i.sprite]}),ln(s.glyphs,i.glyphs)||l.push({command:Ut.setGlyphs,args:[i.glyphs]}),ln(s.transition,i.transition)||l.push({command:Ut.setTransition,args:[i.transition]}),ln(s.light,i.light)||l.push({command:Ut.setLight,args:[i.light]});const h={},f=[];!function(x,C,I,T){let P;for(P in C=C||{},x=x||{})Object.prototype.hasOwnProperty.call(x,P)&&(Object.prototype.hasOwnProperty.call(C,P)||xa(P,I,T));for(P in C)Object.prototype.hasOwnProperty.call(C,P)&&(Object.prototype.hasOwnProperty.call(x,P)?ln(x[P],C[P])||("geojson"===x[P].type&&"geojson"===C[P].type&&el(x,C,P)?I.push({command:Ut.setGeoJSONSourceData,args:[P,C[P].data]}):qi(P,C,I,T)):Ei(P,C,I))}(s.sources,i.sources,f,h);const _=[];s.layers&&s.layers.forEach(x=>{h[x.source]?l.push({command:Ut.removeLayer,args:[x.id]}):_.push(x)}),l=l.concat(f),function(x,C,I){C=C||[];const T=(x=x||[]).map(ns),P=C.map(ns),L=x.reduce(Os,{}),N=C.reduce(Os,{}),j=T.slice(),$=Object.create(null);let q,Q,te,ae,ie,he,fe;for(q=0,Q=0;q<T.length;q++)te=T[q],Object.prototype.hasOwnProperty.call(N,te)?Q++:(I.push({command:Ut.removeLayer,args:[te]}),j.splice(j.indexOf(te,Q),1));for(q=0,Q=0;q<P.length;q++)te=P[P.length-1-q],j[j.length-1-q]!==te&&(Object.prototype.hasOwnProperty.call(L,te)?(I.push({command:Ut.removeLayer,args:[te]}),j.splice(j.lastIndexOf(te,j.length-Q),1)):Q++,he=j[j.length-q],I.push({command:Ut.addLayer,args:[N[te],he]}),j.splice(j.length-q,0,te),$[te]=!0);for(q=0;q<P.length;q++)if(te=P[q],ae=L[te],ie=N[te],!$[te]&&!ln(ae,ie))if(ln(ae.source,ie.source)&&ln(ae["source-layer"],ie["source-layer"])&&ln(ae.type,ie.type)){for(fe in ba(ae.layout,ie.layout,I,te,null,Ut.setLayoutProperty),ba(ae.paint,ie.paint,I,te,null,Ut.setPaintProperty),ln(ae.filter,ie.filter)||I.push({command:Ut.setFilter,args:[te,ie.filter]}),ln(ae.minzoom,ie.minzoom)&&ln(ae.maxzoom,ie.maxzoom)||I.push({command:Ut.setLayerZoomRange,args:[te,ie.minzoom,ie.maxzoom]}),ae)Object.prototype.hasOwnProperty.call(ae,fe)&&"layout"!==fe&&"paint"!==fe&&"filter"!==fe&&"metadata"!==fe&&"minzoom"!==fe&&"maxzoom"!==fe&&(0===fe.indexOf("paint.")?ba(ae[fe],ie[fe],I,te,fe.slice(6),Ut.setPaintProperty):ln(ae[fe],ie[fe])||I.push({command:Ut.setLayerProperty,args:[te,fe,ie[fe]]}));for(fe in ie)Object.prototype.hasOwnProperty.call(ie,fe)&&!Object.prototype.hasOwnProperty.call(ae,fe)&&"layout"!==fe&&"paint"!==fe&&"filter"!==fe&&"metadata"!==fe&&"minzoom"!==fe&&"maxzoom"!==fe&&(0===fe.indexOf("paint.")?ba(ae[fe],ie[fe],I,te,fe.slice(6),Ut.setPaintProperty):ln(ae[fe],ie[fe])||I.push({command:Ut.setLayerProperty,args:[te,fe,ie[fe]]}))}else I.push({command:Ut.removeLayer,args:[te]}),he=j[j.lastIndexOf(te)+1],I.push({command:Ut.addLayer,args:[ie,he]})}(_,i.layers,l)}catch(h){console.warn("Unable to compute style diff:",h),l=[{command:Ut.setStyle,args:[i]}]}return l},g.aF=function(s){const i=[],l=s.id;return void 0===l&&i.push({message:`layers.${l}: missing required property "id"`}),void 0===s.render&&i.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},g.aG=function s(i,l){if(Array.isArray(i)){if(!Array.isArray(l)||i.length!==l.length)return!1;for(let h=0;h<i.length;h++)if(!s(i[h],l[h]))return!1;return!0}if("object"==typeof i&&null!==i&&null!==l){if("object"!=typeof l||Object.keys(i).length!==Object.keys(l).length)return!1;for(const h in i)if(!s(i[h],l[h]))return!1;return!0}return i===l},g.aH=In,g.aI=uo,g.aJ=Kn,g.aK=function(s){return s({pluginStatus:at,pluginURL:en}),Kn.on("pluginStateChange",s),s},g.aL=class extends Fa{constructor(s,i){super(s,i),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},g.aM=dc,g.aN=class extends Fa{constructor(s,i){super(s,i),this.current=Fd}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let i=1;i<16;i++)if(s[i]!==this.current[i]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},g.aO=ou,g.aP=class extends Fa{constructor(s,i){super(s,i),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},g.aQ=class extends Fa{constructor(s,i){super(s,i),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},g.aR=su,g.aS=function(s,i,l,h,f,_,x){var C=1/(i-l),I=1/(h-f),T=1/(_-x);return s[0]=-2*C,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*I,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*T,s[11]=0,s[12]=(i+l)*C,s[13]=(f+h)*I,s[14]=(x+_)*T,s[15]=1,s},g.aT=Ht,g.aU=Lf,g.aV=class extends d{},g.aW=wu,g.aX=class extends v{},g.aY=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},g.aZ=Me,g.a_=Re,g.aa=function(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,f,_)=>{const x=f||_;return i[h]=!x||x.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i},g.ab=function(s,i){const l=[];for(const h in s)h in i||l.push(h);return l},g.ac=function(s){if(null==Ts){const i=s.navigator?s.navigator.userAgent:null;Ts=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Ts},g.ad=co,g.ae=function(s,i,l){var h=Math.sin(l),f=Math.cos(l),_=i[0],x=i[1],C=i[2],I=i[3],T=i[4],P=i[5],L=i[6],N=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=_*f+T*h,s[1]=x*f+P*h,s[2]=C*f+L*h,s[3]=I*f+N*h,s[4]=T*f-_*h,s[5]=P*f-x*h,s[6]=L*f-C*h,s[7]=N*f-I*h,s},g.af=function(s){var i=new bl(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},g.ag=Hd,g.ah=function(s,i){let l=0,h=0;if("constant"===s.kind)h=s.layoutSize;else if("source"!==s.kind){const{interpolationType:f,minZoom:_,maxZoom:x}=s,C=f?co(xi.interpolationFactor(f,i,_,x),0,1):0;"camera"===s.kind?h=Ti.number(s.minSize,s.maxSize,C):l=C}return{uSizeT:l,uSize:h}},g.aj=function(s,{uSize:i,uSizeT:l},{lowerSize:h,upperSize:f}){return"source"===s.kind?h/_s:"composite"===s.kind?Ti.number(h/_s,f/_s,l):i},g.ak=mp,g.al=function(s,i,l,h){const f=i.y-s.y,_=i.x-s.x,x=h.y-l.y,C=h.x-l.x,I=x*_-C*f;if(0===I)return null;const T=(C*(s.y-l.y)-x*(s.x-l.x))/I;return new tt(s.x+T*_,s.y+T*f)},g.am=Eu,g.an=Uo,g.ao=uh,g.ap=ar,g.ar=Th,g.as=function(s,i){var l=i[0],h=i[1],f=i[2],_=i[3],x=i[4],C=i[5],I=i[6],T=i[7],P=i[8],L=i[9],N=i[10],j=i[11],$=i[12],q=i[13],Q=i[14],te=i[15],ae=l*C-h*x,ie=l*I-f*x,he=l*T-_*x,fe=h*I-f*C,De=h*T-_*C,Ue=f*T-_*I,Xe=P*q-L*$,je=P*Q-N*$,Ne=P*te-j*$,Le=L*Q-N*q,He=L*te-j*q,Fe=N*te-j*Q,Te=ae*Fe-ie*He+he*Le+fe*Ne-De*je+Ue*Xe;return Te?(s[0]=(C*Fe-I*He+T*Le)*(Te=1/Te),s[1]=(f*He-h*Fe-_*Le)*Te,s[2]=(q*Ue-Q*De+te*fe)*Te,s[3]=(N*De-L*Ue-j*fe)*Te,s[4]=(I*Ne-x*Fe-T*je)*Te,s[5]=(l*Fe-f*Ne+_*je)*Te,s[6]=(Q*he-$*Ue-te*ie)*Te,s[7]=(P*Ue-N*he+j*ie)*Te,s[8]=(x*He-C*Ne+T*Xe)*Te,s[9]=(h*Ne-l*He-_*Xe)*Te,s[10]=($*De-q*he+te*ae)*Te,s[11]=(L*he-P*De-j*ae)*Te,s[12]=(C*je-x*Le-I*Xe)*Te,s[13]=(l*Le-h*je+f*Xe)*Te,s[14]=(q*ie-$*fe-Q*ae)*Te,s[15]=(P*fe-L*ie+N*ae)*Te,s):null},g.at=Ep,g.au=dp,g.av=Tp,g.aw=function(){const s={},i=_e.$version;for(const l in _e.$root){const h=_e.$root[l];if(h.required){let f=null;f="version"===l?i:"array"===h.type?[]:{},null!=f&&(s[l]=f)}}return s},g.ax=Ut,g.ay=Lr,g.az=an,g.b=function(s,i){const l=new Blob([new Uint8Array(s)],{type:"image/png"});createImageBitmap(l).then(h=>{i(null,h)}).catch(h=>{i(new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},g.b0=pr,g.b1=function(s,i){var l=s[0],h=s[1],f=s[2],_=s[3],x=s[4],C=s[5],I=s[6],T=s[7],P=s[8],L=s[9],N=s[10],j=s[11],$=s[12],q=s[13],Q=s[14],te=s[15],ae=i[0],ie=i[1],he=i[2],fe=i[3],De=i[4],Ue=i[5],Xe=i[6],je=i[7],Ne=i[8],Le=i[9],He=i[10],Fe=i[11],Te=i[12],et=i[13],We=i[14],Pt=i[15];return Math.abs(l-ae)<=ei*Math.max(1,Math.abs(l),Math.abs(ae))&&Math.abs(h-ie)<=ei*Math.max(1,Math.abs(h),Math.abs(ie))&&Math.abs(f-he)<=ei*Math.max(1,Math.abs(f),Math.abs(he))&&Math.abs(_-fe)<=ei*Math.max(1,Math.abs(_),Math.abs(fe))&&Math.abs(x-De)<=ei*Math.max(1,Math.abs(x),Math.abs(De))&&Math.abs(C-Ue)<=ei*Math.max(1,Math.abs(C),Math.abs(Ue))&&Math.abs(I-Xe)<=ei*Math.max(1,Math.abs(I),Math.abs(Xe))&&Math.abs(T-je)<=ei*Math.max(1,Math.abs(T),Math.abs(je))&&Math.abs(P-Ne)<=ei*Math.max(1,Math.abs(P),Math.abs(Ne))&&Math.abs(L-Le)<=ei*Math.max(1,Math.abs(L),Math.abs(Le))&&Math.abs(N-He)<=ei*Math.max(1,Math.abs(N),Math.abs(He))&&Math.abs(j-Fe)<=ei*Math.max(1,Math.abs(j),Math.abs(Fe))&&Math.abs($-Te)<=ei*Math.max(1,Math.abs($),Math.abs(Te))&&Math.abs(q-et)<=ei*Math.max(1,Math.abs(q),Math.abs(et))&&Math.abs(Q-We)<=ei*Math.max(1,Math.abs(Q),Math.abs(We))&&Math.abs(te-Pt)<=ei*Math.max(1,Math.abs(te),Math.abs(Pt))},g.b2=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},g.b3=function(s,i,l){return s[0]=i[0]*l[0],s[1]=i[1]*l[1],s[2]=i[2]*l[2],s[3]=i[3]*l[3],s},g.b4=function(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]+s[3]*i[3]},g.b5=Ms,g.b6=Ey,g.b7=Oh,g.b8=function(s,i,l,h,f){var _,x=1/Math.tan(i/2);return s[0]=x/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=f&&f!==1/0?(s[10]=(f+h)*(_=1/(h-f)),s[14]=2*f*h*_):(s[10]=-1,s[14]=-2*h),s},g.b9=function(s,i,l){var h=Math.sin(l),f=Math.cos(l),_=i[4],x=i[5],C=i[6],I=i[7],T=i[8],P=i[9],L=i[10],N=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=_*f+T*h,s[5]=x*f+P*h,s[6]=C*f+L*h,s[7]=I*f+N*h,s[8]=T*f-_*h,s[9]=P*f-x*h,s[10]=L*f-C*h,s[11]=N*f-I*h,s},g.bA=ap,g.bB=sc,g.bC=Qn,g.ba=$i,g.bb=Ao,g.bc=function(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},g.bd=class extends qn{},g.be=am,g.bf=My,g.bh=_n,g.bi=function(s,i,l=!1){if(at===nu||at===ru||at===Tn)throw new Error("setRTLTextPlugin cannot be called multiple times.");en=As.resolveURL(s),at=nu,Ge=i,qs(),l||Vn()},g.bj=hs,g.bk=function(s,i){const l={};for(let f=0;f<s.length;f++){const _=i&&i[s[f].id]||js(s[f]);i&&(i[s[f].id]=_);let x=l[_];x||(x=l[_]=[]),x.push(s[f])}const h=[];for(const f in l)h.push(l[f]);return h},g.bl=qe,g.bm=xp,g.bn=wp,g.bo=Qf,g.bp=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=tr/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const i=s.bucket.layers[0],l=i.layout,h=i._unevaluatedLayout._values,f={layoutIconSize:h["icon-size"].possiblyEvaluate(new tn(s.bucket.zoom+1),s.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new tn(s.bucket.zoom+1),s.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new tn(18))};if("composite"===s.bucket.textSizeData.kind){const{minZoom:T,maxZoom:P}=s.bucket.textSizeData;f.compositeTextSizes=[h["text-size"].possiblyEvaluate(new tn(T),s.canonical),h["text-size"].possiblyEvaluate(new tn(P),s.canonical)]}if("composite"===s.bucket.iconSizeData.kind){const{minZoom:T,maxZoom:P}=s.bucket.iconSizeData;f.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new tn(T),s.canonical),h["icon-size"].possiblyEvaluate(new tn(P),s.canonical)]}const _=l.get("text-line-height")*ar,x="viewport"!==l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),C=l.get("text-keep-upright"),I=l.get("text-size");for(const T of s.bucket.features){const P=l.get("text-font").evaluate(T,{},s.canonical).join(","),L=I.evaluate(T,{},s.canonical),N=f.layoutTextSize.evaluate(T,{},s.canonical),j=f.layoutIconSize.evaluate(T,{},s.canonical),$={horizontal:{},vertical:void 0},q=T.text;let Q,te=[0,0];if(q){const he=q.toString(),fe=l.get("text-letter-spacing").evaluate(T,{},s.canonical)*ar,De=or(he)?fe:0,Ue=l.get("text-anchor").evaluate(T,{},s.canonical),Xe=Ip(i,T,s.canonical);if(!Xe){const Fe=l.get("text-radial-offset").evaluate(T,{},s.canonical);te=Fe?xm(Ue,[Fe*ar,Fh]):l.get("text-offset").evaluate(T,{},s.canonical).map(Te=>Te*ar)}let je=x?"center":l.get("text-justify").evaluate(T,{},s.canonical);const Ne=l.get("symbol-placement"),Le="point"===Ne?l.get("text-max-width").evaluate(T,{},s.canonical)*ar:0,He=()=>{s.bucket.allowVerticalPlacement&&$t(he)&&($.vertical=Sc(q,s.glyphMap,s.glyphPositions,s.imagePositions,P,Le,_,Ue,"left",De,te,g.ai.vertical,!0,Ne,N,L))};if(!x&&Xe){const Fe=new Set;if("auto"===je)for(let et=0;et<Xe.values.length;et+=2)Fe.add(Ep(Xe.values[et]));else Fe.add(je);let Te=!1;for(const et of Fe)if(!$.horizontal[et])if(Te)$.horizontal[et]=$.horizontal[0];else{const We=Sc(q,s.glyphMap,s.glyphPositions,s.imagePositions,P,Le,_,"center",et,De,te,g.ai.horizontal,!1,Ne,N,L);We&&($.horizontal[et]=We,Te=1===We.positionedLines.length)}He()}else{"auto"===je&&(je=Ep(Ue));const Fe=Sc(q,s.glyphMap,s.glyphPositions,s.imagePositions,P,Le,_,Ue,je,De,te,g.ai.horizontal,!1,Ne,N,L);Fe&&($.horizontal[je]=Fe),He(),$t(he)&&x&&C&&($.vertical=Sc(q,s.glyphMap,s.glyphPositions,s.imagePositions,P,Le,_,Ue,je,De,te,g.ai.vertical,!1,Ne,N,L))}}let ae=!1;if(T.icon&&T.icon.name){const he=s.imageMap[T.icon.name];he&&(Q=Mh(s.imagePositions[T.icon.name],l.get("icon-offset").evaluate(T,{},s.canonical),l.get("icon-anchor").evaluate(T,{},s.canonical)),ae=!!he.sdf,void 0===s.bucket.sdfIcons?s.bucket.sdfIcons=ae:s.bucket.sdfIcons!==ae&&xr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(he.pixelRatio!==s.bucket.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(s.bucket.iconsNeedLinear=!0))}const ie=Cm($.horizontal)||$.vertical;s.bucket.iconsInText=!!ie&&ie.iconsInText,(ie||Q)&&bm(s.bucket,T,$,Q,s.imageMap,f,N,j,te,ae,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},g.bq=vu,g.br=yh,g.bs=Sl,g.bt=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return 0===s.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},g.bu=lr,g.bv=gs,g.bw=function(s,i,l,h,f){return On(this,void 0,void 0,function*(){if(lo())try{return yield ya(s,i,l,h,f)}catch{}return function(_,x,C,I,T){const P=_.width,L=_.height;ho&&yn||(ho=new OffscreenCanvas(P,L),yn=ho.getContext("2d",{willReadFrequently:!0})),ho.width=P,ho.height=L,yn.drawImage(_,0,0,P,L);const N=yn.getImageData(x,C,I,T);return yn.clearRect(0,0,P,L),N.data}(s,i,l,h,f)})},g.bx=Iu,g.by=ye,g.bz=ji,g.c=Ps,g.d=function(s,i){const l=new Image;l.onload=()=>{i(null,l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame(()=>{l.src=Bn})},l.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(s)],{type:"image/png"});l.src=s.byteLength?URL.createObjectURL(h):Bn},g.e=vr,g.f=function(s,i){return po(vr(s,{type:"json"}),i)},g.g=Si,g.h=As,g.i=ir,g.j=Rs,g.k=ts,g.l=Ja,g.m=po,g.n=function(s){return new lr(s).readFields(Cu,[])},g.o=function(s,i,l){if(!s.length)return l(null,[]);let h=s.length;const f=new Array(s.length);let _=null;s.forEach((x,C)=>{i(x,(I,T)=>{I&&(_=I),f[C]=T,0==--h&&l(_,f)})})},g.p=cp,g.q=uu,g.r=Cn,g.s=Hi,g.t=Ld,g.u=Oe,g.v=_e,g.w=xr,g.x=ls,g.y=go,g.z=function([s,i,l]){return i+=90,i*=Math.PI/180,l*=Math.PI/180,{x:s*Math.cos(i)*Math.sin(l),y:s*Math.sin(i)*Math.sin(l),z:s*Math.cos(l)}}}),Bc(0,function(g){class On{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,z){for(const K of F){this._layerConfigs[K.id]=K;const J=this._layers[K.id]=g.aC(K);J._featureFilter=g.a6(J.filter),this.keyCache[K.id]&&delete this.keyCache[K.id]}for(const K of z)delete this.keyCache[K],delete this._layerConfigs[K],delete this._layers[K];this.familiesBySource={};const U=g.bk(Object.values(this._layerConfigs),this.keyCache);for(const K of U){const J=K.map(we=>this._layers[we.id]),ue=J[0];if("none"===ue.visibility)continue;const oe=ue.source||"";let ne=this.familiesBySource[oe];ne||(ne=this.familiesBySource[oe]={});const le=ue.sourceLayer||"_geojsonTileLayer";let xe=ne[le];xe||(xe=ne[le]=[]),xe.push(J)}}}class ye{constructor(F){const z={},U=[];for(const oe in F){const ne=F[oe],le=z[oe]={};for(const xe in ne){const we=ne[+xe];if(!we||0===we.bitmap.width||0===we.bitmap.height)continue;const Se={x:0,y:0,w:we.bitmap.width+2,h:we.bitmap.height+2};U.push(Se),le[xe]={rect:Se,metrics:we.metrics}}}const{w:K,h:J}=g.p(U),ue=new g.q({width:K||1,height:J||1});for(const oe in F){const ne=F[oe];for(const le in ne){const xe=ne[+le];if(!xe||0===xe.bitmap.width||0===xe.bitmap.height)continue;const we=z[oe][le].rect;g.q.copy(xe.bitmap,ue,{x:0,y:0},{x:we.x+1,y:we.y+1},xe.bitmap)}}this.image=ue,this.positions=z}}g.bl("GlyphAtlas",ye);class ji{constructor(F){this.tileID=new g.O(F.tileID.overscaledZ,F.tileID.wrap,F.tileID.canonical.z,F.tileID.canonical.x,F.tileID.canonical.y),this.uid=F.uid,this.zoom=F.zoom,this.pixelRatio=F.pixelRatio,this.tileSize=F.tileSize,this.source=F.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=F.showCollisionBoxes,this.collectResourceTiming=!!F.collectResourceTiming,this.returnDependencies=!!F.returnDependencies,this.promoteId=F.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(F,z,U,K,J){this.status="parsing",this.data=F,this.collisionBoxArray=new g.a3;const ue=new g.bm(Object.keys(F.layers).sort()),oe=new g.bn(this.tileID,this.promoteId);oe.bucketLayerIDs=[];const ne={},le={featureIndex:oe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:U},xe=z.familiesBySource[this.source];for(const jt in xe){const Dt=F.layers[jt];if(!Dt)continue;1===Dt.version&&g.w(`Vector tile source "${this.source}" layer "${jt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const kr=ue.encode(jt),Et=[];for(let wn=0;wn<Dt.length;wn++){const vn=Dt.feature(wn),Zi=oe.getId(vn,jt);Et.push({feature:vn,id:Zi,index:wn,sourceLayerIndex:kr})}for(const wn of xe[jt]){const vn=wn[0];vn.source!==this.source&&g.w(`layer.source = ${vn.source} does not equal this.source = ${this.source}`),vn.minzoom&&this.zoom<Math.floor(vn.minzoom)||vn.maxzoom&&this.zoom>=vn.maxzoom||"none"!==vn.visibility&&(Gr(wn,this.zoom,U),(ne[vn.id]=vn.createBucket({index:oe.bucketLayerIDs.length,layers:wn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:kr,sourceID:this.source})).populate(Et,le,this.tileID.canonical),oe.bucketLayerIDs.push(wn.map(Zi=>Zi.id)))}}let we,Se,Ze,lt;const Ye=g.aH(le.glyphDependencies,jt=>Object.keys(jt).map(Number));this.inFlightDependencies.forEach(jt=>jt?.cancel()),this.inFlightDependencies=[];const nt=++this.dependencySentinel;Object.keys(Ye).length?this.inFlightDependencies.push(K.send("getGlyphs",{uid:this.uid,stacks:Ye,source:this.source,tileID:this.tileID,type:"glyphs"},(jt,Dt)=>{nt===this.dependencySentinel&&(we||(we=jt,Se=Dt,cn.call(this)))})):Se={};const mt=Object.keys(le.iconDependencies);mt.length?this.inFlightDependencies.push(K.send("getImages",{icons:mt,source:this.source,tileID:this.tileID,type:"icons"},(jt,Dt)=>{nt===this.dependencySentinel&&(we||(we=jt,Ze=Dt,cn.call(this)))})):Ze={};const Gt=Object.keys(le.patternDependencies);function cn(){if(we)return J(we);if(Se&&Ze&&lt){const jt=new ye(Se),Dt=new g.bo(Ze,lt);for(const kr in ne){const Et=ne[kr];Et instanceof g.a4?(Gr(Et.layers,this.zoom,U),g.bp({bucket:Et,glyphMap:Se,glyphPositions:jt.positions,imageMap:Ze,imagePositions:Dt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Et.hasPattern&&(Et instanceof g.bq||Et instanceof g.br||Et instanceof g.bs)&&(Gr(Et.layers,this.zoom,U),Et.addFeatures(le,this.tileID.canonical,Dt.patternPositions))}this.status="done",J(null,{buckets:Object.values(ne).filter(kr=>!kr.isEmpty()),featureIndex:oe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:jt.image,imageAtlas:Dt,glyphMap:this.returnDependencies?Se:null,iconMap:this.returnDependencies?Ze:null,glyphPositions:this.returnDependencies?jt.positions:null})}}Gt.length?this.inFlightDependencies.push(K.send("getImages",{icons:Gt,source:this.source,tileID:this.tileID,type:"patterns"},(jt,Dt)=>{nt===this.dependencySentinel&&(we||(we=jt,lt=Dt,cn.call(this)))})):lt={},cn.call(this)}}function Gr(X,F,z){const U=new g.a8(F);for(const K of X)K.recalculate(U,z)}function tt(X,F){const z=g.l(X.request,(U,K,J,ue)=>{if(U)F(U);else if(K)try{const oe=new g.bv.VectorTile(new g.bu(K));F(null,{vectorTile:oe,rawData:K,cacheControl:J,expires:ue})}catch(oe){const ne=new Uint8Array(K);let le=`Unable to parse the tile at ${X.request.url}, `;le+=31===ne[0]&&139===ne[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${oe.messge}`,F(new Error(le))}});return()=>{z.cancel(),F()}}class To{constructor(F,z,U,K){this.actor=F,this.layerIndex=z,this.availableImages=U,this.loadVectorData=K||tt,this.fetching={},this.loading={},this.loaded={}}loadTile(F,z){const U=F.uid;this.loading||(this.loading={});const K=!!(F&&F.request&&F.request.collectResourceTiming)&&new g.bt(F.request),J=this.loading[U]=new ji(F);J.abort=this.loadVectorData(F,(ue,oe)=>{if(delete this.loading[U],ue||!oe)return J.status="done",this.loaded[U]=J,z(ue);const ne=oe.rawData,le={};oe.expires&&(le.expires=oe.expires),oe.cacheControl&&(le.cacheControl=oe.cacheControl);const xe={};if(K){const we=K.finish();we&&(xe.resourceTiming=JSON.parse(JSON.stringify(we)))}J.vectorTile=oe.vectorTile,J.parse(oe.vectorTile,this.layerIndex,this.availableImages,this.actor,(we,Se)=>{if(delete this.fetching[U],we||!Se)return z(we);z(null,g.e({rawTileData:ne.slice(0)},Se,le,xe))}),this.loaded=this.loaded||{},this.loaded[U]=J,this.fetching[U]={rawTileData:ne,cacheControl:le,resourceTiming:xe}})}reloadTile(F,z){const U=this.loaded,K=F.uid;if(U&&U[K]){const J=U[K];J.showCollisionBoxes=F.showCollisionBoxes,"parsing"===J.status?J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,(ue,oe)=>{if(ue||!oe)return z(ue,oe);let ne;if(this.fetching[K]){const{rawTileData:le,cacheControl:xe,resourceTiming:we}=this.fetching[K];delete this.fetching[K],ne=g.e({rawTileData:le.slice(0)},oe,xe,we)}else ne=oe;z(null,ne)}):"done"===J.status&&(J.vectorTile?J.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,z):z())}}abortTile(F,z){const U=this.loading,K=F.uid;U&&U[K]&&U[K].abort&&(U[K].abort(),delete U[K]),z()}removeTile(F,z){const U=this.loaded,K=F.uid;U&&U[K]&&delete U[K],z()}}class fa{constructor(){this.loaded={}}loadTile(F,z){return g._(this,void 0,void 0,function*(){const{uid:U,encoding:K,rawImageData:J,redFactor:ue,greenFactor:oe,blueFactor:ne,baseShift:le}=F,xe=J.width+2,we=J.height+2,Se=g.a(J)?new g.R({width:xe,height:we},yield g.bw(J,-1,-1,xe,we)):J,Ze=new g.bx(U,Se,K,ue,oe,ne,le);this.loaded=this.loaded||{},this.loaded[U]=Ze,z(null,Ze)})}removeTile(F){const z=this.loaded,U=F.uid;z&&z[U]&&delete z[U]}}function Jo(X,F){if(0!==X.length){Zr(X[0],F);for(var z=1;z<X.length;z++)Zr(X[z],!F)}}function Zr(X,F){for(var z=0,U=0,K=0,J=X.length,ue=J-1;K<J;ue=K++){var oe=(X[K][0]-X[ue][0])*(X[ue][1]+X[K][1]),ne=z+oe;U+=Math.abs(z)>=Math.abs(oe)?z-ne+oe:oe-ne+z,z=ne}z+U>=0!=!!F&&X.reverse()}var Yn=g.by(function X(F,z){var U,K=F&&F.type;if("FeatureCollection"===K)for(U=0;U<F.features.length;U++)X(F.features[U],z);else if("GeometryCollection"===K)for(U=0;U<F.geometries.length;U++)X(F.geometries[U],z);else if("Feature"===K)X(F.geometry,z);else if("Polygon"===K)Jo(F.coordinates,z);else if("MultiPolygon"===K)for(U=0;U<F.coordinates.length;U++)Jo(F.coordinates[U],z);return F});const Kl=g.bv.VectorTileFeature.prototype.toGeoJSON;var lo={exports:{}},$i=g.bz,Ao=g.bv.VectorTileFeature,co=Ms;function Ms(X,F){this.options=F||{},this.features=X,this.length=X.length}function vr(X,F){this.id="number"==typeof X.id?X.id:void 0,this.type=X.type,this.rawGeometry=1===X.type?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=F||4096}Ms.prototype.feature=function(X){return new vr(this.features[X],this.options.extent)},vr.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var F=0;F<X.length;F++){for(var z=X[F],U=[],K=0;K<z.length;K++)U.push(new $i(z[K][0],z[K][1]));this.geometry.push(U)}return this.geometry},vr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,F=1/0,z=-1/0,U=1/0,K=-1/0,J=0;J<X.length;J++)for(var ue=X[J],oe=0;oe<ue.length;oe++){var ne=ue[oe];F=Math.min(F,ne.x),z=Math.max(z,ne.x),U=Math.min(U,ne.y),K=Math.max(K,ne.y)}return[F,U,z,K]},vr.prototype.toGeoJSON=Ao.prototype.toGeoJSON;var ma=g.bA,In=co;function uo(X){var F=new ma;return function(z,U){for(var K in z.layers)U.writeMessage(3,ai,z.layers[K])}(X,F),F.finish()}function ai(X,F){var z;F.writeVarintField(15,X.version||1),F.writeStringField(1,X.name||""),F.writeVarintField(5,X.extent||4096);var U={keys:[],values:[],keycache:{},valuecache:{}};for(z=0;z<X.length;z++)U.feature=X.feature(z),F.writeMessage(2,es,U);var K=U.keys;for(z=0;z<K.length;z++)F.writeStringField(3,K[z]);var J=U.values;for(z=0;z<J.length;z++)F.writeMessage(4,Ts,J[z])}function es(X,F){var z=X.feature;void 0!==z.id&&F.writeVarintField(1,z.id),F.writeMessage(2,xr,X),F.writeVarintField(3,z.type),F.writeMessage(4,ir,z)}function xr(X,F){var z=X.feature,U=X.keys,K=X.values,J=X.keycache,ue=X.valuecache;for(var oe in z.properties){var ne=z.properties[oe],le=J[oe];if(null!==ne){void 0===le&&(U.push(oe),J[oe]=le=U.length-1),F.writeVarint(le);var xe=typeof ne;"string"!==xe&&"boolean"!==xe&&"number"!==xe&&(ne=JSON.stringify(ne));var we=xe+":"+ne,Se=ue[we];void 0===Se&&(K.push(ne),ue[we]=Se=K.length-1),F.writeVarint(Se)}}}function gi(X,F){return(F<<3)+(7&X)}function Ui(X){return X<<1^X>>31}function ir(X,F){for(var z=X.loadGeometry(),U=X.type,K=0,J=0,ue=z.length,oe=0;oe<ue;oe++){var ne=z[oe],le=1;1===U&&(le=ne.length),F.writeVarint(gi(1,le));for(var xe=3===U?ne.length-1:ne.length,we=0;we<xe;we++){1===we&&1!==U&&F.writeVarint(gi(2,xe-1));var Se=ne[we].x-K,Ze=ne[we].y-J;F.writeVarint(Ui(Se)),F.writeVarint(Ui(Ze)),K+=Se,J+=Ze}3===U&&F.writeVarint(gi(7,1))}}function Ts(X,F){var z=typeof X;"string"===z?F.writeStringField(1,X):"boolean"===z?F.writeBooleanField(7,X):"number"===z&&(X%1!=0?F.writeDoubleField(3,X):X<0?F.writeSVarintField(6,X):F.writeVarintField(5,X))}lo.exports=uo,lo.exports.fromVectorTileJs=uo,lo.exports.fromGeojsonVt=function(X,F){F=F||{};var z={};for(var U in X)z[U]=new In(X[U].features,F),z[U].name=U,z[U].version=F.version,z[U].extent=F.extent;return uo({layers:z})},lo.exports.GeoJSONWrapper=In;var ga=g.by(lo.exports);const Bn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},ya=Math.fround||(ho=new Float32Array(1),X=>(ho[0]=+X,ho[0]));var ho;const yn=3,li=5,dr=6;class As{constructor(F){this.options=Object.assign(Object.create(Bn),F),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(F){const{log:z,minZoom:U,maxZoom:K}=this.options;z&&console.time("total time");const J=`prepare ${F.length} points`;z&&console.time(J),this.points=F;const ue=[];for(let ne=0;ne<F.length;ne++){const le=F[ne];if(!le.geometry)continue;const[xe,we]=le.geometry.coordinates,Se=ya(an(xe)),Ze=ya(Si(we));ue.push(Se,Ze,1/0,ne,-1,1),this.options.reduce&&ue.push(0)}let oe=this.trees[K+1]=this._createTree(ue);z&&console.timeEnd(J);for(let ne=K;ne>=U;ne--){const le=+Date.now();oe=this.trees[ne]=this._createTree(this._cluster(oe,ne)),z&&console.log("z%d: %d clusters in %dms",ne,oe.numItems,+Date.now()-le)}return z&&console.timeEnd("total time"),this}getClusters(F,z){let U=((F[0]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,F[1]));let J=180===F[2]?180:((F[2]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)U=-180,J=180;else if(U>J){const we=this.getClusters([U,K,180,ue],z),Se=this.getClusters([-180,K,J,ue],z);return we.concat(Se)}const oe=this.trees[this._limitZoom(z)],ne=oe.range(an(U),Si(ue),an(J),Si(K)),le=oe.data,xe=[];for(const we of ne){const Se=this.stride*we;xe.push(le[Se+li]>1?Ps(le,Se,this.clusterProps):this.points[le[Se+yn]])}return xe}getChildren(F){const z=this._getOriginId(F),U=this._getOriginZoom(F),K="No cluster with the specified id.",J=this.trees[U];if(!J)throw new Error(K);const ue=J.data;if(z*this.stride>=ue.length)throw new Error(K);const oe=this.options.radius/(this.options.extent*Math.pow(2,U-1)),ne=J.within(ue[z*this.stride],ue[z*this.stride+1],oe),le=[];for(const xe of ne){const we=xe*this.stride;ue[we+4]===F&&le.push(ue[we+li]>1?Ps(ue,we,this.clusterProps):this.points[ue[we+yn]])}if(0===le.length)throw new Error(K);return le}getLeaves(F,z,U){const K=[];return this._appendLeaves(K,F,z=z||10,U=U||0,0),K}getTile(F,z,U){const K=this.trees[this._limitZoom(F)],J=Math.pow(2,F),{extent:ue,radius:oe}=this.options,ne=oe/ue,le=(U-ne)/J,xe=(U+1+ne)/J,we={features:[]};return this._addTileFeatures(K.range((z-ne)/J,le,(z+1+ne)/J,xe),K.data,z,U,J,we),0===z&&this._addTileFeatures(K.range(1-ne/J,le,1,xe),K.data,J,U,J,we),z===J-1&&this._addTileFeatures(K.range(0,le,ne/J,xe),K.data,-1,U,J,we),we.features.length?we:null}getClusterExpansionZoom(F){let z=this._getOriginZoom(F)-1;for(;z<=this.options.maxZoom;){const U=this.getChildren(F);if(z++,1!==U.length)break;F=U[0].properties.cluster_id}return z}_appendLeaves(F,z,U,K,J){const ue=this.getChildren(z);for(const oe of ue){const ne=oe.properties;if(ne&&ne.cluster?J+ne.point_count<=K?J+=ne.point_count:J=this._appendLeaves(F,ne.cluster_id,U,K,J):J<K?J++:F.push(oe),F.length===U)break}return J}_createTree(F){const z=new g.av(F.length/this.stride|0,this.options.nodeSize,Float32Array);for(let U=0;U<F.length;U+=this.stride)z.add(F[U],F[U+1]);return z.finish(),z.data=F,z}_addTileFeatures(F,z,U,K,J,ue){for(const oe of F){const ne=oe*this.stride,le=z[ne+li]>1;let xe,we,Se;if(le)xe=_n(z,ne,this.clusterProps),we=z[ne],Se=z[ne+1];else{const Ye=this.points[z[ne+yn]];xe=Ye.properties;const[nt,mt]=Ye.geometry.coordinates;we=an(nt),Se=Si(mt)}const Ze={type:1,geometry:[[Math.round(this.options.extent*(we*J-U)),Math.round(this.options.extent*(Se*J-K))]],tags:xe};let lt;lt=le||this.options.generateId?z[ne+yn]:this.points[z[ne+yn]].id,void 0!==lt&&(Ze.id=lt),ue.features.push(Ze)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(Math.floor(+F),this.options.maxZoom+1))}_cluster(F,z){const{radius:U,extent:K,reduce:J,minPoints:ue}=this.options,oe=U/(K*Math.pow(2,z)),ne=F.data,le=[],xe=this.stride;for(let we=0;we<ne.length;we+=xe){if(ne[we+2]<=z)continue;ne[we+2]=z;const Se=ne[we],Ze=ne[we+1],lt=F.within(ne[we],ne[we+1],oe),Ye=ne[we+li];let nt=Ye;for(const mt of lt){const Gt=mt*xe;ne[Gt+2]>z&&(nt+=ne[Gt+li])}if(nt>Ye&&nt>=ue){let mt,Gt=Se*Ye,cn=Ze*Ye,jt=-1;const Dt=((we/xe|0)<<5)+(z+1)+this.points.length;for(const kr of lt){const Et=kr*xe;if(ne[Et+2]<=z)continue;ne[Et+2]=z;const wn=ne[Et+li];Gt+=ne[Et]*wn,cn+=ne[Et+1]*wn,ne[Et+4]=Dt,J&&(mt||(mt=this._map(ne,we,!0),jt=this.clusterProps.length,this.clusterProps.push(mt)),J(mt,this._map(ne,Et)))}ne[we+4]=Dt,le.push(Gt/nt,cn/nt,1/0,Dt,-1,nt),J&&le.push(jt)}else{for(let mt=0;mt<xe;mt++)le.push(ne[we+mt]);if(nt>1)for(const mt of lt){const Gt=mt*xe;if(!(ne[Gt+2]<=z)){ne[Gt+2]=z;for(let cn=0;cn<xe;cn++)le.push(ne[Gt+cn])}}}}return le}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,z,U){if(F[z+li]>1){const ue=this.clusterProps[F[z+dr]];return U?Object.assign({},ue):ue}const K=this.points[F[z+yn]].properties,J=this.options.map(K);return U&&J===K?Object.assign({},J):J}}function Ps(X,F,z){return{type:"Feature",id:X[F+yn],properties:_n(X,F,z),geometry:{type:"Point",coordinates:[(U=X[F],360*(U-.5)),rn(X[F+1])]}};var U}function _n(X,F,z){const U=X[F+li],K=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U,J=X[F+dr],ue=-1===J?{}:Object.assign({},z[J]);return Object.assign(ue,{cluster:!0,cluster_id:X[F+yn],point_count:U,point_count_abbreviated:K})}function an(X){return X/360+.5}function Si(X){const F=Math.sin(X*Math.PI/180),z=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return z<0?0:z>1?1:z}function rn(X){const F=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function po(X,F,z,U){for(var K,J=U,ue=z-F>>1,oe=z-F,ne=X[F],le=X[F+1],xe=X[z],we=X[z+1],Se=F+3;Se<z;Se+=3){var Ze=Ja(X[Se],X[Se+1],ne,le,xe,we);if(Ze>J)K=Se,J=Ze;else if(Ze===J){var lt=Math.abs(Se-ue);lt<oe&&(K=Se,oe=lt)}}J>U&&(K-F>3&&po(X,F,K,U),X[K+2]=J,z-K>3&&po(X,K,z,U))}function Ja(X,F,z,U,K,J){var ue=K-z,oe=J-U;if(0!==ue||0!==oe){var ne=((X-z)*ue+(F-U)*oe)/(ue*ue+oe*oe);ne>1?(z=K,U=J):ne>0&&(z+=ue*ne,U+=oe*ne)}return(ue=X-z)*ue+(oe=F-U)*oe}function Hi(X,F,z,U){var K={id:void 0===X?null:X,type:F,geometry:z,tags:U,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(J){var ue=J.geometry,oe=J.type;if("Point"===oe||"MultiPoint"===oe||"LineString"===oe)_a(J,ue);else if("Polygon"===oe||"MultiLineString"===oe)for(var ne=0;ne<ue.length;ne++)_a(J,ue[ne]);else if("MultiPolygon"===oe)for(ne=0;ne<ue.length;ne++)for(var le=0;le<ue[ne].length;le++)_a(J,ue[ne][le])}(K),K}function _a(X,F){for(var z=0;z<F.length;z+=3)X.minX=Math.min(X.minX,F[z]),X.minY=Math.min(X.minY,F[z+1]),X.maxX=Math.max(X.maxX,F[z]),X.maxY=Math.max(X.maxY,F[z+1])}function ks(X,F,z,U){if(F.geometry){var K=F.geometry.coordinates,J=F.geometry.type,ue=Math.pow(z.tolerance/((1<<z.maxZoom)*z.extent),2),oe=[],ne=F.id;if(z.promoteId?ne=F.properties[z.promoteId]:z.generateId&&(ne=U||0),"Point"===J)ts(K,oe);else if("MultiPoint"===J)for(var le=0;le<K.length;le++)ts(K[le],oe);else if("LineString"===J)Rs(K,oe,ue,!1);else if("MultiLineString"===J){if(z.lineMetrics){for(le=0;le<K.length;le++)Rs(K[le],oe=[],ue,!1),X.push(Hi(ne,"LineString",oe,F.properties));return}va(K,oe,ue,!1)}else if("Polygon"===J)va(K,oe,ue,!0);else{if("MultiPolygon"!==J){if("GeometryCollection"===J){for(le=0;le<F.geometry.geometries.length;le++)ks(X,{id:ne,geometry:F.geometry.geometries[le],properties:F.properties},z,U);return}throw new Error("Input data is not a valid GeoJSON object.")}for(le=0;le<K.length;le++){var xe=[];va(K[le],xe,ue,!0),oe.push(xe)}}X.push(Hi(ne,J,oe,F.properties))}}function ts(X,F){F.push(_e(X[0])),F.push(yi(X[1])),F.push(0)}function Rs(X,F,z,U){for(var K,J,ue=0,oe=0;oe<X.length;oe++){var ne=_e(X[oe][0]),le=yi(X[oe][1]);F.push(ne),F.push(le),F.push(0),oe>0&&(ue+=U?(K*le-ne*J)/2:Math.sqrt(Math.pow(ne-K,2)+Math.pow(le-J,2))),K=ne,J=le}var xe=F.length-3;F[2]=1,po(F,0,xe,z),F[xe+2]=1,F.size=Math.abs(ue),F.start=0,F.end=F.size}function va(X,F,z,U){for(var K=0;K<X.length;K++){var J=[];Rs(X[K],J,z,U),F.push(J)}}function _e(X){return X/360+.5}function yi(X){var F=Math.sin(X*Math.PI/180),z=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return z<0?0:z>1?1:z}function Ii(X,F,z,U,K,J,ue,oe){if(U/=F,J>=(z/=F)&&ue<U)return X;if(ue<z||J>=U)return null;for(var ne=[],le=0;le<X.length;le++){var xe=X[le],we=xe.geometry,Se=xe.type,Ze=0===K?xe.minX:xe.minY,lt=0===K?xe.maxX:xe.maxY;if(Ze>=z&&lt<U)ne.push(xe);else if(!(lt<z||Ze>=U)){var Ye=[];if("Point"===Se||"MultiPoint"===Se)ln(we,Ye,z,U,K);else if("LineString"===Se)Ut(we,Ye,z,U,K,!1,oe.lineMetrics);else if("MultiLineString"===Se)xa(we,Ye,z,U,K,!1);else if("Polygon"===Se)xa(we,Ye,z,U,K,!0);else if("MultiPolygon"===Se)for(var nt=0;nt<we.length;nt++){var mt=[];xa(we[nt],mt,z,U,K,!0),mt.length&&Ye.push(mt)}if(Ye.length){if(oe.lineMetrics&&"LineString"===Se){for(nt=0;nt<Ye.length;nt++)ne.push(Hi(xe.id,Se,Ye[nt],xe.tags));continue}"LineString"!==Se&&"MultiLineString"!==Se||(1===Ye.length?(Se="LineString",Ye=Ye[0]):Se="MultiLineString"),"Point"!==Se&&"MultiPoint"!==Se||(Se=3===Ye.length?"Point":"MultiPoint"),ne.push(Hi(xe.id,Se,Ye,xe.tags))}}}return ne.length?ne:null}function ln(X,F,z,U,K){for(var J=0;J<X.length;J+=3){var ue=X[J+K];ue>=z&&ue<=U&&(F.push(X[J]),F.push(X[J+1]),F.push(X[J+2]))}}function Ut(X,F,z,U,K,J,ue){for(var oe,ne,le=Ei(X),xe=0===K?el:ba,we=X.start,Se=0;Se<X.length-3;Se+=3){var Ze=X[Se],lt=X[Se+1],Ye=X[Se+2],nt=X[Se+3],mt=X[Se+4],Gt=0===K?Ze:lt,cn=0===K?nt:mt,jt=!1;ue&&(oe=Math.sqrt(Math.pow(Ze-nt,2)+Math.pow(lt-mt,2))),Gt<z?cn>z&&(ne=xe(le,Ze,lt,nt,mt,z),ue&&(le.start=we+oe*ne)):Gt>U?cn<U&&(ne=xe(le,Ze,lt,nt,mt,U),ue&&(le.start=we+oe*ne)):qi(le,Ze,lt,Ye),cn<z&&Gt>=z&&(ne=xe(le,Ze,lt,nt,mt,z),jt=!0),cn>U&&Gt<=U&&(ne=xe(le,Ze,lt,nt,mt,U),jt=!0),!J&&jt&&(ue&&(le.end=we+oe*ne),F.push(le),le=Ei(X)),ue&&(we+=oe)}var Dt=X.length-3;Ze=X[Dt],lt=X[Dt+1],Ye=X[Dt+2],(Gt=0===K?Ze:lt)>=z&&Gt<=U&&qi(le,Ze,lt,Ye),Dt=le.length-3,J&&Dt>=3&&(le[Dt]!==le[0]||le[Dt+1]!==le[1])&&qi(le,le[0],le[1],le[2]),le.length&&F.push(le)}function Ei(X){var F=[];return F.size=X.size,F.start=X.start,F.end=X.end,F}function xa(X,F,z,U,K,J){for(var ue=0;ue<X.length;ue++)Ut(X[ue],F,z,U,K,J,!1)}function qi(X,F,z,U){X.push(F),X.push(z),X.push(U)}function el(X,F,z,U,K,J){var ue=(J-F)/(U-F);return X.push(J),X.push(z+(K-z)*ue),X.push(1),ue}function ba(X,F,z,U,K,J){var ue=(J-z)/(K-z);return X.push(F+(U-F)*ue),X.push(J),X.push(1),ue}function ns(X,F){for(var z=[],U=0;U<X.length;U++){var K,J=X[U],ue=J.type;if("Point"===ue||"MultiPoint"===ue||"LineString"===ue)K=Os(J.geometry,F);else if("MultiLineString"===ue||"Polygon"===ue){K=[];for(var oe=0;oe<J.geometry.length;oe++)K.push(Os(J.geometry[oe],F))}else if("MultiPolygon"===ue)for(K=[],oe=0;oe<J.geometry.length;oe++){for(var ne=[],le=0;le<J.geometry[oe].length;le++)ne.push(Os(J.geometry[oe][le],F));K.push(ne)}z.push(Hi(J.id,ue,K,J.tags))}return z}function Os(X,F){var z=[];z.size=X.size,void 0!==X.start&&(z.start=X.start,z.end=X.end);for(var U=0;U<X.length;U+=3)z.push(X[U]+F,X[U+1],X[U+2]);return z}function Pe(X,F){if(X.transformed)return X;var z,U,K,J=1<<X.z,ue=X.x,oe=X.y;for(z=0;z<X.features.length;z++){var ne=X.features[z],le=ne.geometry,xe=ne.type;if(ne.geometry=[],1===xe)for(U=0;U<le.length;U+=2)ne.geometry.push(Gi(le[U],le[U+1],F,J,ue,oe));else for(U=0;U<le.length;U++){var we=[];for(K=0;K<le[U].length;K+=2)we.push(Gi(le[U][K],le[U][K+1],F,J,ue,oe));ne.geometry.push(we)}}return X.transformed=!0,X}function Gi(X,F,z,U,K,J){return[Math.round(z*(X*U-K)),Math.round(z*(F*U-J))]}function Ln(X,F,z,U,K){for(var J=F===K.maxZoom?0:K.tolerance/((1<<F)*K.extent),ue={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:z,y:U,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},oe=0;oe<X.length;oe++){ue.numFeatures++,rs(ue,X[oe],J,K);var ne=X[oe].minX,le=X[oe].minY,xe=X[oe].maxX,we=X[oe].maxY;ne<ue.minX&&(ue.minX=ne),le<ue.minY&&(ue.minY=le),xe>ue.maxX&&(ue.maxX=xe),we>ue.maxY&&(ue.maxY=we)}return ue}function rs(X,F,z,U){var K=F.geometry,J=F.type,ue=[];if("Point"===J||"MultiPoint"===J)for(var oe=0;oe<K.length;oe+=3)ue.push(K[oe]),ue.push(K[oe+1]),X.numPoints++,X.numSimplified++;else if("LineString"===J)Po(ue,K,X,z,!1,!1);else if("MultiLineString"===J||"Polygon"===J)for(oe=0;oe<K.length;oe++)Po(ue,K[oe],X,z,"Polygon"===J,0===oe);else if("MultiPolygon"===J)for(var ne=0;ne<K.length;ne++){var le=K[ne];for(oe=0;oe<le.length;oe++)Po(ue,le[oe],X,z,!0,0===oe)}if(ue.length){var xe=F.tags||null;if("LineString"===J&&U.lineMetrics){for(var we in xe={},F.tags)xe[we]=F.tags[we];xe.mapbox_clip_start=K.start/K.size,xe.mapbox_clip_end=K.end/K.size}var Se={geometry:ue,type:"Polygon"===J||"MultiPolygon"===J?3:"LineString"===J||"MultiLineString"===J?2:1,tags:xe};null!==F.id&&(Se.id=F.id),X.features.push(Se)}}function Po(X,F,z,U,K,J){var ue=U*U;if(U>0&&F.size<(K?ue:U))z.numPoints+=F.length/3;else{for(var oe=[],ne=0;ne<F.length;ne+=3)(0===U||F[ne+2]>ue)&&(z.numSimplified++,oe.push(F[ne]),oe.push(F[ne+1])),z.numPoints++;K&&function(le,xe){for(var we=0,Se=0,Ze=le.length,lt=Ze-2;Se<Ze;lt=Se,Se+=2)we+=(le[Se]-le[lt])*(le[Se+1]+le[lt+1]);if(we>0===xe)for(Se=0,Ze=le.length;Se<Ze/2;Se+=2){var Ye=le[Se],nt=le[Se+1];le[Se]=le[Ze-2-Se],le[Se+1]=le[Ze-1-Se],le[Ze-2-Se]=Ye,le[Ze-1-Se]=nt}}(oe,J),X.push(oe)}}function ze(X,F){var z=(F=this.options=function(K,J){for(var ue in J)K[ue]=J[ue];return K}(Object.create(this.options),F)).debug;if(z&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var K,J,ue,oe,ne,le,U=function(K,J){var ue=[];if("FeatureCollection"===K.type)for(var oe=0;oe<K.features.length;oe++)ks(ue,K.features[oe],J,oe);else ks(ue,"Feature"===K.type?K:{geometry:K},J);return ue}(X,F);this.tiles={},this.tileCoords=[],z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),oe=K=U,ne=Ii(K,1,-1-(ue=(J=F).buffer/J.extent),ue,0,-1,2,J),le=Ii(K,1,1-ue,2+ue,0,-1,2,J),(ne||le)&&(oe=Ii(K,1,-ue,1+ue,0,-1,2,J)||[],ne&&(oe=ns(ne,1).concat(oe)),le&&(oe=oe.concat(ns(le,-1)))),(U=oe).length&&this.splitTile(U,0,0,0),z&&(U.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function St(X,F,z){return 32*((1<<X)*z+F)+X}function ft(X,F){return F?X.properties[F]:X.id}function Wr(X,F){if(null==X)return!0;if("Feature"===X.type)return null!=ft(X,F);if("FeatureCollection"===X.type){const z=new Set;for(const U of X.features){const K=ft(U,F);if(null==K||z.has(K))return!1;z.add(K)}return!0}return!1}function fo(X,F){const z=new Map;if(null!=X)if("Feature"===X.type)z.set(ft(X,F),X);else for(const U of X.features)z.set(ft(U,F),U);return z}ze.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ze.prototype.splitTile=function(X,F,z,U,K,J,ue){for(var oe=[X,F,z,U],ne=this.options,le=ne.debug;oe.length;){U=oe.pop(),z=oe.pop(),F=oe.pop(),X=oe.pop();var xe=1<<F,we=St(F,z,U),Se=this.tiles[we];if(!Se&&(le>1&&console.time("creation"),Se=this.tiles[we]=Ln(X,F,z,U,ne),this.tileCoords.push({z:F,x:z,y:U}),le)){le>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,z,U,Se.numFeatures,Se.numPoints,Se.numSimplified),console.timeEnd("creation"));var Ze="z"+F;this.stats[Ze]=(this.stats[Ze]||0)+1,this.total++}if(Se.source=X,K){if(F===ne.maxZoom||F===K)continue;var lt=1<<K-F;if(z!==Math.floor(J/lt)||U!==Math.floor(ue/lt))continue}else if(F===ne.indexMaxZoom||Se.numPoints<=ne.indexMaxPoints)continue;if(Se.source=null,0!==X.length){le>1&&console.time("clipping");var Ye,nt,mt,Gt,cn,jt,Dt=.5*ne.buffer/ne.extent,kr=.5-Dt,Et=.5+Dt,wn=1+Dt;Ye=nt=mt=Gt=null,cn=Ii(X,xe,z-Dt,z+Et,0,Se.minX,Se.maxX,ne),jt=Ii(X,xe,z+kr,z+wn,0,Se.minX,Se.maxX,ne),X=null,cn&&(Ye=Ii(cn,xe,U-Dt,U+Et,1,Se.minY,Se.maxY,ne),nt=Ii(cn,xe,U+kr,U+wn,1,Se.minY,Se.maxY,ne),cn=null),jt&&(mt=Ii(jt,xe,U-Dt,U+Et,1,Se.minY,Se.maxY,ne),Gt=Ii(jt,xe,U+kr,U+wn,1,Se.minY,Se.maxY,ne),jt=null),le>1&&console.timeEnd("clipping"),oe.push(Ye||[],F+1,2*z,2*U),oe.push(nt||[],F+1,2*z,2*U+1),oe.push(mt||[],F+1,2*z+1,2*U),oe.push(Gt||[],F+1,2*z+1,2*U+1)}}},ze.prototype.getTile=function(X,F,z){var U=this.options,K=U.extent,J=U.debug;if(X<0||X>24)return null;var ue=1<<X,oe=St(X,F=(F%ue+ue)%ue,z);if(this.tiles[oe])return Pe(this.tiles[oe],K);J>1&&console.log("drilling down to z%d-%d-%d",X,F,z);for(var ne,le=X,xe=F,we=z;!ne&&le>0;)le--,xe=Math.floor(xe/2),we=Math.floor(we/2),ne=this.tiles[St(le,xe,we)];return ne&&ne.source?(J>1&&console.log("found parent tile z%d-%d-%d",le,xe,we),J>1&&console.time("drilling down"),this.splitTile(ne.source,le,xe,we,X,F,z),J>1&&console.timeEnd("drilling down"),this.tiles[oe]?Pe(this.tiles[oe],K):null):null};class wt extends To{constructor(F,z,U,K){super(F,z,U),this._dataUpdateable=new Map,this.loadGeoJSON=(J,ue)=>{const{promoteId:oe}=J;if(J.request)return g.f(J.request,(ne,le,xe,we)=>{this._dataUpdateable=Wr(le,oe)?fo(le,oe):void 0,ue(ne,le,xe,we)});if("string"==typeof J.data)try{const ne=JSON.parse(J.data);this._dataUpdateable=Wr(ne,oe)?fo(ne,oe):void 0,ue(null,ne)}catch{ue(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}else J.dataDiff?this._dataUpdateable?(function(ne,le,xe){var we,Se,Ze,lt;if(le.removeAll&&ne.clear(),le.remove)for(const Ye of le.remove)ne.delete(Ye);if(le.add)for(const Ye of le.add){const nt=ft(Ye,xe);null!=nt&&ne.set(nt,Ye)}if(le.update)for(const Ye of le.update){let nt=ne.get(Ye.id);if(null==nt)continue;const mt=!Ye.removeAllProperties&&((null===(we=Ye.removeProperties)||void 0===we?void 0:we.length)>0||(null===(Se=Ye.addOrUpdateProperties)||void 0===Se?void 0:Se.length)>0);if((Ye.newGeometry||Ye.removeAllProperties||mt)&&(nt=Object.assign({},nt),ne.set(Ye.id,nt),mt&&(nt.properties=Object.assign({},nt.properties))),Ye.newGeometry&&(nt.geometry=Ye.newGeometry),Ye.removeAllProperties)nt.properties={};else if((null===(Ze=Ye.removeProperties)||void 0===Ze?void 0:Ze.length)>0)for(const Gt of Ye.removeProperties)Object.prototype.hasOwnProperty.call(nt.properties,Gt)&&delete nt.properties[Gt];if((null===(lt=Ye.addOrUpdateProperties)||void 0===lt?void 0:lt.length)>0)for(const{key:Gt,value:cn}of Ye.addOrUpdateProperties)nt.properties[Gt]=cn}}(this._dataUpdateable,J.dataDiff,oe),ue(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):ue(new Error(`Cannot update existing geojson data in ${J.source}`)):ue(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,K&&(this.loadGeoJSON=K)}loadGeoJSONTile(F,z){const U=F.tileID.canonical;if(!this._geoJSONIndex)return z(null,null);const K=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!K)return z(null,null);const J=new class{constructor(oe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=g.N,this.length=oe.length,this._features=oe}feature(oe){return new class{constructor(ne){this._feature=ne,this.extent=g.N,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(1===this._feature.type){const ne=[];for(const le of this._feature.geometry)ne.push([new g.P(le[0],le[1])]);return ne}{const ne=[];for(const le of this._feature.geometry){const xe=[];for(const we of le)xe.push(new g.P(we[0],we[1]));ne.push(xe)}return ne}}toGeoJSON(ne,le,xe){return Kl.call(this,ne,le,xe)}}(this._features[oe])}}(K.features);let ue=ga(J);0===ue.byteOffset&&ue.byteLength===ue.buffer.byteLength||(ue=new Uint8Array(ue)),z(null,{vectorTile:J,rawData:ue.buffer})}loadData(F,z){var U;null===(U=this._pendingRequest)||void 0===U||U.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const K=!!(F&&F.request&&F.request.collectResourceTiming)&&new g.bt(F.request);this._pendingCallback=z,this._pendingRequest=this.loadGeoJSON(F,(J,ue)=>{if(delete this._pendingCallback,delete this._pendingRequest,J||!ue)return z(J);if("object"!=typeof ue)return z(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));{Yn(ue,!0);try{if(F.filter){const ne=g.bB(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ne.result)throw new Error(ne.value.map(xe=>`${xe.key}: ${xe.message}`).join(", "));ue={type:"FeatureCollection",features:ue.features.filter(xe=>ne.value.evaluate({zoom:0},xe))}}this._geoJSONIndex=F.cluster?new As(function({superclusterOptions:ne,clusterProperties:le}){if(!le||!ne)return ne;const xe={},we={},Se={accumulated:null,zoom:0},Ze={properties:null},lt=Object.keys(le);for(const Ye of lt){const[nt,mt]=le[Ye],Gt=g.bB(mt),cn=g.bB("string"==typeof nt?[nt,["accumulated"],["get",Ye]]:nt);xe[Ye]=Gt.value,we[Ye]=cn.value}return ne.map=Ye=>{Ze.properties=Ye;const nt={};for(const mt of lt)nt[mt]=xe[mt].evaluate(Se,Ze);return nt},ne.reduce=(Ye,nt)=>{Ze.properties=nt;for(const mt of lt)Se.accumulated=Ye[mt],Ye[mt]=we[mt].evaluate(Se,Ze)},ne}(F)).load(ue.features):new ze(ne=ue,F.geojsonVtOptions)}catch(ne){return z(ne)}this.loaded={};const oe={};if(K){const ne=K.finish();ne&&(oe.resourceTiming={},oe.resourceTiming[F.source]=JSON.parse(JSON.stringify(ne)))}z(null,oe)}var ne})}reloadTile(F,z){const U=this.loaded;return U&&U[F.uid]?super.reloadTile(F,z):this.loadTile(F,z)}removeSource(F,z){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),z()}getClusterExpansionZoom(F,z){try{z(null,this._geoJSONIndex.getClusterExpansionZoom(F.clusterId))}catch(U){z(U)}}getClusterChildren(F,z){try{z(null,this._geoJSONIndex.getChildren(F.clusterId))}catch(U){z(U)}}getClusterLeaves(F,z){try{z(null,this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset))}catch(U){z(U)}}}class ko{constructor(F){this.self=F,this.actor=new g.C(F,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:To,geojson:wt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(z,U)=>{if(this.workerSourceTypes[z])throw new Error(`Worker source with name "${z}" already registered.`);this.workerSourceTypes[z]=U},this.self.registerRTLTextPlugin=z=>{if(g.bC.isParsed())throw new Error("RTL text plugin already registered.");g.bC.applyArabicShaping=z.applyArabicShaping,g.bC.processBidirectionalText=z.processBidirectionalText,g.bC.processStyledBidirectionalText=z.processStyledBidirectionalText}}setReferrer(F,z){this.referrer=z}setImages(F,z,U){this.availableImages[F]=z;for(const K in this.workerSources[F]){const J=this.workerSources[F][K];for(const ue in J)J[ue].availableImages=z}U()}setLayers(F,z,U){this.getLayerIndex(F).replace(z),U()}updateLayers(F,z,U){this.getLayerIndex(F).update(z.layers,z.removedIds),U()}loadTile(F,z,U){this.getWorkerSource(F,z.type,z.source).loadTile(z,U)}loadDEMTile(F,z,U){this.getDEMWorkerSource(F,z.source).loadTile(z,U)}reloadTile(F,z,U){this.getWorkerSource(F,z.type,z.source).reloadTile(z,U)}abortTile(F,z,U){this.getWorkerSource(F,z.type,z.source).abortTile(z,U)}removeTile(F,z,U){this.getWorkerSource(F,z.type,z.source).removeTile(z,U)}removeDEMTile(F,z){this.getDEMWorkerSource(F,z.source).removeTile(z)}removeSource(F,z,U){if(!this.workerSources[F]||!this.workerSources[F][z.type]||!this.workerSources[F][z.type][z.source])return;const K=this.workerSources[F][z.type][z.source];delete this.workerSources[F][z.type][z.source],void 0!==K.removeSource?K.removeSource(z,U):U()}loadWorkerSource(F,z,U){try{this.self.importScripts(z.url),U()}catch(K){U(K.toString())}}syncRTLPluginState(F,z,U){try{g.bC.setState(z);const K=g.bC.getPluginURL();if(g.bC.isLoaded()&&!g.bC.isParsed()&&null!=K){this.self.importScripts(K);const J=g.bC.isParsed();U(J?void 0:new Error(`RTL Text Plugin failed to import scripts from ${K}`),J)}}catch(K){U(K.toString())}}getAvailableImages(F){let z=this.availableImages[F];return z||(z=[]),z}getLayerIndex(F){let z=this.layerIndexes[F];return z||(z=this.layerIndexes[F]=new On),z}getWorkerSource(F,z,U){return this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][z]||(this.workerSources[F][z]={}),this.workerSources[F][z][U]||(this.workerSources[F][z][U]=new this.workerSourceTypes[z]({send:(K,J,ue)=>{this.actor.send(K,J,ue,F)}},this.getLayerIndex(F),this.getAvailableImages(F))),this.workerSources[F][z][U]}getDEMWorkerSource(F,z){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][z]||(this.demWorkerSources[F][z]=new fa),this.demWorkerSources[F][z]}}return g.i()&&(self.worker=new ko(self)),ko}),Bc(0,function(g){class ye{static testProp(o){if(!ye.docStyle)return o[0];for(let c=0;c<o.length;c++)if(o[c]in ye.docStyle)return o[c];return o[0]}static create(o,c,d){const m=window.document.createElement(o);return void 0!==c&&(m.className=c),d&&d.appendChild(m),m}static createNS(o,c){return window.document.createElementNS(o,c)}static disableDrag(){ye.docStyle&&ye.selectProp&&(ye.userSelect=ye.docStyle[ye.selectProp],ye.docStyle[ye.selectProp]="none")}static enableDrag(){ye.docStyle&&ye.selectProp&&(ye.docStyle[ye.selectProp]=ye.userSelect)}static setTransform(o,c){o.style[ye.transformProp]=c}static addEventListener(o,c,d,m={}){o.addEventListener(c,d,"passive"in m?m:m.capture)}static removeEventListener(o,c,d,m={}){o.removeEventListener(c,d,"passive"in m?m:m.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",ye.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ye.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",ye.suppressClickInternal,!0)},0)}static mousePos(o,c){const d=o.getBoundingClientRect();return new g.P(c.clientX-d.left-o.clientLeft,c.clientY-d.top-o.clientTop)}static touchPos(o,c){const d=o.getBoundingClientRect(),m=[];for(let v=0;v<c.length;v++)m.push(new g.P(c[v].clientX-d.left-o.clientLeft,c[v].clientY-d.top-o.clientTop));return m}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}ye.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ye.selectProp=ye.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ye.transformProp=ye.testProp(["transform","WebkitTransform"]);const ji={supported:!1,testSupport:function(y){!To&&tt&&(fa?Jo(y):Gr=y)}};let Gr,tt,To=!1,fa=!1;function Jo(y){const o=y.createTexture();y.bindTexture(y.TEXTURE_2D,o);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,tt),y.isContextLost())return;ji.supported=!0}catch{}y.deleteTexture(o),To=!0}var Zr,Yn,y;typeof document<"u"&&(tt=document.createElement("img"),tt.onload=function(){Gr&&Jo(Gr),Gr=null,fa=!0},tt.onerror=function(){To=!0,Gr=null},tt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let o,c,d,m;y.resetRequestQueue=()=>{o=[],c=0,d=0,m={}},y.addThrottleControl=A=>{const k=d++;return m[k]=A,k},y.removeThrottleControl=A=>{delete m[A],S()},y.getImage=(A,k,O=!0)=>{ji.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*");const V={requestParameters:A,supportImageRefresh:O,callback:k,cancelled:!1,completed:!1,cancel:()=>{V.completed||V.cancelled||(V.cancelled=!0,V.innerRequest&&(V.innerRequest.cancel(),c--),S())}};return o.push(V),S(),V};const v=A=>{const{requestParameters:k,supportImageRefresh:O,callback:V}=A;return g.e(k,{type:"image"}),(!1!==O||g.i()||g.g(k.url)||k.headers&&!Object.keys(k.headers).reduce((Z,G)=>Z&&"accept"===G,!0)?g.m:E)(k,(Z,G,Y,H)=>{D(A,V,Z,G,Y,H)})},D=(A,k,O,V,Z,G)=>{var Y,H;O?k(O):V instanceof HTMLImageElement||g.a(V)?k(null,V):V&&(Y=V,H=(Y,H)=>{null!=Y?k(Y):null!=H&&k(null,H,{cacheControl:Z,expires:G})},"function"==typeof createImageBitmap?g.b(Y,H):g.d(Y,H)),A.cancelled||(A.completed=!0,c--,S())},S=()=>{const A=(()=>{const k=Object.keys(m);let O=!1;if(k.length>0)for(const V of k)if(O=m[V](),O)break;return O})()?g.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:g.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=c;k<A&&o.length>0;k++){const O=o.shift();if(O.cancelled){k--;continue}const V=v(O);c++,O.innerRequest=V}},E=(A,k)=>{const O=new Image,V=A.url;let Z=!1;const G=A.credentials;return G&&"include"===G?O.crossOrigin="use-credentials":(G&&"same-origin"===G||!g.s(V))&&(O.crossOrigin="anonymous"),O.fetchPriority="high",O.onload=()=>{k(null,O),O.onerror=O.onload=null},O.onerror=()=>{Z||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),O.onerror=O.onload=null},O.src=V,{cancel:()=>{Z=!0,O.src=""}}}}(Zr||(Zr={})),Zr.resetRequestQueue(),(y=Yn||(Yn={})).Glyphs="Glyphs",y.Image="Image",y.Source="Source",y.SpriteImage="SpriteImage",y.SpriteJSON="SpriteJSON",y.Style="Style",y.Tile="Tile",y.Unknown="Unknown";class Kl{constructor(o){this._transformRequestFn=o}transformRequest(o,c){return this._transformRequestFn&&this._transformRequestFn(o,c)||{url:o}}normalizeSpriteURL(o,c,d){const m=function(v){const D=v.match(lo);if(!D)throw new Error(`Unable to parse URL "${v}"`);return{protocol:D[1],authority:D[2],path:D[3]||"/",params:D[4]?D[4].split("&"):[]}}(o);return m.path+=`${c}${d}`,function(v){const D=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${D}`}(m)}setTransformRequest(o){this._transformRequestFn=o}}const lo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function $i(y){var o=new g.A(3);return o[0]=y[0],o[1]=y[1],o[2]=y[2],o}var Ao,co=function(y,o,c){return y[0]=o[0]-c[0],y[1]=o[1]-c[1],y[2]=o[2]-c[2],y};Ao=new g.A(3),g.A!=Float32Array&&(Ao[0]=0,Ao[1]=0,Ao[2]=0);var Ms=function(y){var o=y[0],c=y[1];return o*o+c*c};function vr(y){const o=[];if("string"==typeof y)o.push({id:"default",url:y});else if(y&&y.length>0){const c=[];for(const{id:d,url:m}of y){const v=`${d}${m}`;-1===c.indexOf(v)&&(c.push(v),o.push({id:d,url:m}))}}return o}function ma(y,o,c,d,m){if(d)return void y(d);if(m!==Object.values(o).length||m!==Object.values(c).length)return;const v={};for(const D in o){v[D]={};const S=g.h.getImageCanvasContext(c[D]),E=o[D];for(const A in E){const{width:k,height:O,x:V,y:Z,sdf:G,pixelRatio:Y,stretchX:H,stretchY:se,content:de}=E[A];v[D][A]={data:null,pixelRatio:Y,sdf:G,stretchX:H,stretchY:se,content:de,spriteData:{width:k,height:O,x:V,y:Z,context:S}}}}y(null,v)}!function(){var y=new g.A(2);g.A!=Float32Array&&(y[0]=0,y[1]=0)}();class In{constructor(o,c,d,m){this.context=o,this.format=d,this.texture=o.gl.createTexture(),this.update(c,m)}update(o,c,d){const{width:m,height:v}=o,D=!(this.size&&this.size[0]===m&&this.size[1]===v||d),{context:S}=this,{gl:E}=S;if(this.useMipmap=!(!c||!c.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!c||!1!==c.premultiply)),D)this.size=[m,v],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||g.a(o)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,o):E.texImage2D(E.TEXTURE_2D,0,this.format,m,v,0,this.format,E.UNSIGNED_BYTE,o.data);else{const{x:A,y:k}=d||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||g.a(o)?E.texSubImage2D(E.TEXTURE_2D,0,A,k,E.RGBA,E.UNSIGNED_BYTE,o):E.texSubImage2D(E.TEXTURE_2D,0,A,k,m,v,E.RGBA,E.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(o,c,d){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),d!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=v.LINEAR),o!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,o),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,d||o),this.filter=o),c!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,c),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function uo(y){const{userImage:o}=y;return!!(o&&o.render&&o.render())&&(y.data.replace(new Uint8Array(o.data.buffer)),!0)}class ai extends g.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new g.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:c,callback:d}of this.requestors)this._notify(c,d);this.requestors=[]}}getImage(o){const c=this.images[o];if(c&&!c.data&&c.spriteData){const d=c.spriteData;c.data=new g.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),c.spriteData=null}return c}addImage(o,c){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,c)&&(this.images[o]=c)}_validate(o,c){let d=!0;const m=c.data||c.spriteData;return this._validateStretch(c.stretchX,m&&m.width)||(this.fire(new g.j(new Error(`Image "${o}" has invalid "stretchX" value`))),d=!1),this._validateStretch(c.stretchY,m&&m.height)||(this.fire(new g.j(new Error(`Image "${o}" has invalid "stretchY" value`))),d=!1),this._validateContent(c.content,c)||(this.fire(new g.j(new Error(`Image "${o}" has invalid "content" value`))),d=!1),d}_validateStretch(o,c){if(!o)return!0;let d=0;for(const m of o){if(m[0]<d||m[1]<m[0]||c<m[1])return!1;d=m[1]}return!0}_validateContent(o,c){if(!o)return!0;if(4!==o.length)return!1;const d=c.spriteData,m=d&&d.width||c.data.width,v=d&&d.height||c.data.height;return!(o[0]<0||m<o[0]||o[1]<0||v<o[1]||o[2]<0||m<o[2]||o[3]<0||v<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,c,d=!0){const m=this.getImage(o);if(d&&(m.data.width!==c.data.width||m.data.height!==c.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${c.data.width}x${c.data.height}).`);c.version=m.version+1,this.images[o]=c,this.updatedImages[o]=!0}removeImage(o){const c=this.images[o];delete this.images[o],delete this.patterns[o],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,c){let d=!0;if(!this.isLoaded())for(const m of o)this.images[m]||(d=!1);this.isLoaded()||d?this._notify(o,c):this.requestors.push({ids:o,callback:c})}_notify(o,c){const d={};for(const m of o){let v=this.getImage(m);v||(this.fire(new g.k("styleimagemissing",{id:m})),v=this.getImage(m)),v?d[m]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!(!v.userImage||!v.userImage.render)}:g.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,d)}getPixelSize(){const{width:o,height:c}=this.atlasImage;return{width:o,height:c}}getPattern(o){const c=this.patterns[o],d=this.getImage(o);if(!d)return null;if(c&&c.position.version===d.version)return c.position;if(c)c.position.version=d.version;else{const m={w:d.data.width+2,h:d.data.height+2,x:0,y:0},v=new g.I(m,d);this.patterns[o]={bin:m,position:v}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const c=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new In(o,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const v in this.patterns)o.push(this.patterns[v].bin);const{w:c,h:d}=g.p(o),m=this.atlasImage;m.resize({width:c||1,height:d||1});for(const v in this.patterns){const{bin:D}=this.patterns[v],S=D.x+1,E=D.y+1,A=this.getImage(v).data,k=A.width,O=A.height;g.R.copy(A,m,{x:0,y:0},{x:S,y:E},{width:k,height:O}),g.R.copy(A,m,{x:0,y:O-1},{x:S,y:E-1},{width:k,height:1}),g.R.copy(A,m,{x:0,y:0},{x:S,y:E+O},{width:k,height:1}),g.R.copy(A,m,{x:k-1,y:0},{x:S-1,y:E},{width:1,height:O}),g.R.copy(A,m,{x:0,y:0},{x:S+k,y:E},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const c of o){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const d=this.getImage(c);d||g.w(`Image with ID: "${c}" was not found`),uo(d)&&this.updateImage(c,d)}}}const es=1e20;function xr(y,o,c,d,m,v,D,S,E){for(let A=o;A<o+d;A++)gi(y,c*v+A,v,m,D,S,E);for(let A=c;A<c+m;A++)gi(y,A*v+o,1,d,D,S,E)}function gi(y,o,c,d,m,v,D){v[0]=0,D[0]=-es,D[1]=es,m[0]=y[o];for(let S=1,E=0,A=0;S<d;S++){m[S]=y[o+S*c];const k=S*S;do{const O=v[E];A=(m[S]-m[O]+k-O*O)/(S-O)/2}while(A<=D[E]&&--E>-1);E++,v[E]=S,D[E]=A,D[E+1]=es}for(let S=0,E=0;S<d;S++){for(;D[E+1]<S;)E++;const A=v[E],k=S-A;y[o+S*c]=m[A]+k*k}}class Ui{constructor(o,c){this.requestManager=o,this.localIdeographFontFamily=c,this.entries={}}setURL(o){this.url=o}getGlyphs(o,c){const d=[];for(const m in o)for(const v of o[m])d.push({stack:m,id:v});g.o(d,({stack:m,id:v},D)=>{let S=this.entries[m];S||(S=this.entries[m]={glyphs:{},requests:{},ranges:{}});let E=S.glyphs[v];if(void 0!==E)return void D(null,{stack:m,id:v,glyph:E});if(E=this._tinySDF(S,m,v),E)return S.glyphs[v]=E,void D(null,{stack:m,id:v,glyph:E});const A=Math.floor(v/256);if(256*A>65535)return void D(new Error("glyphs > 65535 not supported"));if(S.ranges[A])return void D(null,{stack:m,id:v,glyph:E});if(!this.url)return void D(new Error("glyphsUrl is not set"));let k=S.requests[A];k||(k=S.requests[A]=[],Ui.loadGlyphRange(m,A,this.url,this.requestManager,(O,V)=>{if(V){for(const Z in V)this._doesCharSupportLocalGlyph(+Z)||(S.glyphs[+Z]=V[+Z]);S.ranges[A]=!0}for(const Z of k)Z(O,V);delete S.requests[A]})),k.push((O,V)=>{O?D(O):V&&D(null,{stack:m,id:v,glyph:V[v]||null})})},(m,v)=>{if(m)c(m);else if(v){const D={};for(const{stack:S,id:E,glyph:A}of v)(D[S]||(D[S]={}))[E]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};c(null,D)}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(g.u["CJK Unified Ideographs"](o)||g.u["Hangul Syllables"](o)||g.u.Hiragana(o)||g.u.Katakana(o))}_tinySDF(o,c,d){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(d))return;let v=o.tinySDF;if(!v){let S="400";/bold/i.test(c)?S="900":/medium/i.test(c)?S="500":/light/i.test(c)&&(S="200"),v=o.tinySDF=new Ui.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:S})}const D=v.draw(String.fromCharCode(d));return{id:d,bitmap:new g.q({width:D.width||60,height:D.height||60},D.data),metrics:{width:D.glyphWidth/2||24,height:D.glyphHeight/2||24,left:D.glyphLeft/2+.5||0,top:D.glyphTop/2-27.5||-8,advance:D.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ui.loadGlyphRange=function(y,o,c,d,m){const v=256*o,D=v+255,S=d.transformRequest(c.replace("{fontstack}",y).replace("{range}",`${v}-${D}`),Yn.Glyphs);g.l(S,(E,A)=>{if(E)m(E);else if(A){const k={};for(const O of g.n(A))k[O.id]=O;m(null,k)}})},Ui.TinySDF=class{constructor({fontSize:y=24,buffer:o=3,radius:c=8,cutoff:d=.25,fontFamily:m="sans-serif",fontWeight:v="normal",fontStyle:D="normal"}={}){this.buffer=o,this.cutoff=d,this.radius=c;const S=this.size=y+4*o,E=this._createCanvas(S),A=this.ctx=E.getContext("2d",{willReadFrequently:!0});A.font=`${D} ${v} ${y}px ${m}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(y){const o=document.createElement("canvas");return o.width=o.height=y,o}draw(y){const{width:o,actualBoundingBoxAscent:c,actualBoundingBoxDescent:d,actualBoundingBoxLeft:m,actualBoundingBoxRight:v}=this.ctx.measureText(y),D=Math.ceil(c),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-m))),E=Math.min(this.size-this.buffer,D+Math.ceil(d)),A=S+2*this.buffer,k=E+2*this.buffer,O=Math.max(A*k,0),V=new Uint8ClampedArray(O),Z={data:V,width:A,height:k,glyphWidth:S,glyphHeight:E,glyphTop:D,glyphLeft:0,glyphAdvance:o};if(0===S||0===E)return Z;const{ctx:G,buffer:Y,gridInner:H,gridOuter:se}=this;G.clearRect(Y,Y,S,E),G.fillText(y,Y,Y+D);const de=G.getImageData(Y,Y,S,E);se.fill(es,0,O),H.fill(0,0,O);for(let ee=0;ee<E;ee++)for(let ce=0;ce<S;ce++){const me=de.data[4*(ee*S+ce)+3]/255;if(0===me)continue;const ge=(ee+Y)*A+ce+Y;if(1===me)se[ge]=0,H[ge]=es;else{const be=.5-me;se[ge]=be>0?be*be:0,H[ge]=be<0?be*be:0}}xr(se,0,0,A,k,A,this.f,this.v,this.z),xr(H,Y,Y,S,E,A,this.f,this.v,this.z);for(let ee=0;ee<O;ee++){const ce=Math.sqrt(se[ee])-Math.sqrt(H[ee]);V[ee]=Math.round(255-255*(ce/this.radius+this.cutoff))}return Z}};class ir{constructor(){this.specification=g.v.light.position}possiblyEvaluate(o,c){return g.z(o.expression.evaluate(c))}interpolate(o,c,d){return{x:g.B.number(o.x,c.x,d),y:g.B.number(o.y,c.y,d),z:g.B.number(o.z,c.z,d)}}}let Ts;class ga extends g.E{constructor(o){super(),Ts=Ts||new g.r({anchor:new g.D(g.v.light.anchor),position:new ir,color:new g.D(g.v.light.color),intensity:new g.D(g.v.light.intensity)}),this._transitionable=new g.T(Ts),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,c={}){if(!this._validate(g.t,o,c))for(const d in o){const m=o[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),m):this._transitionable.setValue(d,m)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,d){return(!d||!1!==d.validate)&&g.x(this,o.call(g.y,g.e({value:c,style:{glyphs:!0,sprite:!0},styleSpec:g.v})))}}class Bn{constructor(o,c){this.width=o,this.height=c,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,c){const d=o.join(",")+String(c);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(o,c)),this.dashEntry[d]}getDashRanges(o,c,d){const m=[];let v=o.length%2==1?-o[o.length-1]*d:0,D=o[0]*d,S=!0;m.push({left:v,right:D,isDash:S,zeroLength:0===o[0]});let E=o[0];for(let A=1;A<o.length;A++){S=!S;const k=o[A];v=E*d,E+=k,D=E*d,m.push({left:v,right:D,isDash:S,zeroLength:0===k})}return m}addRoundDash(o,c,d){const m=c/2;for(let v=-d;v<=d;v++){const D=this.width*(this.nextRow+d+v);let S=0,E=o[S];for(let A=0;A<this.width;A++){A/E.right>1&&(E=o[++S]);const k=Math.abs(A-E.left),O=Math.abs(A-E.right),V=Math.min(k,O);let Z;const G=v/d*(m+1);if(E.isDash){const Y=m-Math.abs(G);Z=Math.sqrt(V*V+Y*Y)}else Z=m-Math.sqrt(V*V+G*G);this.data[D+A]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(o){for(let S=o.length-1;S>=0;--S){const E=o[S],A=o[S+1];E.zeroLength?o.splice(S,1):A&&A.isDash===E.isDash&&(A.left=E.left,o.splice(S,1))}const c=o[0],d=o[o.length-1];c.isDash===d.isDash&&(c.left=d.left-this.width,d.right=c.right+this.width);const m=this.width*this.nextRow;let v=0,D=o[v];for(let S=0;S<this.width;S++){S/D.right>1&&(D=o[++v]);const E=Math.abs(S-D.left),A=Math.abs(S-D.right),k=Math.min(E,A);this.data[m+S]=Math.max(0,Math.min(255,(D.isDash?k:-k)+128))}}addDash(o,c){const d=c?7:0,m=2*d+1;if(this.nextRow+m>this.height)return g.w("LineAtlas out of space"),null;let v=0;for(let S=0;S<o.length;S++)v+=o[S];if(0!==v){const S=this.width/v,E=this.getDashRanges(o,this.width,S);c?this.addRoundDash(E,S,d):this.addRegularDash(E)}const D={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:v};return this.nextRow+=m,this.dirty=!0,D}bind(o){const c=o.gl;this.texture?(c.bindTexture(c.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,c.texSubImage2D(c.TEXTURE_2D,0,0,0,this.width,this.height,c.ALPHA,c.UNSIGNED_BYTE,this.data))):(this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.ALPHA,this.width,this.height,0,c.ALPHA,c.UNSIGNED_BYTE,this.data))}}class ya{constructor(o,c,d){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=d;const m=this.workerPool.acquire(d);for(let v=0;v<m.length;v++){const D=new g.C(m[v],c,d);D.name=`Worker ${v}`,this.actors.push(D)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,c,d){g.o(this.actors,(m,v)=>{m.send(o,c,v)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(c=>{c.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}}function ho(y,o,c){const d=function(m,v){if(m)return c(m);if(v){const D=g.F(g.e(v,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(D.vectorLayers=v.vector_layers,D.vectorLayerIds=D.vectorLayers.map(S=>S.id)),c(null,D)}};return y.url?g.f(o.transformRequest(y.url,Yn.Source),d):g.h.frame(()=>d(null,y))}class yn{constructor(o,c){o&&(c?this.setSouthWest(o).setNorthEast(c):Array.isArray(o)&&(4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof g.L?new g.L(o.lng,o.lat):g.L.convert(o),this}setSouthWest(o){return this._sw=o instanceof g.L?new g.L(o.lng,o.lat):g.L.convert(o),this}extend(o){const c=this._sw,d=this._ne;let m,v;if(o instanceof g.L)m=o,v=o;else{if(!(o instanceof yn))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(yn.convert(o)):this.extend(g.L.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(g.L.convert(o)):this;if(m=o._sw,v=o._ne,!m||!v)return this}return c||d?(c.lng=Math.min(m.lng,c.lng),c.lat=Math.min(m.lat,c.lat),d.lng=Math.max(v.lng,d.lng),d.lat=Math.max(v.lat,d.lat)):(this._sw=new g.L(m.lng,m.lat),this._ne=new g.L(v.lng,v.lat)),this}getCenter(){return new g.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new g.L(this.getWest(),this.getNorth())}getSouthEast(){return new g.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:c,lat:d}=g.L.convert(o);let m=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&m}static convert(o){return o instanceof yn?o:o&&new yn(o)}static fromLngLat(o,c=0){const d=360*c/40075017,m=d/Math.cos(Math.PI/180*o.lat);return new yn(new g.L(o.lng-m,o.lat-d),new g.L(o.lng+m,o.lat+d))}}class li{constructor(o,c,d){this.bounds=yn.convert(this.validateBounds(o)),this.minzoom=c||0,this.maxzoom=d||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const c=Math.pow(2,o.z),d=Math.floor(g.G(this.bounds.getWest())*c),m=Math.floor(g.H(this.bounds.getNorth())*c),v=Math.ceil(g.G(this.bounds.getEast())*c),D=Math.ceil(g.H(this.bounds.getSouth())*c);return o.x>=d&&o.x<v&&o.y>=m&&o.y<D}}class dr extends g.E{constructor(o,c,d,m){if(super(),this.load=()=>{this._loaded=!1,this.fire(new g.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ho(this._options,this.map._requestManager,(v,D)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),v?this.fire(new g.j(v)):D&&(g.e(this,D),D.bounds&&(this.tileBounds=new li(D.bounds,this.minzoom,this.maxzoom)),this.fire(new g.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>g.e({},this._options),this.id=o,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,g.e(this,g.F(c,["url","scheme","tileSize","promoteId"])),this._options=g.e({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(o,c){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(d,Yn.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function v(D,S){return delete o.request,o.aborted?c(null):D&&404!==D.status?c(D):(S&&S.resourceTiming&&(o.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&o.setExpiryData(S),o.loadVectorData(S,this.map.painter),c(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}m.request.collectResourceTiming=this._collectResourceTiming,o.actor&&"expired"!==o.state?"loading"===o.state?o.reloadCallback=c:o.request=o.actor.send("reloadTile",m,v.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",m,v.bind(this)))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class As extends g.E{constructor(o,c,d,m){super(),this.id=o,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=g.e({type:"raster"},c),g.e(this,g.F(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new g.k("dataloading",{dataType:"source"})),this._tileJSONRequest=ho(this._options,this.map._requestManager,(o,c)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new g.j(o)):c&&(g.e(this,c),c.bounds&&(this.tileBounds=new li(c.bounds,this.minzoom,this.maxzoom)),this.fire(new g.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}serialize(){return g.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,c){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.request=Zr.getImage(this.map._requestManager.transformRequest(d,Yn.Tile),(m,v,D)=>{if(delete o.request,o.aborted)o.state="unloaded",c(null);else if(m)o.state="errored",c(m);else if(v){this.map._refreshExpiredTiles&&D&&o.setExpiryData(D);const S=this.map.painter.context,E=S.gl;o.texture=this.map.painter.getTileTexture(v.width),o.texture?o.texture.update(v,{useMipmap:!0}):(o.texture=new In(S,v,E.RGBA,{useMipmap:!0}),o.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),S.extTextureFilterAnisotropic&&E.texParameterf(E.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax)),o.state="loaded",c(null)}},this.map._refreshExpiredTiles)}abortTile(o,c){o.request&&(o.request.cancel(),delete o.request),c()}unloadTile(o,c){o.texture&&this.map.painter.saveTileTexture(o.texture),c()}hasTransition(){return!1}}class Ps extends As{constructor(o,c,d,m){super(o,c,d,m),this.type="raster-dem",this.maxzoom=22,this._options=g.e({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox",this.redFactor=c.redFactor,this.greenFactor=c.greenFactor,this.blueFactor=c.blueFactor,this.baseShift=c.baseShift}loadTile(o,c){const d=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(d,Yn.Tile);function v(D,S){D&&(o.state="errored",c(D)),S&&(o.dem=S,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded",c(null))}o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.request=Zr.getImage(m,(D,S,E)=>g._(this,void 0,void 0,function*(){if(delete o.request,o.aborted)o.state="unloaded",c(null);else if(D)o.state="errored",c(D);else if(S){this.map._refreshExpiredTiles&&o.setExpiryData(E);const A=g.a(S)&&g.J()?S:yield function(O){return g._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&g.K()){const V=O.width+2,Z=O.height+2;try{return new g.R({width:V,height:Z},yield g.M(O,-1,-1,V,Z))}catch{}}return g.h.getImageData(O,1)})}(S),k={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};o.actor&&"expired"!==o.state||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",k,v))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(o){const c=o.canonical,d=Math.pow(2,c.z),m=(c.x-1+d)%d,v=0===c.x?o.wrap-1:o.wrap,D=(c.x+1+d)%d,S=c.x+1===d?o.wrap+1:o.wrap,E={};return E[new g.O(o.overscaledZ,v,c.z,m,c.y).key]={backfilled:!1},E[new g.O(o.overscaledZ,S,c.z,D,c.y).key]={backfilled:!1},c.y>0&&(E[new g.O(o.overscaledZ,v,c.z,m,c.y-1).key]={backfilled:!1},E[new g.O(o.overscaledZ,o.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},E[new g.O(o.overscaledZ,S,c.z,D,c.y-1).key]={backfilled:!1}),c.y+1<d&&(E[new g.O(o.overscaledZ,v,c.z,m,c.y+1).key]={backfilled:!1},E[new g.O(o.overscaledZ,o.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},E[new g.O(o.overscaledZ,S,c.z,D,c.y+1).key]={backfilled:!1}),E}unloadTile(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})}}class _n extends g.E{constructor(o,c,d,m){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>g.e({},this._options,{type:this.type,data:this._data}),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(m),this._data=c.data,this._options=g.e({},c),this._collectResourceTiming=c.collectResourceTiming,void 0!==c.maxzoom&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const v=g.N/this.tileSize;this.workerOptions=g.e({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(void 0!==c.buffer?c.buffer:128)*v,tolerance:(void 0!==c.tolerance?c.tolerance:.375)*v,extent:g.N,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:void 0!==c.clusterMaxZoom?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:g.N,radius:(c.clusterRadius||50)*v,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(void 0!==o.clusterRadius&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),void 0!==o.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},c),this}getClusterChildren(o,c){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},c),this}getClusterLeaves(o,c,d,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:c,offset:d},m),this}_updateWorkerData(o){const c=g.e({},this.workerOptions);o?c.dataDiff=o:"string"==typeof this._data?(c.request=this.map._requestManager.transformRequest(g.h.resolveURL(this._data),Yn.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new g.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,c,(d,m)=>{if(this._pendingLoads--,this._removed||m&&m.abandoned)return void this.fire(new g.k("dataabort",{dataType:"source"}));let v=null;if(m&&m.resourceTiming&&m.resourceTiming[this.id]&&(v=m.resourceTiming[this.id].slice(0)),d)return void this.fire(new g.j(d));const D={dataType:"source"};this._collectResourceTiming&&v&&v.length>0&&g.e(D,{resourceTiming:v}),this.fire(new g.k("data",Object.assign(Object.assign({},D),{sourceDataType:"metadata"}))),this.fire(new g.k("data",Object.assign(Object.assign({},D),{sourceDataType:"content"})))})}loaded(){return 0===this._pendingLoads}loadTile(o,c){const d=o.actor?"reloadTile":"loadTile";o.actor=this.actor;const m={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.request=this.actor.send(d,m,(v,D)=>(delete o.request,o.unloadVectorData(),o.aborted?c(null):v?c(v):(o.loadVectorData(D,this.map.painter,"reloadTile"===d),c(null))))}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0}unloadTile(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var an=g.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Si extends g.E{constructor(o,c,d,m){super(),this.load=(v,D)=>{this._loaded=!1,this.fire(new g.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=Zr.getImage(this.map._requestManager.transformRequest(this.url,Yn.Image),(S,E)=>{this._request=null,this._loaded=!0,S?this.fire(new g.j(S)):E&&(this.image=E,v&&(this.coordinates=v),D&&D(),this._finishLoading())})},this.prepare=()=>{if(0===Object.keys(this.tiles).length||!this.image)return;const v=this.map.painter.context,D=v.gl;this.boundsBuffer||(this.boundsBuffer=v.createVertexBuffer(this._boundsArray,an.members)),this.boundsSegments||(this.boundsSegments=g.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new In(v,this.image,D.RGBA),this.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE));let S=!1;for(const E in this.tiles){const A=this.tiles[E];"loaded"!==A.state&&(A.state="loaded",A.texture=this.texture,S=!0)}S&&this.fire(new g.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=o,this.dispatcher=d,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=c}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new g.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(o){this.coordinates=o;const c=o.map(g.U.fromLngLat);this.tileID=function(m){let v=1/0,D=1/0,S=-1/0,E=-1/0;for(const V of m)v=Math.min(v,V.x),D=Math.min(D,V.y),S=Math.max(S,V.x),E=Math.max(E,V.y);const A=Math.max(S-v,E-D),k=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),O=Math.pow(2,k);return new g.W(k,Math.floor((v+S)/2*O),Math.floor((D+E)/2*O))}(c),this.minzoom=this.maxzoom=this.tileID.z;const d=c.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new g.V,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,g.N,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,g.N),this._boundsArray.emplaceBack(d[2].x,d[2].y,g.N,g.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new g.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(o,c){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},c(null)):(o.state="errored",c(null))}hasTransition(){return!1}}class rn extends Si{constructor(o,c,d,m){super(o,c,d,m),this.load=()=>{this._loaded=!1;const v=this.options;this.urls=[];for(const D of v.urls)this.urls.push(this.map._requestManager.transformRequest(D,Yn.Source).url);g.X(this.urls,(D,S)=>{this._loaded=!0,D?this.fire(new g.j(D)):S&&(this.video=S,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const v=this.map.painter.context,D=v.gl;this.boundsBuffer||(this.boundsBuffer=v.createVertexBuffer(this._boundsArray,an.members)),this.boundsSegments||(this.boundsSegments=g.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE),D.texSubImage2D(D.TEXTURE_2D,0,0,0,D.RGBA,D.UNSIGNED_BYTE,this.video)):(this.texture=new In(v,this.video,D.RGBA),this.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE));let S=!1;for(const E in this.tiles){const A=this.tiles[E];"loaded"!==A.state&&(A.state="loaded",A.texture=this.texture,S=!0)}S&&this.fire(new g.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=c}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const c=this.video.seekable;o<c.start(0)||o>c.end(0)?this.fire(new g.j(new g.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class po extends Si{constructor(o,c,d,m){super(o,c,d,m),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new g.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let v=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,v=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,v=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const D=this.map.painter.context,S=D.gl;this.boundsBuffer||(this.boundsBuffer=D.createVertexBuffer(this._boundsArray,an.members)),this.boundsSegments||(this.boundsSegments=g.S.simpleSegment(0,0,4,2)),this.texture?(v||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new In(D,this.canvas,S.RGBA,{premultiply:!0});let E=!1;for(const A in this.tiles){const k=this.tiles[A];"loaded"!==k.state&&(k.state="loaded",k.texture=this.texture,E=!0)}E&&this.fire(new g.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),c.coordinates?Array.isArray(c.coordinates)&&4===c.coordinates.length&&!c.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(D=>"number"!=typeof D))||this.fire(new g.j(new g.Y(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new g.j(new g.Y(`sources.${o}`,null,'missing required property "coordinates"'))),c.animate&&"boolean"!=typeof c.animate&&this.fire(new g.j(new g.Y(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),c.canvas?"string"==typeof c.canvas||c.canvas instanceof HTMLCanvasElement||this.fire(new g.j(new g.Y(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new g.j(new g.Y(`sources.${o}`,null,'missing required property "canvas"'))),this.options=c,this.animate=void 0===c.animate||c.animate}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const Ja={},Hi=y=>{switch(y){case"geojson":return _n;case"image":return Si;case"raster":return As;case"raster-dem":return Ps;case"vector":return dr;case"video":return rn;case"canvas":return po}return Ja[y]};function _a(y,o){const c=g.Z();return g.$(c,c,[1,1,0]),g.a0(c,c,[.5*y.width,.5*y.height,1]),g.a1(c,c,y.calculatePosMatrix(o.toUnwrapped()))}function ks(y,o,c,d,m,v){const D=function(O,V,Z){if(O)for(const G of O){const Y=V[G];if(Y&&Y.source===Z&&"fill-extrusion"===Y.type)return!0}else for(const G in V){const Y=V[G];if(Y.source===Z&&"fill-extrusion"===Y.type)return!0}return!1}(m&&m.layers,o,y.id),S=v.maxPitchScaleFactor(),E=y.tilesIn(d,S,D);E.sort(ts);const A=[];for(const O of E)A.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(o,c,y._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,m,v,S,_a(y.transform,O.tileID))});const k=function(O){const V={},Z={};for(const G of O){const Y=G.queryResults,H=G.wrappedTileID,se=Z[H]=Z[H]||{};for(const de in Y){const ee=Y[de],ce=se[de]=se[de]||{},me=V[de]=V[de]||[];for(const ge of ee)ce[ge.featureIndex]||(ce[ge.featureIndex]=!0,me.push(ge))}}return V}(A);for(const O in k)k[O].forEach(V=>{const Z=V.feature,G=y.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=G});return k}function ts(y,o){const c=y.tileID,d=o.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}class Rs{constructor(o,c){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=g.a2(),this.uses=0,this.tileSize=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const c=o+this.timeAdded;c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,c,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(m,v){const D={};if(!v)return D;for(const S of m){const E=S.layerIds.map(A=>v.getLayer(A)).filter(Boolean);if(0!==E.length){S.layers=E,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(A=>E.filter(k=>k.id===A)[0]));for(const A of E)D[A.id]=S}}return D}(o.buckets,c.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const v=this.buckets[m];if(v instanceof g.a4){if(this.hasSymbolBuckets=!0,!d)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const v=this.buckets[m];if(v instanceof g.a4&&v.hasRTLText){this.hasRTLText=!0,g.a5();break}}this.queryPadding=0;for(const m in this.buckets){const v=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(m).queryRadius(v))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new g.a3}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const d in this.buckets){const m=this.buckets[d];m.uploadPending()&&m.upload(o)}const c=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new In(o,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new In(o,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,c,d,m,v,D,S,E,A,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:v,scale:D,tileSize:this.tileSize,pixelPosMatrix:k,transform:E,params:S,queryPadding:this.queryPadding*A},o,c,d):{}}querySourceFeatures(o,c){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const m=d.loadVTLayers(),v=c&&c.sourceLayer?c.sourceLayer:"",D=m._geojsonTileLayer||m[v];if(!D)return;const S=g.a6(c&&c.filter),{z:E,x:A,y:k}=this.tileID.canonical,O={z:E,x:A,y:k};for(let V=0;V<D.length;V++){const Z=D.feature(V);if(S.needGeometry){const H=g.a7(Z,!0);if(!S.filter(new g.a8(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!S.filter(new g.a8(this.tileID.overscaledZ),Z))continue;const G=d.getId(Z,v),Y=new g.a9(Z,E,A,k,G);Y.tile=O,o.push(Y)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const c=this.expirationTime;if(o.cacheControl){const d=g.aa(o.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const d=Date.now();let m=!1;if(this.expirationTime>d)m=!1;else if(c)if(this.expirationTime<c)m=!0;else{const v=this.expirationTime-c;v?this.expirationTime=d+Math.max(v,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,c){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length)return;const d=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!c.style.hasLayer(m))continue;const v=this.buckets[m],D=v.layers[0].sourceLayer||"_geojsonTileLayer",S=d[D],E=o[D];if(!S||!E||0===Object.keys(E).length)continue;v.update(E,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=c&&c.style&&c.style.getLayer(m);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(v)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<g.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=g.h.now()+o}setDependencies(o,c){const d={};for(const m of c)d[m]=!0;this.dependencies[o]=d}hasDependency(o,c){for(const d of o){const m=this.dependencies[d];if(m)for(const v of c)if(m[v])return!0}return!1}}class va{constructor(o,c){this.max=o,this.onRemove=c,this.reset()}reset(){for(const o in this.data)for(const c of this.data[o])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(o,c,d){const m=o.wrapped().key;void 0===this.data[m]&&(this.data[m]=[]);const v={value:c,timeout:void 0};if(void 0!==d&&(v.timeout=setTimeout(()=>{this.remove(o,v)},d)),this.data[m].push(v),this.order.push(m),this.order.length>this.max){const D=this._getAndRemoveByKey(this.order[0]);D&&this.onRemove(D)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const c=this.data[o].shift();return c.timeout&&clearTimeout(c.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),c.value}getByKey(o){const c=this.data[o];return c?c[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,c){if(!this.has(o))return this;const d=o.wrapped().key,m=void 0===c?0:this.data[d].indexOf(c),v=this.data[d][m];return this.data[d].splice(m,1),v.timeout&&clearTimeout(v.timeout),0===this.data[d].length&&delete this.data[d],this.onRemove(v.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(o){const c=[];for(const d in this.data)for(const m of this.data[d])o(m.value)||c.push(m);for(const d of c)this.remove(d.value.tileID,d)}}class _e{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,c,d){const m=String(c);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},g.e(this.stateChanges[o][m],d),null===this.deletedStates[o]){this.deletedStates[o]={};for(const v in this.state[o])v!==m&&(this.deletedStates[o][v]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][m]){this.deletedStates[o][m]={};for(const v in this.state[o][m])d[v]||(this.deletedStates[o][m][v]=null)}else for(const v in d)this.deletedStates[o]&&this.deletedStates[o][m]&&null===this.deletedStates[o][m][v]&&delete this.deletedStates[o][m][v]}removeFeatureState(o,c,d){if(null===this.deletedStates[o])return;const m=String(c);if(this.deletedStates[o]=this.deletedStates[o]||{},d&&void 0!==c)null!==this.deletedStates[o][m]&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][d]=null);else if(void 0!==c)if(this.stateChanges[o]&&this.stateChanges[o][m])for(d in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][d]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}getState(o,c){const d=String(c),m=g.e({},(this.state[o]||{})[d],(this.stateChanges[o]||{})[d]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const v=this.deletedStates[o][c];if(null===v)return{};for(const D in v)delete m[D]}return m}initializeTileState(o,c){o.setFeatureState(this.state,c)}coalesceChanges(o,c){const d={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const v={};for(const D in this.stateChanges[m])this.state[m][D]||(this.state[m][D]={}),g.e(this.state[m][D],this.stateChanges[m][D]),v[D]=this.state[m][D];d[m]=v}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const v={};if(null===this.deletedStates[m])for(const D in this.state[m])v[D]={},this.state[m][D]={};else for(const D in this.deletedStates[m]){if(null===this.deletedStates[m][D])this.state[m][D]={};else for(const S of Object.keys(this.deletedStates[m][D]))delete this.state[m][D][S];v[D]=this.state[m][D]}d[m]=d[m]||{},g.e(d[m],v)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(d).length)for(const m in o)o[m].setFeatureState(d,c)}}class yi extends g.E{constructor(o,c,d){super(),this.id=o,this.dispatcher=d,this.on("data",m=>{"source"===m.dataType&&"metadata"===m.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===m.dataType&&"content"===m.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,v,D,S)=>{const E=new(Hi(v.type))(m,v,D,S);if(E.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${E.id}`);return E})(o,c,d,this),this._tiles={},this._cache=new va(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _e,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const c=this._tiles[o];if("loaded"!==c.state&&"errored"!==c.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,c){return this._source.loadTile(o,c)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){this._source.abortTile&&this._source.abortTile(o,()=>{}),this._source.fire(new g.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const d=this._tiles[c];d.upload(o),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(Ii).map(o=>o.key)}getRenderableIds(o){const c=[];for(const d in this._tiles)this._isIdRenderable(d,o)&&c.push(this._tiles[d]);return o?c.sort((d,m)=>{const v=d.tileID,D=m.tileID,S=new g.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),E=new g.P(D.canonical.x,D.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-D.overscaledZ||E.y-S.y||E.x-S.x}).map(d=>d.tileID.key):c.map(d=>d.tileID).sort(Ii).map(d=>d.key)}hasRenderableParent(o){const c=this.findLoadedParent(o,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(o,c){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(c||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(o,"reloading")}}_reloadTile(o,c){const d=this._tiles[o];d&&("loading"!==d.state&&(d.state=c),this._loadTile(d,this._tileLoaded.bind(this,d,o,c)))}_tileLoaded(o,c,d,m){if(m)return o.state="errored",void(404!==m.status?this._source.fire(new g.j(m,{tile:o})):this.update(this.transform,this.terrain));o.timeAdded=g.h.now(),"expired"===d&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(c,o),"raster-dem"===this.getSource().type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new g.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const c=this.getRenderableIds();for(let m=0;m<c.length;m++){const v=c[m];if(o.neighboringTiles&&o.neighboringTiles[v]){const D=this.getTileByID(v);d(o,D),d(D,o)}}function d(m,v){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let D=v.tileID.canonical.x-m.tileID.canonical.x;const S=v.tileID.canonical.y-m.tileID.canonical.y,E=Math.pow(2,m.tileID.canonical.z),A=v.tileID.key;0===D&&0===S||Math.abs(S)>1||(Math.abs(D)>1&&(1===Math.abs(D+E)?D+=E:1===Math.abs(D-E)&&(D-=E)),v.dem&&m.dem&&(m.dem.backfillBorder(v.dem,D,S),m.neighboringTiles&&m.neighboringTiles[A]&&(m.neighboringTiles[A].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,c,d,m){for(const v in this._tiles){let D=this._tiles[v];if(m[v]||!D.hasData()||D.tileID.overscaledZ<=c||D.tileID.overscaledZ>d)continue;let S=D.tileID;for(;D&&D.tileID.overscaledZ>c+1;){const A=D.tileID.scaledTo(D.tileID.overscaledZ-1);D=this._tiles[A.key],D&&D.hasData()&&(S=A)}let E=S;for(;E.overscaledZ>c;)if(E=E.scaledTo(E.overscaledZ-1),o[E.key]){m[S.key]=S;break}}}findLoadedParent(o,c){if(o.key in this._loadedParentTiles){const d=this._loadedParentTiles[o.key];return d&&d.tileID.overscaledZ>=c?d:null}for(let d=o.overscaledZ-1;d>=c;d--){const m=o.scaledTo(d),v=this._getLoadedTile(m);if(v)return v}}_getLoadedTile(o){const c=this._tiles[o.key];return c&&c.hasData()?c:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const c=Math.ceil(o.width/this._source.tileSize)+1,d=Math.ceil(o.height/this._source.tileSize)+1,m=Math.floor(c*d*(null===this._maxTileCacheZoomLevels?g.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(o){const c=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,c){const d={};for(const m in this._tiles){const v=this._tiles[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+c),d[v.tileID.key]=v}this._tiles=d;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(o,c){if(this.transform=o,this.terrain=c,!this._sourceLoaded||this._paused)return;let d;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new g.O(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y)):(d=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:c}),this._source.hasTile&&(d=d.filter(k=>this._source.hasTile(k)))):d=[];const m=o.coveringZoomLevel(this._source),v=Math.max(m-yi.maxOverzooming,this._source.minzoom),D=Math.max(m+yi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const k={};for(const O of d)if(O.canonical.z>this._source.minzoom){const V=O.scaledTo(O.canonical.z-1);k[V.key]=V;const Z=O.scaledTo(Math.max(this._source.minzoom,Math.min(O.canonical.z,5)));k[Z.key]=Z}d=d.concat(Object.values(k))}const S=0===d.length&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new g.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=this._updateRetainedTiles(d,m);if(ln(this._source.type)){const k={},O={},V=Object.keys(E),Z=g.h.now();for(const G of V){const Y=E[G],H=this._tiles[G];if(!H||0!==H.fadeEndTime&&H.fadeEndTime<=Z)continue;const se=this.findLoadedParent(Y,v);se&&(this._addTile(se.tileID),k[se.tileID.key]=se.tileID),O[G]=Y}this._retainLoadedChildren(O,m,D,E);for(const G in k)E[G]||(this._coveredTiles[G]=!0,E[G]=k[G]);if(c){const G={},Y={};for(const H of d)this._tiles[H.key].hasData()?G[H.key]=H:Y[H.key]=H;for(const H in Y){const se=Y[H].children(this._source.maxzoom);this._tiles[se[0].key]&&this._tiles[se[1].key]&&this._tiles[se[2].key]&&this._tiles[se[3].key]&&(G[se[0].key]=E[se[0].key]=se[0],G[se[1].key]=E[se[1].key]=se[1],G[se[2].key]=E[se[2].key]=se[2],G[se[3].key]=E[se[3].key]=se[3],delete Y[H])}for(const H in Y){const se=this.findLoadedParent(Y[H],this._source.minzoom);if(se){G[se.tileID.key]=E[se.tileID.key]=se.tileID;for(const de in G)G[de].isChildOf(se.tileID)&&delete G[de]}}for(const H in this._tiles)G[H]||(this._coveredTiles[H]=!0)}}for(const k in E)this._tiles[k].clearFadeHold();const A=g.ab(this._tiles,E);for(const k of A){const O=this._tiles[k];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(k)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,c){const d={},m={},v=Math.max(c-yi.maxOverzooming,this._source.minzoom),D=Math.max(c+yi.maxUnderzooming,this._source.minzoom),S={};for(const E of o){const A=this._addTile(E);d[E.key]=E,A.hasData()||c<this._source.maxzoom&&(S[E.key]=E)}this._retainLoadedChildren(S,c,D,d);for(const E of o){let A=this._tiles[E.key];if(A.hasData())continue;if(c+1>this._source.maxzoom){const O=E.children(this._source.maxzoom)[0],V=this.getTile(O);if(V&&V.hasData()){d[O.key]=O;continue}}else{const O=E.children(this._source.maxzoom);if(d[O[0].key]&&d[O[1].key]&&d[O[2].key]&&d[O[3].key])continue}let k=A.wasRequested();for(let O=E.overscaledZ-1;O>=v;--O){const V=E.scaledTo(O);if(m[V.key])break;if(m[V.key]=!0,A=this.getTile(V),!A&&k&&(A=this._addTile(V)),A){const Z=A.hasData();if((k||Z)&&(d[V.key]=V),k=A.wasRequested(),Z)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const c=[];let d,m=this._tiles[o].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){d=this._loadedParentTiles[m.key];break}c.push(m.key);const v=m.scaledTo(m.overscaledZ-1);if(d=this._getLoadedTile(v),d)break;m=v}for(const v of c)this._loadedParentTiles[v]=d}}_addTile(o){let c=this._tiles[o.key];if(c)return c;c=this._cache.getAndRemove(o),c&&(this._setTileReloadTimer(o.key,c),c.tileID=o,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,c)));const d=c;return c||(c=new Rs(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(c,this._tileLoaded.bind(this,c,o.key,c.state))),c.uses++,this._tiles[o.key]=c,d||this._source.fire(new g.k("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(o,c){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const d=c.getExpiryTimeout();d&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},d))}_removeTile(o){const c=this._tiles[o];c&&(c.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),c.uses>0||(c.hasData()&&"reloading"!==c.state?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,c,d){const m=[],v=this.transform;if(!v)return m;const D=d?v.getCameraQueryGeometry(o):o,S=o.map(G=>v.pointCoordinate(G,this.terrain)),E=D.map(G=>v.pointCoordinate(G,this.terrain)),A=this.getIds();let k=1/0,O=1/0,V=-1/0,Z=-1/0;for(const G of E)k=Math.min(k,G.x),O=Math.min(O,G.y),V=Math.max(V,G.x),Z=Math.max(Z,G.y);for(let G=0;G<A.length;G++){const Y=this._tiles[A[G]];if(Y.holdingForFade())continue;const H=Y.tileID,se=Math.pow(2,v.zoom-Y.tileID.overscaledZ),de=c*Y.queryPadding*g.N/Y.tileSize/se,ee=[H.getTilePoint(new g.U(k,O)),H.getTilePoint(new g.U(V,Z))];if(ee[0].x-de<g.N&&ee[0].y-de<g.N&&ee[1].x+de>=0&&ee[1].y+de>=0){const ce=S.map(ge=>H.getTilePoint(ge)),me=E.map(ge=>H.getTilePoint(ge));m.push({tile:Y,tileID:H,queryGeometry:ce,cameraQueryGeometry:me,scale:se})}}return m}getVisibleCoordinates(o){const c=this.getRenderableIds(o).map(d=>this._tiles[d].tileID);for(const d of c)d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped());return c}hasTransition(){if(this._source.hasTransition())return!0;if(ln(this._source.type)){const o=g.h.now();for(const c in this._tiles)if(this._tiles[c].fadeEndTime>=o)return!0}return!1}setFeatureState(o,c,d){this._state.updateState(o=o||"_geojsonTileLayer",c,d)}removeFeatureState(o,c,d){this._state.removeFeatureState(o=o||"_geojsonTileLayer",c,d)}getFeatureState(o,c){return this._state.getState(o=o||"_geojsonTileLayer",c)}setDependencies(o,c,d){const m=this._tiles[o];m&&m.setDependencies(c,d)}reloadTilesForDependencies(o,c){for(const d in this._tiles)this._tiles[d].hasDependency(o,c)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(o,c))}}function Ii(y,o){const c=Math.abs(2*y.wrap)-+(y.wrap<0),d=Math.abs(2*o.wrap)-+(o.wrap<0);return y.overscaledZ-o.overscaledZ||d-c||o.canonical.y-y.canonical.y||o.canonical.x-y.canonical.x}function ln(y){return"raster"===y||"image"===y||"video"===y}yi.maxOverzooming=10,yi.maxUnderzooming=3;const Ut="mapboxgl_preloaded_worker_pool";class Ei{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Ei.workerCount;)this.workers.push(new Worker(g.c.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ut]}numActive(){return Object.keys(this.active).length}}const xa=Math.floor(g.h.hardwareConcurrency/2);let qi;function el(){return qi||(qi=new Ei),qi}Ei.workerCount=g.ac(globalThis)?Math.max(Math.min(xa,3),1):1;class ba{constructor(o,c){this.reset(o,c)}reset(o,c){this.points=o||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=g.ad(o,0,1);let c=1,d=this._distances[c];const m=o*this.paddedLength+this.padding;for(;d<m&&c<this._distances.length;)d=this._distances[++c];const v=c-1,D=this._distances[v],S=d-D,E=S>0?(m-D)/S:0;return this.points[v].mult(1-E).add(this.points[c].mult(E))}}function ns(y,o){let c=!0;return"always"===y||"never"!==y&&"never"!==o||(c=!1),c}class Os{constructor(o,c,d){const m=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(o/d),this.yCellCount=Math.ceil(c/d);for(let D=0;D<this.xCellCount*this.yCellCount;D++)m.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=c,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,c,d,m,v){this._forEachCell(c,d,m,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(v)}insertCircle(o,c,d,m){this._forEachCell(c-m,d-m,c+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(c),this.circles.push(d),this.circles.push(m)}_insertBoxCell(o,c,d,m,v,D){this.boxCells[v].push(D)}_insertCircleCell(o,c,d,m,v,D){this.circleCells[v].push(D)}_query(o,c,d,m,v,D,S){if(d<0||o>this.width||m<0||c>this.height)return[];const E=[];if(o<=0&&c<=0&&this.width<=d&&this.height<=m){if(v)return[{key:null,x1:o,y1:c,x2:d,y2:m}];for(let A=0;A<this.boxKeys.length;A++)E.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const k=this.circles[3*A],O=this.circles[3*A+1],V=this.circles[3*A+2];E.push({key:this.circleKeys[A],x1:k-V,y1:O-V,x2:k+V,y2:O+V})}}else this._forEachCell(o,c,d,m,this._queryCell,E,{hitTest:v,overlapMode:D,seenUids:{box:{},circle:{}}},S);return E}query(o,c,d,m){return this._query(o,c,d,m,!1,null)}hitTest(o,c,d,m,v,D){return this._query(o,c,d,m,!0,v,D).length>0}hitTestCircle(o,c,d,m,v){const D=o-d,S=o+d,E=c-d,A=c+d;if(S<0||D>this.width||A<0||E>this.height)return!1;const k=[];return this._forEachCell(D,E,S,A,this._queryCellCircle,k,{hitTest:!0,overlapMode:m,circle:{x:o,y:c,radius:d},seenUids:{box:{},circle:{}}},v),k.length>0}_queryCell(o,c,d,m,v,D,S,E){const{seenUids:A,hitTest:k,overlapMode:O}=S,V=this.boxCells[v];if(null!==V){const G=this.bboxes;for(const Y of V)if(!A.box[Y]){A.box[Y]=!0;const H=4*Y,se=this.boxKeys[Y];if(o<=G[H+2]&&c<=G[H+3]&&d>=G[H+0]&&m>=G[H+1]&&(!E||E(se))&&(!k||!ns(O,se.overlapMode))&&(D.push({key:se,x1:G[H],y1:G[H+1],x2:G[H+2],y2:G[H+3]}),k))return!0}}const Z=this.circleCells[v];if(null!==Z){const G=this.circles;for(const Y of Z)if(!A.circle[Y]){A.circle[Y]=!0;const H=3*Y,se=this.circleKeys[Y];if(this._circleAndRectCollide(G[H],G[H+1],G[H+2],o,c,d,m)&&(!E||E(se))&&(!k||!ns(O,se.overlapMode))){const de=G[H],ee=G[H+1],ce=G[H+2];if(D.push({key:se,x1:de-ce,y1:ee-ce,x2:de+ce,y2:ee+ce}),k)return!0}}}return!1}_queryCellCircle(o,c,d,m,v,D,S,E){const{circle:A,seenUids:k,overlapMode:O}=S,V=this.boxCells[v];if(null!==V){const G=this.bboxes;for(const Y of V)if(!k.box[Y]){k.box[Y]=!0;const H=4*Y,se=this.boxKeys[Y];if(this._circleAndRectCollide(A.x,A.y,A.radius,G[H+0],G[H+1],G[H+2],G[H+3])&&(!E||E(se))&&!ns(O,se.overlapMode))return D.push(!0),!0}}const Z=this.circleCells[v];if(null!==Z){const G=this.circles;for(const Y of Z)if(!k.circle[Y]){k.circle[Y]=!0;const H=3*Y,se=this.circleKeys[Y];if(this._circlesCollide(G[H],G[H+1],G[H+2],A.x,A.y,A.radius)&&(!E||E(se))&&!ns(O,se.overlapMode))return D.push(!0),!0}}}_forEachCell(o,c,d,m,v,D,S,E){const A=this._convertToXCellCoord(o),k=this._convertToYCellCoord(c),O=this._convertToXCellCoord(d),V=this._convertToYCellCoord(m);for(let Z=A;Z<=O;Z++)for(let G=k;G<=V;G++)if(v.call(this,o,c,d,m,this.xCellCount*G+Z,D,S,E))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,c,d,m,v,D){const S=m-o,E=v-c,A=d+D;return A*A>S*S+E*E}_circleAndRectCollide(o,c,d,m,v,D,S){const E=(D-m)/2,A=Math.abs(o-(m+E));if(A>E+d)return!1;const k=(S-v)/2,O=Math.abs(c-(v+k));if(O>k+d)return!1;if(A<=E||O<=k)return!0;const V=A-E,Z=O-k;return V*V+Z*Z<=d*d}}function Pe(y,o,c,d,m){const v=g.Z();return o?(g.a0(v,v,[1/m,1/m,1]),c||g.ae(v,v,d.angle)):g.a1(v,d.labelPlaneMatrix,y),v}function Gi(y,o,c,d,m){if(o){const v=g.af(y);return g.a0(v,v,[m,m,1]),c||g.ae(v,v,-d.angle),v}return d.glCoordMatrix}function Ln(y,o,c){let d;c?(d=[y.x,y.y,c(y.x,y.y),1],g.ag(d,d,o)):(d=[y.x,y.y,0,1],K(d,d,o));const m=d[3];return{point:new g.P(d[0]/m,d[1]/m),signedDistanceFromCamera:m}}function rs(y,o){return.5+y/o*.5}function Po(y,o){const c=y[0]/y[3],d=y[1]/y[3];return c>=-o[0]&&c<=o[0]&&d>=-o[1]&&d<=o[1]}function ze(y,o,c,d,m,v,D,S,E,A){const k=d?y.textSizeData:y.iconSizeData,O=g.ah(k,c.transform.zoom),V=[256/c.width*2+1,256/c.height*2+1],Z=d?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;Z.clear();const G=y.lineVertexArray,Y=d?y.text.placedSymbolArray:y.icon.placedSymbolArray,H=c.transform.width/c.transform.height;let se=!1;for(let de=0;de<Y.length;de++){const ee=Y.get(de);if(ee.hidden||ee.writingMode===g.ai.vertical&&!se){U(ee.numGlyphs,Z);continue}let ce;if(se=!1,A?(ce=[ee.anchorX,ee.anchorY,A(ee.anchorX,ee.anchorY),1],g.ag(ce,ce,o)):(ce=[ee.anchorX,ee.anchorY,0,1],K(ce,ce,o)),!Po(ce,V)){U(ee.numGlyphs,Z);continue}const me=rs(c.transform.cameraToCenterDistance,ce[3]),ge=g.aj(k,O,ee),be=D?ge/me:ge*me,Ee=new g.P(ee.anchorX,ee.anchorY),Ie=Ln(Ee,m,A).point,Re={projections:{},offsets:{}},$e=Wr(ee,be,!1,S,o,m,v,y.glyphOffsetArray,G,Z,Ie,Ee,Re,H,E,A);se=$e.useVertical,($e.notEnoughRoom||se||$e.needsFlipping&&Wr(ee,be,!0,S,o,m,v,y.glyphOffsetArray,G,Z,Ie,Ee,Re,H,E,A).notEnoughRoom)&&U(ee.numGlyphs,Z)}d?y.text.dynamicLayoutVertexBuffer.updateData(Z):y.icon.dynamicLayoutVertexBuffer.updateData(Z)}function St(y,o,c,d,m,v,D,S,E,A,k,O,V){const Z=S.glyphStartIndex+S.numGlyphs,G=S.lineStartIndex,Y=S.lineStartIndex+S.lineLength,H=o.getoffsetX(S.glyphStartIndex),se=o.getoffsetX(Z-1),de=F(y*H,c,d,m,v,D,S.segment,G,Y,E,A,k,O,V);if(!de)return null;const ee=F(y*se,c,d,m,v,D,S.segment,G,Y,E,A,k,O,V);return ee?{first:de,last:ee}:null}function ft(y,o,c,d){return y===g.ai.horizontal&&Math.abs(c.y-o.y)>Math.abs(c.x-o.x)*d?{useVertical:!0}:(y===g.ai.vertical?o.y<c.y:o.x>c.x)?{needsFlipping:!0}:null}function Wr(y,o,c,d,m,v,D,S,E,A,k,O,V,Z,G,Y){const H=o/24,se=y.lineOffsetX*H,de=y.lineOffsetY*H;let ee;if(y.numGlyphs>1){const ce=y.glyphStartIndex+y.numGlyphs,me=y.lineStartIndex,ge=y.lineStartIndex+y.lineLength,be=St(H,S,se,de,c,k,O,y,E,v,V,G,Y);if(!be)return{notEnoughRoom:!0};const Ee=Ln(be.first.point,D,Y).point,Ie=Ln(be.last.point,D,Y).point;if(d&&!c){const Re=ft(y.writingMode,Ee,Ie,Z);if(Re)return Re}ee=[be.first];for(let Re=y.glyphStartIndex+1;Re<ce-1;Re++)ee.push(F(H*S.getoffsetX(Re),se,de,c,k,O,y.segment,me,ge,E,v,V,G,Y));ee.push(be.last)}else{if(d&&!c){const me=Ln(O,m,Y).point,ge=y.lineStartIndex+y.segment+1,be=new g.P(E.getx(ge),E.gety(ge)),Ee=Ln(be,m,Y),Ie=Ee.signedDistanceFromCamera>0?Ee.point:fo(O,be,me,1,m,Y),Re=ft(y.writingMode,me,Ie,Z);if(Re)return Re}const ce=F(H*S.getoffsetX(y.glyphStartIndex),se,de,c,k,O,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,E,v,V,G,Y);if(!ce)return{notEnoughRoom:!0};ee=[ce]}for(const ce of ee)g.ak(A,ce.point,ce.angle);return{}}function fo(y,o,c,d,m,v){const D=Ln(y.add(y.sub(o)._unit()),m,v).point,S=c.sub(D);return c.add(S._mult(d/S.mag()))}function wt(y,o){const{projectionCache:c,lineVertexArray:d,labelPlaneMatrix:m,tileAnchorPoint:v,distanceFromAnchor:D,getElevation:S,previousVertex:E,direction:A,absOffsetX:k}=o;if(c.projections[y])return c.projections[y];const O=new g.P(d.getx(y),d.gety(y)),V=Ln(O,m,S);if(V.signedDistanceFromCamera>0)return c.projections[y]=V.point,V.point;const Z=y-A;return fo(0===D?v:new g.P(d.getx(Z),d.gety(Z)),O,E,k-D+1,m,S)}function ko(y,o,c){return y._unit()._perp()._mult(o*c)}function X(y,o,c,d,m,v,D,S){const{projectionCache:E,direction:A}=S;if(E.offsets[y])return E.offsets[y];const k=c.add(o);if(y+A<d||y+A>=m)return E.offsets[y]=k,k;const O=wt(y+A,S),V=ko(O.sub(c),D,A),Z=c.add(V),G=O.add(V);return E.offsets[y]=g.al(v,k,Z,G)||k,E.offsets[y]}function F(y,o,c,d,m,v,D,S,E,A,k,O,V,Z){const G=d?y-o:y+o;let Y=G>0?1:-1,H=0;d&&(Y*=-1,H=Math.PI),Y<0&&(H+=Math.PI);let se,de,ee=Y>0?S+D:S+D+1,ce=m,me=m,ge=0,be=0;const Ee=Math.abs(G),Ie=[];let Re;for(;ge+be<=Ee;){if(ee+=Y,ee<S||ee>=E)return null;ge+=be,me=ce,de=se;const ke={projectionCache:O,lineVertexArray:A,labelPlaneMatrix:k,tileAnchorPoint:v,distanceFromAnchor:ge,getElevation:Z,previousVertex:me,direction:Y,absOffsetX:Ee};if(ce=wt(ee,ke),0===c)Ie.push(me),Re=ce.sub(me);else{let it;const Qe=ce.sub(me);it=0===Qe.mag()?ko(wt(ee+Y,ke).sub(ce),c,Y):ko(Qe,c,Y),de||(de=me.add(it)),se=X(ee,it,ce,S,E,de,c,ke),Ie.push(de),Re=se.sub(de)}be=Re.mag()}const $e=Re._mult((Ee-ge)/be)._add(de||me),Tt=H+Math.atan2(ce.y-me.y,ce.x-me.x);return Ie.push($e),{point:$e,angle:V?Tt:0,path:Ie}}const z=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function U(y,o){for(let c=0;c<y;c++){const d=o.length;o.resize(d+4),o.float32.set(z,3*d)}}function K(y,o,c){const d=o[0],m=o[1];return y[0]=c[0]*d+c[4]*m+c[12],y[1]=c[1]*d+c[5]*m+c[13],y[3]=c[3]*d+c[7]*m+c[15],y}const J=100;class ue{constructor(o,c=new Os(o.width+200,o.height+200,25),d=new Os(o.width+200,o.height+200,25)){this.transform=o,this.grid=c,this.ignoredGrid=d,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+J,this.screenBottomBoundary=o.height+J,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,c,d,m,v,D){const S=this.projectAndGetPerspectiveRatio(m,o.anchorPointX,o.anchorPointY,D),E=d*S.perspectiveRatio,A=o.x1*E+S.point.x,k=o.y1*E+S.point.y,O=o.x2*E+S.point.x,V=o.y2*E+S.point.y;return!this.isInsideGrid(A,k,O,V)||"always"!==c&&this.grid.hitTest(A,k,O,V,c,v)||S.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[A,k,O,V],offscreen:this.isOffscreen(A,k,O,V)}}placeCollisionCircles(o,c,d,m,v,D,S,E,A,k,O,V,Z,G){const Y=[],H=new g.P(c.anchorX,c.anchorY),se=Ln(H,D,G),de=rs(this.transform.cameraToCenterDistance,se.signedDistanceFromCamera),ee=(k?v/de:v*de)/g.ap,ce=Ln(H,S,G).point,me=St(ee,m,c.lineOffsetX*ee,c.lineOffsetY*ee,!1,ce,H,c,d,S,{projections:{},offsets:{}},!1,G);let ge=!1,be=!1,Ee=!0;if(me){const Ie=.5*V*de+Z,Re=new g.P(-100,-100),$e=new g.P(this.screenRightBoundary,this.screenBottomBoundary),Tt=new ba,ke=me.first,it=me.last;let Qe=[];for(let bt=ke.path.length-1;bt>=1;bt--)Qe.push(ke.path[bt]);for(let bt=1;bt<it.path.length;bt++)Qe.push(it.path[bt]);const nn=2.5*Ie;if(E){const bt=Qe.map(kt=>Ln(kt,E,G));Qe=bt.some(kt=>kt.signedDistanceFromCamera<=0)?[]:bt.map(kt=>kt.point)}let At=[];if(Qe.length>0){const bt=Qe[0].clone(),kt=Qe[0].clone();for(let An=1;An<Qe.length;An++)bt.x=Math.min(bt.x,Qe[An].x),bt.y=Math.min(bt.y,Qe[An].y),kt.x=Math.max(kt.x,Qe[An].x),kt.y=Math.max(kt.y,Qe[An].y);At=bt.x>=Re.x&&kt.x<=$e.x&&bt.y>=Re.y&&kt.y<=$e.y?[Qe]:kt.x<Re.x||bt.x>$e.x||kt.y<Re.y||bt.y>$e.y?[]:g.am([Qe],Re.x,Re.y,$e.x,$e.y)}for(const bt of At){Tt.reset(bt,.25*Ie);let kt=0;kt=Tt.length<=.5*Ie?1:Math.ceil(Tt.paddedLength/nn)+1;for(let An=0;An<kt;An++){const un=An/Math.max(kt-1,1),pr=Tt.lerp(un),er=pr.x+J,$n=pr.y+J;Y.push(er,$n,Ie,0);const Nr=er-Ie,on=$n-Ie,Jr=er+Ie,to=$n+Ie;if(Ee=Ee&&this.isOffscreen(Nr,on,Jr,to),be=be||this.isInsideGrid(Nr,on,Jr,to),"always"!==o&&this.grid.hitTestCircle(er,$n,Ie,o,O)&&(ge=!0,!A))return{circles:[],offscreen:!1,collisionDetected:ge}}}}return{circles:!A&&ge||!be||de<this.perspectiveRatioCutoff?[]:Y,offscreen:Ee,collisionDetected:ge}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let d=1/0,m=1/0,v=-1/0,D=-1/0;for(const k of o){const O=new g.P(k.x+J,k.y+J);d=Math.min(d,O.x),m=Math.min(m,O.y),v=Math.max(v,O.x),D=Math.max(D,O.y),c.push(O)}const S=this.grid.query(d,m,v,D).concat(this.ignoredGrid.query(d,m,v,D)),E={},A={};for(const k of S){const O=k.key;if(void 0===E[O.bucketInstanceId]&&(E[O.bucketInstanceId]={}),E[O.bucketInstanceId][O.featureIndex])continue;const V=[new g.P(k.x1,k.y1),new g.P(k.x2,k.y1),new g.P(k.x2,k.y2),new g.P(k.x1,k.y2)];g.an(c,V)&&(E[O.bucketInstanceId][O.featureIndex]=!0,void 0===A[O.bucketInstanceId]&&(A[O.bucketInstanceId]=[]),A[O.bucketInstanceId].push(O.featureIndex))}return A}insertCollisionBox(o,c,d,m,v,D){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:D,overlapMode:c},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,c,d,m,v,D){const S=d?this.ignoredGrid:this.grid,E={bucketInstanceId:m,featureIndex:v,collisionGroupID:D,overlapMode:c};for(let A=0;A<o.length;A+=4)S.insertCircle(E,o[A],o[A+1],o[A+2])}projectAndGetPerspectiveRatio(o,c,d,m){let v;return m?(v=[c,d,m(c,d),1],g.ag(v,v,o)):(v=[c,d,0,1],K(v,v,o)),{point:new g.P((v[0]/v[3]+1)/2*this.transform.width+J,(-v[1]/v[3]+1)/2*this.transform.height+J),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(o,c,d,m){return d<J||o>=this.screenRightBoundary||m<J||c>this.screenBottomBoundary}isInsideGrid(o,c,d,m){return d>=0&&o<this.gridRightBoundary&&m>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const o=g.ao([]);return g.$(o,o,[-100,-100,0]),o}}function oe(y,o,c){return o*(g.N/(y.tileSize*Math.pow(2,c-y.tileID.overscaledZ)))}class ne{constructor(o,c,d,m){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?c:-c))):m&&d?1:0,this.placed=d}isHidden(){return 0===this.opacity&&!this.placed}}class le{constructor(o,c,d,m,v){this.text=new ne(o?o.text:null,c,d,v),this.icon=new ne(o?o.icon:null,c,m,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xe{constructor(o,c,d){this.text=o,this.icon=c,this.skipFade=d}}class we{constructor(){this.invProjMatrix=g.Z(),this.viewportMatrix=g.Z(),this.circles=[]}}class Se{constructor(o,c,d,m,v){this.bucketInstanceId=o,this.featureIndex=c,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=v}}class Ze{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const c=++this.maxGroupID;this.collisionGroups[o]={ID:c,predicate:d=>d.collisionGroupID===c}}return this.collisionGroups[o]}}function lt(y,o,c,d,m){const{horizontalAlign:v,verticalAlign:D}=g.au(y);return new g.P(-(v-.5)*o+d[0]*m,-(D-.5)*c+d[1]*m)}function Ye(y,o,c,d,m,v){const{x1:D,x2:S,y1:E,y2:A,anchorPointX:k,anchorPointY:O}=y,V=new g.P(o,c);return d&&V._rotate(m?v:-v),{x1:D+V.x,y1:E+V.y,x2:S+V.x,y2:A+V.y,anchorPointX:k,anchorPointY:O}}class nt{constructor(o,c,d,m,v){this.transform=o.clone(),this.terrain=c,this.collisionIndex=new ue(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Ze(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,c,d,m){const v=d.getBucket(c),D=d.latestFeatureIndex;if(!v||!D||c.id!==v.layerIds[0])return;const S=d.collisionBoxArray,E=v.layers[0].layout,A=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),k=d.tileSize/g.N,O=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),V="map"===E.get("text-pitch-alignment"),Z="map"===E.get("text-rotation-alignment"),G=oe(d,1,this.transform.zoom),Y=Pe(O,V,Z,this.transform,G);let H=null;if(V){const de=Gi(O,V,Z,this.transform,G);H=g.a1([],this.transform.labelPlaneMatrix,de)}this.retainedQueryData[v.bucketInstanceId]=new Se(v.bucketInstanceId,D,v.sourceLayerIndex,v.index,d.tileID);const se={bucket:v,layout:E,posMatrix:O,textLabelPlaneMatrix:Y,labelToScreenMatrix:H,scale:A,textPixelRatio:k,holdingForFade:d.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:g.ah(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(m)for(const de of v.sortKeyRanges){const{sortKey:ee,symbolInstanceStart:ce,symbolInstanceEnd:me}=de;o.push({sortKey:ee,symbolInstanceStart:ce,symbolInstanceEnd:me,parameters:se})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:se})}attemptAnchorPlacement(o,c,d,m,v,D,S,E,A,k,O,V,Z,G,Y,H){const se=g.aq[o.textAnchor],de=[o.textOffset0,o.textOffset1],ee=lt(se,d,m,de,v),ce=this.collisionIndex.placeCollisionBox(Ye(c,ee.x,ee.y,D,S,this.transform.angle),O,E,A,k.predicate,H);if((!Y||0!==this.collisionIndex.placeCollisionBox(Ye(Y,ee.x,ee.y,D,S,this.transform.angle),O,E,A,k.predicate,H).box.length)&&ce.box.length>0){let me;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(me=this.prevPlacement.variableOffsets[V.crossTileID].anchor),0===V.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:de,width:d,height:m,anchor:se,textBoxScale:v,prevAnchor:me},this.markUsedJustification(Z,se,V,G),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,G,V),this.placedOrientations[V.crossTileID]=G),{shift:ee,placedGlyphBoxes:ce}}}placeLayerBucketPart(o,c,d){const{bucket:m,layout:v,posMatrix:D,textLabelPlaneMatrix:S,labelToScreenMatrix:E,textPixelRatio:A,holdingForFade:k,collisionBoxArray:O,partiallyEvaluatedTextSize:V,collisionGroup:Z}=o.parameters,G=v.get("text-optional"),Y=v.get("icon-optional"),H=g.ar(v,"text-overlap","text-allow-overlap"),se="always"===H,de=g.ar(v,"icon-overlap","icon-allow-overlap"),ee="always"===de,ce="map"===v.get("text-rotation-alignment"),me="map"===v.get("text-pitch-alignment"),ge="none"!==v.get("icon-text-fit"),be="viewport-y"===v.get("symbol-z-order"),Ee=se&&(ee||!m.hasIconData()||Y),Ie=ee&&(se||!m.hasTextData()||G);!m.collisionArrays&&O&&m.deserializeCollisionBoxes(O);const Re=this.retainedQueryData[m.bucketInstanceId].tileID,$e=this.terrain?(ke,it)=>this.terrain.getElevation(Re,ke,it):null,Tt=(ke,it)=>{var Qe,nn;if(c[ke.crossTileID])return;if(k)return void(this.placements[ke.crossTileID]=new xe(!1,!1,!1));let At=!1,bt=!1,kt=!0,An=null,un={box:null,offscreen:null},pr={box:null,offscreen:null},er=null,$n=null,Nr=null,on=0,Jr=0,to=0;it.textFeatureIndex?on=it.textFeatureIndex:ke.useRuntimeCollisionCircles&&(on=ke.featureIndex),it.verticalTextFeatureIndex&&(Jr=it.verticalTextFeatureIndex);const Xs=it.textBox;if(Xs){const zr=Pn=>{let sr=g.ai.horizontal;if(m.allowVerticalPlacement&&!Pn&&this.prevPlacement){const Br=this.prevPlacement.placedOrientations[ke.crossTileID];Br&&(this.placedOrientations[ke.crossTileID]=Br,sr=Br,this.markUsedOrientation(m,sr,ke))}return sr},Ir=(Pn,sr)=>{if(m.allowVerticalPlacement&&ke.numVerticalGlyphVertices>0&&it.verticalTextBox){for(const Br of m.writingModes)if(Br===g.ai.vertical?(un=sr(),pr=un):un=Pn(),un&&un.box&&un.box.length)break}else un=Pn()},ui=ke.textAnchorOffsetStartIndex,fs=ke.textAnchorOffsetEndIndex;if(fs===ui){const Pn=(sr,Br)=>{const Gn=this.collisionIndex.placeCollisionBox(sr,H,A,D,Z.predicate,$e);return Gn&&Gn.box&&Gn.box.length&&(this.markUsedOrientation(m,Br,ke),this.placedOrientations[ke.crossTileID]=Br),Gn};Ir(()=>Pn(Xs,g.ai.horizontal),()=>{const sr=it.verticalTextBox;return m.allowVerticalPlacement&&ke.numVerticalGlyphVertices>0&&sr?Pn(sr,g.ai.vertical):{box:null,offscreen:null}}),zr(un&&un.box&&un.box.length)}else{let Pn=g.aq[null===(nn=null===(Qe=this.prevPlacement)||void 0===Qe?void 0:Qe.variableOffsets[ke.crossTileID])||void 0===nn?void 0:nn.anchor];const sr=(Gn,Fa,dc)=>{const ou=Gn.x2-Gn.x1,su=Gn.y2-Gn.y1,Fd=ke.textBoxScale,au=ge&&"never"===de?Fa:null;let yo={box:[],offscreen:!1},ms="never"===H?1:2,_o="never";Pn&&ms++;for(let Ci=0;Ci<ms;Ci++){for(let vo=ui;vo<fs;vo++){const sh=m.textAnchorOffsets.get(vo);if(Pn&&sh.textAnchor!==Pn)continue;const $o=this.attemptAnchorPlacement(sh,Gn,ou,su,Fd,ce,me,A,D,Z,_o,ke,m,dc,au,$e);if($o&&(yo=$o.placedGlyphBoxes,yo&&yo.box&&yo.box.length))return At=!0,An=$o.shift,yo}Pn?Pn=null:_o=H}return yo};Ir(()=>sr(Xs,it.iconBox,g.ai.horizontal),()=>{const Gn=it.verticalTextBox;return m.allowVerticalPlacement&&!(un&&un.box&&un.box.length)&&ke.numVerticalGlyphVertices>0&&Gn?sr(Gn,it.verticalIconBox,g.ai.vertical):{box:null,offscreen:null}}),un&&(At=un.box,kt=un.offscreen);const Br=zr(un&&un.box);if(!At&&this.prevPlacement){const Gn=this.prevPlacement.variableOffsets[ke.crossTileID];Gn&&(this.variableOffsets[ke.crossTileID]=Gn,this.markUsedJustification(m,Gn.anchor,ke,Br))}}}if(er=un,At=er&&er.box&&er.box.length>0,kt=er&&er.offscreen,ke.useRuntimeCollisionCircles){const zr=m.text.placedSymbolArray.get(ke.centerJustifiedTextSymbolIndex),Ir=g.aj(m.textSizeData,V,zr),ui=v.get("text-padding");$n=this.collisionIndex.placeCollisionCircles(H,zr,m.lineVertexArray,m.glyphOffsetArray,Ir,D,S,E,d,me,Z.predicate,ke.collisionCircleDiameter,ui,$e),$n.circles.length&&$n.collisionDetected&&!d&&g.w("Collisions detected, but collision boxes are not shown"),At=se||$n.circles.length>0&&!$n.collisionDetected,kt=kt&&$n.offscreen}if(it.iconFeatureIndex&&(to=it.iconFeatureIndex),it.iconBox){const zr=Ir=>{const ui=ge&&An?Ye(Ir,An.x,An.y,ce,me,this.transform.angle):Ir;return this.collisionIndex.placeCollisionBox(ui,de,A,D,Z.predicate,$e)};pr&&pr.box&&pr.box.length&&it.verticalIconBox?(Nr=zr(it.verticalIconBox),bt=Nr.box.length>0):(Nr=zr(it.iconBox),bt=Nr.box.length>0),kt=kt&&Nr.offscreen}const La=G||0===ke.numHorizontalGlyphVertices&&0===ke.numVerticalGlyphVertices,vl=Y||0===ke.numIconVertices;if(La||vl?vl?La||(bt=bt&&At):At=bt&&At:bt=At=bt&&At,At&&er&&er.box&&this.collisionIndex.insertCollisionBox(er.box,H,v.get("text-ignore-placement"),m.bucketInstanceId,pr&&pr.box&&Jr?Jr:on,Z.ID),bt&&Nr&&this.collisionIndex.insertCollisionBox(Nr.box,de,v.get("icon-ignore-placement"),m.bucketInstanceId,to,Z.ID),$n&&(At&&this.collisionIndex.insertCollisionCircles($n.circles,H,v.get("text-ignore-placement"),m.bucketInstanceId,on,Z.ID),d)){const zr=m.bucketInstanceId;let Ir=this.collisionCircleArrays[zr];void 0===Ir&&(Ir=this.collisionCircleArrays[zr]=new we);for(let ui=0;ui<$n.circles.length;ui+=4)Ir.circles.push($n.circles[ui+0]),Ir.circles.push($n.circles[ui+1]),Ir.circles.push($n.circles[ui+2]),Ir.circles.push($n.collisionDetected?1:0)}if(0===ke.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===m.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ke.crossTileID]=new xe(At||Ee,bt||Ie,kt||m.justReloaded),c[ke.crossTileID]=!0};if(be){if(0!==o.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const ke=m.getSortedSymbolIndexes(this.transform.angle);for(let it=ke.length-1;it>=0;--it){const Qe=ke[it];Tt(m.symbolInstances.get(Qe),m.collisionArrays[Qe])}}else for(let ke=o.symbolInstanceStart;ke<o.symbolInstanceEnd;ke++)Tt(m.symbolInstances.get(ke),m.collisionArrays[ke]);if(d&&m.bucketInstanceId in this.collisionCircleArrays){const ke=this.collisionCircleArrays[m.bucketInstanceId];g.as(ke.invProjMatrix,D),ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(o,c,d,m){let v;v=m===g.ai.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[g.at(c)];const D=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const S of D)S>=0&&(o.text.placedSymbolArray.get(S).crossTileID=v>=0&&S!==v?0:d.crossTileID)}markUsedOrientation(o,c,d){const m=c===g.ai.horizontal||c===g.ai.horizontalOnly?c:0,v=c===g.ai.vertical?c:0,D=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const S of D)o.text.placedSymbolArray.get(S).placedOrientation=m;d.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let d=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const m=c?c.symbolFadeChange(o):1,v=c?c.opacities:{},D=c?c.variableOffsets:{},S=c?c.placedOrientations:{};for(const E in this.placements){const A=this.placements[E],k=v[E];k?(this.opacities[E]=new le(k,m,A.text,A.icon),d=d||A.text!==k.text.placed||A.icon!==k.icon.placed):(this.opacities[E]=new le(null,m,A.text,A.icon,A.skipFade),d=d||A.text||A.icon)}for(const E in v){const A=v[E];if(!this.opacities[E]){const k=new le(A,m,!1,!1);k.isHidden()||(this.opacities[E]=k,d=d||A.text.placed||A.icon.placed)}}for(const E in D)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=D[E]);for(const E in S)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=S[E]);if(c&&void 0===c.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:o)}updateLayerOpacities(o,c){const d={};for(const m of c){const v=m.getBucket(o);v&&m.latestFeatureIndex&&o.id===v.layerIds[0]&&this.updateBucketOpacities(v,d,m.collisionBoxArray)}}updateBucketOpacities(o,c,d){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const m=o.layers[0],v=m.layout,D=new le(null,0,!1,!1,!0),S=v.get("text-allow-overlap"),E=v.get("icon-allow-overlap"),A=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),k="map"===v.get("text-rotation-alignment"),O="map"===v.get("text-pitch-alignment"),V="none"!==v.get("icon-text-fit"),Z=new le(null,0,S&&(E||!o.hasIconData()||v.get("icon-optional")),E&&(S||!o.hasTextData()||v.get("text-optional")),!0);!o.collisionArrays&&d&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(d);const G=(Y,H,se)=>{for(let de=0;de<H/4;de++)Y.opacityVertexArray.emplaceBack(se);Y.hasVisibleVertices=Y.hasVisibleVertices||se!==Zi};for(let Y=0;Y<o.symbolInstances.length;Y++){const H=o.symbolInstances.get(Y),{numHorizontalGlyphVertices:se,numVerticalGlyphVertices:de,crossTileID:ee}=H;let ce=this.opacities[ee];c[ee]?ce=D:ce||(ce=Z,this.opacities[ee]=ce),c[ee]=!0;const me=H.numIconVertices>0,ge=this.placedOrientations[H.crossTileID],be=ge===g.ai.vertical,Ee=ge===g.ai.horizontal||ge===g.ai.horizontalOnly;if(se>0||de>0){const Ie=vn(ce.text);G(o.text,se,be?Zi:Ie),G(o.text,de,Ee?Zi:Ie);const Re=ce.text.isHidden();[H.rightJustifiedTextSymbolIndex,H.centerJustifiedTextSymbolIndex,H.leftJustifiedTextSymbolIndex].forEach(ke=>{ke>=0&&(o.text.placedSymbolArray.get(ke).hidden=Re||be?1:0)}),H.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(H.verticalPlacedTextSymbolIndex).hidden=Re||Ee?1:0);const $e=this.variableOffsets[H.crossTileID];$e&&this.markUsedJustification(o,$e.anchor,H,ge);const Tt=this.placedOrientations[H.crossTileID];Tt&&(this.markUsedJustification(o,"left",H,Tt),this.markUsedOrientation(o,Tt,H))}if(me){const Ie=vn(ce.icon),Re=!(V&&H.verticalPlacedIconSymbolIndex&&be);H.placedIconSymbolIndex>=0&&(G(o.icon,H.numIconVertices,Re?Ie:Zi),o.icon.placedSymbolArray.get(H.placedIconSymbolIndex).hidden=ce.icon.isHidden()),H.verticalPlacedIconSymbolIndex>=0&&(G(o.icon,H.numVerticalIconVertices,Re?Zi:Ie),o.icon.placedSymbolArray.get(H.verticalPlacedIconSymbolIndex).hidden=ce.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Ie=o.collisionArrays[Y];if(Ie){let Re=new g.P(0,0);if(Ie.textBox||Ie.verticalTextBox){let Tt=!0;if(A){const ke=this.variableOffsets[ee];ke?(Re=lt(ke.anchor,ke.width,ke.height,ke.textOffset,ke.textBoxScale),k&&Re._rotate(O?this.transform.angle:-this.transform.angle)):Tt=!1}Ie.textBox&&mt(o.textCollisionBox.collisionVertexArray,ce.text.placed,!Tt||be,Re.x,Re.y),Ie.verticalTextBox&&mt(o.textCollisionBox.collisionVertexArray,ce.text.placed,!Tt||Ee,Re.x,Re.y)}const $e=!(Ee||!Ie.verticalIconBox);Ie.iconBox&&mt(o.iconCollisionBox.collisionVertexArray,ce.icon.placed,$e,V?Re.x:0,V?Re.y:0),Ie.verticalIconBox&&mt(o.iconCollisionBox.collisionVertexArray,ce.icon.placed,!$e,V?Re.x:0,V?Re.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=Y.invProjMatrix,o.placementViewportMatrix=Y.viewportMatrix,o.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,c){const d=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*d>o}setStale(){this.stale=!0}}function mt(y,o,c,d,m){y.emplaceBack(o?1:0,c?1:0,d||0,m||0),y.emplaceBack(o?1:0,c?1:0,d||0,m||0),y.emplaceBack(o?1:0,c?1:0,d||0,m||0),y.emplaceBack(o?1:0,c?1:0,d||0,m||0)}const Gt=Math.pow(2,25),cn=Math.pow(2,24),jt=Math.pow(2,17),Dt=Math.pow(2,16),kr=Math.pow(2,9),Et=Math.pow(2,8),wn=Math.pow(2,1);function vn(y){if(0===y.opacity&&!y.placed)return 0;if(1===y.opacity&&y.placed)return 4294967295;const o=y.placed?1:0,c=Math.floor(127*y.opacity);return c*Gt+o*cn+c*jt+o*Dt+c*kr+o*Et+c*wn+o}const Zi=0;class Uu{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,c,d,m,v){const D=this._bucketParts;for(;this._currentTileIndex<o.length;)if(c.getBucketParts(D,m,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((S,E)=>S.sortKey-E.sortKey));this._currentPartIndex<D.length;)if(c.placeLayerBucketPart(D[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,v())return!0;return!1}}class wa{constructor(o,c,d,m,v,D,S,E){this.placement=new nt(o,c,D,S,E),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(o,c,d){const m=g.h.now(),v=()=>!this._forceFullPlacement&&g.h.now()-m>2;for(;this._currentPlacementIndex>=0;){const D=c[o[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===D.type&&(!D.minzoom||D.minzoom<=S)&&(!D.maxzoom||D.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Uu(D)),this._inProgressLayer.continuePlacement(d[D.source],this.placement,this._showCollisionBoxes,D,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const is=512/g.N/2;class Td{constructor(o,c,d){this.tileID=o,this.bucketInstanceId=d,this._symbolsByKey={};const m=new Map;for(let v=0;v<c.length;v++){const D=c.get(v),S=D.key,E=m.get(S);E?E.push(D):m.set(S,[D])}for(const[v,D]of m){const S={positions:D.map(E=>({x:Math.floor(E.anchorX*is),y:Math.floor(E.anchorY*is)})),crossTileIDs:D.map(E=>E.crossTileID)};if(S.positions.length>128){const E=new g.av(S.positions.length,16,Uint16Array);for(const{x:A,y:k}of S.positions)E.add(A,k);E.finish(),delete S.positions,S.index=E}this._symbolsByKey[v]=S}}getScaledCoordinates(o,c){const{x:d,y:m,z:v}=this.tileID.canonical,{x:D,y:S,z:E}=c.canonical,A=is/Math.pow(2,E-v),k=(S*g.N+o.anchorY)*A,O=m*g.N*is;return{x:Math.floor((D*g.N+o.anchorX)*A-d*g.N*is),y:Math.floor(k-O)}}findMatches(o,c,d){const m=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let v=0;v<o.length;v++){const D=o.get(v);if(D.crossTileID)continue;const S=this._symbolsByKey[D.key];if(!S)continue;const E=this.getScaledCoordinates(D,c);if(S.index){const A=S.index.range(E.x-m,E.y-m,E.x+m,E.y+m).sort();for(const k of A){const O=S.crossTileIDs[k];if(!d[O]){d[O]=!0,D.crossTileID=O;break}}}else if(S.positions)for(let A=0;A<S.positions.length;A++){const k=S.positions[A],O=S.crossTileIDs[A];if(Math.abs(k.x-E.x)<=m&&Math.abs(k.y-E.y)<=m&&!d[O]){d[O]=!0,D.crossTileID=O;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class Ht{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Vc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const c=Math.round((o-this.lng)/360);if(0!==c)for(const d in this.indexes){const m=this.indexes[d],v={};for(const D in m){const S=m[D];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),v[S.tileID.key]=S}this.indexes[d]=v}this.lng=o}addBucket(o,c,d){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let v=0;v<c.symbolInstances.length;v++)c.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const m=this.usedCrossTileIDs[o.overscaledZ];for(const v in this.indexes){const D=this.indexes[v];if(Number(v)>o.overscaledZ)for(const S in D){const E=D[S];E.tileID.isChildOf(o)&&E.findMatches(c.symbolInstances,o,m)}else{const S=D[o.scaledTo(Number(v)).key];S&&S.findMatches(c.symbolInstances,o,m)}}for(let v=0;v<c.symbolInstances.length;v++){const D=c.symbolInstances.get(v);D.crossTileID||(D.crossTileID=d.generate(),m[D.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Td(o,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(o,c){for(const d of c.getCrossTileIDsLists())for(const m of d)delete this.usedCrossTileIDs[o][m]}removeStaleBuckets(o){let c=!1;for(const d in this.indexes){const m=this.indexes[d];for(const v in m)o[m[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[v]),delete m[v],c=!0)}return c}}class tl{constructor(){this.layerIndexes={},this.crossTileIDs=new Ht,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,c,d){let m=this.layerIndexes[o.id];void 0===m&&(m=this.layerIndexes[o.id]=new Vc);let v=!1;const D={};m.handleWrapJump(d);for(const S of c){const E=S.getBucket(o);E&&o.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(S.tileID,E,this.crossTileIDs)&&(v=!0),D[E.bucketInstanceId]=!0)}return m.removeStaleBuckets(D)&&(v=!0),v}pruneUnusedLayers(o){const c={};o.forEach(d=>{c[d]=!0});for(const d in this.layerIndexes)c[d]||delete this.layerIndexes[d]}}const br=(y,o)=>g.x(y,o&&o.filter(c=>"source.canvas"!==c.identifier)),_i=g.F(g.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Ad=g.F(g.ax,["setCenter","setZoom","setBearing","setPitch"]),Mi=g.aw();class wr extends g.E{constructor(o,c={}){super(),this.map=o,this.dispatcher=new ya(el(),this,o._getMapId()),this.imageManager=new ai,this.imageManager.setEventedParent(this),this.glyphManager=new Ui(o._requestManager,c.localIdeographFontFamily),this.lineAtlas=new Bn(256,512),this.crossTileSymbolIndex=new tl,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new g.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",g.az());const d=this;this._rtlTextPluginCallback=wr.registerForPluginStateChange(m=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(v,D)=>{if(g.aA(v),D&&D.every(S=>S))for(const S in d.sourceCaches){const E=d.sourceCaches[S].getSource().type;"vector"!==E&&"geojson"!==E||d.sourceCaches[S].reload()}})}),this.on("data",m=>{if("source"!==m.dataType||"metadata"!==m.sourceDataType)return;const v=this.sourceCaches[m.sourceId];if(!v)return;const D=v.getSource();if(D&&D.vectorLayerIds)for(const S in this._layers){const E=this._layers[S];E.source===D.id&&this._validateLayer(E)}})}loadURL(o,c={},d){this.fire(new g.k("dataloading",{dataType:"style"})),c.validate="boolean"!=typeof c.validate||c.validate;const m=this.map._requestManager.transformRequest(o,Yn.Style);this._request=g.f(m,(v,D)=>{this._request=null,v?this.fire(new g.j(v)):D&&this._load(D,c,d)})}loadJSON(o,c={},d){this.fire(new g.k("dataloading",{dataType:"style"})),this._request=g.h.frame(()=>{this._request=null,c.validate=!1!==c.validate,this._load(o,c,d)})}loadEmpty(){this.fire(new g.k("dataloading",{dataType:"style"})),this._load(Mi,{validate:!1})}_load(o,c,d){var m;const v=c.transformStyle?c.transformStyle(d,o):o;if(!c.validate||!br(this,g.y(v))){this._loaded=!0,this.stylesheet=v;for(const D in v.sources)this.addSource(D,v.sources[D],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new ga(this.stylesheet.light),this.map.setTerrain(null!==(m=this.stylesheet.terrain)&&void 0!==m?m:null),this.fire(new g.k("data",{dataType:"style"})),this.fire(new g.k("style.load"))}}_createLayers(){const o=g.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",o),this._order=o.map(c=>c.id),this._layers={},this._serializedLayers=null;for(const c of o){const d=g.aC(c);d.setEventedParent(this,{layer:{id:c.id}}),this._layers[c.id]=d}}_loadSprite(o,c=!1,d=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(m,v,D,S){const E=vr(m),A=E.length,k=D>1?"@2x":"",O={},V={},Z={};for(const{id:G,url:Y}of E){const H=v.transformRequest(v.normalizeSpriteURL(Y,k,".json"),Yn.SpriteJSON),se=`${G}_${H.url}`;O[se]=g.f(H,(ce,me)=>{delete O[se],V[G]=me,ma(S,V,Z,ce,A)});const de=v.transformRequest(v.normalizeSpriteURL(Y,k,".png"),Yn.SpriteImage),ee=`${G}_${de.url}`;O[ee]=Zr.getImage(de,(ce,me)=>{delete O[ee],Z[G]=me,ma(S,V,Z,ce,A)})}return{cancel(){for(const G of Object.values(O))G.cancel()}}}(o,this.map._requestManager,this.map.getPixelRatio(),(m,v)=>{if(this._spriteRequest=null,m)this.fire(new g.j(m));else if(v)for(const D in v){this._spritesImagesIds[D]=[];const S=this._spritesImagesIds[D]?this._spritesImagesIds[D].filter(E=>!(E in v)):[];for(const E of S)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in v[D]){const A="default"===D?E:`${D}:${E}`;this._spritesImagesIds[D].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,v[D][E],!1):this.imageManager.addImage(A,v[D][E]),c&&(this._changedImages[A]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),c&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new g.k("data",{dataType:"style"})),d&&d(m)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new g.k("data",{dataType:"style"}))}_validateLayer(o){const c=this.sourceCaches[o.source];if(!c)return;const d=o.sourceLayer;if(!d)return;const m=c.getSource();("geojson"===m.type||m.vectorLayerIds&&-1===m.vectorLayerIds.indexOf(d))&&this.fire(new g.j(new Error(`Source layer "${d}" does not exist on source "${m.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o){const c=this._serializedAllLayers();if(!o||0===o.length)return Object.values(c);const d=[];for(const m of o)c[m]&&d.push(c[m]);return d}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const c=Object.keys(this._layers);for(const d of c){const m=this._layers[d];"custom"!==m.type&&(o[d]=m.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const c=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(m.length||v.length)&&this._updateWorkerLayers(m,v);for(const D in this._updatedSources){const S=this._updatedSources[D];if("reload"===S)this._reloadSource(D);else{if("clear"!==S)throw new Error(`Invalid action ${S}`);this._clearSource(D)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const D in this._updatedPaintProps)this._layers[D].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const d={};for(const m in this.sourceCaches){const v=this.sourceCaches[m];d[m]=v.used,v.used=!1}for(const m of this._order){const v=this._layers[m];v.recalculate(o,this._availableImages),!v.isHidden(o.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const m in d){const v=this.sourceCaches[m];d[m]!==v.used&&v.fire(new g.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(o),this.z=o.zoom,c&&this.fire(new g.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(o),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,c={}){this._checkLoaded();const d=this.serialize();if(o=c.transformStyle?c.transformStyle(d,o):o,br(this,g.y(o)))return!1;(o=g.aD(o)).layers=g.aB(o.layers);const m=g.aE(d,o).filter(D=>!(D.command in Ad));if(0===m.length)return!1;const v=m.filter(D=>!(D.command in _i));if(v.length>0)throw new Error(`Unimplemented: ${v.map(D=>D.command).join(", ")}.`);for(const D of m)"setTransition"!==D.command&&this[D.command].apply(this,D.args);return this.stylesheet=o,this._serializedLayers=null,!0}addImage(o,c){if(this.getImage(o))return this.fire(new g.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,c),this._afterImageUpdated(o)}updateImage(o,c){this.imageManager.updateImage(o,c)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new g.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new g.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,c,d={}){if(this._checkLoaded(),void 0!==this.sourceCaches[o])throw new Error(`Source "${o}" already exists.`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(g.y.source,`sources.${o}`,c,null,d))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const m=this.sourceCaches[o]=new yi(o,c,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:o})),m.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),void 0===this.sourceCaches[o])throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===o)return this.fire(new g.j(new Error(`Source "${o}" cannot be removed while layer "${d}" is using it.`)));const c=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],c.fire(new g.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),c.setEventedParent(null),c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,c){if(this._checkLoaded(),void 0===this.sourceCaches[o])throw new Error(`There is no source with this ID=${o}`);const d=this.sourceCaches[o].getSource();if("geojson"!==d.type)throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(c),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,c,d={}){this._checkLoaded();const m=o.id;if(this.getLayer(m))return void this.fire(new g.j(new Error(`Layer "${m}" already exists on this map.`)));let v;if("custom"===o.type){if(br(this,g.aF(o)))return;v=g.aC(o)}else{if("source"in o&&"object"==typeof o.source&&(this.addSource(m,o.source),o=g.aD(o),o=g.e(o,{source:m})),this._validate(g.y.layer,`layers.${m}`,o,{arrayIndex:-1},d))return;v=g.aC(o),this._validateLayer(v),v.setEventedParent(this,{layer:{id:m}})}const D=c?this._order.indexOf(c):this._order.length;if(c&&-1===D)this.fire(new g.j(new Error(`Cannot add layer "${m}" before non-existing layer "${c}".`)));else{if(this._order.splice(D,0,m),this._layerOrderChanged=!0,this._layers[m]=v,this._removedLayers[m]&&v.source&&"custom"!==v.type){const S=this._removedLayers[m];delete this._removedLayers[m],S.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(o,c){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new g.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===c)return;const d=this._order.indexOf(o);this._order.splice(d,1);const m=c?this._order.indexOf(c):this._order.length;c&&-1===m?this.fire(new g.j(new Error(`Cannot move layer "${o}" before non-existing layer "${c}".`))):(this._order.splice(m,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const c=this._layers[o];if(!c)return void this.fire(new g.j(new Error(`Cannot remove non-existing layer "${o}".`)));c.setEventedParent(null);const d=this._order.indexOf(o);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=c,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],c.onRemove&&c.onRemove(this.map)}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,c,d){this._checkLoaded();const m=this.getLayer(o);m?m.minzoom===c&&m.maxzoom===d||(null!=c&&(m.minzoom=c),null!=d&&(m.maxzoom=d),this._updateLayer(m)):this.fire(new g.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,c,d={}){this._checkLoaded();const m=this.getLayer(o);if(m){if(!g.aG(m.filter,c))return null==c?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(g.y.filter,`layers.${m.id}.filter`,c,null,d)||(m.filter=g.aD(c),this._updateLayer(m)))}else this.fire(new g.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return g.aD(this.getLayer(o).filter)}setLayoutProperty(o,c,d,m={}){this._checkLoaded();const v=this.getLayer(o);v?g.aG(v.getLayoutProperty(c),d)||(v.setLayoutProperty(c,d,m),this._updateLayer(v)):this.fire(new g.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,c){const d=this.getLayer(o);if(d)return d.getLayoutProperty(c);this.fire(new g.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,c,d,m={}){this._checkLoaded();const v=this.getLayer(o);v?g.aG(v.getPaintProperty(c),d)||(v.setPaintProperty(c,d,m)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new g.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,c){return this.getLayer(o).getPaintProperty(c)}setFeatureState(o,c){this._checkLoaded();const d=o.source,m=o.sourceLayer,v=this.sourceCaches[d];if(void 0===v)return void this.fire(new g.j(new Error(`The source '${d}' does not exist in the map's style.`)));const D=v.getSource().type;"geojson"===D&&m?this.fire(new g.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==D||m?(void 0===o.id&&this.fire(new g.j(new Error("The feature id parameter must be provided."))),v.setFeatureState(m,o.id,c)):this.fire(new g.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,c){this._checkLoaded();const d=o.source,m=this.sourceCaches[d];if(void 0===m)return void this.fire(new g.j(new Error(`The source '${d}' does not exist in the map's style.`)));const v=m.getSource().type,D="vector"===v?o.sourceLayer:void 0;"vector"!==v||D?c&&"string"!=typeof o.id&&"number"!=typeof o.id?this.fire(new g.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(D,o.id,c):this.fire(new g.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const c=o.source,d=o.sourceLayer,m=this.sourceCaches[c];if(void 0!==m)return"vector"!==m.getSource().type||d?(void 0===o.id&&this.fire(new g.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(d,o.id)):void this.fire(new g.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new g.j(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return g.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=g.aH(this.sourceCaches,v=>v.serialize()),c=this._serializeByIds(this._order),d=this.map.getTerrain()||void 0,m=this.stylesheet;return g.aI({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:o,layers:c,terrain:d},v=>void 0!==v)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&"raster"!==this.sourceCaches[o.source].getSource().type&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const c=D=>"fill-extrusion"===this._layers[D].type,d={},m=[];for(let D=this._order.length-1;D>=0;D--){const S=this._order[D];if(c(S)){d[S]=D;for(const E of o){const A=E[S];if(A)for(const k of A)m.push(k)}}}m.sort((D,S)=>S.intersectionZ-D.intersectionZ);const v=[];for(let D=this._order.length-1;D>=0;D--){const S=this._order[D];if(c(S))for(let E=m.length-1;E>=0;E--){const A=m[E].feature;if(d[A.layer.id]<D)break;v.push(A),m.pop()}else for(const E of o){const A=E[S];if(A)for(const k of A)v.push(k.feature)}}return v}queryRenderedFeatures(o,c,d){c&&c.filter&&this._validate(g.y.filter,"queryRenderedFeatures.filter",c.filter,null,c);const m={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new g.j(new Error("parameters.layers must be an Array."))),[];for(const S of c.layers){const E=this._layers[S];if(!E)return this.fire(new g.j(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];m[E.source]=!0}}const v=[];c.availableImages=this._availableImages;const D=this._serializedAllLayers();for(const S in this.sourceCaches)c.layers&&!m[S]||v.push(ks(this.sourceCaches[S],this._layers,D,o,c,d));return this.placement&&v.push(function(S,E,A,k,O,V,Z){const G={},Y=V.queryRenderedSymbols(k),H=[];for(const se of Object.keys(Y).map(Number))H.push(Z[se]);H.sort(ts);for(const se of H){const de=se.featureIndex.lookupSymbolFeatures(Y[se.bucketInstanceId],E,se.bucketIndex,se.sourceLayerIndex,O.filter,O.layers,O.availableImages,S);for(const ee in de){const ce=G[ee]=G[ee]||[],me=de[ee];me.sort((ge,be)=>{const Ee=se.featureSortOrder;if(Ee){const Ie=Ee.indexOf(ge.featureIndex);return Ee.indexOf(be.featureIndex)-Ie}return be.featureIndex-ge.featureIndex});for(const ge of me)ce.push(ge)}}for(const se in G)G[se].forEach(de=>{const ee=de.feature,ce=A[S[se].source].getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=ce});return G}(this._layers,D,this.sourceCaches,o,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(o,c){c&&c.filter&&this._validate(g.y.filter,"querySourceFeatures.filter",c.filter,null,c);const d=this.sourceCaches[o];return d?function(m,v){const D=m.getRenderableIds().map(A=>m.getTileByID(A)),S=[],E={};for(let A=0;A<D.length;A++){const k=D[A],O=k.tileID.canonical.key;E[O]||(E[O]=!0,k.querySourceFeatures(S,v))}return S}(d,c):[]}addSourceType(o,c,d){return Hi(o)?d(new Error(`A source type called "${o}" already exists.`)):(Ja[o]=c,c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:c.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(o,c={}){this._checkLoaded();const d=this.light.getLight();let m=!1;for(const D in o)if(!g.aG(o[D],d[D])){m=!0;break}if(!m)return;const v={now:g.h.now(),transition:g.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,c),this.light.updateTransitions(v)}_validate(o,c,d,m,v={}){return(!v||!1!==v.validate)&&br(this,o.call(g.y,g.e({key:c,style:this.serialize(),value:d,styleSpec:g.v},m)))}_remove(o=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),g.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this.sourceCaches){const d=this.sourceCaches[c];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const c in this.sourceCaches)this.sourceCaches[c].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,c,d,m,v=!1){let D=!1,S=!1;const E={};for(const A of this._order){const k=this._layers[A];if("symbol"!==k.type)continue;if(!E[k.source]){const V=this.sourceCaches[k.source];E[k.source]=V.getRenderableIds(!0).map(Z=>V.getTileByID(Z)).sort((Z,G)=>G.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(G.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(k,E[k.source],o.center.lng);D=D||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||0===d)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(g.h.now(),o.zoom))&&(this.pauseablePlacement=new wa(o,this.map.terrain,this._order,v,c,d,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(g.h.now()),S=!0),D&&this.pauseablePlacement.placement.setStale()),S||D)for(const A of this._order){const k=this._layers[A];"symbol"===k.type&&this.placement.updateLayerOpacities(k,E[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(g.h.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,c,d){this.imageManager.getImages(c.icons,d),this._updateTilesForChangedImages();const m=this.sourceCaches[c.source];m&&m.setDependencies(c.tileID.key,c.type,c.icons)}getGlyphs(o,c,d){this.glyphManager.getGlyphs(c.stacks,d);const m=this.sourceCaches[c.source];m&&m.setDependencies(c.tileID.key,c.type,[""])}getResource(o,c,d){return g.m(c,d)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,c={}){this._checkLoaded(),o&&this._validate(g.y.glyphs,"glyphs",o,null,c)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,c,d={},m){this._checkLoaded();const v=[{id:o,url:c}],D=[...vr(this.stylesheet.sprite),...v];this._validate(g.y.sprite,"sprite",D,null,d)||(this.stylesheet.sprite=D,this._loadSprite(v,!0,m))}removeSprite(o){this._checkLoaded();const c=vr(this.stylesheet.sprite);if(c.find(d=>d.id===o)){if(this._spritesImagesIds[o])for(const d of this._spritesImagesIds[o])this.imageManager.removeImage(d),this._changedImages[d]=!0;c.splice(c.findIndex(d=>d.id===o),1),this.stylesheet.sprite=c.length>0?c:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new g.k("data",{dataType:"style"}))}else this.fire(new g.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return vr(this.stylesheet.sprite)}setSprite(o,c={},d){this._checkLoaded(),o&&this._validate(g.y.sprite,"sprite",o,null,c)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,d):(this._unloadSprite(),d&&d(null)))}}wr.registerForPluginStateChange=g.aK;var nl=g.Q([{name:"a_pos",type:"Int16",components:2}]),Ca="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const En={prelude:gt("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:gt("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:gt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:gt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:gt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:gt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:gt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:gt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:gt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:gt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:gt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:gt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:gt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:gt("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:gt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:gt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:gt("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:gt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:gt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:gt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:gt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:gt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:gt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:gt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:gt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ca),terrainDepth:gt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ca),terrainCoords:gt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ca)};function gt(y,o){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=o.match(/attribute ([\w]+) ([\w]+)/g),m=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),D=v?v.concat(m):m,S={};return{fragmentSource:y=y.replace(c,(E,A,k,O,V)=>(S[V]=!0,"define"===A?`\n#ifndef HAS_UNIFORM_u_${V}\nvarying ${k} ${O} ${V};\n#else\nuniform ${k} ${O} u_${V};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${V}\n    ${k} ${O} ${V} = u_${V};\n#endif\n`)),vertexSource:o=o.replace(c,(E,A,k,O,V)=>{const Z="float"===O?"vec2":"vec4",G=V.match(/color/)?"color":Z;return S[V]?"define"===A?`\n#ifndef HAS_UNIFORM_u_${V}\nuniform lowp float u_${V}_t;\nattribute ${k} ${Z} a_${V};\nvarying ${k} ${O} ${V};\n#else\nuniform ${k} ${O} u_${V};\n#endif\n`:"vec4"===G?`\n#ifndef HAS_UNIFORM_u_${V}\n    ${V} = a_${V};\n#else\n    ${k} ${O} ${V} = u_${V};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${V}\n    ${V} = unpack_mix_${G}(a_${V}, u_${V}_t);\n#else\n    ${k} ${O} ${V} = u_${V};\n#endif\n`:"define"===A?`\n#ifndef HAS_UNIFORM_u_${V}\nuniform lowp float u_${V}_t;\nattribute ${k} ${Z} a_${V};\n#else\nuniform ${k} ${O} u_${V};\n#endif\n`:"vec4"===G?`\n#ifndef HAS_UNIFORM_u_${V}\n    ${k} ${O} ${V} = a_${V};\n#else\n    ${k} ${O} ${V} = u_${V};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${V}\n    ${k} ${O} ${V} = unpack_mix_${G}(a_${V}, u_${V}_t);\n#else\n    ${k} ${O} ${V} = u_${V};\n#endif\n`}),staticAttributes:d,staticUniforms:D}}class Ls{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,c,d,m,v,D,S,E,A){this.context=o;let k=this.boundPaintVertexBuffers.length!==m.length;for(let O=0;!k&&O<m.length;O++)this.boundPaintVertexBuffers[O]!==m[O]&&(k=!0);!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==d||k||this.boundIndexBuffer!==v||this.boundVertexOffset!==D||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==A?this.freshBind(c,d,m,v,D,S,E,A):(o.bindVertexArray.set(this.vao),S&&S.bind(),v&&v.dynamicDraw&&v.bind(),E&&E.bind(),A&&A.bind())}freshBind(o,c,d,m,v,D,S,E){const A=o.numAttributes,k=this.context,O=k.gl;this.vao&&this.destroy(),this.vao=k.createVertexArray(),k.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=D,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=E,c.enableAttributes(O,o);for(const V of d)V.enableAttributes(O,o);D&&D.enableAttributes(O,o),S&&S.enableAttributes(O,o),E&&E.enableAttributes(O,o),c.bind(),c.setVertexAttribPointers(O,o,v);for(const V of d)V.bind(),V.setVertexAttribPointers(O,o,v);D&&(D.bind(),D.setVertexAttribPointers(O,o,v)),m&&m.bind(),S&&(S.bind(),S.setVertexAttribPointers(O,o,v)),E&&(E.bind(),E.setVertexAttribPointers(O,o,v)),k.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function qt(y){const o=[];for(let c=0;c<y.length;c++){if(null===y[c])continue;const d=y[c].split(" ");o.push(d.pop())}return o}class yt{constructor(o,c,d,m,v,D){const S=o.gl;this.program=S.createProgram();const E=qt(c.staticAttributes),A=d?d.getBinderAttributes():[],k=E.concat(A),O=En.prelude.staticUniforms?qt(En.prelude.staticUniforms):[],V=c.staticUniforms?qt(c.staticUniforms):[],Z=d?d.getBinderUniforms():[],G=O.concat(V).concat(Z),Y=[];for(const ge of G)Y.indexOf(ge)<0&&Y.push(ge);const H=d?d.defines():[];v&&H.push("#define OVERDRAW_INSPECTOR;"),D&&H.push("#define TERRAIN3D;");const se=H.concat(En.prelude.fragmentSource,c.fragmentSource).join("\n"),de=H.concat(En.prelude.vertexSource,c.vertexSource).join("\n"),ee=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(ee,se),S.compileShader(ee),!S.getShaderParameter(ee,S.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${S.getShaderInfoLog(ee)}`);S.attachShader(this.program,ee);const ce=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);if(S.shaderSource(ce,de),S.compileShader(ce),!S.getShaderParameter(ce,S.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${S.getShaderInfoLog(ce)}`);S.attachShader(this.program,ce),this.attributes={};const me={};this.numAttributes=k.length;for(let ge=0;ge<this.numAttributes;ge++)k[ge]&&(S.bindAttribLocation(this.program,ge,k[ge]),this.attributes[k[ge]]=ge);if(S.linkProgram(this.program),!S.getProgramParameter(this.program,S.LINK_STATUS))throw new Error(`Program failed to link: ${S.getProgramInfoLog(this.program)}`);S.deleteShader(ce),S.deleteShader(ee);for(let ge=0;ge<Y.length;ge++){const be=Y[ge];if(be&&!me[be]){const Ee=S.getUniformLocation(this.program,be);Ee&&(me[be]=Ee)}}var ge,be;this.fixedUniforms=m(o,me),this.terrainUniforms={u_depth:new g.aL(ge=o,(be=me).u_depth),u_terrain:new g.aL(ge,be.u_terrain),u_terrain_dim:new g.aM(ge,be.u_terrain_dim),u_terrain_matrix:new g.aN(ge,be.u_terrain_matrix),u_terrain_unpack:new g.aO(ge,be.u_terrain_unpack),u_terrain_exaggeration:new g.aM(ge,be.u_terrain_exaggeration)},this.binderUniforms=d?d.getUniforms(o,me):[]}draw(o,c,d,m,v,D,S,E,A,k,O,V,Z,G,Y,H,se,de){const ee=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(d),o.setStencilMode(m),o.setColorMode(v),o.setCullFace(D),E){o.activeTexture.set(ee.TEXTURE2),ee.bindTexture(ee.TEXTURE_2D,E.depthTexture),o.activeTexture.set(ee.TEXTURE3),ee.bindTexture(ee.TEXTURE_2D,E.texture);for(const me in this.terrainUniforms)this.terrainUniforms[me].set(E[me])}for(const me in this.fixedUniforms)this.fixedUniforms[me].set(S[me]);Y&&Y.setUniforms(o,this.binderUniforms,Z,{zoom:G});let ce=0;switch(c){case ee.LINES:ce=2;break;case ee.TRIANGLES:ce=3;break;case ee.LINE_STRIP:ce=1}for(const me of V.get()){const ge=me.vaos||(me.vaos={});(ge[A]||(ge[A]=new Ls)).bind(o,this,k,Y?Y.getPaintVertexBuffers():[],O,me.vertexOffset,H,se,de),ee.drawElements(c,me.primitiveLength*ce,ee.UNSIGNED_SHORT,me.primitiveOffset*ce*2)}}}function vi(y,o,c){const d=1/oe(c,1,o.transform.tileZoom),m=Math.pow(2,c.tileID.overscaledZ),v=c.tileSize*Math.pow(2,o.transform.tileZoom)/m,D=v*(c.tileID.canonical.x+c.tileID.wrap*m),S=v*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[D>>16,S>>16],u_pixel_coord_lower:[65535&D,65535&S]}}const rl=(y,o,c,d)=>{const m=o.style.light,v=m.properties.get("position"),D=[v.x,v.y,v.z],S=(A=new g.A(9),g.A!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A);var A;"viewport"===m.properties.get("anchor")&&function(A,k){var O=Math.sin(k),V=Math.cos(k);A[0]=V,A[1]=O,A[2]=0,A[3]=-O,A[4]=V,A[5]=0,A[6]=0,A[7]=0,A[8]=1}(S,-o.transform.angle),function(A,k,O){var V=k[0],Z=k[1],G=k[2];A[0]=V*O[0]+Z*O[3]+G*O[6],A[1]=V*O[1]+Z*O[4]+G*O[7],A[2]=V*O[2]+Z*O[5]+G*O[8]}(D,D,S);const E=m.properties.get("color");return{u_matrix:y,u_lightpos:D,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+c,u_opacity:d}},Cr=(y,o,c,d,m,v,D)=>g.e(rl(y,o,c,d),vi(v,o,D),{u_height_factor:-Math.pow(2,m.overscaledZ)/D.tileSize/8}),Hu=y=>({u_matrix:y}),jc=(y,o,c,d)=>g.e(Hu(y),vi(c,o,d)),Wt=(y,o)=>({u_matrix:y,u_world:o}),Fs=(y,o,c,d,m)=>g.e(jc(y,o,c,d),{u_world:m}),xn=(y,o,c,d)=>{const m=y.transform;let v,D;if("map"===d.paint.get("circle-pitch-alignment")){const S=oe(c,1,m.zoom);v=!0,D=[S,S]}else v=!1,D=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+("map"===d.paint.get("circle-pitch-scale")),u_matrix:y.translatePosMatrix(o.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:D}},il=(y,o,c)=>{const d=oe(c,1,o.zoom),m=Math.pow(2,o.zoom-c.tileID.overscaledZ),v=c.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[o.pixelsToGLUnits[0]/(d*m),o.pixelsToGLUnits[1]/(d*m)],u_overscale_factor:v}},ol=(y,o,c=1)=>({u_matrix:y,u_color:o,u_overlay:0,u_overlay_scale:c}),Ql=y=>({u_matrix:y}),xt=(y,o,c,d)=>({u_matrix:y,u_extrude_scale:oe(o,1,c),u_intensity:d});function sl(y,o){const c=Math.pow(2,o.canonical.z),d=o.canonical.y;return[new g.U(0,d/c).toLngLat().lat,new g.U(0,(d+1)/c).toLngLat().lat]}const al=(y,o,c,d)=>{const m=y.transform;return{u_matrix:_t(y,o,c,d),u_ratio:1/oe(o,1,m.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Pd=(y,o,c,d,m)=>g.e(al(y,o,c,m),{u_image:0,u_image_height:d}),qu=(y,o,c,d,m)=>{const v=y.transform,D=ll(o,v);return{u_matrix:_t(y,o,c,m),u_texsize:o.imageAtlasTexture.size,u_ratio:1/oe(o,1,v.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[D,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Ve=(y,o,c,d,m,v)=>{const D=y.lineAtlas,S=ll(o,y.transform),E="round"===c.layout.get("line-cap"),A=D.getDash(d.from,E),k=D.getDash(d.to,E),O=A.width*m.fromScale,V=k.width*m.toScale;return g.e(al(y,o,c,v),{u_patternscale_a:[S/O,-A.height/2],u_patternscale_b:[S/V,-k.height/2],u_sdfgamma:D.width/(256*Math.min(O,V)*y.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:k.y,u_mix:m.t})};function ll(y,o){return 1/oe(y,1,o.tileZoom)}function _t(y,o,c,d){return y.translatePosMatrix(d?d.posMatrix:o.tileID.posMatrix,o,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const Jt=(y,o,c,d,m)=>{return{u_matrix:y,u_tl_parent:o,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(D=m.paint.get("raster-saturation"),D>0?1-1/(1.001-D):-D),u_contrast_factor:(v=m.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Gu(m.paint.get("raster-hue-rotate"))};var v,D};function Gu(y){y*=Math.PI/180;const o=Math.sin(y),c=Math.cos(y);return[(2*c+1)/3,(-Math.sqrt(3)*o-c+1)/3,(Math.sqrt(3)*o-c+1)/3]}const Zu=(y,o,c,d,m,v,D,S,E,A)=>{const k=m.transform;return{u_is_size_zoom_constant:+("constant"===y||"source"===y),u_is_size_feature_constant:+("constant"===y||"camera"===y),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:k.cameraToCenterDistance,u_pitch:k.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:k.width/k.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:D,u_coord_matrix:S,u_is_text:+E,u_pitch_with_map:+d,u_texsize:A,u_texture:0}},$c=(y,o,c,d,m,v,D,S,E,A,k)=>{const O=m.transform;return g.e(Zu(y,o,c,d,m,v,D,S,E,A),{u_gamma_scale:d?Math.cos(O._pitch)*O.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+k})},Ro=(y,o,c,d,m,v,D,S,E,A)=>g.e($c(y,o,c,d,m,v,D,S,!0,E,!0),{u_texsize_icon:A,u_texture_icon:1}),Rr=(y,o,c)=>({u_matrix:y,u_opacity:o,u_color:c}),Wi=(y,o,c,d,m,v)=>g.e(function(D,S,E,A){const k=E.imageManager.getPattern(D.from.toString()),O=E.imageManager.getPattern(D.to.toString()),{width:V,height:Z}=E.imageManager.getPixelSize(),G=Math.pow(2,A.tileID.overscaledZ),Y=A.tileSize*Math.pow(2,E.transform.tileZoom)/G,H=Y*(A.tileID.canonical.x+A.tileID.wrap*G),se=Y*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[V,Z],u_mix:S.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/oe(A,1,E.transform.tileZoom),u_pixel_coord_upper:[H>>16,se>>16],u_pixel_coord_lower:[65535&H,65535&se]}}(d,v,c,m),{u_matrix:y,u_opacity:o}),Jl={fillExtrusion:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_lightpos:new g.aP(y,o.u_lightpos),u_lightintensity:new g.aM(y,o.u_lightintensity),u_lightcolor:new g.aP(y,o.u_lightcolor),u_vertical_gradient:new g.aM(y,o.u_vertical_gradient),u_opacity:new g.aM(y,o.u_opacity)}),fillExtrusionPattern:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_lightpos:new g.aP(y,o.u_lightpos),u_lightintensity:new g.aM(y,o.u_lightintensity),u_lightcolor:new g.aP(y,o.u_lightcolor),u_vertical_gradient:new g.aM(y,o.u_vertical_gradient),u_height_factor:new g.aM(y,o.u_height_factor),u_image:new g.aL(y,o.u_image),u_texsize:new g.aQ(y,o.u_texsize),u_pixel_coord_upper:new g.aQ(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new g.aQ(y,o.u_pixel_coord_lower),u_scale:new g.aP(y,o.u_scale),u_fade:new g.aM(y,o.u_fade),u_opacity:new g.aM(y,o.u_opacity)}),fill:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix)}),fillPattern:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_image:new g.aL(y,o.u_image),u_texsize:new g.aQ(y,o.u_texsize),u_pixel_coord_upper:new g.aQ(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new g.aQ(y,o.u_pixel_coord_lower),u_scale:new g.aP(y,o.u_scale),u_fade:new g.aM(y,o.u_fade)}),fillOutline:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_world:new g.aQ(y,o.u_world)}),fillOutlinePattern:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_world:new g.aQ(y,o.u_world),u_image:new g.aL(y,o.u_image),u_texsize:new g.aQ(y,o.u_texsize),u_pixel_coord_upper:new g.aQ(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new g.aQ(y,o.u_pixel_coord_lower),u_scale:new g.aP(y,o.u_scale),u_fade:new g.aM(y,o.u_fade)}),circle:(y,o)=>({u_camera_to_center_distance:new g.aM(y,o.u_camera_to_center_distance),u_scale_with_map:new g.aL(y,o.u_scale_with_map),u_pitch_with_map:new g.aL(y,o.u_pitch_with_map),u_extrude_scale:new g.aQ(y,o.u_extrude_scale),u_device_pixel_ratio:new g.aM(y,o.u_device_pixel_ratio),u_matrix:new g.aN(y,o.u_matrix)}),collisionBox:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_camera_to_center_distance:new g.aM(y,o.u_camera_to_center_distance),u_pixels_to_tile_units:new g.aM(y,o.u_pixels_to_tile_units),u_extrude_scale:new g.aQ(y,o.u_extrude_scale),u_overscale_factor:new g.aM(y,o.u_overscale_factor)}),collisionCircle:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_inv_matrix:new g.aN(y,o.u_inv_matrix),u_camera_to_center_distance:new g.aM(y,o.u_camera_to_center_distance),u_viewport_size:new g.aQ(y,o.u_viewport_size)}),debug:(y,o)=>({u_color:new g.aR(y,o.u_color),u_matrix:new g.aN(y,o.u_matrix),u_overlay:new g.aL(y,o.u_overlay),u_overlay_scale:new g.aM(y,o.u_overlay_scale)}),clippingMask:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix)}),heatmap:(y,o)=>({u_extrude_scale:new g.aM(y,o.u_extrude_scale),u_intensity:new g.aM(y,o.u_intensity),u_matrix:new g.aN(y,o.u_matrix)}),heatmapTexture:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_world:new g.aQ(y,o.u_world),u_image:new g.aL(y,o.u_image),u_color_ramp:new g.aL(y,o.u_color_ramp),u_opacity:new g.aM(y,o.u_opacity)}),hillshade:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_image:new g.aL(y,o.u_image),u_latrange:new g.aQ(y,o.u_latrange),u_light:new g.aQ(y,o.u_light),u_shadow:new g.aR(y,o.u_shadow),u_highlight:new g.aR(y,o.u_highlight),u_accent:new g.aR(y,o.u_accent)}),hillshadePrepare:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_image:new g.aL(y,o.u_image),u_dimension:new g.aQ(y,o.u_dimension),u_zoom:new g.aM(y,o.u_zoom),u_unpack:new g.aO(y,o.u_unpack)}),line:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_ratio:new g.aM(y,o.u_ratio),u_device_pixel_ratio:new g.aM(y,o.u_device_pixel_ratio),u_units_to_pixels:new g.aQ(y,o.u_units_to_pixels)}),lineGradient:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_ratio:new g.aM(y,o.u_ratio),u_device_pixel_ratio:new g.aM(y,o.u_device_pixel_ratio),u_units_to_pixels:new g.aQ(y,o.u_units_to_pixels),u_image:new g.aL(y,o.u_image),u_image_height:new g.aM(y,o.u_image_height)}),linePattern:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_texsize:new g.aQ(y,o.u_texsize),u_ratio:new g.aM(y,o.u_ratio),u_device_pixel_ratio:new g.aM(y,o.u_device_pixel_ratio),u_image:new g.aL(y,o.u_image),u_units_to_pixels:new g.aQ(y,o.u_units_to_pixels),u_scale:new g.aP(y,o.u_scale),u_fade:new g.aM(y,o.u_fade)}),lineSDF:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_ratio:new g.aM(y,o.u_ratio),u_device_pixel_ratio:new g.aM(y,o.u_device_pixel_ratio),u_units_to_pixels:new g.aQ(y,o.u_units_to_pixels),u_patternscale_a:new g.aQ(y,o.u_patternscale_a),u_patternscale_b:new g.aQ(y,o.u_patternscale_b),u_sdfgamma:new g.aM(y,o.u_sdfgamma),u_image:new g.aL(y,o.u_image),u_tex_y_a:new g.aM(y,o.u_tex_y_a),u_tex_y_b:new g.aM(y,o.u_tex_y_b),u_mix:new g.aM(y,o.u_mix)}),raster:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_tl_parent:new g.aQ(y,o.u_tl_parent),u_scale_parent:new g.aM(y,o.u_scale_parent),u_buffer_scale:new g.aM(y,o.u_buffer_scale),u_fade_t:new g.aM(y,o.u_fade_t),u_opacity:new g.aM(y,o.u_opacity),u_image0:new g.aL(y,o.u_image0),u_image1:new g.aL(y,o.u_image1),u_brightness_low:new g.aM(y,o.u_brightness_low),u_brightness_high:new g.aM(y,o.u_brightness_high),u_saturation_factor:new g.aM(y,o.u_saturation_factor),u_contrast_factor:new g.aM(y,o.u_contrast_factor),u_spin_weights:new g.aP(y,o.u_spin_weights)}),symbolIcon:(y,o)=>({u_is_size_zoom_constant:new g.aL(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new g.aL(y,o.u_is_size_feature_constant),u_size_t:new g.aM(y,o.u_size_t),u_size:new g.aM(y,o.u_size),u_camera_to_center_distance:new g.aM(y,o.u_camera_to_center_distance),u_pitch:new g.aM(y,o.u_pitch),u_rotate_symbol:new g.aL(y,o.u_rotate_symbol),u_aspect_ratio:new g.aM(y,o.u_aspect_ratio),u_fade_change:new g.aM(y,o.u_fade_change),u_matrix:new g.aN(y,o.u_matrix),u_label_plane_matrix:new g.aN(y,o.u_label_plane_matrix),u_coord_matrix:new g.aN(y,o.u_coord_matrix),u_is_text:new g.aL(y,o.u_is_text),u_pitch_with_map:new g.aL(y,o.u_pitch_with_map),u_texsize:new g.aQ(y,o.u_texsize),u_texture:new g.aL(y,o.u_texture)}),symbolSDF:(y,o)=>({u_is_size_zoom_constant:new g.aL(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new g.aL(y,o.u_is_size_feature_constant),u_size_t:new g.aM(y,o.u_size_t),u_size:new g.aM(y,o.u_size),u_camera_to_center_distance:new g.aM(y,o.u_camera_to_center_distance),u_pitch:new g.aM(y,o.u_pitch),u_rotate_symbol:new g.aL(y,o.u_rotate_symbol),u_aspect_ratio:new g.aM(y,o.u_aspect_ratio),u_fade_change:new g.aM(y,o.u_fade_change),u_matrix:new g.aN(y,o.u_matrix),u_label_plane_matrix:new g.aN(y,o.u_label_plane_matrix),u_coord_matrix:new g.aN(y,o.u_coord_matrix),u_is_text:new g.aL(y,o.u_is_text),u_pitch_with_map:new g.aL(y,o.u_pitch_with_map),u_texsize:new g.aQ(y,o.u_texsize),u_texture:new g.aL(y,o.u_texture),u_gamma_scale:new g.aM(y,o.u_gamma_scale),u_device_pixel_ratio:new g.aM(y,o.u_device_pixel_ratio),u_is_halo:new g.aL(y,o.u_is_halo)}),symbolTextAndIcon:(y,o)=>({u_is_size_zoom_constant:new g.aL(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new g.aL(y,o.u_is_size_feature_constant),u_size_t:new g.aM(y,o.u_size_t),u_size:new g.aM(y,o.u_size),u_camera_to_center_distance:new g.aM(y,o.u_camera_to_center_distance),u_pitch:new g.aM(y,o.u_pitch),u_rotate_symbol:new g.aL(y,o.u_rotate_symbol),u_aspect_ratio:new g.aM(y,o.u_aspect_ratio),u_fade_change:new g.aM(y,o.u_fade_change),u_matrix:new g.aN(y,o.u_matrix),u_label_plane_matrix:new g.aN(y,o.u_label_plane_matrix),u_coord_matrix:new g.aN(y,o.u_coord_matrix),u_is_text:new g.aL(y,o.u_is_text),u_pitch_with_map:new g.aL(y,o.u_pitch_with_map),u_texsize:new g.aQ(y,o.u_texsize),u_texsize_icon:new g.aQ(y,o.u_texsize_icon),u_texture:new g.aL(y,o.u_texture),u_texture_icon:new g.aL(y,o.u_texture_icon),u_gamma_scale:new g.aM(y,o.u_gamma_scale),u_device_pixel_ratio:new g.aM(y,o.u_device_pixel_ratio),u_is_halo:new g.aL(y,o.u_is_halo)}),background:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_opacity:new g.aM(y,o.u_opacity),u_color:new g.aR(y,o.u_color)}),backgroundPattern:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_opacity:new g.aM(y,o.u_opacity),u_image:new g.aL(y,o.u_image),u_pattern_tl_a:new g.aQ(y,o.u_pattern_tl_a),u_pattern_br_a:new g.aQ(y,o.u_pattern_br_a),u_pattern_tl_b:new g.aQ(y,o.u_pattern_tl_b),u_pattern_br_b:new g.aQ(y,o.u_pattern_br_b),u_texsize:new g.aQ(y,o.u_texsize),u_mix:new g.aM(y,o.u_mix),u_pattern_size_a:new g.aQ(y,o.u_pattern_size_a),u_pattern_size_b:new g.aQ(y,o.u_pattern_size_b),u_scale_a:new g.aM(y,o.u_scale_a),u_scale_b:new g.aM(y,o.u_scale_b),u_pixel_coord_upper:new g.aQ(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new g.aQ(y,o.u_pixel_coord_lower),u_tile_units_to_pixels:new g.aM(y,o.u_tile_units_to_pixels)}),terrain:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_texture:new g.aL(y,o.u_texture),u_ele_delta:new g.aM(y,o.u_ele_delta)}),terrainDepth:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_ele_delta:new g.aM(y,o.u_ele_delta)}),terrainCoords:(y,o)=>({u_matrix:new g.aN(y,o.u_matrix),u_texture:new g.aL(y,o.u_texture),u_terrain_coords_id:new g.aM(y,o.u_terrain_coords_id),u_ele_delta:new g.aM(y,o.u_ele_delta)})};class Uc{constructor(o,c,d){this.context=o;const m=o.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Xi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Hc{constructor(o,c,d,m){this.length=c.length,this.attributes=d,this.itemSize=c.bytesPerElement,this.dynamicDraw=m,this.context=o;const v=o.gl;this.buffer=v.createBuffer(),o.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,c){for(let d=0;d<this.attributes.length;d++){const m=c.attributes[this.attributes[d].name];void 0!==m&&o.enableVertexAttribArray(m)}}setVertexAttribPointers(o,c,d){for(let m=0;m<this.attributes.length;m++){const v=this.attributes[m],D=c.attributes[v.name];void 0!==D&&o.vertexAttribPointer(D,v.components,o[Xi[v.type]],!1,this.itemSize,v.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const cl=new WeakMap;function Ns(y){var o;if(cl.has(y))return cl.get(y);{const c=null===(o=y.getParameter(y.VERSION))||void 0===o?void 0:o.startsWith("WebGL 2.0");return cl.set(y,c),c}}class Bt{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ec extends Bt{getDefault(){return g.aT.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Ti extends Bt{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class xi extends Bt{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Wu extends Bt{getDefault(){return[!0,!0,!0,!0]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Xr extends Bt{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class ut extends Bt{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Xu extends Bt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const c=this.current;(o.func!==c.func||o.ref!==c.ref||o.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Yu extends Bt{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class qc extends Bt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=o,this.dirty=!1}}class ct extends Bt{getDefault(){return[0,1]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Ku extends Bt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=o,this.dirty=!1}}class Ai extends Bt{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class ul extends Bt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.BLEND):c.disable(c.BLEND),this.current=o,this.dirty=!1}}class Qu extends Bt{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class zs extends Bt{getDefault(){return g.aT.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class kd extends Bt{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class tc extends Bt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=o,this.dirty=!1}}class nc extends Bt{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Gc extends Bt{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Ju extends Bt{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Rd extends Bt{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Lt extends Bt{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Da extends Bt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class rc extends Bt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Or extends Bt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Bs extends Bt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Od extends Bt{getDefault(){return null}set(o){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class dn extends Bt{getDefault(){return null}set(o){var c;if(o===this.current&&!this.dirty)return;const d=this.gl;Ns(d)?d.bindVertexArray(o):null===(c=d.getExtension("OES_vertex_array_object"))||void 0===c||c.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class eh extends Bt{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Sa extends Bt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class ot extends Bt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class mo extends Bt{constructor(o,c){super(o),this.context=o,this.parent=c}getDefault(){return null}}class os extends mo{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Zc extends mo{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class hl extends mo{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Zt{constructor(o,c,d,m,v){this.context=o,this.width=c,this.height=d;const D=o.gl,S=this.framebuffer=D.createFramebuffer();if(this.colorAttachment=new os(o,S),m)this.depthAttachment=v?new hl(o,S):new Zc(o,S);else if(v)throw new Error("Stencil cannot be setted without depth");if(D.checkFramebufferStatus(D.FRAMEBUFFER)!==D.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,c=this.colorAttachment.get();if(c&&o.deleteTexture(c),this.depthAttachment){const d=this.depthAttachment.get();d&&o.deleteRenderbuffer(d)}o.deleteFramebuffer(this.framebuffer)}}class bn{constructor(o,c,d){this.blendFunction=o,this.blendColor=c,this.mask=d}}bn.Replace=[1,0],bn.disabled=new bn(bn.Replace,g.aT.transparent,[!1,!1,!1,!1]),bn.unblended=new bn(bn.Replace,g.aT.transparent,[!0,!0,!0,!0]),bn.alphaBlended=new bn([1,771],g.aT.transparent,[!0,!0,!0,!0]);class Pf{constructor(o){var c,d;if(this.gl=o,this.clearColor=new ec(this),this.clearDepth=new Ti(this),this.clearStencil=new xi(this),this.colorMask=new Wu(this),this.depthMask=new Xr(this),this.stencilMask=new ut(this),this.stencilFunc=new Xu(this),this.stencilOp=new Yu(this),this.stencilTest=new qc(this),this.depthRange=new ct(this),this.depthTest=new Ku(this),this.depthFunc=new Ai(this),this.blend=new ul(this),this.blendFunc=new Qu(this),this.blendColor=new zs(this),this.blendEquation=new kd(this),this.cullFace=new tc(this),this.cullFaceSide=new nc(this),this.frontFace=new Gc(this),this.program=new Ju(this),this.activeTexture=new Rd(this),this.viewport=new Lt(this),this.bindFramebuffer=new Da(this),this.bindRenderbuffer=new rc(this),this.bindTexture=new Or(this),this.bindVertexBuffer=new Bs(this),this.bindElementBuffer=new Od(this),this.bindVertexArray=new dn(this),this.pixelStoreUnpack=new eh(this),this.pixelStoreUnpackPremultiplyAlpha=new Sa(this),this.pixelStoreUnpackFlipY=new ot(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),Ns(o)){this.HALF_FLOAT=o.HALF_FLOAT;const m=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(c=o.RGBA16F)&&void 0!==c?c:m?.RGBA16F_EXT,this.RGB16F=null!==(d=o.RGB16F)&&void 0!==d?d:m?.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const m=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=m?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,c){return new Uc(this,o,c)}createVertexBuffer(o,c,d){return new Hc(this,o,c,d)}createRenderbuffer(o,c,d){const m=this.gl,v=m.createRenderbuffer();return this.bindRenderbuffer.set(v),m.renderbufferStorage(m.RENDERBUFFER,o,c,d),this.bindRenderbuffer.set(null),v}createFramebuffer(o,c,d,m){return new Zt(this,o,c,d,m)}clear({color:o,depth:c,stencil:d}){const m=this.gl;let v=0;o&&(v|=m.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(v|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==d&&(v|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),m.clear(v)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){g.aG(o.blendFunction,bn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return Ns(this.gl)?this.gl.createVertexArray():null===(o=this.gl.getExtension("OES_vertex_array_object"))||void 0===o?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var c;return Ns(this.gl)?this.gl.deleteVertexArray(o):null===(c=this.gl.getExtension("OES_vertex_array_object"))||void 0===c?void 0:c.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class Vt{constructor(o,c,d){this.func=o,this.mask=c,this.range=d}}Vt.ReadOnly=!1,Vt.ReadWrite=!0,Vt.disabled=new Vt(519,Vt.ReadOnly,[0,1]);class Fn{constructor(o,c,d,m,v,D){this.test=o,this.ref=c,this.mask=d,this.fail=m,this.depthFail=v,this.pass=D}}Fn.disabled=new Fn({func:519,mask:0},0,0,7680,7680,7680);class Mn{constructor(o,c,d){this.enable=o,this.mode=c,this.frontFace=d}}let Oo;function ic(y,o,c,d,m,v,D){const S=y.context,E=S.gl,A=y.useProgram("collisionBox"),k=[];let O=0,V=0;for(let ee=0;ee<d.length;ee++){const ce=d[ee],me=o.getTile(ce),ge=me.getBucket(c);if(!ge)continue;let be=ce.posMatrix;0===m[0]&&0===m[1]||(be=y.translatePosMatrix(ce.posMatrix,me,m,v));const Ee=D?ge.textCollisionBox:ge.iconCollisionBox,Ie=ge.collisionCircleArray;if(Ie.length>0){const Re=g.Z(),$e=be;g.aU(Re,ge.placementInvProjMatrix,y.transform.glCoordMatrix),g.aU(Re,Re,ge.placementViewportMatrix),k.push({circleArray:Ie,circleOffset:V,transform:$e,invTransform:Re,coord:ce}),O+=Ie.length/4,V=O}Ee&&A.draw(S,E.LINES,Vt.disabled,Fn.disabled,y.colorModeForRenderPass(),Mn.disabled,il(be,y.transform,me),y.style.map.terrain&&y.style.map.terrain.getTerrainData(ce),c.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,y.transform.zoom,null,null,Ee.collisionVertexBuffer)}if(!D||!k.length)return;const Z=y.useProgram("collisionCircle"),G=new g.aV;G.resize(4*O),G._trim();let Y=0;for(const ee of k)for(let ce=0;ce<ee.circleArray.length/4;ce++){const me=4*ce,ge=ee.circleArray[me+0],be=ee.circleArray[me+1],Ee=ee.circleArray[me+2],Ie=ee.circleArray[me+3];G.emplace(Y++,ge,be,Ee,Ie,0),G.emplace(Y++,ge,be,Ee,Ie,1),G.emplace(Y++,ge,be,Ee,Ie,2),G.emplace(Y++,ge,be,Ee,Ie,3)}(!Oo||Oo.length<2*O)&&(Oo=function(ee){const ce=2*ee,me=new g.aX;me.resize(ce),me._trim();for(let ge=0;ge<ce;ge++){const be=6*ge;me.uint16[be+0]=4*ge+0,me.uint16[be+1]=4*ge+1,me.uint16[be+2]=4*ge+2,me.uint16[be+3]=4*ge+2,me.uint16[be+4]=4*ge+3,me.uint16[be+5]=4*ge+0}return me}(O));const H=S.createIndexBuffer(Oo,!0),se=S.createVertexBuffer(G,g.aW.members,!0);for(const ee of k){const ce={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(de=y.transform).cameraToCenterDistance,u_viewport_size:[de.width,de.height]};Z.draw(S,E.TRIANGLES,Vt.disabled,Fn.disabled,y.colorModeForRenderPass(),Mn.disabled,ce,y.style.map.terrain&&y.style.map.terrain.getTerrainData(ee.coord),c.id,se,H,g.S.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,y.transform.zoom,null,null,null)}var de;se.destroy(),H.destroy()}Mn.disabled=new Mn(!1,1029,2305),Mn.backCCW=new Mn(!0,1029,2305);const Ea=g.ao(new Float32Array(16));function oc(y,o,c,d,m,v){const{horizontalAlign:D,verticalAlign:S}=g.au(y);return new g.P((-(D-.5)*o/m+d[0])*v,(-(S-.5)*c/m+d[1])*v)}function sc(y,o,c,d,m,v,D,S,E,A,k){const O=y.text.placedSymbolArray,V=y.text.dynamicLayoutVertexArray,Z=y.icon.dynamicLayoutVertexArray,G={};V.clear();for(let Y=0;Y<O.length;Y++){const H=O.get(Y),se=H.hidden||!H.crossTileID||y.allowVerticalPlacement&&!H.placedOrientation?null:d[H.crossTileID];if(se){const de=new g.P(H.anchorX,H.anchorY),ee=Ln(de,c?D:v,k),ce=rs(m.cameraToCenterDistance,ee.signedDistanceFromCamera);let me=g.aj(y.textSizeData,E,H)*ce/g.ap;c&&(me*=y.tilePixelRatio/S);const{width:ge,height:be,anchor:Ee,textOffset:Ie,textBoxScale:Re}=se,$e=oc(Ee,ge,be,Ie,Re,me),Tt=c?Ln(de.add($e),v,k).point:ee.point.add(o?$e.rotate(-m.angle):$e),ke=y.allowVerticalPlacement&&H.placedOrientation===g.ai.vertical?Math.PI/2:0;for(let it=0;it<H.numGlyphs;it++)g.ak(V,Tt,ke);A&&H.associatedIconIndex>=0&&(G[H.associatedIconIndex]={shiftedAnchor:Tt,angle:ke})}else U(H.numGlyphs,V)}if(A){Z.clear();const Y=y.icon.placedSymbolArray;for(let H=0;H<Y.length;H++){const se=Y.get(H);if(se.hidden)U(se.numGlyphs,Z);else{const de=G[H];if(de)for(let ee=0;ee<se.numGlyphs;ee++)g.ak(Z,de.shiftedAnchor,de.angle);else U(se.numGlyphs,Z)}}y.icon.dynamicLayoutVertexBuffer.updateData(Z)}y.text.dynamicLayoutVertexBuffer.updateData(V)}function Wc(y,o,c){return c.iconsInText&&o?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function dl(y,o,c,d,m,v,D,S,E,A,k,O){const V=y.context,Z=V.gl,G=y.transform,Y="map"===S,H="map"===E,se="viewport"!==S&&"point"!==c.layout.get("symbol-placement"),de=Y&&!H&&!se,ee=!c.layout.get("symbol-sort-key").isConstant();let ce=!1;const me=y.depthModeForSublayer(0,Vt.ReadOnly),ge=c._unevaluatedLayout.hasValue("text-variable-anchor")||c._unevaluatedLayout.hasValue("text-variable-anchor-offset"),be=[];for(const Ee of d){const Ie=o.getTile(Ee),Re=Ie.getBucket(c);if(!Re)continue;const $e=m?Re.text:Re.icon;if(!$e||!$e.segments.get().length||!$e.hasVisibleVertices)continue;const Tt=$e.programConfigurations.get(c.id),ke=m||Re.sdfIcons,it=m?Re.textSizeData:Re.iconSizeData,Qe=H||0!==G.pitch,nn=y.useProgram(Wc(ke,m,Re),Tt),At=g.ah(it,G.zoom),bt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ee);let kt,An,un,pr,er=[0,0],$n=null;if(m)An=Ie.glyphAtlasTexture,un=Z.LINEAR,kt=Ie.glyphAtlasTexture.size,Re.iconsInText&&(er=Ie.imageAtlasTexture.size,$n=Ie.imageAtlasTexture,pr=Qe||y.options.rotating||y.options.zooming||"composite"===it.kind||"camera"===it.kind?Z.LINEAR:Z.NEAREST);else{const Pn=1!==c.layout.get("icon-size").constantOr(0)||Re.iconsNeedLinear;An=Ie.imageAtlasTexture,un=ke||y.options.rotating||y.options.zooming||Pn||Qe?Z.LINEAR:Z.NEAREST,kt=Ie.imageAtlasTexture.size}const Nr=oe(Ie,1,y.transform.zoom),on=Pe(Ee.posMatrix,H,Y,y.transform,Nr),Jr=Gi(Ee.posMatrix,H,Y,y.transform,Nr),to=ge&&Re.hasTextData(),Xs="none"!==c.layout.get("icon-text-fit")&&to&&Re.hasIconData();if(se){const Pn=y.style.map.terrain?(Br,Gn)=>y.style.map.terrain.getElevation(Ee,Br,Gn):null,sr="map"===c.layout.get("text-rotation-alignment");ze(Re,Ee.posMatrix,y,m,on,Jr,H,A,sr,Pn)}const La=y.translatePosMatrix(Ee.posMatrix,Ie,v,D),vl=se||m&&ge||Xs?Ea:on,zr=y.translatePosMatrix(Jr,Ie,v,D,!0),Ir=ke&&0!==c.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1);let ui;ui=ke?Re.iconsInText?Ro(it.kind,At,de,H,y,La,vl,zr,kt,er):$c(it.kind,At,de,H,y,La,vl,zr,m,kt,!0):Zu(it.kind,At,de,H,y,La,vl,zr,m,kt);const fs={program:nn,buffers:$e,uniformValues:ui,atlasTexture:An,atlasTextureIcon:$n,atlasInterpolation:un,atlasInterpolationIcon:pr,isSDF:ke,hasHalo:Ir};if(ee&&Re.canOverlap){ce=!0;const Pn=$e.segments.get();for(const sr of Pn)be.push({segments:new g.S([sr]),sortKey:sr.sortKey,state:fs,terrainData:bt})}else be.push({segments:$e.segments,sortKey:0,state:fs,terrainData:bt})}ce&&be.sort((Ee,Ie)=>Ee.sortKey-Ie.sortKey);for(const Ee of be){const Ie=Ee.state;if(V.activeTexture.set(Z.TEXTURE0),Ie.atlasTexture.bind(Ie.atlasInterpolation,Z.CLAMP_TO_EDGE),Ie.atlasTextureIcon&&(V.activeTexture.set(Z.TEXTURE1),Ie.atlasTextureIcon&&Ie.atlasTextureIcon.bind(Ie.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Ie.isSDF){const Re=Ie.uniformValues;Ie.hasHalo&&(Re.u_is_halo=1,ss(Ie.buffers,Ee.segments,c,y,Ie.program,me,k,O,Re,Ee.terrainData)),Re.u_is_halo=0}ss(Ie.buffers,Ee.segments,c,y,Ie.program,me,k,O,Ie.uniformValues,Ee.terrainData)}}function ss(y,o,c,d,m,v,D,S,E,A){const k=d.context;m.draw(k,k.gl.TRIANGLES,v,D,S,Mn.disabled,E,A,c.id,y.layoutVertexBuffer,y.indexBuffer,o,c.paint,d.transform.zoom,y.programConfigurations.get(c.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function pl(y,o,c,d,m){if(!c||!d||!d.imageAtlas)return;const v=d.imageAtlas.patternPositions;let D=v[c.to.toString()],S=v[c.from.toString()];if(!D||!S){const E=m.getPaintProperty(o);D=v[E],S=v[E]}D&&S&&y.setConstantPatternPositions(D,S)}function Pi(y,o,c,d,m,v,D){const S=y.context.gl,E="fill-pattern",A=c.paint.get(E),k=A&&A.constantOr(1),O=c.getCrossfadeParameters();let V,Z,G,Y,H;D?(Z=k&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",V=S.LINES):(Z=k?"fillPattern":"fill",V=S.TRIANGLES);const se=A.constantOr(null);for(const de of d){const ee=o.getTile(de);if(k&&!ee.patternsLoaded())continue;const ce=ee.getBucket(c);if(!ce)continue;const me=ce.programConfigurations.get(c.id),ge=y.useProgram(Z,me),be=y.style.map.terrain&&y.style.map.terrain.getTerrainData(de);k&&(y.context.activeTexture.set(S.TEXTURE0),ee.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),me.updatePaintBuffers(O)),pl(me,E,se,ee,c);const Ee=be?de:null,Ie=y.translatePosMatrix(Ee?Ee.posMatrix:de.posMatrix,ee,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(D){Y=ce.indexBuffer2,H=ce.segments2;const Re=[S.drawingBufferWidth,S.drawingBufferHeight];G="fillOutlinePattern"===Z&&k?Fs(Ie,y,O,ee,Re):Wt(Ie,Re)}else Y=ce.indexBuffer,H=ce.segments,G=k?jc(Ie,y,O,ee):Hu(Ie);ge.draw(y.context,V,m,y.stencilModeForClipping(de),v,Mn.disabled,G,be,c.id,ce.layoutVertexBuffer,Y,H,c.paint,y.transform.zoom,me)}}function fl(y,o,c,d,m,v,D){const S=y.context,E=S.gl,A="fill-extrusion-pattern",k=c.paint.get(A),O=k.constantOr(1),V=c.getCrossfadeParameters(),Z=c.paint.get("fill-extrusion-opacity"),G=k.constantOr(null);for(const Y of d){const H=o.getTile(Y),se=H.getBucket(c);if(!se)continue;const de=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Y),ee=se.programConfigurations.get(c.id),ce=y.useProgram(O?"fillExtrusionPattern":"fillExtrusion",ee);O&&(y.context.activeTexture.set(E.TEXTURE0),H.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ee.updatePaintBuffers(V)),pl(ee,A,G,H,c);const me=y.translatePosMatrix(Y.posMatrix,H,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),ge=c.paint.get("fill-extrusion-vertical-gradient"),be=O?Cr(me,y,ge,Z,Y,V,H):rl(me,y,ge,Z);ce.draw(S,S.gl.TRIANGLES,m,v,D,Mn.backCCW,be,de,c.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,c.paint,y.transform.zoom,ee,y.style.map.terrain&&se.centroidVertexBuffer)}}function ht(y,o,c,d,m,v,D){const S=y.context,E=S.gl,A=c.fbo;if(!A)return;const k=y.useProgram("hillshade"),O=y.style.map.terrain&&y.style.map.terrain.getTerrainData(o);S.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,A.colorAttachment.get()),k.draw(S,E.TRIANGLES,m,v,D,Mn.disabled,((V,Z,G,Y)=>{const H=G.paint.get("hillshade-shadow-color"),se=G.paint.get("hillshade-highlight-color"),de=G.paint.get("hillshade-accent-color");let ee=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===G.paint.get("hillshade-illumination-anchor")&&(ee-=V.transform.angle);const ce=!V.options.moving;return{u_matrix:Y?Y.posMatrix:V.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),ce),u_image:0,u_latrange:sl(0,Z.tileID),u_light:[G.paint.get("hillshade-exaggeration"),ee],u_shadow:H,u_highlight:se,u_accent:de}})(y,c,d,O?o:null),O,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function ac(y,o,c,d,m,v){const D=y.context,S=D.gl,E=o.dem;if(E&&E.data){const A=E.dim,k=E.stride,O=E.getPixels();if(D.activeTexture.set(S.TEXTURE1),D.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||y.getTileTexture(k),o.demTexture){const Z=o.demTexture;Z.update(O,{premultiply:!1}),Z.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else o.demTexture=new In(D,O,S.RGBA,{premultiply:!1}),o.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);D.activeTexture.set(S.TEXTURE0);let V=o.fbo;if(!V){const Z=new In(D,{width:A,height:A,data:null},S.RGBA);Z.bind(S.LINEAR,S.CLAMP_TO_EDGE),V=o.fbo=D.createFramebuffer(A,A,!0,!1),V.colorAttachment.set(Z.texture)}D.bindFramebuffer.set(V.framebuffer),D.viewport.set([0,0,A,A]),y.useProgram("hillshadePrepare").draw(D,S.TRIANGLES,d,m,v,Mn.disabled,((Z,G)=>{const Y=G.stride,H=g.Z();return g.aS(H,0,g.N,-g.N,0,0,1),g.$(H,H,[0,-g.N,0]),{u_matrix:H,u_image:1,u_dimension:[Y,Y],u_zoom:Z.overscaledZ,u_unpack:G.getUnpackVector()}})(o.tileID,E),null,c.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function Je(y,o,c,d,m,v){const D=d.paint.get("raster-fade-duration");if(!v&&D>0){const S=g.h.now(),E=(S-y.timeAdded)/D,A=o?(S-o.timeAdded)/D:-1,k=c.getSource(),O=m.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),V=!o||Math.abs(o.tileID.overscaledZ-O)>Math.abs(y.tileID.overscaledZ-O),Z=V&&y.refreshedUponExpiration?1:g.ad(V?E:1-A,0,1);return y.refreshedUponExpiration&&E>=1&&(y.refreshedUponExpiration=!1),o?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const ml=new g.aT(1,0,0,1),Ma=new g.aT(0,1,0,1),Vs=new g.aT(0,0,1,1),th=new g.aT(1,0,1,1),nh=new g.aT(0,1,1,1);function gl(y,o,c,d){js(y,0,o+c/2,y.transform.width,c,d)}function ki(y,o,c,d){js(y,o-c/2,0,c,y.transform.height,d)}function js(y,o,c,d,m,v){const D=y.context,S=D.gl;S.enable(S.SCISSOR_TEST),S.scissor(o*y.pixelRatio,c*y.pixelRatio,d*y.pixelRatio,m*y.pixelRatio),D.clear({color:v}),S.disable(S.SCISSOR_TEST)}function Ri(y,o,c){const d=y.context,m=d.gl,v=c.posMatrix,D=y.useProgram("debug"),S=Vt.disabled,E=Fn.disabled,A=y.colorModeForRenderPass(),k="$debug",O=y.style.map.terrain&&y.style.map.terrain.getTerrainData(c);d.activeTexture.set(m.TEXTURE0);const V=o.getTileByID(c.key).latestRawTileData,Z=Math.floor((V&&V.byteLength||0)/1024),G=o.getTile(c).tileSize,Y=512/Math.min(G,512)*(c.overscaledZ/y.transform.zoom)*.5;let H=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(H+=` => ${c.overscaledZ}`),function(se,de){se.initDebugOverlayCanvas();const ee=se.debugOverlayCanvas,ce=se.context.gl,me=se.debugOverlayCanvas.getContext("2d");me.clearRect(0,0,ee.width,ee.height),me.shadowColor="white",me.shadowBlur=2,me.lineWidth=1.5,me.strokeStyle="white",me.textBaseline="top",me.font="bold 36px Open Sans, sans-serif",me.fillText(de,5,5),me.strokeText(de,5,5),se.debugOverlayTexture.update(ee),se.debugOverlayTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}(y,`${H} ${Z}kB`),D.draw(d,m.TRIANGLES,S,E,bn.alphaBlended,Mn.disabled,ol(v,g.aT.transparent,Y),null,k,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),D.draw(d,m.LINE_STRIP,S,E,A,Mn.disabled,ol(v,g.aT.red),O,k,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function Xt(y,o,c){const d=y.context,m=d.gl,v=y.colorModeForRenderPass(),D=new Vt(m.LEQUAL,Vt.ReadWrite,y.depthRangeFor3D),S=y.useProgram("terrain"),E=o.getTerrainMesh();d.bindFramebuffer.set(null),d.viewport.set([0,0,y.width,y.height]);for(const A of c){const k=y.renderToTexture.getTexture(A),O=o.getTerrainData(A.tileID);d.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,k.texture);const V={u_matrix:y.transform.calculatePosMatrix(A.tileID.toUnwrapped()),u_texture:0,u_ele_delta:o.getMeshFrameDelta(y.transform.zoom)};S.draw(d,m.TRIANGLES,D,Fn.disabled,v,Mn.backCCW,V,O,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}}class Nt{constructor(o,c){this.context=new Pf(o),this.transform=c,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:g.Z(),renderTime:0},this.setup(),this.numSublayers=yi.maxUnderzooming+yi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new tl}resize(o,c,d){if(this.width=Math.floor(o*d),this.height=Math.floor(c*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const o=this.context,c=new g.a_;c.emplaceBack(0,0),c.emplaceBack(g.N,0),c.emplaceBack(0,g.N),c.emplaceBack(g.N,g.N),this.tileExtentBuffer=o.createVertexBuffer(c,nl.members),this.tileExtentSegments=g.S.simpleSegment(0,0,4,2);const d=new g.a_;d.emplaceBack(0,0),d.emplaceBack(g.N,0),d.emplaceBack(0,g.N),d.emplaceBack(g.N,g.N),this.debugBuffer=o.createVertexBuffer(d,nl.members),this.debugSegments=g.S.simpleSegment(0,0,4,5);const m=new g.V;m.emplaceBack(0,0,0,0),m.emplaceBack(g.N,0,g.N,0),m.emplaceBack(0,g.N,0,g.N),m.emplaceBack(g.N,g.N,g.N,g.N),this.rasterBoundsBuffer=o.createVertexBuffer(m,an.members),this.rasterBoundsSegments=g.S.simpleSegment(0,0,4,2);const v=new g.a_;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(v,nl.members),this.viewportSegments=g.S.simpleSegment(0,0,4,2);const D=new g.a$;D.emplaceBack(0),D.emplaceBack(1),D.emplaceBack(3),D.emplaceBack(2),D.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(D);const S=new g.b0;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(S);const E=this.context.gl;this.stencilClearMode=new Fn({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){const o=this.context,c=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=g.Z();g.aS(d,0,this.width,this.height,0,0,1),g.a0(d,d,[c.drawingBufferWidth,c.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,c.TRIANGLES,Vt.disabled,this.stencilClearMode,bn.disabled,Mn.disabled,Ql(d),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,c){if(this.currentStencilSource===o.source||!o.isTileClipped()||!c||!c.length)return;this.currentStencilSource=o.source;const d=this.context,m=d.gl;this.nextStencilID+c.length>256&&this.clearStencil(),d.setColorMode(bn.disabled),d.setDepthMode(Vt.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of c){const S=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D);v.draw(d,m.TRIANGLES,Vt.disabled,new Fn({func:m.ALWAYS,mask:0},S,255,m.KEEP,m.KEEP,m.REPLACE),bn.disabled,Mn.disabled,Ql(D.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,c=this.context.gl;return new Fn({func:c.NOTEQUAL,mask:255},o,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(o){const c=this.context.gl;return new Fn({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(o){const c=this.context.gl,d=o.sort((D,S)=>S.overscaledZ-D.overscaledZ),m=d[d.length-1].overscaledZ,v=d[0].overscaledZ-m+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const D={};for(let S=0;S<v;S++)D[S+m]=new Fn({func:c.GEQUAL,mask:255},S+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=v,[D,d]}return[{[m]:Fn.disabled},d]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new bn([o.CONSTANT_COLOR,o.ONE],new g.aT(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?bn.unblended:bn.alphaBlended}depthModeForSublayer(o,c,d){if(!this.opaquePassEnabledForLayer())return Vt.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Vt(d||this.context.gl.LEQUAL,c,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,c){this.style=o,this.options=c,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(g.h.now()),this.imageManager.beginFrame();const d=this.style._order,m=this.style.sourceCaches,v={},D={},S={};for(const E in m){const A=m[E];A.used&&A.prepare(this.context),v[E]=A.getVisibleCoordinates(),D[E]=v[E].slice().reverse(),S[E]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<d.length;E++)if(this.style._layers[d[E]].is3D()){this.opaquePassCutoff=E;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const E=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!g.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||E.length)&&(g.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,k){const O=A.context,V=O.gl,Z=bn.unblended,G=new Vt(V.LEQUAL,Vt.ReadWrite,[0,1]),Y=k.getTerrainMesh(),H=k.sourceCache.getRenderableTiles(),se=A.useProgram("terrainDepth");O.bindFramebuffer.set(k.getFramebuffer("depth").framebuffer),O.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),O.clear({color:g.aT.transparent,depth:1});for(const de of H){const ee=k.getTerrainData(de.tileID),ce={u_matrix:A.transform.calculatePosMatrix(de.tileID.toUnwrapped()),u_ele_delta:k.getMeshFrameDelta(A.transform.zoom)};se.draw(O,V.TRIANGLES,G,Fn.disabled,Z,Mn.backCCW,ce,ee,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments)}O.bindFramebuffer.set(null),O.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,k){const O=A.context,V=O.gl,Z=bn.unblended,G=new Vt(V.LEQUAL,Vt.ReadWrite,[0,1]),Y=k.getTerrainMesh(),H=k.getCoordsTexture(),se=k.sourceCache.getRenderableTiles(),de=A.useProgram("terrainCoords");O.bindFramebuffer.set(k.getFramebuffer("coords").framebuffer),O.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),O.clear({color:g.aT.transparent,depth:1}),k.coordsIndex=[];for(const ee of se){const ce=k.getTerrainData(ee.tileID);O.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,H.texture);const me={u_matrix:A.transform.calculatePosMatrix(ee.tileID.toUnwrapped()),u_terrain_coords_id:(255-k.coordsIndex.length)/255,u_texture:0,u_ele_delta:k.getMeshFrameDelta(A.transform.zoom)};de.draw(O,V.TRIANGLES,G,Fn.disabled,Z,Mn.backCCW,me,ce,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments),k.coordsIndex.push(ee.tileID.key)}O.bindFramebuffer.set(null),O.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const E of d){const A=this.style._layers[E];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const k=D[A.source];("custom"===A.type||k.length)&&this.renderLayer(this,m[A.source],A,k)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:c.showOverdrawInspector?g.aT.black:g.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[d[this.currentLayer]],A=m[E.source],k=v[E.source];this._renderTileClippingMasks(E,k),this.renderLayer(this,A,E,k)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const E=this.style._layers[d[this.currentLayer]],A=m[E.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(E))continue;const k=("symbol"===E.type?S:D)[E.source];this._renderTileClippingMasks(E,v[E.source]),this.renderLayer(this,A,E,k)}if(this.options.showTileBoundaries){const E=function(A,k){let O=null;const V=Object.values(A._layers).flatMap(H=>H.source&&!H.isHidden(k)?[A.sourceCaches[H.source]]:[]),Z=V.filter(H=>"vector"===H.getSource().type),G=V.filter(H=>"vector"!==H.getSource().type),Y=H=>{(!O||O.getSource().maxzoom<H.getSource().maxzoom)&&(O=H)};return Z.forEach(H=>Y(H)),O||G.forEach(H=>Y(H)),O}(this.style,this.transform.zoom);E&&function(A,k,O){for(let V=0;V<O.length;V++)Ri(A,k,O[V])}(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const A=E.transform.padding;gl(E,E.transform.height-(A.top||0),3,ml),gl(E,A.bottom||0,3,Ma),ki(E,A.left||0,3,Vs),ki(E,E.transform.width-(A.right||0),3,th);const k=E.transform.centerPoint;var O,V,Z,G;js(O=E,(V=k.x)-1,(Z=E.transform.height-k.y)-10,2,20,G=nh),js(O,V-10,Z-1,20,2,G)}(this),this.context.setDefault()}renderLayer(o,c,d,m){if(!d.isHidden(this.transform.zoom)&&("background"===d.type||"custom"===d.type||(m||[]).length))switch(this.id=d.id,d.type){case"symbol":!function(v,D,S,E,A){if("translucent"!==v.renderPass)return;const k=Fn.disabled,O=v.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(V,Z,G,Y,H,se,de){const ee=Z.transform,ce="map"===H,me="map"===se;for(const ge of V){const be=Y.getTile(ge),Ee=be.getBucket(G);if(!Ee||!Ee.text||!Ee.text.segments.get().length)continue;const Ie=g.ah(Ee.textSizeData,ee.zoom),Re=oe(be,1,Z.transform.zoom),$e=Pe(ge.posMatrix,me,ce,Z.transform,Re),Tt="none"!==G.layout.get("icon-text-fit")&&Ee.hasIconData();if(Ie){const ke=Math.pow(2,ee.zoom-be.tileID.overscaledZ);sc(Ee,ce,me,de,ee,$e,ge.posMatrix,ke,Ie,Tt,Z.style.map.terrain?(it,Qe)=>Z.style.map.terrain.getElevation(ge,it,Qe):null)}}}(E,v,S,D,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),A),0!==S.paint.get("icon-opacity").constantOr(1)&&dl(v,D,S,E,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),k,O),0!==S.paint.get("text-opacity").constantOr(1)&&dl(v,D,S,E,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),k,O),D.map.showCollisionBoxes&&(ic(v,D,S,E,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),!0),ic(v,D,S,E,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),!1))}(o,c,d,m,this.style.placement.variableOffsets);break;case"circle":!function(v,D,S,E){if("translucent"!==v.renderPass)return;const A=S.paint.get("circle-opacity"),k=S.paint.get("circle-stroke-width"),O=S.paint.get("circle-stroke-opacity"),V=!S.layout.get("circle-sort-key").isConstant();if(0===A.constantOr(1)&&(0===k.constantOr(1)||0===O.constantOr(1)))return;const Z=v.context,G=Z.gl,Y=v.depthModeForSublayer(0,Vt.ReadOnly),H=Fn.disabled,se=v.colorModeForRenderPass(),de=[];for(let ee=0;ee<E.length;ee++){const ce=E[ee],me=D.getTile(ce),ge=me.getBucket(S);if(!ge)continue;const be=ge.programConfigurations.get(S.id),Ee=v.useProgram("circle",be),Ie=ge.layoutVertexBuffer,Re=ge.indexBuffer,$e=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ce),Tt={programConfiguration:be,program:Ee,layoutVertexBuffer:Ie,indexBuffer:Re,uniformValues:xn(v,ce,me,S),terrainData:$e};if(V){const ke=ge.segments.get();for(const it of ke)de.push({segments:new g.S([it]),sortKey:it.sortKey,state:Tt})}else de.push({segments:ge.segments,sortKey:0,state:Tt})}V&&de.sort((ee,ce)=>ee.sortKey-ce.sortKey);for(const ee of de){const{programConfiguration:ce,program:me,layoutVertexBuffer:ge,indexBuffer:be,uniformValues:Ee,terrainData:Ie}=ee.state;me.draw(Z,G.TRIANGLES,Y,H,se,Mn.disabled,Ee,Ie,S.id,ge,be,ee.segments,S.paint,v.transform.zoom,ce)}}(o,c,d,m);break;case"heatmap":!function(v,D,S,E){if(0!==S.paint.get("heatmap-opacity"))if("offscreen"===v.renderPass){const A=v.context,k=A.gl,O=Fn.disabled,V=new bn([k.ONE,k.ONE],g.aT.transparent,[!0,!0,!0,!0]);(function(Z,G,Y){const H=Z.gl;Z.activeTexture.set(H.TEXTURE1),Z.viewport.set([0,0,G.width/4,G.height/4]);let se=Y.heatmapFbo;if(se)H.bindTexture(H.TEXTURE_2D,se.colorAttachment.get()),Z.bindFramebuffer.set(se.framebuffer);else{const de=H.createTexture();H.bindTexture(H.TEXTURE_2D,de),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MAG_FILTER,H.LINEAR),se=Y.heatmapFbo=Z.createFramebuffer(G.width/4,G.height/4,!1,!1),function(ee,ce,me,ge){var be,Ee;const Ie=ee.gl,Re=null!==(be=ee.HALF_FLOAT)&&void 0!==be?be:Ie.UNSIGNED_BYTE,$e=null!==(Ee=ee.RGBA16F)&&void 0!==Ee?Ee:Ie.RGBA;Ie.texImage2D(Ie.TEXTURE_2D,0,$e,ce.width/4,ce.height/4,0,Ie.RGBA,Re,null),ge.colorAttachment.set(me)}(Z,G,de,se)}})(A,v,S),A.clear({color:g.aT.transparent});for(let Z=0;Z<E.length;Z++){const G=E[Z];if(D.hasRenderableParent(G))continue;const Y=D.getTile(G),H=Y.getBucket(S);if(!H)continue;const se=H.programConfigurations.get(S.id),de=v.useProgram("heatmap",se),{zoom:ee}=v.transform;de.draw(A,k.TRIANGLES,Vt.disabled,O,V,Mn.disabled,xt(G.posMatrix,Y,ee,S.paint.get("heatmap-intensity")),null,S.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,S.paint,v.transform.zoom,se)}A.viewport.set([0,0,v.width,v.height])}else"translucent"===v.renderPass&&(v.context.setColorMode(v.colorModeForRenderPass()),function(A,k){const O=A.context,V=O.gl,Z=k.heatmapFbo;if(!Z)return;O.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,Z.colorAttachment.get()),O.activeTexture.set(V.TEXTURE1);let G=k.colorRampTexture;G||(G=k.colorRampTexture=new In(O,k.colorRamp,V.RGBA)),G.bind(V.LINEAR,V.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(O,V.TRIANGLES,Vt.disabled,Fn.disabled,A.colorModeForRenderPass(),Mn.disabled,((Y,H,se,de)=>{const ee=g.Z();g.aS(ee,0,Y.width,Y.height,0,0,1);const ce=Y.context.gl;return{u_matrix:ee,u_world:[ce.drawingBufferWidth,ce.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}})(A,k),null,k.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,k.paint,A.transform.zoom)}(v,S))}(o,c,d,m);break;case"line":!function(v,D,S,E){if("translucent"!==v.renderPass)return;const A=S.paint.get("line-opacity"),k=S.paint.get("line-width");if(0===A.constantOr(1)||0===k.constantOr(1))return;const O=v.depthModeForSublayer(0,Vt.ReadOnly),V=v.colorModeForRenderPass(),Z=S.paint.get("line-dasharray"),G=S.paint.get("line-pattern"),Y=G.constantOr(1),H=S.paint.get("line-gradient"),se=S.getCrossfadeParameters(),de=Y?"linePattern":Z?"lineSDF":H?"lineGradient":"line",ee=v.context,ce=ee.gl;let me=!0;for(const ge of E){const be=D.getTile(ge);if(Y&&!be.patternsLoaded())continue;const Ee=be.getBucket(S);if(!Ee)continue;const Ie=Ee.programConfigurations.get(S.id),Re=v.context.program.get(),$e=v.useProgram(de,Ie),Tt=me||$e.program!==Re,ke=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ge),it=G.constantOr(null);if(it&&be.imageAtlas){const At=be.imageAtlas,bt=At.patternPositions[it.to.toString()],kt=At.patternPositions[it.from.toString()];bt&&kt&&Ie.setConstantPatternPositions(bt,kt)}const Qe=ke?ge:null,nn=Y?qu(v,be,S,se,Qe):Z?Ve(v,be,S,Z,se,Qe):H?Pd(v,be,S,Ee.lineClipsArray.length,Qe):al(v,be,S,Qe);if(Y)ee.activeTexture.set(ce.TEXTURE0),be.imageAtlasTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE),Ie.updatePaintBuffers(se);else if(Z&&(Tt||v.lineAtlas.dirty))ee.activeTexture.set(ce.TEXTURE0),v.lineAtlas.bind(ee);else if(H){const At=Ee.gradients[S.id];let bt=At.texture;if(S.gradientVersion!==At.version){let kt=256;if(S.stepInterpolant){const An=D.getSource().maxzoom,un=ge.canonical.z===An?Math.ceil(1<<v.transform.maxZoom-ge.canonical.z):1;kt=g.ad(g.aY(Ee.maxLineLength/g.N*1024*un),256,ee.maxTextureSize)}At.gradient=g.aZ({expression:S.gradientExpression(),evaluationKey:"lineProgress",resolution:kt,image:At.gradient||void 0,clips:Ee.lineClipsArray}),At.texture?At.texture.update(At.gradient):At.texture=new In(ee,At.gradient,ce.RGBA),At.version=S.gradientVersion,bt=At.texture}ee.activeTexture.set(ce.TEXTURE0),bt.bind(S.stepInterpolant?ce.NEAREST:ce.LINEAR,ce.CLAMP_TO_EDGE)}$e.draw(ee,ce.TRIANGLES,O,v.stencilModeForClipping(ge),V,Mn.disabled,nn,ke,S.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,S.paint,v.transform.zoom,Ie,Ee.layoutVertexBuffer2),me=!1}}(o,c,d,m);break;case"fill":!function(v,D,S,E){const A=S.paint.get("fill-color"),k=S.paint.get("fill-opacity");if(0===k.constantOr(1))return;const O=v.colorModeForRenderPass(),V=S.paint.get("fill-pattern"),Z=v.opaquePassEnabledForLayer()&&!V.constantOr(1)&&1===A.constantOr(g.aT.transparent).a&&1===k.constantOr(0)?"opaque":"translucent";if(v.renderPass===Z){const G=v.depthModeForSublayer(1,"opaque"===v.renderPass?Vt.ReadWrite:Vt.ReadOnly);Pi(v,D,S,E,G,O,!1)}if("translucent"===v.renderPass&&S.paint.get("fill-antialias")){const G=v.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,Vt.ReadOnly);Pi(v,D,S,E,G,O,!0)}}(o,c,d,m);break;case"fill-extrusion":!function(v,D,S,E){const A=S.paint.get("fill-extrusion-opacity");if(0!==A&&"translucent"===v.renderPass){const k=new Vt(v.context.gl.LEQUAL,Vt.ReadWrite,v.depthRangeFor3D);if(1!==A||S.paint.get("fill-extrusion-pattern").constantOr(1))fl(v,D,S,E,k,Fn.disabled,bn.disabled),fl(v,D,S,E,k,v.stencilModeFor3D(),v.colorModeForRenderPass());else{const O=v.colorModeForRenderPass();fl(v,D,S,E,k,Fn.disabled,O)}}}(o,c,d,m);break;case"hillshade":!function(v,D,S,E){if("offscreen"!==v.renderPass&&"translucent"!==v.renderPass)return;const A=v.context,k=v.depthModeForSublayer(0,Vt.ReadOnly),O=v.colorModeForRenderPass(),[V,Z]="translucent"===v.renderPass?v.stencilConfigForOverlap(E):[{},E];for(const G of Z){const Y=D.getTile(G);void 0!==Y.needsHillshadePrepare&&Y.needsHillshadePrepare&&"offscreen"===v.renderPass?ac(v,Y,S,k,Fn.disabled,O):"translucent"===v.renderPass&&ht(v,G,Y,S,k,V[G.overscaledZ],O)}A.viewport.set([0,0,v.width,v.height])}(o,c,d,m);break;case"raster":!function(v,D,S,E){if("translucent"!==v.renderPass||0===S.paint.get("raster-opacity")||!E.length)return;const A=v.context,k=A.gl,O=D.getSource(),V=v.useProgram("raster"),Z=v.colorModeForRenderPass(),[G,Y]=O instanceof Si?[{},E]:v.stencilConfigForOverlap(E),H=Y[Y.length-1].overscaledZ,se=!v.options.moving;for(const de of Y){const ee=v.depthModeForSublayer(de.overscaledZ-H,1===S.paint.get("raster-opacity")?Vt.ReadWrite:Vt.ReadOnly,k.LESS),ce=D.getTile(de);ce.registerFadeDuration(S.paint.get("raster-fade-duration"));const me=D.findLoadedParent(de,0),ge=Je(ce,me,D,S,v.transform,v.style.map.terrain);let be,Ee;const Ie="nearest"===S.paint.get("raster-resampling")?k.NEAREST:k.LINEAR;A.activeTexture.set(k.TEXTURE0),ce.texture.bind(Ie,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(k.TEXTURE1),me?(me.texture.bind(Ie,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),be=Math.pow(2,me.tileID.overscaledZ-ce.tileID.overscaledZ),Ee=[ce.tileID.canonical.x*be%1,ce.tileID.canonical.y*be%1]):ce.texture.bind(Ie,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);const Re=v.style.map.terrain&&v.style.map.terrain.getTerrainData(de),$e=Re?de:null,Tt=$e?$e.posMatrix:v.transform.calculatePosMatrix(de.toUnwrapped(),se),ke=Jt(Tt,Ee||[0,0],be||1,ge,S);O instanceof Si?V.draw(A,k.TRIANGLES,ee,Fn.disabled,Z,Mn.disabled,ke,Re,S.id,O.boundsBuffer,v.quadTriangleIndexBuffer,O.boundsSegments):V.draw(A,k.TRIANGLES,ee,G[de.overscaledZ],Z,Mn.disabled,ke,Re,S.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}}(o,c,d,m);break;case"background":!function(v,D,S,E){const A=S.paint.get("background-color"),k=S.paint.get("background-opacity");if(0===k)return;const O=v.context,V=O.gl,Z=v.transform,G=Z.tileSize,Y=S.paint.get("background-pattern");if(v.isPatternMissing(Y))return;const H=!Y&&1===A.a&&1===k&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==H)return;const se=Fn.disabled,de=v.depthModeForSublayer(0,"opaque"===H?Vt.ReadWrite:Vt.ReadOnly),ee=v.colorModeForRenderPass(),ce=v.useProgram(Y?"backgroundPattern":"background"),me=E||Z.coveringTiles({tileSize:G,terrain:v.style.map.terrain});Y&&(O.activeTexture.set(V.TEXTURE0),v.imageManager.bind(v.context));const ge=S.getCrossfadeParameters();for(const be of me){const Ee=E?be.posMatrix:v.transform.calculatePosMatrix(be.toUnwrapped()),Ie=Y?Wi(Ee,k,v,Y,{tileID:be,tileSize:G},ge):Rr(Ee,k,A),Re=v.style.map.terrain&&v.style.map.terrain.getTerrainData(be);ce.draw(O,V.TRIANGLES,de,se,ee,Mn.disabled,Ie,Re,S.id,v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}(o,0,d,m);break;case"custom":!function(v,D,S){const E=v.context,A=S.implementation;if("offscreen"===v.renderPass){const k=A.prerender;k&&(v.setCustomLayerDefaults(),E.setColorMode(v.colorModeForRenderPass()),k.call(A,E.gl,v.transform.customLayerMatrix()),E.setDirty(),v.setBaseState())}else if("translucent"===v.renderPass){v.setCustomLayerDefaults(),E.setColorMode(v.colorModeForRenderPass()),E.setStencilMode(Fn.disabled);const k="3d"===A.renderingMode?new Vt(v.context.gl.LEQUAL,Vt.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,Vt.ReadOnly);E.setDepthMode(k),A.render(E.gl,v.transform.customLayerMatrix()),E.setDirty(),v.setBaseState(),E.bindFramebuffer.set(null)}}(o,0,d)}}translatePosMatrix(o,c,d,m,v){if(!d[0]&&!d[1])return o;const D=v?"map"===m?this.transform.angle:0:"viewport"===m?-this.transform.angle:0;if(D){const A=Math.sin(D),k=Math.cos(D);d=[d[0]*k-d[1]*A,d[0]*A+d[1]*k]}const S=[v?d[0]:oe(c,d[0],this.transform.zoom),v?d[1]:oe(c,d[1],this.transform.zoom),0],E=new Float32Array(16);return g.$(E,o,S),E}saveTileTexture(o){const c=this._tileTextures[o.size[0]];c?c.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const c=this._tileTextures[o];return c&&c.length>0?c.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const c=this.imageManager.getPattern(o.from.toString()),d=this.imageManager.getPattern(o.to.toString());return!c||!d}useProgram(o,c){this.cache=this.cache||{};const d=o+(c?c.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[d]||(this.cache[d]=new yt(this.context,En[o],c,Jl[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new In(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:c}=this.context.gl;return this.width!==o||this.height!==c}}class Dr{constructor(o,c){this.points=o,this.planes=c}static fromInvProjectionMatrix(o,c,d){const m=Math.pow(2,d),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const E=1/(S=g.ag([],S,o))[3]/c*m;return g.b3(S,S,[E,E,1/S[3],E])}),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const E=function(V,Z){var G=Z[0],Y=Z[1],H=Z[2],se=G*G+Y*Y+H*H;return se>0&&(se=1/Math.sqrt(se)),V[0]=Z[0]*se,V[1]=Z[1]*se,V[2]=Z[2]*se,V}([],(V=[],Z=co([],v[S[0]],v[S[1]]),G=co([],v[S[2]],v[S[1]]),Y=Z[0],de=G[0],V[0]=(H=Z[1])*(ce=G[2])-(se=Z[2])*(ee=G[1]),V[1]=se*de-Y*ce,V[2]=Y*ee-H*de,V)),A=-((k=E)[0]*(O=v[S[1]])[0]+k[1]*O[1]+k[2]*O[2]);var V,Z,G,Y,H,se,de,ee,ce,k,O;return E.concat(A)});return new Dr(v,D)}}class as{constructor(o,c){var d,m,v;this.min=o,this.max=c,this.center=function(d,m,v){return d[0]=.5*m[0],d[1]=.5*m[1],d[2]=.5*m[2],d}([],((d=[])[0]=(m=this.min)[0]+(v=this.max)[0],d[1]=m[1]+v[1],d[2]=m[2]+v[2],d))}quadrant(o){const c=[o%2==0,o<2],d=$i(this.min),m=$i(this.max);for(let v=0;v<c.length;v++)d[v]=c[v]?this.min[v]:this.center[v],m[v]=c[v]?this.center[v]:this.max[v];return m[2]=this.max[2],new as(d,m)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const c=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let d=!0;for(let m=0;m<o.planes.length;m++){const v=o.planes[m];let D=0;for(let S=0;S<c.length;S++)g.b4(v,c[S])>=0&&D++;if(0===D)return 0;D!==c.length&&(d=!1)}if(d)return 2;for(let m=0;m<3;m++){let v=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(let S=0;S<o.points.length;S++){const E=o.points[S][m]-this.min[m];v=Math.min(v,E),D=Math.max(D,E)}if(D<0||v>this.max[m]-this.min[m])return 0}return 1}}class $s{constructor(o=0,c=0,d=0,m=0){if(isNaN(o)||o<0||isNaN(c)||c<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=c,this.left=d,this.right=m}interpolate(o,c,d){return null!=c.top&&null!=o.top&&(this.top=g.B.number(o.top,c.top,d)),null!=c.bottom&&null!=o.bottom&&(this.bottom=g.B.number(o.bottom,c.bottom,d)),null!=c.left&&null!=o.left&&(this.left=g.B.number(o.left,c.left,d)),null!=c.right&&null!=o.right&&(this.right=g.B.number(o.right,c.right,d)),this}getCenter(o,c){const d=g.ad((this.left+o-this.right)/2,0,o),m=g.ad((this.top+c-this.bottom)/2,0,c);return new g.P(d,m)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new $s(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class yl{constructor(o,c,d,m,v){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===v||!!v,this._minZoom=o||0,this._maxZoom=c||22,this._minPitch=d??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new g.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new $s,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const o=new yl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this._minEleveationForCurrentTile=o._minEleveationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new g.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const c=-g.b5(o,-180,180)*Math.PI/180;var d;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(d=new g.A(4),g.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d),function(d,m,v){var D=m[0],S=m[1],E=m[2],A=m[3],k=Math.sin(v),O=Math.cos(v);d[0]=D*O+E*k,d[1]=S*O+A*k,d[2]=D*-k+E*O,d[3]=S*-k+A*O}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const c=g.ad(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const c=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._zoom=c,this.tileZoom=Math.max(0,Math.floor(c)),this.scale=this.zoomScale(c),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,c,d){this._unmodified=!1,this._edgeInsets.interpolate(o,c,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const c=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(o){const c=[new g.b6(0,o)];if(this._renderWorldCopies){const d=this.pointCoordinate(new g.P(0,0)),m=this.pointCoordinate(new g.P(this.width,0)),v=this.pointCoordinate(new g.P(this.width,this.height)),D=this.pointCoordinate(new g.P(0,this.height)),S=Math.floor(Math.min(d.x,m.x,v.x,D.x)),E=Math.floor(Math.max(d.x,m.x,v.x,D.x)),A=1;for(let k=S-A;k<=E+A;k++)0!==k&&c.push(new g.b6(k,o))}return c}coveringTiles(o){var c,d;let m=this.coveringZoomLevel(o);const v=m;if(void 0!==o.minzoom&&m<o.minzoom)return[];void 0!==o.maxzoom&&m>o.maxzoom&&(m=o.maxzoom);const D=this.pointCoordinate(this.getCameraPoint()),S=g.U.fromLngLat(this.center),E=Math.pow(2,m),A=[E*D.x,E*D.y,0],k=[E*S.x,E*S.y,0],O=Dr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let V=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(V=m);const Z=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,G=ee=>({aabb:new as([ee*E,0,0],[(ee+1)*E,E,0]),zoom:0,x:0,y:0,wrap:ee,fullyVisible:!1}),Y=[],H=[],se=m,de=o.reparseOverscaled?v:m;if(this._renderWorldCopies)for(let ee=1;ee<=3;ee++)Y.push(G(-ee)),Y.push(G(ee));for(Y.push(G(0));Y.length>0;){const ee=Y.pop(),ce=ee.x,me=ee.y;let ge=ee.fullyVisible;if(!ge){const $e=ee.aabb.intersects(O);if(0===$e)continue;ge=2===$e}const be=o.terrain?A:k,Ee=ee.aabb.distanceX(be),Ie=ee.aabb.distanceY(be),Re=Math.max(Math.abs(Ee),Math.abs(Ie));if(ee.zoom===se||Re>Z+(1<<se-ee.zoom)-2&&ee.zoom>=V){const $e=se-ee.zoom,Tt=A[0]-.5-(ce<<$e),ke=A[1]-.5-(me<<$e);H.push({tileID:new g.O(ee.zoom===se?de:ee.zoom,ee.wrap,ee.zoom,ce,me),distanceSq:Ms([k[0]-.5-ce,k[1]-.5-me]),tileDistanceToCamera:Math.sqrt(Tt*Tt+ke*ke)})}else for(let $e=0;$e<4;$e++){const Tt=(ce<<1)+$e%2,ke=(me<<1)+($e>>1),it=ee.zoom+1;let Qe=ee.aabb.quadrant($e);if(o.terrain){const nn=new g.O(it,ee.wrap,it,Tt,ke),At=o.terrain.getMinMaxElevation(nn),bt=null!==(c=At.minElevation)&&void 0!==c?c:this.elevation,kt=null!==(d=At.maxElevation)&&void 0!==d?d:this.elevation;Qe=new as([Qe.min[0],Qe.min[1],bt],[Qe.max[0],Qe.max[1],kt])}Y.push({aabb:Qe,zoom:it,x:Tt,y:ke,wrap:ee.wrap,fullyVisible:ge})}}return H.sort((ee,ce)=>ee.distanceSq-ce.distanceSq).map(ee=>ee.tileID)}resize(o,c){this.width=o,this.height=c,this.pixelsToGLUnits=[2/o,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const c=g.ad(o.lat,-this.maxValidLatitude,this.maxValidLatitude);return new g.P(g.G(o.lng)*this.worldSize,g.H(c)*this.worldSize)}unproject(o){return new g.U(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const c=this.pointLocation(this.centerPoint,o),d=o.getElevationForLngLatZoom(c,this.tileZoom);if(!(this.elevation-d))return;const m=this.getCameraPosition(),v=g.U.fromLngLat(m.lngLat,m.altitude),D=g.U.fromLngLat(c,d),S=v.x-D.x,E=v.y-D.y,A=v.z-D.z,k=Math.sqrt(S*S+E*E+A*A),O=this.scaleZoom(this.cameraToCenterDistance/k/this.tileSize);this._elevation=d,this._center=c,this.zoom=O}setLocationAtPoint(o,c){const d=this.pointCoordinate(c),m=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(o),D=new g.U(v.x-(d.x-m.x),v.y-(d.y-m.y));this.center=this.coordinateLocation(D),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,c){return c?this.coordinatePoint(this.locationCoordinate(o),c.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,c){return this.coordinateLocation(this.pointCoordinate(o,c))}locationCoordinate(o){return g.U.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,c){if(c){const V=c.pointCoordinate(o);if(null!=V)return V}const d=[o.x,o.y,0,1],m=[o.x,o.y,1,1];g.ag(d,d,this.pixelMatrixInverse),g.ag(m,m,this.pixelMatrixInverse);const v=d[3],D=m[3],S=d[1]/v,E=m[1]/D,A=d[2]/v,k=m[2]/D,O=A===k?0:(0-A)/(k-A);return new g.U(g.B.number(d[0]/v,m[0]/D,O)/this.worldSize,g.B.number(S,E,O)/this.worldSize)}coordinatePoint(o,c=0,d=this.pixelMatrix){const m=[o.x*this.worldSize,o.y*this.worldSize,c,1];return g.ag(m,m,d),new g.P(m[0]/m[3],m[1]/m[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return(new yn).extend(this.pointLocation(new g.P(0,o))).extend(this.pointLocation(new g.P(this.width,o))).extend(this.pointLocation(new g.P(this.width,this.height))).extend(this.pointLocation(new g.P(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new yn([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(o,c=!1){const d=o.key,m=c?this._alignedPosMatrixCache:this._posMatrixCache;if(m[d])return m[d];const v=o.canonical,D=this.worldSize/this.zoomScale(v.z),S=v.x+Math.pow(2,v.z)*o.wrap,E=g.ao(new Float64Array(16));return g.$(E,E,[S*D,v.y*D,0]),g.a0(E,E,[D/g.N,D/g.N,1]),g.a1(E,c?this.alignedProjMatrix:this.projMatrix,E),m[d]=new Float32Array(E),m[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o,c,d,m,v=-90,D=90,S=-180,E=180;const A=this.size,k=this._unmodified;if(this.latRange){const Z=this.latRange;v=g.H(Z[1])*this.worldSize,D=g.H(Z[0])*this.worldSize,o=D-v<A.y?A.y/(D-v):0}if(this.lngRange){const Z=this.lngRange;S=g.b5(g.G(Z[0])*this.worldSize,0,this.worldSize),E=g.b5(g.G(Z[1])*this.worldSize,0,this.worldSize),E<S&&(E+=this.worldSize),c=E-S<A.x?A.x/(E-S):0}const O=this.point,V=Math.max(c||0,o||0);if(V)return this.center=this.unproject(new g.P(c?(E+S)/2:O.x,o?(D+v)/2:O.y)),this.zoom+=this.scaleZoom(V),this._unmodified=k,void(this._constraining=!1);if(this.latRange){const Z=O.y,G=A.y/2;Z-G<v&&(m=v+G),Z+G>D&&(m=D-G)}if(this.lngRange){const Z=(S+E)/2,G=g.b5(O.x,Z-this.worldSize/2,Z+this.worldSize/2),Y=A.x/2;G-Y<S&&(d=S+Y),G+Y>E&&(d=E-Y)}void 0===d&&void 0===m||(this.center=this.unproject(new g.P(void 0!==d?d:O.x,void 0!==m?m:O.y)).wrap()),this._unmodified=k,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,c=this.point.x,d=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=g.b7(1,this.center.lat)*this.worldSize;let m=g.ao(new Float64Array(16));g.a0(m,m,[this.width/2,-this.height/2,1]),g.$(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=g.ao(new Float64Array(16)),g.a0(m,m,[1,-1,1]),g.$(m,m,[-1,-1,0]),g.a0(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const v=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),D=Math.min(this.elevation,this._minEleveationForCurrentTile),S=v-D*this._pixelPerMeter/Math.cos(this._pitch),E=D<0?S:v,A=Math.PI/2+this._pitch,k=this._fov*(.5+o.y/this.height),O=Math.sin(k)*E/Math.sin(g.ad(Math.PI-A-k,.01,Math.PI-.01)),V=this.getHorizon(),Z=2*Math.atan(V/this.cameraToCenterDistance)*(.5+o.y/(2*V)),G=Math.sin(Z)*E/Math.sin(g.ad(Math.PI-A-Z,.01,Math.PI-.01)),Y=Math.min(O,G),H=1.01*(Math.cos(Math.PI/2-this._pitch)*Y+E),se=this.height/50;m=new Float64Array(16),g.b8(m,this._fov,this.width/this.height,se,H),m[8]=2*-o.x/this.width,m[9]=2*o.y/this.height,g.a0(m,m,[1,-1,1]),g.$(m,m,[0,0,-this.cameraToCenterDistance]),g.b9(m,m,this._pitch),g.ae(m,m,this.angle),g.$(m,m,[-c,-d,0]),this.mercatorMatrix=g.a0([],m,[this.worldSize,this.worldSize,this.worldSize]),g.a0(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=g.a1(new Float64Array(16),this.labelPlaneMatrix,m),g.$(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=g.as([],m),this.pixelMatrix3D=g.a1(new Float64Array(16),this.labelPlaneMatrix,m);const de=this.width%2/2,ee=this.height%2/2,ce=Math.cos(this.angle),me=Math.sin(this.angle),ge=c-Math.round(c)+ce*de+me*ee,be=d-Math.round(d)+ce*ee+me*de,Ee=new Float64Array(m);if(g.$(Ee,Ee,[ge>.5?ge-1:ge,be>.5?be-1:be,0]),this.alignedProjMatrix=Ee,m=g.as(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new g.P(0,0)),c=[o.x*this.worldSize,o.y*this.worldSize,0,1];return g.ag(c,c,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new g.P(0,o))}getCameraQueryGeometry(o){const c=this.getCameraPoint();if(1===o.length)return[o[0],c];{let d=c.x,m=c.y,v=c.x,D=c.y;for(const S of o)d=Math.min(d,S.x),m=Math.min(m,S.y),v=Math.max(v,S.x),D=Math.max(D,S.y);return[new g.P(d,m),new g.P(v,m),new g.P(v,D),new g.P(d,D),new g.P(d,m)]}}}function Yr(y,o){let c,d=!1,m=null,v=null;const D=()=>{m=null,d&&(y.apply(v,c),m=setTimeout(D,o),d=!1)};return(...S)=>(d=!0,v=this,c=S,m||D(),m)}class Lo{constructor(o){this._getCurrentHash=()=>{const c=window.location.hash.replace("#","");if(this._hashName){let d;return c.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(d=m)}),(d&&d[1]||"").split("/")}return c.split("/")},this._onHashChange=()=>{const c=this._getCurrentHash();if(c.length>=3&&!c.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:d,pitch:+(c[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const c=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,c)}catch{}},this._updateHash=Yr(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const c=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,m),D=Math.round(c.lng*v)/v,S=Math.round(c.lat*v)/v,E=this._map.getBearing(),A=this._map.getPitch();let k="";if(k+=o?`/${D}/${S}/${d}`:`${d}/${S}/${D}`,(E||A)&&(k+="/"+Math.round(10*E)/10),A&&(k+=`/${Math.round(A)}`),this._hashName){const O=this._hashName;let V=!1;const Z=window.location.hash.slice(1).split("&").map(G=>{const Y=G.split("=")[0];return Y===O?(V=!0,`${Y}=${k}`):G}).filter(G=>G);return V||Z.push(`${O}=${k}`),`#${Z.join("&")}`}return`#${k}`}}const Us={linearity:.3,easing:g.ba(0,0,.3,1)},Xc=g.e({deceleration:2500,maxSpeed:1400},Us),lc=g.e({deceleration:20,maxSpeed:1400},Us),Yc=g.e({deceleration:1e3,maxSpeed:360},Us),Kc=g.e({deceleration:1e3,maxSpeed:90},Us);class Ta{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:g.h.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,c=g.h.now();for(;o.length>0&&c-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new g.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)c.zoom+=v.zoomDelta||0,c.bearing+=v.bearingDelta||0,c.pitch+=v.pitchDelta||0,v.panDelta&&c.pan._add(v.panDelta),v.around&&(c.around=v.around),v.pinchAround&&(c.pinchAround=v.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(c.pan.mag()){const v=Aa(c.pan.mag(),d,g.e({},Xc,o||{}));m.offset=c.pan.mult(v.amount/c.pan.mag()),m.center=this._map.transform.center,Yi(m,v)}if(c.zoom){const v=Aa(c.zoom,d,lc);m.zoom=this._map.transform.zoom+v.amount,Yi(m,v)}if(c.bearing){const v=Aa(c.bearing,d,Yc);m.bearing=this._map.transform.bearing+g.ad(v.amount,-179,179),Yi(m,v)}if(c.pitch){const v=Aa(c.pitch,d,Kc);m.pitch=this._map.transform.pitch+v.amount,Yi(m,v)}if(m.zoom||m.bearing){const v=void 0===c.pinchAround?c.around:c.pinchAround;m.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),g.e(m,{noMoveStart:!0})}}function Yi(y,o){(!y.duration||y.duration<o.duration)&&(y.duration=o.duration,y.easing=o.easing)}function Aa(y,o,c){const{maxSpeed:d,linearity:m,deceleration:v}=c,D=g.ad(y*m/(o/1e3),-d,d),S=Math.abs(D)/(v*m);return{easing:c.easing,duration:1e3*S,amount:D*(S/2)}}class bi extends g.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,d,m={}){const v=ye.mousePos(c.getCanvasContainer(),d),D=c.unproject(v);super(o,g.e({point:v,lngLat:D,originalEvent:d},m)),this._defaultPrevented=!1,this.target=c}}class Pa extends g.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,d){const m="touchend"===o?d.changedTouches:d.touches,v=ye.touchPos(c.getCanvasContainer(),m),D=v.map(E=>c.unproject(E)),S=v.reduce((E,A,k,O)=>E.add(A.div(O.length)),new g.P(0,0));super(o,{points:v,point:S,lngLats:D,lngLat:c.unproject(S),originalEvent:d}),this._defaultPrevented=!1}}class rh extends g.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,d){super(o,{originalEvent:d}),this._defaultPrevented=!1}}class ih{constructor(o,c){this._map=o,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new rh(o.type,this._map,o))}mousedown(o,c){return this._mousedownPos=c,this._firePreventable(new bi(o.type,this._map,o))}mouseup(o){this._map.fire(new bi(o.type,this._map,o))}click(o,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||this._map.fire(new bi(o.type,this._map,o))}dblclick(o){return this._firePreventable(new bi(o.type,this._map,o))}mouseover(o){this._map.fire(new bi(o.type,this._map,o))}mouseout(o){this._map.fire(new bi(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Pa(o.type,this._map,o))}touchmove(o){this._map.fire(new Pa(o.type,this._map,o))}touchend(o){this._map.fire(new Pa(o.type,this._map,o))}touchcancel(o){this._map.fire(new Pa(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oi{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new bi(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new bi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new bi(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fo{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(g.P.convert(o),this._map.terrain)}}class Qc{constructor(o,c){this._map=o,this._tr=new Fo(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,c){this.isEnabled()&&o.shiftKey&&0===o.button&&(ye.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(o,c){if(!this._active)return;const d=c;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=d,this._box||(this._box=ye.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const v=Math.min(m.x,d.x),D=Math.max(m.x,d.x),S=Math.min(m.y,d.y),E=Math.max(m.y,d.y);ye.setTransform(this._box,`translate(${v}px,${S}px)`),this._box.style.width=D-v+"px",this._box.style.height=E-S+"px"}mouseupWindow(o,c){if(!this._active||0!==o.button)return;const d=this._startPos,m=c;if(this.reset(),ye.suppressClick(),d.x!==m.x||d.y!==m.y)return this._map.fire(new g.k("boxzoomend",{originalEvent:o})),{cameraAnimation:v=>v.fitScreenCoordinates(d,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ye.remove(this._box),this._box=null),ye.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,c){return this._map.fire(new g.k(o,{originalEvent:c}))}}function Li(y,o){if(y.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${o.length}`);const c={};for(let d=0;d<y.length;d++)c[y[d].identifier]=o[d];return c}class No{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,c,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=o.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){const v=new g.P(0,0);for(const D of m)v._add(D);return v.div(m.length)}(c),this.touches=Li(d,c)))}touchmove(o,c,d){if(this.aborted||!this.centroid)return;const m=Li(d,c);for(const v in this.touches){const D=m[v];(!D||D.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(o,c,d){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===d.length){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class cc{constructor(o){this.singleTap=new No(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,c,d){this.singleTap.touchstart(o,c,d)}touchmove(o,c,d){this.singleTap.touchmove(o,c,d)}touchend(o,c,d){const m=this.singleTap.touchend(o,c,d);if(m){const v=o.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(m)<30;if(v&&D||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class zo{constructor(o){this._tr=new Fo(o),this._zoomIn=new cc({numTouches:1,numTaps:2}),this._zoomOut=new cc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,c,d){this._zoomIn.touchstart(o,c,d),this._zoomOut.touchstart(o,c,d)}touchmove(o,c,d){this._zoomIn.touchmove(o,c,d),this._zoomOut.touchmove(o,c,d)}touchend(o,c,d){const m=this._zoomIn.touchend(o,c,d),v=this._zoomOut.touchend(o,c,d),D=this._tr;return m?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:D.zoom+1,around:D.unproject(m)},{originalEvent:o})}):v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:D.zoom-1,around:D.unproject(v)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class go{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const c=this._moveFunction(...o);if(c.bearingDelta||c.pitchDelta||c.around||c.panDelta)return this._active=!0,c}dragStart(o,c){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=c.length?c[0]:c,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,c){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const m=c.length?c[0]:c;return!this._moved&&m.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(d,m))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&ye.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ld={0:1,2:2};class Jc{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const c=ye.mouseButton(o);this._eventButton=c}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(c,d){const m=Ld[d];return void 0===c.buttons||(c.buttons&m)!==m}(o,this._eventButton)}isValidEndEvent(o){return ye.mouseButton(o)===this._eventButton}}class oh{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return 1===o.targetTouches.length}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const ls=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(o){o.preventDefault()}},ka=({enable:y,clickTolerance:o,bearingDegreesPerPixelMoved:c=.8})=>{const d=new Jc({checkCorrectEvent:m=>0===ye.mouseButton(m)&&m.ctrlKey||2===ye.mouseButton(m)});return new go({clickTolerance:o,move:(m,v)=>({bearingDelta:(v.x-m.x)*c}),moveStateManager:d,enable:y,assignEvents:ls})},Bo=({enable:y,clickTolerance:o,pitchDegreesPerPixelMoved:c=-.5})=>{const d=new Jc({checkCorrectEvent:m=>0===ye.mouseButton(m)&&m.ctrlKey||2===ye.mouseButton(m)});return new go({clickTolerance:o,move:(m,v)=>({pitchDelta:(v.y-m.y)*c}),moveStateManager:d,enable:y,assignEvents:ls})};class qe{constructor(o,c){this._minTouches=o.cooperativeGestures?2:1,this._clickTolerance=o.clickTolerance||1,this._map=c,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new g.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(o,c,d){return this._calculateTransform(o,c,d)}touchmove(o,c,d){if(this._map._cooperativeGestures&&(2===this._minTouches&&d.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(o,!1,d.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(d.length<this._minTouches))return o.preventDefault(),this._calculateTransform(o,c,d)}touchend(o,c,d){this._calculateTransform(o,c,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,c,d){d.length>0&&(this._active=!0);const m=Li(d,c),v=new g.P(0,0),D=new g.P(0,0);let S=0;for(const A in m){const k=m[A],O=this._touches[A];O&&(v._add(k),D._add(k.sub(O)),S++,m[A]=k)}if(this._touches=m,S<this._minTouches||!D.mag())return;const E=D.div(S);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(S),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ki{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,c,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([c[0],c[1]]))}touchmove(o,c,d){if(!this._firstTwoTouches)return;o.preventDefault();const[m,v]=this._firstTwoTouches,D=cs(d,c,m),S=cs(d,c,v);if(!D||!S)return;const E=this._aroundCenter?null:D.add(S).div(2);return this._move([D,S],E,o)}touchend(o,c,d){if(!this._firstTwoTouches)return;const[m,v]=this._firstTwoTouches,D=cs(d,c,m),S=cs(d,c,v);D&&S||(this._active&&ye.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function cs(y,o,c){for(let d=0;d<y.length;d++)if(y[d].identifier===c)return o[d]}function Hs(y,o){return Math.log(y/o)/Math.LN2}class Lr extends Ki{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,c){const d=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Hs(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Hs(this._distance,d),pinchAround:c}}}function Oe(y,o){return 180*y.angleWith(o)/Math.PI}class $t extends Ki{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,c){const d=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Oe(this._vector,d),pinchAround:c}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const c=25/(Math.PI*this._minDiameter)*360,d=Oe(o,this._startVector);return Math.abs(d)<c}}function or(y){return Math.abs(y.y)>Math.abs(y.x)}class Kr extends Ki{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,c,d){super.touchstart(o,c,d),this._currentTouchCount=d.length}_start(o){this._lastPoints=o,or(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,c,d){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const m=o[0].sub(this._lastPoints[0]),v=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,v,d.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(m.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(o,c,d){if(void 0!==this._valid)return this._valid;const m=o.mag()>=2,v=c.mag()>=2;if(!m&&!v)return;if(!m||!v)return void 0===this._firstMove&&(this._firstMove=d),d-this._firstMove<100&&void 0;const D=o.y>0==c.y>0;return or(o)&&or(c)&&D}}const us={panStep:100,bearingStep:15,pitchStep:10};class ci{constructor(o){this._tr=new Fo(o);const c=us;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let c=0,d=0,m=0,v=0,D=0;switch(o.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:o.shiftKey?d=-1:(o.preventDefault(),v=-1);break;case 39:o.shiftKey?d=1:(o.preventDefault(),v=1);break;case 38:o.shiftKey?m=1:(o.preventDefault(),D=-1);break;case 40:o.shiftKey?m=-1:(o.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:S=>{const E=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:eu,zoom:c?Math.round(E.zoom)+c*(o.shiftKey?2:1):E.zoom,bearing:E.bearing+d*this._bearingStep,pitch:E.pitch+m*this._pitchStep,offset:[-v*this._panStep,-D*this._panStep],center:E.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function eu(y){return y*(2-y)}const tu=4.000244140625;class uc{constructor(o,c){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=o,this._tr=new Fo(o),this._el=o.getCanvasContainer(),this._triggerRenderFrame=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!o[this._map._metaKey])return;o.preventDefault()}let c=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const d=g.h.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,0!==c&&c%tu==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(m*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),o.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=o,this._delta-=c,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=ye.mousePos(this._el,o),d=this._tr;this._around=g.L.convert(this._aroundCenter?d.center:d.unproject(c)),this._aroundPoint=d.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(0!==this._delta){const S="wheel"===this._type&&Math.abs(this._delta)>tu?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&0!==E&&(E=1/E);const A="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(A*E))),"wheel"===this._type&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const c="number"==typeof this._targetZoom?this._targetZoom:o.zoom,d=this._startZoom,m=this._easing;let v,D=!1;if("wheel"===this._type&&d&&m){const S=Math.min((g.h.now()-this._lastWheelEventTime)/200,1),E=m(S);v=g.B.number(d,c,E),S<1?this._frameId||(this._frameId=!0):D=!0}else v=c,D=!0;return this._active=!0,D&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!D,zoomDelta:v-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let c=g.bb;if(this._prevEase){const d=this._prevEase,m=(g.h.now()-d.start)/d.duration,v=d.easing(m+.01)-d.easing(m),D=.27/Math.sqrt(v*v+1e-4)*.01,S=Math.sqrt(.0729-D*D);c=g.ba(D,S,.25,1)}return this._prevEase={start:g.h.now(),duration:o,easing:c},c}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class nu{constructor(o,c){this._clickZoom=o,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ru{constructor(o){this._tr=new Fo(o),this.reset()}reset(){this._active=!1}dblclick(o,c){return o.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(c)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tn{constructor(){this._tap=new cc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,c,d){if(!this._swipePoint)if(this._tapTime){const m=c[0],v=o.timeStamp-this._tapTime<500,D=this._tapPoint.dist(m)<30;v&&D?d.length>0&&(this._swipePoint=m,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(o,c,d)}touchmove(o,c,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const m=c[0],v=m.y-this._swipePoint.y;return this._swipePoint=m,o.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(o,c,d)}touchend(o,c,d){if(this._tapTime)this._swipePoint&&0===d.length&&this.reset();else{const m=this._tap.touchend(o,c,d);m&&(this._tapTime=o.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ge{constructor(o,c,d){this._el=o,this._mousePan=c,this._touchPan=d}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class at{constructor(o,c,d){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=c,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class en{constructor(o,c,d,m){this._el=o,this._touchZoom=c,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Qr=y=>y.zoom||y.drag||y.pitch||y.rotate;class qs extends g.k{}function Kn(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class hs{constructor(o,c){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,v)=>{if("blur"===m.type)return void this.stop(!0);this._updatingCamera=!0;const D="renderFrame"===m.type?void 0:m,S={needsRenderFrame:!1},E={},A={},k=m.touches,O=k?this._getMapTouches(k):void 0,V=O?ye.touchPos(this._el,O):ye.mousePos(this._el,m);for(const{handlerName:Y,handler:H,allowed:se}of this._handlers){if(!H.isEnabled())continue;let de;this._blockedByActive(A,se,Y)?H.reset():H[v||m.type]&&(de=H[v||m.type](m,V,O),this.mergeHandlerResult(S,E,de,Y,D),de&&de.needsRenderFrame&&this._triggerRenderFrame()),(de||H.isActive())&&(A[Y]=H)}const Z={};for(const Y in this._previousActiveHandlers)A[Y]||(Z[Y]=D);this._previousActiveHandlers=A,(Object.keys(Z).length||Kn(S))&&(this._changes.push([S,E,Z]),this._triggerRenderFrame()),(Object.keys(A).length||Kn(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=S;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ta(o),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(c);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,v,D]of this._listeners)ye.addEventListener(m,v,m===document?this.handleWindowEvent:this.handleEvent,D)}destroy(){for(const[o,c,d]of this._listeners)ye.removeEventListener(o,c,o===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(o){const c=this._map,d=c.getCanvasContainer();this._add("mapEvent",new ih(c,o));const m=c.boxZoom=new Qc(c,o);this._add("boxZoom",m),o.interactive&&o.boxZoom&&m.enable();const v=new zo(c),D=new ru(c);c.doubleClickZoom=new nu(D,v),this._add("tapZoom",v),this._add("clickZoom",D),o.interactive&&o.doubleClickZoom&&c.doubleClickZoom.enable();const S=new Tn;this._add("tapDragZoom",S);const E=c.touchPitch=new Kr(c);this._add("touchPitch",E),o.interactive&&o.touchPitch&&c.touchPitch.enable(o.touchPitch);const A=ka(o),k=Bo(o);c.dragRotate=new at(o,A,k),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]),o.interactive&&o.dragRotate&&c.dragRotate.enable();const O=(({enable:se,clickTolerance:de})=>{const ee=new Jc({checkCorrectEvent:ce=>0===ye.mouseButton(ce)&&!ce.ctrlKey});return new go({clickTolerance:de,move:(ce,me)=>({around:me,panDelta:me.sub(ce)}),activateOnStart:!0,moveStateManager:ee,enable:se,assignEvents:ls})})(o),V=new qe(o,c);c.dragPan=new Ge(d,O,V),this._add("mousePan",O),this._add("touchPan",V,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&c.dragPan.enable(o.dragPan);const Z=new $t,G=new Lr;c.touchZoomRotate=new en(d,G,Z,S),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&c.touchZoomRotate.enable(o.touchZoomRotate);const Y=c.scrollZoom=new uc(c,()=>this._triggerRenderFrame());this._add("scrollZoom",Y,["mousePan"]),o.interactive&&o.scrollZoom&&c.scrollZoom.enable(o.scrollZoom);const H=c.keyboard=new ci(c);this._add("keyboard",H),o.interactive&&o.keyboard&&c.keyboard.enable(),this._add("blockableMapEvent",new Oi(c))}_add(o,c,d){this._handlers.push({handlerName:o,handler:c,allowed:d}),this._handlersById[o]=c}stop(o){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Qr(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,c,d){for(const m in o)if(m!==d&&(!c||c.indexOf(m)<0))return!0;return!1}_getMapTouches(o){const c=[];for(const d of o)this._el.contains(d.target)&&c.push(d);return c}mergeHandlerResult(o,c,d,m,v){if(!d)return;g.e(o,d);const D={handlerName:m,originalEvent:d.originalEvent||v};void 0!==d.zoomDelta&&(c.zoom=D),void 0!==d.panDelta&&(c.drag=D),void 0!==d.pitchDelta&&(c.pitch=D),void 0!==d.bearingDelta&&(c.rotate=D)}_applyChanges(){const o={},c={},d={};for(const[m,v,D]of this._changes)m.panDelta&&(o.panDelta=(o.panDelta||new g.P(0,0))._add(m.panDelta)),m.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+m.pitchDelta),void 0!==m.around&&(o.around=m.around),void 0!==m.pinchAround&&(o.pinchAround=m.pinchAround),m.noInertia&&(o.noInertia=m.noInertia),g.e(c,v),g.e(d,D);this._updateMapTransform(o,c,d),this._changes=[]}_updateMapTransform(o,c,d){const m=this._map,v=m._getTransformForUpdate(),D=m.terrain;if(!(Kn(o)||D&&this._terrainMovement))return this._fireEvents(c,d,!0);let{panDelta:S,zoomDelta:E,bearingDelta:A,pitchDelta:k,around:O,pinchAround:V}=o;void 0!==V&&(O=V),m._stop(!0),O=O||m.transform.centerPoint;const Z=v.pointLocation(S?O.sub(S):O);A&&(v.bearing+=A),k&&(v.pitch+=k),E&&(v.zoom+=E),D?this._terrainMovement||!c.drag&&!c.zoom?c.drag&&this._terrainMovement?v.center=v.pointLocation(v.centerPoint.sub(S)):v.setLocationAtPoint(Z,O):(this._terrainMovement=!0,this._map._elevationFreeze=!0,v.setLocationAtPoint(Z,O),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,v.recalculateZoom(m.terrain)})):v.setLocationAtPoint(Z,O),m._applyUpdatedTransform(v),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(c,d,!0)}_fireEvents(o,c,d){const m=Qr(this._eventsInProgress),v=Qr(o),D={};for(const k in o){const{originalEvent:O}=o[k];this._eventsInProgress[k]||(D[`${k}start`]=O),this._eventsInProgress[k]=o[k]}!m&&v&&this._fireEvent("movestart",v.originalEvent);for(const k in D)this._fireEvent(k,D[k]);v&&this._fireEvent("move",v.originalEvent);for(const k in o){const{originalEvent:O}=o[k];this._fireEvent(k,O)}const S={};let E;for(const k in this._eventsInProgress){const{handlerName:O,originalEvent:V}=this._eventsInProgress[k];this._handlersById[O].isActive()||(delete this._eventsInProgress[k],E=c[O]||V,S[`${k}end`]=E)}for(const k in S)this._fireEvent(k,S[k]);const A=Qr(this._eventsInProgress);if(d&&(m||v)&&!A){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=V=>0!==V&&-this._bearingSnap<V&&V<this._bearingSnap;!k||!k.essential&&g.h.prefersReducedMotion?(this._map.fire(new g.k("moveend",{originalEvent:E})),O(this._map.getBearing())&&this._map.resetNorth()):(O(k.bearing||this._map.getBearing())&&(k.bearing=0),k.freezeElevation=!0,this._map.easeTo(k,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(o,c){this._map.fire(new g.k(o,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new qs("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Vn extends g.E{constructor(o,c){super(),this._renderFrameCallback=()=>{const d=Math.min((g.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=c.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new g.L(this.transform.center.lng,this.transform.center.lat)}setCenter(o,c){return this.jumpTo({center:o},c)}panBy(o,c,d){return o=g.P.convert(o).mult(-1),this.panTo(this.transform.center,g.e({offset:o},c),d)}panTo(o,c,d){return this.easeTo(g.e({center:o},c),d)}getZoom(){return this.transform.zoom}setZoom(o,c){return this.jumpTo({zoom:o},c),this}zoomTo(o,c,d){return this.easeTo(g.e({zoom:o},c),d)}zoomIn(o,c){return this.zoomTo(this.getZoom()+1,o,c),this}zoomOut(o,c){return this.zoomTo(this.getZoom()-1,o,c),this}getBearing(){return this.transform.bearing}setBearing(o,c){return this.jumpTo({bearing:o},c),this}getPadding(){return this.transform.padding}setPadding(o,c){return this.jumpTo({padding:o},c),this}rotateTo(o,c,d){return this.easeTo(g.e({bearing:o},c),d)}resetNorth(o,c){return this.rotateTo(0,g.e({duration:1e3},o),c),this}resetNorthPitch(o,c){return this.easeTo(g.e({bearing:0,pitch:0,duration:1e3},o),c),this}snapToNorth(o,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,c):this}getPitch(){return this.transform.pitch}setPitch(o,c){return this.jumpTo({pitch:o},c),this}cameraForBounds(o,c){o=yn.convert(o);const d=c&&c.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),d,c)}_cameraForBoxAndBearing(o,c,d,m){const v={top:0,bottom:0,right:0,left:0};if("number"==typeof(m=g.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding){const me=m.padding;m.padding={top:me,bottom:me,right:me,left:me}}m.padding=g.e(v,m.padding);const D=this.transform,S=D.padding,E=D.project(g.L.convert(o)),A=D.project(g.L.convert(c)),k=E.rotate(-d*Math.PI/180),O=A.rotate(-d*Math.PI/180),V=new g.P(Math.max(k.x,O.x),Math.max(k.y,O.y)),Z=new g.P(Math.min(k.x,O.x),Math.min(k.y,O.y)),G=V.sub(Z),Y=(D.width-(S.left+S.right+m.padding.left+m.padding.right))/G.x,H=(D.height-(S.top+S.bottom+m.padding.top+m.padding.bottom))/G.y;if(H<0||Y<0)return void g.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const se=Math.min(D.scaleZoom(D.scale*Math.min(Y,H)),m.maxZoom),de=g.P.convert(m.offset),ee=new g.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(d*Math.PI/180),ce=de.add(ee).mult(D.scale/D.zoomScale(se));return{center:D.unproject(E.add(A).div(2).sub(ce)),zoom:se,bearing:d}}fitBounds(o,c,d){return this._fitInternal(this.cameraForBounds(o,c),c,d)}fitScreenCoordinates(o,c,d,m,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(g.P.convert(o)),this.transform.pointLocation(g.P.convert(c)),d,m),m,v)}_fitInternal(o,c,d){return o?(delete(c=g.e(o,c)).padding,c.linear?this.easeTo(c,d):this.flyTo(c,d)):this}jumpTo(o,c){this.stop();const d=this._getTransformForUpdate();let m=!1,v=!1,D=!1;return"zoom"in o&&d.zoom!==+o.zoom&&(m=!0,d.zoom=+o.zoom),void 0!==o.center&&(d.center=g.L.convert(o.center)),"bearing"in o&&d.bearing!==+o.bearing&&(v=!0,d.bearing=+o.bearing),"pitch"in o&&d.pitch!==+o.pitch&&(D=!0,d.pitch=+o.pitch),null==o.padding||d.isPaddingEqual(o.padding)||(d.padding=o.padding),this._applyUpdatedTransform(d),this.fire(new g.k("movestart",c)).fire(new g.k("move",c)),m&&this.fire(new g.k("zoomstart",c)).fire(new g.k("zoom",c)).fire(new g.k("zoomend",c)),v&&this.fire(new g.k("rotatestart",c)).fire(new g.k("rotate",c)).fire(new g.k("rotateend",c)),D&&this.fire(new g.k("pitchstart",c)).fire(new g.k("pitch",c)).fire(new g.k("pitchend",c)),this.fire(new g.k("moveend",c))}calculateCameraOptionsFromTo(o,c,d,m=0){const v=g.U.fromLngLat(o,c),D=g.U.fromLngLat(d,m),S=D.x-v.x,E=D.y-v.y,A=D.z-v.z,k=Math.hypot(S,E,A);if(0===k)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(S,E),V=this.transform.scaleZoom(this.transform.cameraToCenterDistance/k/this.transform.tileSize),Z=180*Math.atan2(S,-E)/Math.PI;let G=180*Math.acos(O/k)/Math.PI;return G=A<0?90-G:90+G,{center:D.toLngLat(),zoom:V,pitch:G,bearing:Z}}easeTo(o,c){this._stop(!1,o.easeId),(!1===(o=g.e({offset:[0,0],duration:500,easing:g.bb},o)).animate||!o.essential&&g.h.prefersReducedMotion)&&(o.duration=0);const d=this._getTransformForUpdate(),m=this.getZoom(),v=this.getBearing(),D=this.getPitch(),S=this.getPadding(),E="zoom"in o?+o.zoom:m,A="bearing"in o?this._normalizeBearing(o.bearing,v):v,k="pitch"in o?+o.pitch:D,O="padding"in o?o.padding:d.padding,V=g.P.convert(o.offset);let Z=d.centerPoint.add(V);const G=d.pointLocation(Z),Y=g.L.convert(o.center||G);this._normalizeCenter(Y);const H=d.project(G),se=d.project(Y).sub(H),de=d.zoomScale(E-m);let ee,ce;o.around&&(ee=g.L.convert(o.around),ce=d.locationPoint(ee));const me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||E!==m,this._rotating=this._rotating||v!==A,this._pitching=this._pitching||k!==D,this._padding=!d.isPaddingEqual(O),this._easeId=o.easeId,this._prepareEase(c,o.noMoveStart,me),this.terrain&&this._prepareElevation(Y),this._ease(ge=>{if(this._zooming&&(d.zoom=g.B.number(m,E,ge)),this._rotating&&(d.bearing=g.B.number(v,A,ge)),this._pitching&&(d.pitch=g.B.number(D,k,ge)),this._padding&&(d.interpolatePadding(S,O,ge),Z=d.centerPoint.add(V)),this.terrain&&!o.freezeElevation&&this._updateElevation(ge),ee)d.setLocationAtPoint(ee,ce);else{const be=d.zoomScale(d.zoom-m),Ee=E>m?Math.min(2,de):Math.max(.5,de),Ie=Math.pow(Ee,1-ge),Re=d.unproject(H.add(se.mult(ge*Ie)).mult(be));d.setLocationAtPoint(d.renderWorldCopies?Re.wrap():Re,Z)}this._applyUpdatedTransform(d),this._fireMoveEvents(c)},ge=>{this.terrain&&this._finalizeElevation(),this._afterEase(c,ge)},o),this}_prepareEase(o,c,d={}){this._moving=!0,c||d.moving||this.fire(new g.k("movestart",o)),this._zooming&&!d.zooming&&this.fire(new g.k("zoomstart",o)),this._rotating&&!d.rotating&&this.fire(new g.k("rotatestart",o)),this._pitching&&!d.pitching&&this.fire(new g.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const c=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&c!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(d-(c-(d*o+this._elevationStart))/(1-o)),this._elevationTarget=c}this.transform.elevation=g.B.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(o){if(!this.transformCameraUpdate)return;const c=o.clone(),{center:d,zoom:m,pitch:v,bearing:D,elevation:S}=this.transformCameraUpdate(c);d&&(c.center=d),void 0!==m&&(c.zoom=m),void 0!==v&&(c.pitch=v),void 0!==D&&(c.bearing=D),void 0!==S&&(c.elevation=S),this.transform.apply(c)}_fireMoveEvents(o){this.fire(new g.k("move",o)),this._zooming&&this.fire(new g.k("zoom",o)),this._rotating&&this.fire(new g.k("rotate",o)),this._pitching&&this.fire(new g.k("pitch",o))}_afterEase(o,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId;const d=this._zooming,m=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new g.k("zoomend",o)),m&&this.fire(new g.k("rotateend",o)),v&&this.fire(new g.k("pitchend",o)),this.fire(new g.k("moveend",o))}flyTo(o,c){if(!o.essential&&g.h.prefersReducedMotion){const Qe=g.F(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Qe,c)}this.stop(),o=g.e({offset:[0,0],speed:1.2,curve:1.42,easing:g.bb},o);const d=this._getTransformForUpdate(),m=this.getZoom(),v=this.getBearing(),D=this.getPitch(),S=this.getPadding(),E="zoom"in o?g.ad(+o.zoom,d.minZoom,d.maxZoom):m,A="bearing"in o?this._normalizeBearing(o.bearing,v):v,k="pitch"in o?+o.pitch:D,O="padding"in o?o.padding:d.padding,V=d.zoomScale(E-m),Z=g.P.convert(o.offset);let G=d.centerPoint.add(Z);const Y=d.pointLocation(G),H=g.L.convert(o.center||Y);this._normalizeCenter(H);const se=d.project(Y),de=d.project(H).sub(se);let ee=o.curve;const ce=Math.max(d.width,d.height),me=ce/V,ge=de.mag();if("minZoom"in o){const Qe=g.ad(Math.min(o.minZoom,m,E),d.minZoom,d.maxZoom),nn=ce/d.zoomScale(Qe-m);ee=Math.sqrt(nn/ge*2)}const be=ee*ee;function Ee(Qe){const nn=(me*me-ce*ce+(Qe?-1:1)*be*be*ge*ge)/(2*(Qe?me:ce)*be*ge);return Math.log(Math.sqrt(nn*nn+1)-nn)}function Ie(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function Re(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const $e=Ee(!1);let Tt=function(Qe){return Re($e)/Re($e+ee*Qe)},ke=function(Qe){return ce*((Re($e)*(Ie(nn=$e+ee*Qe)/Re(nn))-Ie($e))/be)/ge;var nn},it=(Ee(!0)-$e)/ee;if(Math.abs(ge)<1e-6||!isFinite(it)){if(Math.abs(ce-me)<1e-6)return this.easeTo(o,c);const Qe=me<ce?-1:1;it=Math.abs(Math.log(me/ce))/ee,ke=function(){return 0},Tt=function(nn){return Math.exp(Qe*ee*nn)}}return o.duration="duration"in o?+o.duration:1e3*it/("screenSpeed"in o?+o.screenSpeed/ee:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=v!==A,this._pitching=k!==D,this._padding=!d.isPaddingEqual(O),this._prepareEase(c,!1),this.terrain&&this._prepareElevation(H),this._ease(Qe=>{const nn=Qe*it,At=1/Tt(nn);d.zoom=1===Qe?E:m+d.scaleZoom(At),this._rotating&&(d.bearing=g.B.number(v,A,Qe)),this._pitching&&(d.pitch=g.B.number(D,k,Qe)),this._padding&&(d.interpolatePadding(S,O,Qe),G=d.centerPoint.add(Z)),this.terrain&&!o.freezeElevation&&this._updateElevation(Qe);const bt=1===Qe?H:d.unproject(se.add(de.mult(ke(nn))).mult(At));d.setLocationAtPoint(d.renderWorldCopies?bt.wrap():bt,G),this._applyUpdatedTransform(d),this._fireMoveEvents(c)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(c)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,c)}if(!o){const d=this.handlers;d&&d.stop(!1)}return this}_ease(o,c,d){!1===d.animate||0===d.duration?(o(1),c()):(this._easeStart=g.h.now(),this._easeOptions=d,this._onEaseFrame=o,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,c){o=g.b5(o,-180,180);const d=Math.abs(o-c);return Math.abs(o-360-c)<d&&(o-=360),Math.abs(o+360-c)<d&&(o+=360),o}_normalizeCenter(o){const c=this.transform;if(!c.renderWorldCopies||c.lngRange)return;const d=o.lng-c.center.lng;o.lng+=d>180?-360:d<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(g.L.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}class Qn{constructor(o={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=c=>{!c||"metadata"!==c.sourceDataType&&"visibility"!==c.sourceDataType&&"style"!==c.dataType&&"terrain"!==c.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options&&this.options.compact,this._container=ye.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ye.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ye.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ye.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,c){const d=this._map._getUIString(`AttributionControl.${c}`);o.title=d,o.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(m=>"string"!=typeof m?"":m)):"string"==typeof this.options.customAttribution&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const c=this._map.style.sourceCaches;for(const m in c){const v=c[m];if(v.used||v.usedForTerrain){const D=v.getSource();D.attribution&&o.indexOf(D.attribution)<0&&o.push(D.attribution)}}o=o.filter(m=>String(m).trim()),o.sort((m,v)=>m.length-v.length),o=o.filter((m,v)=>{for(let D=v+1;D<o.length;D++)if(o[D].indexOf(m)>=0)return!1;return!0});const d=o.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,o.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class tn{constructor(o={}){this._updateCompact=()=>{const c=this._container.children;if(c.length){const d=c[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=ye.create("div","maplibregl-ctrl");const c=ye.create("a","maplibregl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://maplibre.org/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ye.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class vt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const c=++this._id;return this._queue.push({callback:o,id:c,cancelled:!1}),c}remove(o){const c=this._currentlyRunning,d=c?this._queue.concat(c):this._queue;for(const m of d)if(m.id===o)return void(m.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const c=this._currentlyRunning=this._queue;this._queue=[];for(const d of c)if(!d.cancelled&&(d.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Gs={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var iu=g.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Zs extends g.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,c){this.sourceCache.update(o,c),this._renderableTilesKeys=[];const d={};for(const m of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:c}))d[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),g.aS(m.posMatrix,0,g.N,0,g.N,0,1),this._tiles[m.key]=new Rs(m,this.tileSize));for(const m in this._tiles)d[m]||delete this._tiles[m]}freeRtt(o){for(const c in this._tiles){const d=this._tiles[c];(!o||d.tileID.equals(o)||d.tileID.isChildOf(o)||o.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const c={};for(const d of this._renderableTilesKeys){const m=this._tiles[d].tileID;if(m.canonical.equals(o.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16),g.aS(v.posMatrix,0,g.N,0,g.N,0,1),c[d]=v}else if(m.canonical.isChildOf(o.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16);const D=m.canonical.z-o.canonical.z,S=m.canonical.x-(m.canonical.x>>D<<D),E=m.canonical.y-(m.canonical.y>>D<<D),A=g.N>>D;g.aS(v.posMatrix,0,A,0,A,0,1),g.$(v.posMatrix,v.posMatrix,[-S*A,-E*A,0]),c[d]=v}else if(o.canonical.isChildOf(m.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16);const D=o.canonical.z-m.canonical.z,S=o.canonical.x-(o.canonical.x>>D<<D),E=o.canonical.y-(o.canonical.y>>D<<D),A=g.N>>D;g.aS(v.posMatrix,0,g.N,0,g.N,0,1),g.$(v.posMatrix,v.posMatrix,[S*A,E*A,0]),g.a0(v.posMatrix,v.posMatrix,[1/2**D,1/2**D,0]),c[d]=v}}return c}getSourceTile(o,c){const d=this.sourceCache._source;let m=o.overscaledZ-this.deltaZoom;if(m>d.maxzoom&&(m=d.maxzoom),m<d.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(m).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!v||!v.dem)&&c)for(;m>=d.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(o.scaledTo(m--).key);return v}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(c=>c.timeAdded>=o)}}class jn{constructor(o,c,d){this.painter=o,this.sourceCache=new Zs(c),this.options=d,this.exaggeration="number"==typeof d.exaggeration?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,c,d,m=g.N){var v;if(!(c>=0&&c<m&&d>=0&&d<m))return 0;const D=this.getTerrainData(o),S=null===(v=D.tile)||void 0===v?void 0:v.dem;if(!S)return 0;const E=((G=[])[0]=(H=D.u_terrain_matrix)[0]*(se=(Y=[c/m*g.N,d/m*g.N])[0])+H[4]*(de=Y[1])+H[12],G[1]=H[1]*se+H[5]*de+H[13],G),A=[E[0]*S.dim,E[1]*S.dim],k=Math.floor(A[0]),O=Math.floor(A[1]),V=A[0]-k,Z=A[1]-O;var G,Y,H,se,de;return S.get(k,O)*(1-V)*(1-Z)+S.get(k+1,O)*V*(1-Z)+S.get(k,O+1)*(1-V)*Z+S.get(k+1,O+1)*V*Z}getElevationForLngLatZoom(o,c){const{tileID:d,mercatorX:m,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(o,c);return this.getElevation(d,m%g.N,v%g.N,g.N)}getElevation(o,c,d,m=g.N){return this.getDEMElevation(o,c,d,m)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const m=this.painter.context,v=new g.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new In(m,v,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new In(m,new g.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=g.ao([])}const c=this.sourceCache.getSourceTile(o,!0);if(c&&c.dem&&(!c.demTexture||c.needsTerrainPrepare)){const m=this.painter.context;c.demTexture=this.painter.getTileTexture(c.dem.stride),c.demTexture?c.demTexture.update(c.dem.getPixels(),{premultiply:!1}):c.demTexture=new In(m,c.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),c.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),c.needsTerrainPrepare=!1}const d=c&&c+c.tileID.key+o.key;if(d&&!this._demMatrixCache[d]){const m=this.sourceCache.sourceCache._source.maxzoom;let v=o.canonical.z-c.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=m?v=o.canonical.z-m:g.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const D=o.canonical.x-(o.canonical.x>>v<<v),S=o.canonical.y-(o.canonical.y>>v<<v),E=g.bc(new Float64Array(16),[1/(g.N<<v),1/(g.N<<v),0]);g.$(E,E,[D*g.N,S*g.N,0]),this._demMatrixCache[o.key]={matrix:E,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:c&&c.dem&&c.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:c&&c.dem&&c.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(c&&c.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:c}}getFramebuffer(o){const c=this.painter,d=c.width/devicePixelRatio,m=c.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new In(c.context,{width:d,height:m,data:null},c.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(c.context.gl.NEAREST,c.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new In(c.context,{width:d,height:m,data:null},c.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(c.context.gl.NEAREST,c.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=c.context.createFramebuffer(d,m,!0,!1),this._fbo.depthAttachment.set(c.context.createRenderbuffer(c.context.gl.DEPTH_COMPONENT16,d,m))),this._fbo.colorAttachment.set("coords"===o?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const c=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,D=0;v<this._coordsTextureSize;v++)for(let S=0;S<this._coordsTextureSize;S++,D+=4)c[D+0]=255&S,c[D+1]=255&v,c[D+2]=S>>8<<4|v>>8,c[D+3]=0;const d=new g.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(c.buffer)),m=new In(o,d,o.gl.RGBA,{premultiply:!1});return m.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(o){const c=new Uint8Array(4),d=this.painter.context,m=d.gl;d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,c),d.bindFramebuffer.set(null);const v=c[0]+(c[2]>>4<<8),D=c[1]+((15&c[2])<<8),S=this.coordsIndex[255-c[3]],E=S&&this.sourceCache.getTileByID(S);if(!E)return null;const A=this._coordsTextureSize,k=(1<<E.tileID.canonical.z)*A;return new g.U((E.tileID.canonical.x*A+v)/k,(E.tileID.canonical.y*A+D)/k,this.getElevation(E.tileID,v,D,A))}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,c=new g.bd,d=new g.b0,m=this.meshSize,v=g.N/m,D=m*m;for(let O=0;O<=m;O++)for(let V=0;V<=m;V++)c.emplaceBack(V*v,O*v,0);for(let O=0;O<D;O+=m+1)for(let V=0;V<m;V++)d.emplaceBack(V+O,m+V+O+1,m+V+O+2),d.emplaceBack(V+O,m+V+O+2,V+O+1);const S=c.length,E=S+2*(m+1);for(const O of[0,1])for(let V=0;V<=m;V++)for(const Z of[0,1])c.emplaceBack(V*v,O*g.N,Z);for(let O=0;O<2*m;O+=2)d.emplaceBack(E+O,E+O+1,E+O+3),d.emplaceBack(E+O,E+O+3,E+O+2),d.emplaceBack(S+O,S+O+3,S+O+1),d.emplaceBack(S+O,S+O+2,S+O+3);const A=c.length,k=A+2*(m+1);for(const O of[0,1])for(let V=0;V<=m;V++)for(const Z of[0,1])c.emplaceBack(O*g.N,V*v,Z);for(let O=0;O<2*m;O+=2)d.emplaceBack(A+O,A+O+1,A+O+3),d.emplaceBack(A+O,A+O+3,A+O+2),d.emplaceBack(k+O,k+O+3,k+O+1),d.emplaceBack(k+O,k+O+2,k+O+3);return this._mesh={indexBuffer:o.createIndexBuffer(d),vertexBuffer:o.createVertexBuffer(c,iu.members),segments:g.S.simpleSegment(0,0,c.length,d.length)},this._mesh}getMeshFrameDelta(o){return 2*Math.PI*g.be/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,c){var d;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(o,c);return null!==(d=this.getMinMaxElevation(m).minElevation)&&void 0!==d?d:0}getMinMaxElevation(o){const c=this.getTerrainData(o).tile,d={minElevation:null,maxElevation:null};return c&&c.dem&&(d.minElevation=c.dem.min*this.exaggeration,d.maxElevation=c.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(o,c){const d=g.U.fromLngLat(o.wrap()),m=(1<<c)*g.N,v=d.x*m,D=d.y*m,S=Math.floor(v/g.N),E=Math.floor(D/g.N);return{tileID:new g.O(c,0,c,S,E),mercatorX:v,mercatorY:D}}}class _l{constructor(o,c,d){this._context=o,this._size=c,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const c=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new In(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),c.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),c.colorAttachment.set(d.texture),{id:o,fbo:c,texture:d,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(c=>o.id!==c),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const c of this._recentlyUsed)if(!this._objects[c].inUse)return this._objects[c];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some(o=>!o.inUse)}}const Jn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class wi{constructor(o,c){this.painter=o,this.terrain=c,this.pool=new _l(o.context,30,c.sourceCache.tileSize*c.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,c){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(d=>!o._layers[d].isHidden(c)),this._coordsDescendingInv={};for(const d in o.sourceCaches){this._coordsDescendingInv[d]={};const m=o.sourceCaches[d].getVisibleCoordinates();for(const v of m){const D=this.terrain.sourceCache.getTerrainCoords(v);for(const S in D)this._coordsDescendingInv[d][S]||(this._coordsDescendingInv[d][S]=[]),this._coordsDescendingInv[d][S].push(D[S])}}this._coordsDescendingInvStr={};for(const d of o._order){const m=o._layers[d],v=m.source;if(Jn[m.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const D in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][D]=this._coordsDescendingInv[v][D].map(S=>S.key).sort().join()}}for(const d of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[m][d.tileID.key];v&&v!==d.rttCoords[m]&&(d.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const c=o.type,d=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(Jn[c]&&(this._prevType&&Jn[this._prevType]||this._stacks.push([]),this._prevType=c,this._stacks[this._stacks.length-1].push(o.id),!m))return!0;if(Jn[this._prevType]||Jn[c]&&m){this._prevType=c;const v=this._stacks.length-1,D=this._stacks[v]||[];for(const S of this._renderableTiles){if(this.pool.isFull()&&(Xt(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(S),S.rtt[v]){const A=this.pool.getObjectForId(S.rtt[v].id);if(A.stamp===S.rtt[v].stamp){this.pool.useObject(A);continue}}const E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),S.rtt[v]={id:E.id,stamp:E.stamp},d.context.bindFramebuffer.set(E.fbo.framebuffer),d.context.clear({color:g.aT.transparent,stencil:0}),d.currentStencilSource=void 0;for(let A=0;A<D.length;A++){const k=d.style._layers[D[A]],O=k.source?this._coordsDescendingInv[k.source][S.tileID.key]:[S.tileID];d.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),d._renderTileClippingMasks(k,O),d.renderLayer(d,d.style.sourceCaches[k.source],k,O),k.source&&(S.rttCoords[k.source]=this._coordsDescendingInvStr[k.source][S.tileID.key])}}return Xt(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Jn[c]}return!1}}const rt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:g.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Fi=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Qi={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ws{constructor(o,c,d=!1){this.mousedown=D=>{this.startMouse(g.e({},D,{ctrlKey:!0,preventDefault:()=>D.preventDefault()}),ye.mousePos(this.element,D)),ye.addEventListener(window,"mousemove",this.mousemove),ye.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=D=>{this.moveMouse(D,ye.mousePos(this.element,D))},this.mouseup=D=>{this.mouseRotate.dragEnd(D),this.mousePitch&&this.mousePitch.dragEnd(D),this.offTemp()},this.touchstart=D=>{1!==D.targetTouches.length?this.reset():(this._startPos=this._lastPos=ye.touchPos(this.element,D.targetTouches)[0],this.startTouch(D,this._startPos),ye.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ye.addEventListener(window,"touchend",this.touchend))},this.touchmove=D=>{1!==D.targetTouches.length?this.reset():(this._lastPos=ye.touchPos(this.element,D.targetTouches)[0],this.moveTouch(D,this._lastPos))},this.touchend=D=>{0===D.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=o.dragRotate._mouseRotate.getClickTolerance(),v=o.dragRotate._mousePitch.getClickTolerance();this.element=c,this.mouseRotate=ka({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:D,clickTolerance:S,bearingDegreesPerPixelMoved:E=.8})=>{const A=new oh;return new go({clickTolerance:S,move:(k,O)=>({bearingDelta:(O.x-k.x)*E}),moveStateManager:A,enable:D,assignEvents:Fi})})({clickTolerance:m,enable:!0}),this.map=o,d&&(this.mousePitch=Bo({clickTolerance:v,enable:!0}),this.touchPitch=(({enable:D,clickTolerance:S,pitchDegreesPerPixelMoved:E=-.5})=>{const A=new oh;return new go({clickTolerance:S,move:(k,O)=>({pitchDelta:(O.y-k.y)*E}),moveStateManager:A,enable:D,assignEvents:Fi})})({clickTolerance:v,enable:!0})),ye.addEventListener(c,"mousedown",this.mousedown),ye.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),ye.addEventListener(c,"touchcancel",this.reset)}startMouse(o,c){this.mouseRotate.dragStart(o,c),this.mousePitch&&this.mousePitch.dragStart(o,c),ye.disableDrag()}startTouch(o,c){this.touchRotate.dragStart(o,c),this.touchPitch&&this.touchPitch.dragStart(o,c),ye.disableDrag()}moveMouse(o,c){const d=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(o,c)||{};if(m&&d.setBearing(d.getBearing()+m),this.mousePitch){const{pitchDelta:v}=this.mousePitch.dragMove(o,c)||{};v&&d.setPitch(d.getPitch()+v)}}moveTouch(o,c){const d=this.map,{bearingDelta:m}=this.touchRotate.dragMove(o,c)||{};if(m&&d.setBearing(d.getBearing()+m),this.touchPitch){const{pitchDelta:v}=this.touchPitch.dragMove(o,c)||{};v&&d.setPitch(d.getPitch()+v)}}off(){const o=this.element;ye.removeEventListener(o,"mousedown",this.mousedown),ye.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),ye.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ye.removeEventListener(window,"touchend",this.touchend),ye.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){ye.enableDrag(),ye.removeEventListener(window,"mousemove",this.mousemove),ye.removeEventListener(window,"mouseup",this.mouseup),ye.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ye.removeEventListener(window,"touchend",this.touchend)}}let Cn;function Ft(y,o,c){if(y=new g.L(y.lng,y.lat),o){const d=new g.L(y.lng-360,y.lat),m=new g.L(y.lng+360,y.lat),v=c.locationPoint(y).distSqr(o);c.locationPoint(d).distSqr(o)<v?y=d:c.locationPoint(m).distSqr(o)<v&&(y=m)}for(;Math.abs(y.lng-c.center.lng)>180;){const d=c.locationPoint(y);if(d.x>=0&&d.y>=0&&d.x<=c.width&&d.y<=c.height)break;y.lng>c.center.lng?y.lng-=360:y.lng+=360}return y}const Ji={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function hc(y,o,c){const d=y.classList;for(const m in Ji)d.remove(`maplibregl-${c}-anchor-${m}`);d.add(`maplibregl-${c}-anchor-${o}`)}class ds extends g.E{constructor(o){if(super(),this._onKeyPress=c=>{const d=c.code,m=c.charCode||c.keyCode;"Space"!==d&&"Enter"!==d&&32!==m&&13!==m||this.togglePopup()},this._onMapClick=c=>{const d=c.originalEvent.target,m=this._element;this._popup&&(d===m||m.contains(d))&&this.togglePopup()},this._update=c=>{if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();("terrain"===c?.type||"render"===c?.type&&!d)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Ft(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let m="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?m=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?v="rotateX(0deg)":"map"===this._pitchAlignment&&(v=`rotateX(${this._map.getPitch()}deg)`),c&&"moveend"!==c.type||(this._pos=this._pos.round()),ye.setTransform(this._element,`${Ji[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${m}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const D=this._map.unproject(this._pos),S=40075016.686*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=D.distanceTo(this._lngLat)>20*S?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=c=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new g.k("dragstart"))),this.fire(new g.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new g.k("dragend")),this._state="inactive"},this._addDragHandler=c=>{this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=g.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=ye.create("div"),this._element.setAttribute("aria-label","Map marker");const c=ye.createNS("http://www.w3.org/2000/svg","svg"),d=41,m=27;c.setAttributeNS(null,"display","block"),c.setAttributeNS(null,"height",`${d}px`),c.setAttributeNS(null,"width",`${m}px`),c.setAttributeNS(null,"viewBox",`0 0 ${m} ${d}`);const v=ye.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const D=ye.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill-rule","nonzero");const S=ye.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const se of E){const de=ye.createNS("http://www.w3.org/2000/svg","ellipse");de.setAttributeNS(null,"opacity","0.04"),de.setAttributeNS(null,"cx","10.5"),de.setAttributeNS(null,"cy","5.80029008"),de.setAttributeNS(null,"rx",se.rx),de.setAttributeNS(null,"ry",se.ry),S.appendChild(de)}const A=ye.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const k=ye.createNS("http://www.w3.org/2000/svg","path");k.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(k);const O=ye.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const V=ye.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(V);const Z=ye.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const G=ye.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Y=ye.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#000000"),Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962");const H=ye.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#FFFFFF"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962"),G.appendChild(Y),G.appendChild(H),D.appendChild(S),D.appendChild(A),D.appendChild(O),D.appendChild(Z),D.appendChild(G),c.appendChild(D),c.setAttributeNS(null,"height",d*this._scale+"px"),c.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(c),this._offset=g.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",c=>{c.preventDefault()}),this._element.addEventListener("mousedown",c=>{c.preventDefault()}),hc(this._element,this._anchor,"marker"),o&&o.className)for(const c of o.className.split(" "))this._element.classList.add(c);this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ye.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=g.L.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const m=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(24.6+m)],"bottom-right":[-m,-1*(24.6+m)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(o){return this._offset=g.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Yt={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let pn=0,eo=!1;const Vo={maxWidth:100,unit:"metric"};function qn(y,o,c){const d=c&&c.maxWidth||100,m=y._container.clientHeight/2,v=y.unproject([0,m]),D=y.unproject([d,m]),S=v.distanceTo(D);if(c&&"imperial"===c.unit){const E=3.2808*S;E>5280?Ra(o,d,E/5280,y._getUIString("ScaleControl.Miles")):Ra(o,d,E,y._getUIString("ScaleControl.Feet"))}else c&&"nautical"===c.unit?Ra(o,d,S/1852,y._getUIString("ScaleControl.NauticalMiles")):S>=1e3?Ra(o,d,S/1e3,y._getUIString("ScaleControl.Kilometers")):Ra(o,d,S,y._getUIString("ScaleControl.Meters"))}function Ra(y,o,c,d){const m=function(v){const D=Math.pow(10,`${Math.floor(v)}`.length-1);let S=v/D;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(E){const A=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*A)/A}(S),D*S}(c);y.style.width=o*(m/c)+"px",y.innerHTML=`${m}&nbsp;${d}`}const Fr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Sr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ps(y){if(y){if("number"==typeof y){const o=Math.round(Math.abs(y)/Math.SQRT2);return{center:new g.P(0,0),top:new g.P(0,y),"top-left":new g.P(o,o),"top-right":new g.P(-o,o),bottom:new g.P(0,-y),"bottom-left":new g.P(o,-o),"bottom-right":new g.P(-o,-o),left:new g.P(y,0),right:new g.P(-y,0)}}if(y instanceof g.P||Array.isArray(y)){const o=g.P.convert(y);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:g.P.convert(y.center||[0,0]),top:g.P.convert(y.top||[0,0]),"top-left":g.P.convert(y["top-left"]||[0,0]),"top-right":g.P.convert(y["top-right"]||[0,0]),bottom:g.P.convert(y.bottom||[0,0]),"bottom-left":g.P.convert(y["bottom-left"]||[0,0]),"bottom-right":g.P.convert(y["bottom-right"]||[0,0]),left:g.P.convert(y.left||[0,0]),right:g.P.convert(y.right||[0,0])}}return ps(new g.P(0,0))}const jo={extend:(y,...o)=>g.e(y,...o),run(y){y()},logToElement(y,o=!1,c="log"){const d=window.document.getElementById(c);d&&(o&&(d.innerHTML=""),d.innerHTML+=`<br>${y}`)}};class Mt{static get version(){return"3.5.2"}static get workerCount(){return Ei.workerCount}static set workerCount(o){Ei.workerCount=o}static get maxParallelImageRequests(){return g.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(o){g.c.MAX_PARALLEL_IMAGE_REQUESTS=o}static get workerUrl(){return g.c.WORKER_URL}static set workerUrl(o){g.c.WORKER_URL=o}static addProtocol(o,c){g.c.REGISTERED_PROTOCOLS[o]=c}static removeProtocol(o){delete g.c.REGISTERED_PROTOCOLS[o]}}return Mt.Map=class extends Vn{constructor(y){if(g.bf.mark(g.bg.create),null!=(y=g.e({},rt,y)).minZoom&&null!=y.maxZoom&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=y.minPitch&&null!=y.maxPitch&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=y.minPitch&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=y.maxPitch&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new yl(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._cooperativeGesturesOnWheel=o=>{this._onCooperativeGesture(o,o[this._metaKey],1)},this._contextLost=o=>{o.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new g.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new g.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._cooperativeGestures=y.cooperativeGestures,this._metaKey=0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey",this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new vt,this._controls=[],this._mapId=g.a2(),this._locale=g.e({},Gs,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=Zr.addThrottleControl(()=>this.isMoving()),this._requestManager=new Kl(y.transformRequest),"string"==typeof y.container){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const c=Yr(d=>{this._trackResize&&!this._removed&&this.resize(d)._update()},50);this._resizeObserver=new ResizeObserver(d=>{o?c(d):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new hs(this,y),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=y.hash&&new Lo("string"==typeof y.hash&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,g.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new Qn({customAttribution:y.customAttribution})),y.maplibreLogo&&this.addControl(new tn,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update("style"===o.dataType),this.fire(new g.k(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new g.k(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new g.k("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(y,o){if(void 0===o&&(o=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new g.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=y.onAdd(this);this._controls.push(y);const d=this._controlPositions[o];return-1!==o.indexOf("bottom")?d.insertBefore(c,d.firstChild):d.appendChild(c),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new g.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(y);return o>-1&&this._controls.splice(o,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,o,c,d){return null==d&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(c,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,o,c,d)}resize(y){var o;const c=this._containerDimensions(),d=c[0],m=c[1],v=this._getClampedPixelRatio(d,m);if(this._resizeCanvas(d,m,v),this.painter.resize(d,m,v),this.painter.overLimit()){const S=this.painter.context.gl;this._maxCanvasSize=[S.drawingBufferWidth,S.drawingBufferHeight];const E=this._getClampedPixelRatio(d,m);this._resizeCanvas(d,m,E),this.painter.resize(d,m,E)}this.transform.resize(d,m),null===(o=this._requestedCameraState)||void 0===o||o.resize(d,m);const D=!this._moving;return D&&(this.stop(),this.fire(new g.k("movestart",y)).fire(new g.k("move",y))),this.fire(new g.k("resize",y)),D&&this.fire(new g.k("moveend",y)),this}_getClampedPixelRatio(y,o){const{0:c,1:d}=this._maxCanvasSize,m=this.getPixelRatio(),v=y*m,D=o*m;return Math.min(v>c?c/v:1,D>d?d/D:1)*m}getPixelRatio(){var y;return null!==(y=this._overridePixelRatio)&&void 0!==y?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(yn.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(y){return this._cooperativeGestures=y,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(y){return this.transform.locationPoint(g.L.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(g.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||(null===(y=this.handlers)||void 0===y?void 0:y.isMoving())}isZooming(){var y;return this._zooming||(null===(y=this.handlers)||void 0===y?void 0:y.isZooming())}isRotating(){var y;return this._rotating||(null===(y=this.handlers)||void 0===y?void 0:y.isRotating())}_createDelegatedListener(y,o,c){if("mouseenter"===y||"mouseover"===y){let d=!1;return{layer:o,listener:c,delegates:{mousemove:v=>{const D=this.getLayer(o)?this.queryRenderedFeatures(v.point,{layers:[o]}):[];D.length?d||(d=!0,c.call(this,new bi(y,this,v.originalEvent,{features:D}))):d=!1},mouseout:()=>{d=!1}}}}if("mouseleave"===y||"mouseout"===y){let d=!1;return{layer:o,listener:c,delegates:{mousemove:D=>{(this.getLayer(o)?this.queryRenderedFeatures(D.point,{layers:[o]}):[]).length?d=!0:d&&(d=!1,c.call(this,new bi(y,this,D.originalEvent)))},mouseout:D=>{d&&(d=!1,c.call(this,new bi(y,this,D.originalEvent)))}}}}{const d=m=>{const v=this.getLayer(o)?this.queryRenderedFeatures(m.point,{layers:[o]}):[];v.length&&(m.features=v,c.call(this,m),delete m.features)};return{layer:o,listener:c,delegates:{[y]:d}}}}on(y,o,c){if(void 0===c)return super.on(y,o);const d=this._createDelegatedListener(y,o,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(d);for(const m in d.delegates)this.on(m,d.delegates[m]);return this}once(y,o,c){if(void 0===c)return super.once(y,o);const d=this._createDelegatedListener(y,o,c);for(const m in d.delegates)this.once(m,d.delegates[m]);return this}off(y,o,c){return void 0===c?super.off(y,o):(this._delegatedListeners&&this._delegatedListeners[y]&&(d=>{const m=this._delegatedListeners[y];for(let v=0;v<m.length;v++){const D=m[v];if(D.layer===o&&D.listener===c){for(const S in D.delegates)this.off(S,D.delegates[S]);return m.splice(v,1),this}}})(),this)}queryRenderedFeatures(y,o){if(!this.style)return[];let c;const d=y instanceof g.P||Array.isArray(y),m=d?y:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(d?{}:y)||{},m instanceof g.P||"number"==typeof m[0])c=[g.P.convert(m)];else{const v=g.P.convert(m[0]),D=g.P.convert(m[1]);c=[v,new g.P(D.x,v.y),D,new g.P(v.x,D.y),v]}return this.style.queryRenderedFeatures(c,o,this.transform)}querySourceFeatures(y,o){return this.style.querySourceFeatures(y,o)}setStyle(y,o){return!1!==(o=g.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(y,o))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const o=this._locale[y];if(null==o)throw new Error(`Missing UI string '${y}'`);return o}_updateStyle(y,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,o));const c=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new wr(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof y?this.style.loadURL(y,o,c):this.style.loadJSON(y,o,c),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new wr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,o){if("string"==typeof y){const c=this._requestManager.transformRequest(y,Yn.Style);g.f(c,(d,m)=>{d?this.fire(new g.j(d)):m&&this._updateDiff(m,o)})}else"object"==typeof y&&this._updateDiff(y,o)}_updateDiff(y,o){try{this.style.setState(y,o)&&this._update(!0)}catch(c){g.w(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(y,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():g.w("There is no style added to the map.")}addSource(y,o){return this._lazyInitEmptyStyle(),this.style.addSource(y,o),this._update(!0)}isSourceLoaded(y){const o=this.style&&this.style.sourceCaches[y];if(void 0!==o)return o.loaded();this.fire(new g.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const o=this.style.sourceCaches[y.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);for(const c in this.style._layers){const d=this.style._layers[c];"hillshade"===d.type&&d.source===y.source&&g.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new jn(this.painter,o,y),this.painter.renderToTexture=new wi(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=c=>{"style"===c.dataType?this.terrain.sourceCache.freeRtt():"source"===c.dataType&&c.tile&&(c.sourceId!==y.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(c.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new g.k("terrain",{terrain:y})),this}getTerrain(){var y,o;return null!==(o=null===(y=this.terrain)||void 0===y?void 0:y.options)&&void 0!==o?o:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const o in y){const c=y[o]._tiles;for(const d in c){const m=c[d];if("loaded"!==m.state&&"errored"!==m.state)return!1}}return!0}addSourceType(y,o,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(y,o,c)}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,o,c={}){const{pixelRatio:d=1,sdf:m=!1,stretchX:v,stretchY:D,content:S}=c;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||g.a(o))){if(void 0===o.width||void 0===o.height)return this.fire(new g.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:A,data:k}=o,O=o;return this.style.addImage(y,{data:new g.R({width:E,height:A},new Uint8Array(k)),pixelRatio:d,stretchX:v,stretchY:D,content:S,sdf:m,version:0,userImage:O}),O.onAdd&&O.onAdd(this,y),this}}{const{width:E,height:A,data:k}=g.h.getImageData(o);this.style.addImage(y,{data:new g.R({width:E,height:A},k),pixelRatio:d,stretchX:v,stretchY:D,content:S,sdf:m,version:0})}}updateImage(y,o){const c=this.style.getImage(y);if(!c)return this.fire(new g.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=o instanceof HTMLImageElement||g.a(o)?g.h.getImageData(o):o,{width:m,height:v,data:D}=d;if(void 0===m||void 0===v)return this.fire(new g.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==c.data.width||v!==c.data.height)return this.fire(new g.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(o instanceof HTMLImageElement||g.a(o));return c.data.replace(D,S),this.style.updateImage(y,c),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new g.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y,o){Zr.getImage(this._requestManager.transformRequest(y,Yn.Image),o)}listImages(){return this.style.listImages()}addLayer(y,o){return this._lazyInitEmptyStyle(),this.style.addLayer(y,o),this._update(!0)}moveLayer(y,o){return this.style.moveLayer(y,o),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}setLayerZoomRange(y,o,c){return this.style.setLayerZoomRange(y,o,c),this._update(!0)}setFilter(y,o,c={}){return this.style.setFilter(y,o,c),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,o,c,d={}){return this.style.setPaintProperty(y,o,c,d),this._update(!0)}getPaintProperty(y,o){return this.style.getPaintProperty(y,o)}setLayoutProperty(y,o,c,d={}){return this.style.setLayoutProperty(y,o,c,d),this._update(!0)}getLayoutProperty(y,o){return this.style.getLayoutProperty(y,o)}setGlyphs(y,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,o,c={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,o,c,d=>{d||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,o,c=>{c||this._update(!0)}),this}setLight(y,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,o){return this.style.setFeatureState(y,o),this._update()}removeFeatureState(y,o){return this.style.removeFeatureState(y,o),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,o=0;return this._container&&(y=this._container.clientWidth||400,o=this._container.clientHeight||300),[y,o]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const o=this._canvasContainer=ye.create("div","maplibregl-canvas-container",y);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=ye.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const c=this._containerDimensions(),d=this._getClampedPixelRatio(c[0],c[1]);this._resizeCanvas(c[0],c[1],d);const m=this._controlContainer=ye.create("div","maplibregl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(D=>{v[D]=ye.create("div",`maplibregl-ctrl-${D} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=ye.create("div","maplibregl-cooperative-gesture-screen",this._container);let y="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";0===navigator.platform.indexOf("Mac")&&(y="boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`\n            <div class="maplibregl-desktop-message">${y}</div>\n            <div class="maplibregl-mobile-message">${"boolean"!=typeof this._cooperativeGestures&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>\n        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){ye.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(y,o,c){this._canvas.width=Math.floor(c*y),this._canvas.height=Math.floor(c*o),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",d=>{o={requestedAttributes:y},d&&(o.statusMessage=d.statusMessage,o.type=d.type)},{once:!0});const c=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!c){const d="Failed to initialize WebGL";throw o?(o.message=d,new Error(JSON.stringify(o))):new Error(d)}this.painter=new Nt(c,this.transform),ji.testSupport(c)}_onCooperativeGesture(y,o,c){return!o&&c<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let c=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,v=g.h.now();this.style.zoomHistory.update(m,v);const D=new g.a8(m,{now:v,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),S=D.crossFadingFactor();1===S&&S===this._crossFadingFactor||(c=!0,this._crossFadingFactor=S),this.style.update(D)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new g.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,g.bf.mark(g.bg.load),this.fire(new g.k("load"))),this.style&&(this.style.hasTransitions()||c)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new g.k("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,g.bf.mark(g.bg.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Zr.removeThrottleControl(this._imageQueueHandle),null===(y=this._resizeObserver)||void 0===y||y.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ye.remove(this._canvasContainer),ye.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),g.bf.clearMetrics(),this._removed=!0,this.fire(new g.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=g.h.frame(y=>{g.bf.frame(y),this._frame=null,this._render(y)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return"3.5.2"}getCameraTargetElevation(){return this.transform.elevation}},Mt.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const o=this._map.getZoom(),c=o===this._map.getMaxZoom(),d=o===this._map.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,c)=>{const d=this._map._getUIString(`NavigationControl.${c}`);o.title=d,o.setAttribute("aria-label",d)},this.options=g.e({},Qi,y),this._container=ye.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),ye.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),ye.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=ye.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ws(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ye.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,o){const c=ye.create("button",y,this._container);return c.type="button",c.addEventListener("click",o),c}},Mt.GeolocateControl=class extends g.E{constructor(y){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new g.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(o),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new g.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const c=new g.L(o.coords.longitude,o.coords.latitude),d=o.coords.accuracy,m=this._map.getBearing(),v=g.e({bearing:m},this.options.fitBoundsOptions),D=yn.fromLngLat(c,d);this._map.fitBounds(D,v,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const c=new g.L(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(1===o.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===o.code&&eo)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new g.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=o=>{if(this._map){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=ye.create("button","maplibregl-ctrl-geolocate",this._container),ye.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===o){g.w("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=c,this._geolocateButton.setAttribute("aria-label",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ye.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ds({element:this._dotElement}),this._circleElement=ye.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ds({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||"ACTIVE_LOCK"!==this._watchState||c.originalEvent&&"resize"===c.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new g.k("trackuserlocationend")))})}},this.options=g.e({},Yt,y)}onAdd(y){return this._map=y,this._container=ye.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(o,c=!1){void 0===Cn||c?void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(d=>{Cn="denied"!==d.state,o(Cn)}).catch(()=>{Cn=!!window.navigator.geolocation,o(Cn)}):(Cn=!!window.navigator.geolocation,o(Cn)):o(Cn)}(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ye.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,pn=0,eo=!1}_isOutOfMapMaxBounds(y){const o=this._map.getMaxBounds(),c=y.coords;return o&&(c.longitude<o.getWest()||c.longitude>o.getEast()||c.latitude<o.getSouth()||c.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),o=y.getSouthEast(),c=y.getNorthEast(),d=o.distanceTo(c),m=Math.ceil(this._accuracy/(d/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return g.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new g.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":pn--,eo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new g.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new g.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),pn++,pn>1?(y={maximumAge:6e5,timeout:0},eo=!0):(y=this.options.positionOptions,eo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Mt.AttributionControl=Qn,Mt.LogoControl=tn,Mt.ScaleControl=class{constructor(y){this._onMove=()=>{qn(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,qn(this._map,this._container,this.options)},this.options=g.e({},Vo,y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=ye.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ye.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Mt.FullscreenControl=class extends g.E{constructor(y={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:g.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=ye.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ye.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=ye.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ye.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new g.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new g.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Mt.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=y}onAdd(y){return this._map=y,this._container=ye.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ye.create("button","maplibregl-ctrl-terrain",this._container),ye.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ye.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Mt.Popup=class extends g.E{constructor(y){super(),this.remove=()=>(this._content&&ye.remove(this._content),this._container&&(ye.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new g.k("close")),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ye.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ye.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const D of this.options.className.split(" "))this._container.classList.add(D);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ft(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!o)return;const c=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);let d=this.options.anchor;const m=ps(this.options.offset);if(!d){const D=this._container.offsetWidth,S=this._container.offsetHeight;let E;E=c.y+m.bottom.y<S?["top"]:c.y>this._map.transform.height-S?["bottom"]:[],c.x<D/2?E.push("left"):c.x>this._map.transform.width-D/2&&E.push("right"),d=0===E.length?"bottom":E.join("-")}const v=c.add(m[d]).round();ye.setTransform(this._container,`${Ji[d]} translate(${v.x}px,${v.y}px)`),hc(this._container,d,"popup")},this._onClose=()=>{this.remove()},this.options=g.e(Object.create(Fr),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new g.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=g.L.convert(y),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const o=document.createDocumentFragment(),c=document.createElement("body");let d;for(c.innerHTML=y;d=c.firstChild,d;)o.appendChild(d);return this.setDOMContent(o)}getMaxWidth(){var y;return null===(y=this._container)||void 0===y?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ye.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}_createCloseButton(){this.options.closeButton&&(this._closeButton=ye.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Sr);y&&y.focus()}},Mt.Marker=ds,Mt.Style=wr,Mt.LngLat=g.L,Mt.LngLatBounds=yn,Mt.Point=g.P,Mt.MercatorCoordinate=g.U,Mt.Evented=g.E,Mt.AJAXError=g.bh,Mt.config=g.c,Mt.CanvasSource=po,Mt.GeoJSONSource=_n,Mt.ImageSource=Si,Mt.RasterDEMTileSource=Ps,Mt.RasterTileSource=As,Mt.VectorTileSource=dr,Mt.VideoSource=rn,Mt.setRTLTextPlugin=g.bi,Mt.getRTLTextPluginStatus=g.bj,Mt.prewarm=function(){el().acquire(Ut)},Mt.clearPrewarmedResources=function(){const y=qi;y&&(y.isPreloaded()&&1===y.numActive()?(y.release(Ut),qi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},jo.extend(Mt,{isSafari:g.ac,getPerformanceMetrics:g.bf.getPerformanceMetrics}),Mt}),hn}()}},Ed=>{Ed(Ed.s=738)}]);